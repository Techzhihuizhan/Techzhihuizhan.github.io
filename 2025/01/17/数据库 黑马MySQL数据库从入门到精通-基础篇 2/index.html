<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>黑马MySQL数据库从入门到精通-基础篇 2 | Tech智汇站</title><meta name="keywords" content="大数据"><meta name="author" content="智汇君"><meta name="copyright" content="智汇君"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="黑马MySQL数据库从入门到精通-基础篇 2"><meta name="application-name" content="黑马MySQL数据库从入门到精通-基础篇 2"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="黑马MySQL数据库从入门到精通-基础篇 2"><meta property="og:url" content="http://example.com/2025/01/17/数据库 黑马MySQL数据库从入门到精通-基础篇 2/index.html"><meta property="og:site_name" content="Tech智汇站"><meta property="og:description" content="游标1游标(CURSOR)是用来存储查询结果集的数据类型，在存储过程和函数中可以使用游标对结果集进行循环的处理。游标的使用包括游标的声明、OPEN、FETCH和 CLOSE，其语法分别如下。  用法1234567891011声明游标DECLARE 游标名称 CURSOR FOR 查询语句;打开游标O"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http://example.com/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg"><meta property="article:author" content="智汇君"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://example.com/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg"><meta name="description" content="游标1游标(CURSOR)是用来存储查询结果集的数据类型，在存储过程和函数中可以使用游标对结果集进行循环的处理。游标的使用包括游标的声明、OPEN、FETCH和 CLOSE，其语法分别如下。  用法1234567891011声明游标DECLARE 游标名称 CURSOR FOR 查询语句;打开游标O"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/01/17/%E6%95%B0%E6%8D%AE%E5%BA%93%20%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-%E5%9F%BA%E7%A1%80%E7%AF%87%202/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css#fontawesome_animation 如果有就会加载，示例值：https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"与数百名博主无限进步","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":270},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: 智汇君","link":"链接: ","source":"来源: Tech智汇站","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Tech智汇站',
  title: '黑马MySQL数据库从入门到精通-基础篇 2',
  postAI: '',
  pageFillDescription: '游标, 用法, 案例1, 异常处理程序, 案例2, 案例3, 案例4 异常处理程序, 案例5 带输入参数 in, 案例6 带输出参数 out, 案例7 带输入和输出参数 in out, 案例8 inout, 案例9 事务 异常处理程序, 案例10 复杂案例 异常处理 回滚, 案例, 案例, 存储过程, 介绍, 特点, 基本语法, 创建, 变量, 参数, delimiter, 调用, 查看, 删除, 注意, 存储过程异常处理handler, Prepare、execute、deallocate, 语法, 优点, 疑惑解答, 案例, 存储函数, 语法, 与存储过程的区别, 触发器, 介绍, 语法, insert类型, insert插入之后在其它表插入相关信息, insert插入之前检查数据是否符合规范, update类型, before update, after update, delete类型, after delete, before delete, 变量, 系统变量, 会话变量, 查看, 设置, 全局变量, 用户自定义变量, 赋值, 使用, 注意, 案例, 局部变量, 声明, 赋值, IF条件判断, 语法, 参数, 用法, case, 语法一, 语法二, 循环, while, repeat, loop, 视图, 作用, 优点, 缺点, 语法, 创建, 通过视图变更数据, 插入, WITH CHECK OPTION, 删除, 注意, 临时表, 语法, 注意游标游标是用来存储查询结果集的数据类型在存储过程和函数中可以使用游标对结果集进行循环的处理游标的使用包括游标的声明和其语法分别如下用法声明游标游标名称查询语句打开游标游标名称获取游标记录游标名称变量变量关闭游标游标名称案例执行创建存储过程命令报错声明变量和声明游标的顺序有要求上面的报错是因为执行存储过程后当游标里的数据遍历完成后由于是死循环当无数据时也执行导致报错异常处理程序上图是对前面的案例的改进案例创建存储过程里面使用游标对每一行进行数据修改案例创建存储过程里面使用游标对小于的进行删除案例异常处理程序定义一个来存储商品名称的拼接定义一个变量来接收每次游标的商品名称定义变量默认值为查询所有的商品名称放入游标中表示该变量为游标类型游标遍历结束会出现设置的值为打开游标弹出游标的一条数据赋值给拼接字符串关闭游标就像中需要关闭一样打印出结果调用案例带输入参数定义一个整形变量将输入参数的值赋给变量执行插入操作调用这个存储过程案例带输出参数调用该存储过程注意输出参数必须是一个带符号的变量查询刚刚在存储过程中使用到的变量案例带输入和输出参数用符号加变量名的方式定义一个变量与类似语句体内可以执行多条但必须以分号分隔调用该存储过程注意输入参数是一个值而输出参数则必须是一个带符号的变量案例这里需要先设置一个已赋值的变量然后再作为参数传入案例事务异常处理程序存储过程异常处理发生异常时程序继续并设置开启事务苹果主键冲突出现异常事务回滚回滚提交调用查看结果案例复杂案例异常处理回滚编写取消订单的存储过程输入参数为订单输出参数为代表存储过程成功代表存储过程出现异常如果出现异常设置返回值为开启事务设置初始值这里设置为修改订单状态定义变量用来判断定义变量来接收游标的商品定义变量来接收游标的商品数量定义游标存储根据订单查询到订单项中的商品与数量当游标循环结束设置的值为打开游标循环将游标的值设置到变量中判断不然会多修改一次没有出现异常就提交测试查看结果案例参考传入参数分类创建临时表用来存储所有的临时表在链接结束会自动删除清空该表临时表用来存储所有的商品信息根据分类查询商品的时候商品展示列表只需要这几个字段就可以了详情的时候才是所有字段调用另外的存储过程设置循环条件设置来接收游标中弹出的递归过程将所有的放在临时表中现在查出放在游标中当游标遍历结束打开游标弹出游标一个值赋给根据分类查找到商品插入数据到商品临时表中返回查询到的商品结果集定义接收每次查询到的分类定义为继续循环定义游标来获得为传入的的集合游标循环结束出现循环结束递归的时候需要设置深度将插入临时表中打开游标将查询到的游标结果弹出赋值给每次弹出一个递归调用当前存储过程案例传入参数分类创建临时表用来存储所有的临时表在链接结束会自动删除清空该表临时表用来存储所有的商品信息根据分类查询商品的时候商品展示列表只需要这几个字段就可以了详情的时候才是所有字段调用另外的存储过程设置循环条件设置来接收游标中弹出的递归过程将所有的放在临时表中现在查出放在游标中当游标遍历结束打开游标弹出游标一个值赋给根据分类查找到商品插入数据到商品临时表中返回查询到的商品结果集定义接收每次查询到的分类定义为继续循环定义游标来获得为传入的的集合游标循环结束出现循环结束递归的时候需要设置深度将插入临时表中打开游标将查询到的游标结果弹出赋值给每次弹出一个递归调用当前存储过程存储过程参考参考介绍存储过程是事先经过编译并存储在数据库中的一段语句的集合调用存储过程可以简化应用开发人员的很多工作减少数据在数据库和应用服务器之间的传输对于提高数据处理的效率是有好处的存储过程思想上很简单就是数据库语言层面的代码封装与重用特点封装复用更加安全可以接收参数也可以返回数据减少网络交互效率提升可以实现复杂的操作比如包含逻辑语句等基本语法创建变量声明局部变量要在存储过程中声明一个变量可以使用语句赋值要为变量分配一个值可以使用语句或者使用语句将查询的结果分配给一个变量或者变量范围作用域一个变量有自己的范围作用域它用来定义它的生命周期如果在存储过程中声明一个变量那么当达到存储过程的语句时它将超出范围因此在其它代码块中无法访问如果您在块内声明一个变量那么如果达到它将超出范围可以在不同的作用域中声明具有相同名称的两个或多个变量因为变量仅在自己的作用域中有效但是在不同范围内声明具有相同名称的变量不是很好的编程习惯以符号开头的变量是会话变量直到会话结束前它可用和可访问参数在中参数有三种模式或是默认模式可写可不写在存储过程中定义参数时调用程序必须将参数传递给存储过程另外参数的值被保护这意味着即使在存储过程中更改了参数的值在存储过程结束后仍保留其原始值换句话说存储过程只使用参数的副本可以在存储过程中更改参数的值并将其更改后新值传递回调用程序请注意存储过程在启动时无法访问参数的初始值参数是和参数的组合这意味着调用程序可以传递参数并且存储过程可以修改参数并将新值传递回调用程序中的默认的语句结束符为分号但是例如我们需要在命令行输入较复杂的语句时如存储过程存储函数等可能包含多行语句或者语句中包含分号那么在遇到第一个分号时就会执行就是用于修改语句结束符使得在正确编写完语句后再执行其中定好结束符为然后最后又定义为这样只有当出现之后解释器才会执行这段语句查看会话变量调用查看查询指定数库的存储过程及状态信息存储过程名称查询某个存储过程的定义删除存储过程名称注意注意在命令行中执行创建存储过程的时需要通过关键字指定语句的结束符存储过程异常处理当出现异常的时候跳出存储过程并设置值为当出现异常的时候继续存储过程并设置值为继续退出执行处理器异常注意异常情况可以写异常错误码异常别名或码操作继续退出撤销异常情况列表继续执行当前程序终止执行当前程序状态码如所有以开头的代码的简写所有以开头的代码的简写所有没有被或捕获的代码的简写语法你的语句变量存放如果有参数的话这里的只能是会话变量预定义好执行预定义的释放掉数据库连接语句准备好一条语句并分配给这条语句一个名字供之后调用准备好的语句通过命令执行通过命令释放掉准备好的语句名字可以是字符串也可以是用户指定的包含文本的变量中的文本必须代表一条单独的语句而不能是多条语句在语句中字符用来作为后面执行查询使用的一个参数使用预处理语句时要使用的是用户变量使用方式声明不同于局部变量定义的变量优点他还可以在存储过程中动态的拼接表名字段名来达到动态查询的效果语句中还可以用来代表参数这样可以有效的防止注入注入疑惑解答疑惑解答的解析器要求语句中的标识符表名字段名必须在编译时确定普通等语句在存储过程中是静态其结构包括标识符必须是固定字符串案例预定义传入两个会话变量来填充中的释放连接传入一个字符串如果临时表存在先删除掉创建临时表的语法我们把传入的参数拼接进来执行第一种使用方式使用传入参数第二种使用方式你的分表格式前缀加日期最终要执行的语句最终执行语句释放资源说明最终要执行的语句要看你自己的业务了我这里只是计算一个均值直接使用了函数把语句依次拼接完整存储函数存储函数是有返回值的存储过程存储函数的参数只能是类型的是一种允许用户扩展功能的机制用户可以在查询中直接调用这些函数实现特定的业务逻辑语法存储函数名称参数列表返回值类型语句与存储过程的区别存储函数只能返回一个值而存储过程可以返回零个或多个值存储函数可以作为查询语句的一部分来调用而存储过程则一般需要通过语句来调用存储函数只能有输入参数且参数名不能带关键字而存储过程可以有输入输出或输入输出参数存储过程的功能更强大可以实现复杂的业务逻辑包括数据修改操作如而存储函数则主要用于计算和返回一个值对数据库表的直接操作较少报错是因为版本问题触发器参考介绍触发器是与表有关的数据库对象指在之前或之后触发并执行触发器中定义的语句集合触发器的这种特性可以协助应用在数据库端确保数据的完整性日志记录数据校验等操作使用别名和来引用触发器中发生变化的记录内容这与其他的数据库是相似的现在触发器还只支持行级触发不支持语句级触发行级触发器影响多少行就触发多少次语句级触发器不管影响多少行数据只触发一次语法行级触发器当前数据库触发器类型插入之后在其它表插入相关信息账户创建成功特别适合这种状态变更的关联写入操作比如开户暂停注销等各类状态变更插入之前检查数据是否符合规范你输入的销售总额超过元类型触发器与触发器非常类似我们可以使用触发器在更新数据之前先做一次业务逻辑检测避免发生误操作级别客户不能降级为普通级别客户多用于记录在管理系统多操作者使用的环境中管理员需要设置操作记录以便在出问题时可以查看操作者对表编辑的操作可追根溯源下面的就是前面说的行级触发器问题了影响多少行就触发多少次触发器将监测用户更新前的销售总额更新后的销售总额操作者修改时间等信息作为存入表中使用以下命令建立这个记录触发器类型触发器的另一个用途是在删除主表中的数据后与这个主表关联的数据一起自动删除我们来看一下这个触发器如何创建这些类型的触发器通常用于在不同的相关表上强制执行参照完整性的应用场景通常是确保有关联的数据不被错误的误删除掉例如表通过与表相关联如果操作者删除了表中的一条数据那么表中某些数据就失去了关联线索为了避免这种情况的发生我们需要创建一个触发器防止记录被误删除这位客户有相关联的销售记录不能删除不过有时候我们需要删除主数据后再让系统自动帮我们删除与之相关联的其他所有数据这时我们就要用到这个触发器了变量系统变量会话变量会话变量是由系统提供的只在当前会话连接中有效查看查看所有会话变量查看指定的会话变量修改指定的会话变量设置系统变量名值系统变量名值注意如果没有指定默认是会话变量服务重新启动之后所设置的全局参数会失效要想不失效可以在中配置全局变量全局变量由系统提供整个服务器内有效语法查看全局变量中变量名有的记录查看全局变量的值用户自定义变量用户变量不用提前声明使用即为声明其作用域为当前连接会话赋值字段名表名中没有比较运算符赋值和比较运算符都是这里建议用使用注意注意用户定义的变量无需对其进行声明或初始化只不过获取到的值为案例使用用户变量出参为用户变量赋参数值调用函数查询该用户变量创建一个入参和出参的存储过程传入参数查询员工返回值查询出的值用出参接收并返回调用函数传入参数并声明传入一个用户变量查询用户变量声明一个变量将传入的参数赋值给变量通过查询并返回将传入的与和查询结果字符串做拼接并查询出来拼接字符串声明一个用户变量并赋予参数为调用函数并传入参数值执行结果局部变量局部变量是根据需要定义的在局部生效的变量访问之前需要声明可用作存储过程内的局部变量局部变量的范围是在其内声明的块声明变量名变量类型变量类型就是数据库字段类型等赋值变量名值变量名值字段名变量名表名条件判断语法条件条件可选可选参数用法存储过程名称参数名参数类型语句语法一语法二选循环和与和类似别名条件循环语句别名开始循环指定循环结束条件循环结束查询循环拼接字符串循环类似中的循环是有条件的循环控制语句当满足条件的时候退出循环具体语法为别名循环语句条件别名开始循环结束条件结束结束循环查询字符串拼接结果为死循环需要手动退出循环我们可以使用来退出循环实现简单的循环如果不在逻辑中增加退出循环的条件可以用其来实现简单的死循环可以配合一下两个语句使用配合循环使用退出循环必须用在循环中作用是跳过当前循环剩下的语句直接进入下一次循环别名循环语句别名声明计数器开始循环查询计数器记录的值判断大于等于停止计数计数器自增结束循环声明变量计数器声明字符串容器开始循环计数器自增字符串容器拼接计数器结果计数器如果小于就继续执行计数器如果大于就停止循环停止循环查询字符串容器的拼接结果视图视图是一个虚拟表其内容由查询定义数据库中只存放了视图的定义而并没有存放视图中的数据这些数据存放在原来的表中使用视图查询数据时数据库系统会从原来的表中取出对应的数据因此视图中的数据是依赖于原来的表中的数据的一旦表中的数据发生改变显示在视图中的数据也会发生改变同样对视图的更新会影响到原来表的数据安全原因视图可以隐藏一些数据例如员工信息表可以用视图只显示姓名工龄地址而不显示社会保险号和工资数等这个视图就像一个窗口从中只能看到你想看的数据列作用优点使操作简单化视图需要达到的目的就是所见即所需视图不仅可以简化用户对数据的理解也可以简化他们的操作那些被经常使用的查询可以被定义为视图从而使得用户不必为以后的操作每次指定全部的条件增加数据的安全性通过视图用户只能查询和修改指定的数据指定数据之外的信息用户根本接触不到这样可以防止敏感信息被未授权的用户查看增强机密信息的安全性提高表的逻辑独立性视图可以屏蔽原有表结构变化带来的影响例如原有表增加列和删除未被引用的列对视图不会造成影响同样如果修改表中的某些列可以使用修改视图来解决这些列带来的影响缺点在实际数据表的基础上创建视图那么如果实际数据表的结构变更了我们就需要及时对相关的视图进行相应的维护特别是嵌套的视图就是在视图的基础上创建视图维护会变得比较复杂可读性不好容易变成系统的潜在隐患因为创建视图的查询可能会对字段重命名也可能包含复杂的逻辑这些都会增加维护的成本实际项目中如果视图过多会导致数据库维护成本的问题所以在创建视图的时候你要结合实际项目需求综合考虑视图的优点和不足这样才能正确使用视图使系统整体达到最优语法创建视图是指在已经存在的数据库表上建立视图视图可以建立在一张表中也可以建立在多张表中创建视图需要具有的权限同时应该具有查询涉及的列的权限可以使用语句来查询这些权限信息查询语法如下用户名视图名属性清单语句可选项表示视图选择的算法若加了时还需要用户具有删除视图的权限表示替换已经创建的视图可选项表示更新视图时要保证在该视图的权限范围之内与为可选参数为默认值表示更新视图时要满足所有相关视图和表的条件表示更新视图时满足该视图本身定义的条件即可创建针对别名的处理可以在创建视图的子查询中指定对应的别名也可以在创建视图的视图名称后添加对应的别名字段可以基于视图创建视图通过视图变更数据插入首先是很多张表连接得到的视图成功柴油报错一号柴油第一条语句成功对表进行插入数据可以通过视图插入数据但是只能基于一个基础表进行插入不能跨表更新数据如果在创建视图的时候制定了那么更新数据时不能插入或更新不符合视图限制条件的记录机油此时插入不符合视图条件的会报错此时更新结果不符合视图条件的会报错删除注意在定义视图的语句中包含了子查询而子查询中引用了后面的表视图将不支持在定义视图的语句后的字段列表中使用聚合函数等视图将不支持在定义视图的语句后的字段列表中使用了数学表达式或子查询视图将不支持也不支持使用了数学表达式子查询的字段值在定义视图的时候指定了视图将不支持和操作视图中不包含基表中所有被定义为非空又未指定默认值的列视图将不支持操作在定义视图的语句中使用了联合查询视图将不支持和操作临时表在中临时表是一种特殊的表它用于在当前会话中存储临时数据集这些表在会话结束时自动销毁非常适合存储中间结果集或进行复杂查询时使用语法也可以通过查询结果来创建临时表这样可以直接将查询结果集存储在临时表中而不需要单独插入数据例如注意一旦临时表被创建你就可以像使用普通表一样对其进行各种操作包括插入查询修改和删除数据临时表只在创建它的会话中可见其他会话无法访问如果你需要在多个会话之间共享数据应该使用普通表而不是临时表此外临时表不应与永久表共享相同的名称以避免混淆和数据丢失的风险',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-07-21 11:28:44',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://video-b2g.pages.dev/" title="视频解析"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/视频.png" alt="视频解析"/><span class="back-menu-item-text">视频解析</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://md5-uir.pages.dev/" title="md5值解密"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/MD5.png" alt="md5值解密"/><span class="back-menu-item-text">md5值解密</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://screencheck.pages.dev/#welcome" title="屏幕坏点检查"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/屏幕外观.png" alt="屏幕坏点检查"/><span class="back-menu-item-text">屏幕坏点检查</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://htmleditor-9lo.pages.dev/" title="在线html编辑器"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/html编辑器.png" alt="在线html编辑器"/><span class="back-menu-item-text">在线html编辑器</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">博客</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://ttyong-github-io.pages.dev/" title="旧博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/博客.png" alt="旧博客"/><span class="back-menu-item-text">旧博客</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">Tech智汇站</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/img/%E5%BE%AE%E4%BF%A1%E6%94%B6%E6%AC%BE%E7%A0%81.jpg" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E5%BE%AE%E4%BF%A1%E6%94%B6%E6%AC%BE%E7%A0%81.jpg"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%B6%E6%AC%BE%E7%A0%81.jpg" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%B6%E6%AC%BE%E7%A0%81.jpg"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Git/" style="font-size: 1.05rem;">Git<sup>1</sup></a><a href="/tags/GitHub/" style="font-size: 1.05rem;">GitHub<sup>1</sup></a><a href="/tags/Hexo/" style="font-size: 1.05rem;">Hexo<sup>1</sup></a><a href="/tags/NodeJs/" style="font-size: 1.05rem;">NodeJs<sup>1</sup></a><a href="/tags/git/" style="font-size: 1.05rem;">git<sup>3</sup></a><a href="/tags/github/" style="font-size: 1.05rem;">github<sup>1</sup></a><a href="/tags/idea/" style="font-size: 1.05rem;">idea<sup>1</sup></a><a href="/tags/%E5%85%AC%E8%80%83%E6%9D%A8%E8%80%81%E5%B8%88/" style="font-size: 1.05rem;">公考杨老师<sup>10</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 1.05rem;">博客<sup>1</sup></a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 1.05rem;">大数据<sup>31</sup></a><a href="/tags/%E5%AE%89%E7%9F%A5%E9%B1%BC%E4%B8%BB%E9%A2%98/" style="font-size: 1.05rem;">安知鱼主题<sup>1</sup></a><a href="/tags/%E5%BB%96%E9%9B%AA%E5%B3%B0/" style="font-size: 1.05rem;">廖雪峰<sup>15</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">计算机网络<sup>1</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 1.05rem;">面试<sup>10</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">92</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url">大数据</a><i class="anzhiyufont anzhiyu-icon-angle-right post-meta-separator"></i><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/" itemprop="url">黑马MySQL数据库从入门到精通</a><i class="anzhiyufont anzhiyu-icon-angle-right post-meta-separator"></i><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F/" itemprop="url">数据库系统</a></span></div></div><h1 class="post-title" itemprop="name headline">黑马MySQL数据库从入门到精通-基础篇 2</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="post-meta-icon anzhiyufont anzhiyu-icon-calendar-days"></i><span class="post-meta-label">发表于</span><time itemprop="dateCreated datePublished" datetime="2025-01-17T09:35:02.000Z" title="发表于 2025-01-17 17:35:02">2025-01-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为重庆"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>重庆</span></div></div></div><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/01/17/%E6%95%B0%E6%8D%AE%E5%BA%93%20%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-%E5%9F%BA%E7%A1%80%E7%AF%87%202/"><header><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url">大数据</a><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/" itemprop="url">黑马MySQL数据库从入门到精通</a><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F/" itemprop="url">数据库系统</a><h1 id="CrawlerTitle" itemprop="name headline">黑马MySQL数据库从入门到精通-基础篇 2</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">智汇君</span><time itemprop="dateCreated datePublished" datetime="2025-01-17T09:35:02.000Z" title="undefined 2025-01-17 17:35:02">2025-01-17</time></header><h2 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">游标(CURSOR)是用来存储查询结果集的数据类型，在存储过程和函数中可以使用游标对结果集进行循环的处理。游标的使用包括游标的声明、OPEN、FETCH和 CLOSE，其语法分别如下。</span><br></pre></td></tr></table></figure>

<h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">声明游标</span><br><span class="line">DECLARE 游标名称 CURSOR FOR 查询语句;</span><br><span class="line"></span><br><span class="line">打开游标</span><br><span class="line">OPEN 游标名称;</span><br><span class="line"></span><br><span class="line">获取游标记录</span><br><span class="line">FETCH 游标名称 INTO 变量[,变量];</span><br><span class="line"></span><br><span class="line">关闭游标</span><br><span class="line">CLOSE 游标名称</span><br></pre></td></tr></table></figure>

<h3 id="案例1"><a href="#案例1" class="headerlink" title="案例1"></a>案例1</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110022316.png" alt="image-20240111002240398"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110024592.png" alt="image-20240111002411661"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110032028.png" alt="image-20240111003237427"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110034774.png" alt="image-20240111003359274"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">执行创建存储过程命令报错，声明变量和声明游标的顺序有要求</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110035349.png" alt="image-20240111003504209"></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110037497.png" alt="image-20240111003723995"  />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">上面的报错是因为执行存储过程后，当游标里的数据遍历完成后，由于是死循环当无数据时也执行，导致报错</span><br></pre></td></tr></table></figure>

<h4 id="异常处理程序"><a href="#异常处理程序" class="headerlink" title="异常处理程序"></a>异常处理程序</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110046723.png" alt="image-20240111004654529"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">上图是对前面的案例的改进</span><br></pre></td></tr></table></figure>

<h3 id="案例2"><a href="#案例2" class="headerlink" title="案例2"></a>案例2</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">创建存储过程，里面使用游标，对每一行进行数据修改</span><br><span class="line"></span><br><span class="line">create procedure a()</span><br><span class="line">begin</span><br><span class="line">	declare cno int;</span><br><span class="line">	declare sno int;	</span><br><span class="line">	declare my_cursor cursor for select cno,sno from t;</span><br><span class="line">	open my_cursor;</span><br><span class="line">	fetch mycursor into cno,sno;</span><br><span class="line">	while fetch_status = 0</span><br><span class="line">	do</span><br><span class="line">		update t set score = score + 5 where sno = t.sno and cno = t.cno;</span><br><span class="line">		fetch mycursor into cno,sno;</span><br><span class="line">	end while;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>

<h3 id="案例3"><a href="#案例3" class="headerlink" title="案例3"></a>案例3</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">创建存储过程，里面使用游标，对score小于60的进行删除</span><br><span class="line"></span><br><span class="line">create procedure d()</span><br><span class="line">begin</span><br><span class="line">declare score int;</span><br><span class="line">declare my_cursor cursor for select score from t;</span><br><span class="line">open my_cursor;</span><br><span class="line">fetch my_cursor into score;</span><br><span class="line">where fetch_status = 0</span><br><span class="line">do</span><br><span class="line">	if score &lt; 60 then</span><br><span class="line">		delete t where t.score = score;</span><br><span class="line">	end if;</span><br><span class="line">	fetch my_cursor into score;</span><br><span class="line">end while;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>

<h3 id="案例4-异常处理程序"><a href="#案例4-异常处理程序" class="headerlink" title="案例4 异常处理程序"></a>案例4 异常处理程序</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER //</span><br><span class="line">CREATE PROCEDURE my_test8()</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE result VARCHAR(100) DEFAULT &#x27;&#x27;;-- 定义一个result 来存储商品名称的拼接</span><br><span class="line">DECLARE product_name VARCHAR(10);-- 定义一个变量来接收每次游标的商品名称</span><br><span class="line">DECLARE done INT DEFAULT FALSE; -- 定义done变量 默认值为false</span><br><span class="line">-- 查询所有的商品名称放入游标中 CURSOR 表示该变量为游标类型</span><br><span class="line">DECLARE curl CURSOR FOR SELECT p_name FROM xmcc_product;</span><br><span class="line">-- 游标遍历结束 会出现not found 设置done的值为true</span><br><span class="line">DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;  </span><br><span class="line">OPEN curl;-- 打开游标</span><br><span class="line">    WHILE(NOT done) DO</span><br><span class="line">    FETCH curl INTO product_name; -- 弹出游标的一条数据赋值给product_name</span><br><span class="line">    SET result:=CONCAT(result,&#x27;,&#x27;,product_name);-- 拼接字符串</span><br><span class="line">    END WHILE;</span><br><span class="line">CLOSE curl;-- 关闭游标 就像java中需要关闭resultset一样</span><br><span class="line">SELECT result;-- 打印出结果</span><br><span class="line">END;//</span><br><span class="line"></span><br><span class="line">#调用</span><br><span class="line">CALL my_test8();</span><br></pre></td></tr></table></figure>

<h3 id="案例5-带输入参数-in"><a href="#案例5-带输入参数-in" class="headerlink" title="案例5 带输入参数 in"></a>案例5 带输入参数 in</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">create procedure sp1(in p int)</span><br><span class="line">comment &#x27;insert into a int value&#x27;</span><br><span class="line">begin</span><br><span class="line">/* 定义一个整形变量 */</span><br><span class="line">declare v1 int;</span><br><span class="line"></span><br><span class="line">/* 将输入参数的值赋给变量 */</span><br><span class="line">set v1 = p;</span><br><span class="line"></span><br><span class="line">/* 执行插入操作 */</span><br><span class="line">insert into test(id) values(v1);</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">/* 调用这个存储过程 */</span><br><span class="line">call sp1(1)//</span><br></pre></td></tr></table></figure>

<h3 id="案例6-带输出参数-out"><a href="#案例6-带输出参数-out" class="headerlink" title="案例6 带输出参数 out"></a>案例6 带输出参数 out</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create procedure sp2(out p int)</span><br><span class="line">begin</span><br><span class="line">select max(id) into p from test;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">/* 调用该存储过程，注意：输出参数必须是一个带@符号的变量 */</span><br><span class="line">call sp2(@pv)</span><br><span class="line">/* 查询刚刚在存储过程中使用到的变量 */</span><br><span class="line"></span><br><span class="line">select @pv</span><br></pre></td></tr></table></figure>

<h3 id="案例7-带输入和输出参数-in-out"><a href="#案例7-带输入和输出参数-in-out" class="headerlink" title="案例7 带输入和输出参数 in out"></a>案例7 带输入和输出参数 in out</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">create procedure sp3(in p1 int , out p2 int)</span><br><span class="line">begin</span><br><span class="line">if p1 = 1 then</span><br><span class="line">/* 用@符号加变量名的方式定义一个变量，与declare类似 */</span><br><span class="line">set @v = 10;</span><br><span class="line">else</span><br><span class="line">set @v = 20;</span><br><span class="line">end if;</span><br><span class="line"></span><br><span class="line">/* 语句体内可以执行多条sql，但必须以分号分隔 */</span><br><span class="line">insert into test(id) values(@v);</span><br><span class="line">select max(id) into p2 from test;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">/* 调用该存储过程，注意：输入参数是一个值，而输出参数则必须是一个带@符号的变量 */</span><br><span class="line">call sp3(1,@ret)//</span><br><span class="line"></span><br><span class="line">select @ret//</span><br></pre></td></tr></table></figure>

<h3 id="案例8-inout"><a href="#案例8-inout" class="headerlink" title="案例8 inout"></a>案例8 inout</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">drop procedure if exists sp4 //</span><br><span class="line">create procedure sp4(inout p4 int)</span><br><span class="line">begin</span><br><span class="line">if p4 = 4 then</span><br><span class="line">set @pg = 400;</span><br><span class="line">else</span><br><span class="line">set @pg = 500;</span><br><span class="line">end if; </span><br><span class="line"></span><br><span class="line">select @pg;</span><br><span class="line"></span><br><span class="line">end//</span><br><span class="line"></span><br><span class="line">call sp4(@pp)//</span><br><span class="line"></span><br><span class="line">/* 这里需要先设置一个已赋值的变量，然后再作为参数传入 */</span><br><span class="line">set @pp = 4//</span><br><span class="line">call sp4(@pp)//</span><br></pre></td></tr></table></figure>

<h3 id="案例9-事务-异常处理程序"><a href="#案例9-事务-异常处理程序" class="headerlink" title="案例9 事务 异常处理程序"></a>案例9 事务 异常处理程序</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#存储过程异常处理</span><br><span class="line">DELIMITER//</span><br><span class="line">CREATE PROCEDURE my_test7()</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE i INT DEFAULT 0;</span><br><span class="line">#发生SQL异常时，程序继续，并设置i=-1；</span><br><span class="line">DECLARE CONTINUE HANDLER FOR SQLEXCEPTION  SET i:=-1;</span><br><span class="line">START TRANSACTION;#开启事务</span><br><span class="line">UPDATE xmcc_product SET p_name=&#x27;苹果&#x27; WHERE p_id=10000;</span><br><span class="line">INSERT INTO xmcc_product VALUES(10000,&#x27;主键冲突&#x27;,10,100); </span><br><span class="line">IF i=-1 THEN</span><br><span class="line">SELECT &#x27;出现异常，事务回滚&#x27;;</span><br><span class="line">ROLLBACK; #回滚</span><br><span class="line">ELSE</span><br><span class="line">COMMIT; #提交</span><br><span class="line">END IF;</span><br><span class="line">END//</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#调用 </span><br><span class="line">CALL my_test7();</span><br><span class="line">#查看结果</span><br><span class="line">SELECT * FROM xmcc_product</span><br></pre></td></tr></table></figure>

<h3 id="案例10-复杂案例-异常处理-回滚"><a href="#案例10-复杂案例-异常处理-回滚" class="headerlink" title="案例10 复杂案例 异常处理 回滚"></a>案例10 复杂案例 异常处理 回滚</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#编写取消订单的存储过程</span><br><span class="line">DELIMITER $$</span><br><span class="line">#输入参数为订单order_id 输出参数为result 1 代表存储过程成功 -1代表存储过程出现异常</span><br><span class="line">CREATE PROCEDURE cancel_order(IN order_id VARCHAR(30),OUT result INT)</span><br><span class="line">BEGIN </span><br><span class="line">DECLARE CONTINUE HANDLER FOR SQLEXCEPTION SET result:=-1;#如果出现异常设置返回值为-1</span><br><span class="line"></span><br><span class="line">START TRANSACTION;#开启事务</span><br><span class="line"></span><br><span class="line">SET result:=1;#设置初始值 这里设置为1</span><br><span class="line">UPDATE xmcc_order SET o_statu=1 WHERE o_id=order_id; #修改订单状态</span><br><span class="line"></span><br><span class="line">BEGIN </span><br><span class="line">    DECLARE done INT DEFAULT TRUE;#定义变量done用来判断</span><br><span class="line">    DECLARE product_id VARCHAR(30); #定义变量 来接收游标的商品id</span><br><span class="line">    DECLARE quantity_1 INT; #定义变量来接收游标的商品数量</span><br><span class="line">    </span><br><span class="line">    #定义游标 存储根据订单id查询到订单项中的商品id与数量</span><br><span class="line">    DECLARE cur CURSOR FOR SELECT p_id,quantity FROM xmcc_orderdetail WHERE o_id=order_id;</span><br><span class="line">    #当游标循环结束 设置done的值为false</span><br><span class="line">    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done:=FALSE;</span><br><span class="line">    OPEN cur;#打开游标</span><br><span class="line">    </span><br><span class="line">    WHILE done DO #循环</span><br><span class="line">        FETCH cur INTO product_id,quantity_1;#将游标的值设置到变量中</span><br><span class="line">        IF done THEN #判断 不然会多修改一次</span><br><span class="line">        	UPDATE xmcc_product SET p_stock=p_stock+quantity_1 WHERE p_id=product_id;</span><br><span class="line">        END IF;</span><br><span class="line">    END WHILE;</span><br><span class="line">    CLOSE cur;</span><br><span class="line">END ;</span><br><span class="line">IF result=1 THEN #没有出现异常就提交</span><br><span class="line">	COMMIT;</span><br><span class="line">ELSE </span><br><span class="line">	ROLLBACK;</span><br><span class="line">END IF;</span><br><span class="line">END ; $$</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#测试</span><br><span class="line">CALL cancel_order(&#x27;20001&#x27;,@result);</span><br><span class="line">#查看结果</span><br><span class="line">SELECT @result</span><br></pre></td></tr></table></figure>

<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36095679/article/details/90109480">参考</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER //</span><br><span class="line">#传入参数category_id 分类id</span><br><span class="line">CREATE PROCEDURE find_category_id(IN category_id INT)</span><br><span class="line">BEGIN</span><br><span class="line">DROP TABLE IF EXISTS tmp_id;</span><br><span class="line">#创建临时表 用来存储所有的id 临时表在链接结束会自动删除</span><br><span class="line">CREATE TEMPORARY TABLE  tmp_id(id INT);</span><br><span class="line">#清空该表</span><br><span class="line">TRUNCATE TABLE tmp_id;</span><br><span class="line">#临时表 用来存储所有的商品信息;</span><br><span class="line">#根据分类查询商品的时候，商品展示列表只需要这几个字段就可以了，详情的时候才是所有字段 </span><br><span class="line">DROP TABLE IF EXISTS tmp_product;</span><br><span class="line">CREATE TEMPORARY TABLE  tmp_product(SELECT id,NAME,subtitle,main_image,price FROM xmcc_product WHERE 1=2);</span><br><span class="line">TRUNCATE TABLE tmp_id;</span><br><span class="line">#调用另外的存储过程</span><br><span class="line">CALL recursive_find_id(category_id);</span><br><span class="line">  BEGIN</span><br><span class="line">  #设置循环条件</span><br><span class="line">   DECLARE done INT DEFAULT &#x27;0&#x27;;</span><br><span class="line">   #设置cid来接收游标中弹出的id</span><br><span class="line">   DECLARE cid INT DEFAULT &#x27;0&#x27;;</span><br><span class="line">   #递归过程将所有的id放在临时表中 现在查出放在游标ids中</span><br><span class="line">   DECLARE ids CURSOR FOR SELECT id FROM tmp_id;</span><br><span class="line">   #当游标遍历结束 done=1</span><br><span class="line">   DECLARE CONTINUE HANDLER  FOR NOT FOUND SET done=1;</span><br><span class="line">   #打开游标</span><br><span class="line">   OPEN ids;</span><br><span class="line">   #弹出游标一个值赋给cid</span><br><span class="line">   FETCH ids INTO cid;</span><br><span class="line">   WHILE (done=0) DO</span><br><span class="line">   #根据分类查找到商品 ，插入数据到商品临时表中</span><br><span class="line">   INSERT INTO tmp_product  SELECT id,NAME,subtitle,main_image,price FROM xmcc_product xp WHERE xp.category_id=cid and xp.status=1;</span><br><span class="line">   FETCH ids INTO cid;</span><br><span class="line">   END WHILE;</span><br><span class="line">  END;</span><br><span class="line">  #返回查询到的商品结果集</span><br><span class="line">SELECT * FROM tmp_product;</span><br><span class="line">END ;//</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">DELIMITER //</span><br><span class="line">CREATE PROCEDURE recursive_find_id(IN category_id INT)</span><br><span class="line">BEGIN </span><br><span class="line">#定义id接收每次查询到的分类id</span><br><span class="line">DECLARE cid INT;</span><br><span class="line">#定义done为0TRUE继续循环</span><br><span class="line">DECLARE done INT DEFAULT TRUE;</span><br><span class="line">#定义ids游标来获得parent_id为传入的id的集合</span><br><span class="line">DECLARE ids CURSOR FOR SELECT id FROM xmcc_category WHERE parent_id=category_id;</span><br><span class="line">#游标循环结束 出现not found  done=1循环结束</span><br><span class="line">DECLARE CONTINUE HANDLER  FOR NOT FOUND SET done=FALSE;</span><br><span class="line">#mysql 递归的时候 需要设置深度</span><br><span class="line">SET @@max_sp_recursion_depth = 10;</span><br><span class="line">#将id插入临时表中</span><br><span class="line">INSERT INTO tmp_id VALUES(category_id);</span><br><span class="line">OPEN ids;#打开游标</span><br><span class="line">#将查询到的游标结果 弹出赋值给id 每次弹出一个</span><br><span class="line">FETCH ids INTO cid;</span><br><span class="line">WHILE done DO</span><br><span class="line">#递归调用当前存储过程</span><br><span class="line">CALL recursive_find_id(cid);</span><br><span class="line">FETCH ids INTO cid;</span><br><span class="line">END WHILE;</span><br><span class="line">CLOSE ids;</span><br><span class="line">END;//</span><br></pre></td></tr></table></figure>

<h3 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER //</span><br><span class="line">#传入参数category_id 分类id</span><br><span class="line">CREATE PROCEDURE find_category_id(IN category_id INT)</span><br><span class="line">BEGIN</span><br><span class="line">DROP TABLE IF EXISTS tmp_id;</span><br><span class="line">#创建临时表 用来存储所有的id 临时表在链接结束会自动删除</span><br><span class="line">CREATE TEMPORARY TABLE  tmp_id(id INT);</span><br><span class="line">#清空该表</span><br><span class="line">TRUNCATE TABLE tmp_id;</span><br><span class="line">#临时表 用来存储所有的商品信息;</span><br><span class="line">#根据分类查询商品的时候，商品展示列表只需要这几个字段就可以了，详情的时候才是所有字段 </span><br><span class="line">DROP TABLE IF EXISTS tmp_product;</span><br><span class="line">CREATE TEMPORARY TABLE  tmp_product(SELECT id,NAME,subtitle,main_image,price FROM xmcc_product WHERE 1=2);</span><br><span class="line">TRUNCATE TABLE tmp_id;</span><br><span class="line">#调用另外的存储过程</span><br><span class="line">CALL recursive_find_id(category_id);</span><br><span class="line">  BEGIN</span><br><span class="line">  #设置循环条件</span><br><span class="line">   DECLARE done INT DEFAULT &#x27;0&#x27;;</span><br><span class="line">   #设置cid来接收游标中弹出的id</span><br><span class="line">   DECLARE cid INT DEFAULT &#x27;0&#x27;;</span><br><span class="line">   #递归过程将所有的id放在临时表中 现在查出放在游标ids中</span><br><span class="line">   DECLARE ids CURSOR FOR SELECT id FROM tmp_id;</span><br><span class="line">   #当游标遍历结束 done=1</span><br><span class="line">   DECLARE CONTINUE HANDLER  FOR NOT FOUND SET done=1;</span><br><span class="line">   #打开游标</span><br><span class="line">   OPEN ids;</span><br><span class="line">   #弹出游标一个值赋给cid</span><br><span class="line">   FETCH ids INTO cid;</span><br><span class="line">   WHILE (done=0) DO</span><br><span class="line">   #根据分类查找到商品 ，插入数据到商品临时表中</span><br><span class="line">   INSERT INTO tmp_product  SELECT id,NAME,subtitle,main_image,price FROM xmcc_product xp WHERE xp.category_id=cid and xp.status=1;</span><br><span class="line">   FETCH ids INTO cid;</span><br><span class="line">   END WHILE;</span><br><span class="line">  END;</span><br><span class="line">  #返回查询到的商品结果集</span><br><span class="line">SELECT * FROM tmp_product;</span><br><span class="line">END ;//</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">DELIMITER //</span><br><span class="line">CREATE PROCEDURE recursive_find_id(IN category_id INT)</span><br><span class="line">BEGIN </span><br><span class="line">#定义id接收每次查询到的分类id</span><br><span class="line">DECLARE cid INT;</span><br><span class="line">#定义done为0TRUE继续循环</span><br><span class="line">DECLARE done INT DEFAULT TRUE;</span><br><span class="line">#定义ids游标来获得parent_id为传入的id的集合</span><br><span class="line">DECLARE ids CURSOR FOR SELECT id FROM xmcc_category WHERE parent_id=category_id;</span><br><span class="line">#游标循环结束 出现not found  done=1循环结束</span><br><span class="line">DECLARE CONTINUE HANDLER  FOR NOT FOUND SET done=FALSE;</span><br><span class="line">#mysql 递归的时候 需要设置深度</span><br><span class="line">SET @@max_sp_recursion_depth = 10;</span><br><span class="line">#将id插入临时表中</span><br><span class="line">INSERT INTO tmp_id VALUES(category_id);</span><br><span class="line">OPEN ids;#打开游标</span><br><span class="line">#将查询到的游标结果 弹出赋值给id 每次弹出一个</span><br><span class="line">FETCH ids INTO cid;</span><br><span class="line">WHILE done DO</span><br><span class="line">#递归调用当前存储过程</span><br><span class="line">CALL recursive_find_id(cid);</span><br><span class="line">FETCH ids INTO cid;</span><br><span class="line">END WHILE;</span><br><span class="line">CLOSE ids;</span><br><span class="line">END;//</span><br></pre></td></tr></table></figure>







<h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36095679/article/details/90109480">参考</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/148939731">参考</a></p>
<h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">存储过程是事先经过编译并存储在数据库中的一段SQL语句的集合，调用存储过程可以简化应用开发人员的很多工作，减少数据在数据库和应用服务器之间的传输，对于提高数据处理的效率是有好处的。存储过程思想上很简单，就是数据库SQL 语言层面的代码封装与重用。</span><br></pre></td></tr></table></figure>

<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">封装，复用，更加安全。</span><br><span class="line">可以接收参数，也可以返回数据</span><br><span class="line">减少网络交互，效率提升</span><br><span class="line">可以实现复杂的操作，比如包含逻辑语句while if等</span><br></pre></td></tr></table></figure>

<h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><h4 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create procedure pro_name()</span><br><span class="line">begin</span><br><span class="line">x</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>

<h5 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">声明局部变量：要在存储过程中声明一个变量，可以使用DECLARE语句</span><br><span class="line"></span><br><span class="line">DECLARE variable_name datatype[(size)]  DEFAULT default_value;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">赋值：要为变量分配一个值，可以使用SET语句，或者使用SELECT INTO语句将查询的结果分配给一个变量</span><br><span class="line">DECLARE total_count INT DEFAULT 0;</span><br><span class="line">SET total_count := 10; # SET total_count= 10;</span><br><span class="line">或者：</span><br><span class="line">SELECT COUNT(*) INTO total_count  FROM products</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">变量范围(作用域)</span><br><span class="line"></span><br><span class="line">一个变量有自己的范围(作用域)，它用来定义它的生命周期。 如果在存储过程中声明一个变量，那么当达到存储过程的END语句时，它将超出范围，因此在其它代码块中无法访问。</span><br><span class="line"></span><br><span class="line">如果您在BEGIN END块内声明一个变量，那么如果达到END，它将超出范围。 可以在不同的作用域中声明具有相同名称的两个或多个变量，因为变量仅在自己的作用域中有效。 但是，在不同范围内声明具有相同名称的变量不是很好的编程习惯。</span><br><span class="line"></span><br><span class="line">以@符号开头的变量是会话变量。直到会话结束前它可用和可访问。</span><br></pre></td></tr></table></figure>

<h5 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">在MySQL中，参数有三种模式：IN，OUT或INOUT。</span><br><span class="line"></span><br><span class="line">IN - 是默认模式。(可写可不写) 在存储过程中定义IN参数时，调用程序必须将参数传递给存储过程。 另外，IN参数的值被保护。这意味着即使在存储过程中更改了IN参数的值，在存储过程结束后仍保留其原始值。换句话说，存储过程只使用IN参数的副本。</span><br><span class="line">OUT - 可以在存储过程中更改OUT参数的值，并将其更改后新值传递回调用程序。请注意，存储过程在启动时无法访问OUT参数的初始值。</span><br><span class="line">INOUT - INOUT参数是IN和OUT参数的组合。这意味着调用程序可以传递参数，并且存储过程可以修改INOUT参数并将新值传递回调用程序。</span><br></pre></td></tr></table></figure>

<h4 id="delimiter"><a href="#delimiter" class="headerlink" title="delimiter"></a>delimiter</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql中的默认的语句结束符为分号；但是例如我们需要在命令行输入较复杂的语句时(如存储过程，存储函数等)，可能包含多行语句或者语句中包含分号，那么mysql在遇到第一个分号时就会执行。delimiter就是用于修改语句结束符，使得在正确编写完sql语句后再执行</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$ </span><br><span class="line">DROP TRIGGER IF EXISTS `updateegopriceondelete`$$ </span><br><span class="line">CREATE </span><br><span class="line">    TRIGGER `updateegopriceondelete` AFTER  DELETE ON  `customerinfo` </span><br><span class="line">    FOR EACH ROW BEGIN </span><br><span class="line">DELETE FROM egoprice  WHERE customerId=OLD.customerId; </span><br><span class="line">    END$$ </span><br><span class="line">DELIMITER ; </span><br><span class="line"></span><br><span class="line">其中DELIMITER 定好结束符为&quot;$$&quot;, 然后最后又定义为&quot;;&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delimiter // </span><br><span class="line">mysql&gt; CREATE FUNCTION `SHORTEN`(S VARCHAR(255), N INT) </span><br><span class="line">mysql&gt;     RETURNS varchar(255) </span><br><span class="line">mysql&gt; BEGIN </span><br><span class="line">mysql&gt; IF ISNULL(S) THEN </span><br><span class="line">mysql&gt;     RETURN &#x27;&#x27;; </span><br><span class="line">mysql&gt; ELSEIF N&lt;15 THEN </span><br><span class="line">mysql&gt;     RETURN LEFT(S, N); </span><br><span class="line">mysql&gt; ELSE </span><br><span class="line">mysql&gt;     IF CHAR_LENGTH(S) &lt;=N THEN </span><br><span class="line">mysql&gt;    RETURN S; </span><br><span class="line">mysql&gt;     ELSE </span><br><span class="line">mysql&gt;    RETURN CONCAT(LEFT(S, N-10), &#x27;...&#x27;, RIGHT(S, 5)); </span><br><span class="line">mysql&gt;     END IF; </span><br><span class="line">mysql&gt; END IF; </span><br><span class="line">mysql&gt; END;// </span><br><span class="line"></span><br><span class="line">这样只有当//出现之后，mysql解释器才会执行这段语句 </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">create procedure val_session()</span><br><span class="line">begin</span><br><span class="line">    # 查看会话变量</span><br><span class="line">    show session variables;</span><br><span class="line">end //</span><br><span class="line"></span><br><span class="line">call val_session() //</span><br></pre></td></tr></table></figure>



<h4 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call pro_name();</span><br></pre></td></tr></table></figure>

<h4 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM INFORMATON_SCHEMA.ROUTINES WHERE ROUTINE_SCHEMA=&#x27;xxx&#x27;; -查询指定数库的存储过程及状态信息</span><br><span class="line"></span><br><span class="line">SHOW CREATE PROCEDURE 存储过程名称;- 查询某个存储过程的定义</span><br></pre></td></tr></table></figure>

<h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP PROCEDURE [IF EXIST5] 存储过程名称;</span><br></pre></td></tr></table></figure>

<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意: 在命令行中，执行创建存储过程的SQL时，</span><br><span class="line">需要通过关键字delimiter指定SQL语句的结束符</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401102140194.png" alt="image-20240110214023091"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401102141934.png" alt="image-20240110214100926"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401102141666.png" alt="image-20240110214120773"></p>
<h3 id="存储过程异常处理handler"><a href="#存储过程异常处理handler" class="headerlink" title="存储过程异常处理handler"></a>存储过程异常处理handler</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">01）当sql出现异常的时候跳出存储过程并设置值为xxx</span><br><span class="line">    Declare exit handler for sqlException set …..</span><br><span class="line"></span><br><span class="line">02）当sql出现异常的时候继续存储过程并设置值为xxx</span><br><span class="line">    Declare continue handler for sqlException set …..</span><br><span class="line"></span><br><span class="line">-- continue继续  exit 退出  HANDLER执行处理器    SQLEXCEPTION:sql异常</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">注意：异常情况可以写异常错误码、异常别名或SQLSTATE码。</span><br><span class="line"></span><br><span class="line">handler操作：</span><br><span class="line">CONTINUE： 继续</span><br><span class="line">EXIT： 退出</span><br><span class="line">UNDO： 撤销</span><br><span class="line"></span><br><span class="line">异常情况列表：</span><br><span class="line">mysql_error_code</span><br><span class="line">SQLSTATE [VALUE] sqlstate_value</span><br><span class="line">condition_name</span><br><span class="line">SQLWARNING</span><br><span class="line">NOT FOUND</span><br><span class="line">SQLEXCEPTION</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">handler_action</span><br><span class="line">	CONTINUE: 继续执行当前程序</span><br><span class="line">	EXIT: 终止执行当前程序</span><br><span class="line">condition_value</span><br><span class="line">    SQLSTATE sqlstate_value: 状态码，如02000</span><br><span class="line">    SQLWARNING: 所有以01开头的SQLSTATE代码的简写</span><br><span class="line">    NOT FOUND:所有以02开头的SQLSTATE代码的简写</span><br><span class="line">    SQLEXCEPTION: 所有没有被SQLWARNING或NOT FOUND捕获的SQLSTATE代码的简写</span><br></pre></td></tr></table></figure>

<h3 id="Prepare、execute、deallocate"><a href="#Prepare、execute、deallocate" class="headerlink" title="Prepare、execute、deallocate"></a>Prepare、execute、deallocate</h3><h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PREPARE stmt from &#x27;你的sql语句&#x27;; // PREPARE msql FROM @MyQuery; 变量存放sql</span><br><span class="line">EXECUTE stmt (如果sql有参数的话, USING xxx,xxx); // 这里USING的只能是会话变量</span><br><span class="line">DEALLOCATE PREPARE stmt;</span><br><span class="line"></span><br><span class="line">预定义好sql.</span><br><span class="line">执行预定义的sql</span><br><span class="line">释放掉数据库连接</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PREPARE语句准备好一条SQL语句，并分配给这条SQL语句一个名字供之后调用。准备好的SQL语句通过EXECUTE命令执行，通过DEALLOCATE PREPARE命令释放掉。</span><br><span class="line"></span><br><span class="line">准备好的SQL语句名字可以是字符串，也可以是用户指定的包含SQL文本的变量。PREPARE中的SQL文本必须代表一条单独的SQL语句而不能是多条SQL语句。在SQL语句中，? 字符用来作为后面执行查询使用的一个参数。</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">使用预处理语句时  要使用的是  【用户变量】(使用SET @xxx = xxxx 方式声明 )  不同于局部变量 （DECLARE 定义的变量）。</span><br></pre></td></tr></table></figure>

<h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">他还可以在存储过程中动态的拼接表名，字段名，来达到动态查询的效果</span><br><span class="line">sql语句中还可以用?来代表参数，这样可以有效的防止sql注入</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/A951860555/article/details/116484328">sql注入</a></p>
<h4 id="疑惑解答"><a href="#疑惑解答" class="headerlink" title="疑惑解答"></a>疑惑解答</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">疑惑解答：</span><br><span class="line">MySQL的解析器要求SQL语句中的标识符（表名、字段名）必须在编译时确定。</span><br><span class="line">普通SELECT/UPDATE等语句在存储过程中是静态SQL，其结构（包括标识符）必须是固定字符串。</span><br></pre></td></tr></table></figure>


<h4 id="案例-2"><a href="#案例-2" class="headerlink" title="案例"></a>案例</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">create procedure myTest()</span><br><span class="line">begin</span><br><span class="line">set @_sql = &#x27;select ? + ?&#x27;;</span><br><span class="line">set @a = 5;</span><br><span class="line">set @b = 6;</span><br><span class="line">PREPARE stmt from @_sql; // 预定义sql</span><br><span class="line">EXECUTE stmt USING @a,@b;// 传入两个会话变量来填充sql中的 ?</span><br><span class="line">DEALLOCATE PREPARE stmt; // 释放连接</span><br><span class="line">end //</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">create procedure myTest(in columnName varchar(32)) // 传入一个字符串</span><br><span class="line">BEGIN</span><br><span class="line">drop table if exists tmpTable; // 如果临时表存在先删除掉</span><br><span class="line">set @_sql = concat(&#x27;create temporary table if not exists tmpTable( &#x27;, columnName, &#x27; varchar(32), id int(11), _name varchar(32));&#x27;); // 创建临时表的语法，我们把传入的参数拼接进来</span><br><span class="line">PREPARE stmt from @_sql;    </span><br><span class="line">EXECUTE stmt;   执行</span><br><span class="line">DEALLOCATE PREPARE stmt;</span><br><span class="line">desc tmpTable;</span><br><span class="line">end //</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 第一种使用方式： 使用USING传入参数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 第二种使用方式： </span><br><span class="line">SET @select_test = CONCAT(&#x27;SELECT * FROM &#x27;, @table_name);</span><br><span class="line">PREPARE pr2 FROM @select_test;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SET @TargetTableName = CONCAT(&#x27;xxxxxxx&#x27;,&#x27;_&#x27;,DATE_FORMAT(NOW(),&#x27;%Y&#x27;)); --yourtablename_2022你的分表格式，前缀加日期</span><br><span class="line"></span><br><span class="line">SET @c_ExecSql = CONCAT(&#x27;SELECT AVG(AvgDust) INTO @c_AvgDust FROM  &#x27;, @TargetTableName);</span><br><span class="line"></span><br><span class="line">SET @c_ExecSqlFinally = CONCAT(@c_ExecSql,&#x27;WHERE id = @id AND    StartTime &gt;=@StartTime AND EndTime &lt;= @EndTime&#x27;); # 最终要执行的SQL语句</span><br><span class="line"></span><br><span class="line">PREPARE pr1 FROM @c_ExecSqlFinally;</span><br><span class="line">EXECUTE  pr1; # 最终执行语句</span><br><span class="line">DEALLOCATE PREPARE pr1 ; # 释放资源</span><br><span class="line"></span><br><span class="line"># 说明： 最终要执行的语句要看你自己的业务了我这里只是计算一个均值，直接使用了CONCAT函数把语句依次拼接完整。</span><br></pre></td></tr></table></figure>



<h2 id="存储函数"><a href="#存储函数" class="headerlink" title="存储函数"></a>存储函数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">存储函数是有返回值的存储过程，存储函数的参数只能是IN类型的。</span><br><span class="line"></span><br><span class="line">是一种允许用户扩展MySQL功能的机制。用户可以在SQL查询中直接调用这些函数，实现特定的业务逻辑。</span><br></pre></td></tr></table></figure>

<h3 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE FUNCTION 存储函数名称([参数列表])</span><br><span class="line">RETURNS 返回值类型</span><br><span class="line">BEGIN</span><br><span class="line">	--SQL语句</span><br><span class="line">	RETURN...;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<h3 id="与存储过程的区别"><a href="#与存储过程的区别" class="headerlink" title="与存储过程的区别"></a>与存储过程的区别</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">存储函数只能返回一个值，而存储过程可以返回零个或多个值</span><br><span class="line">存储函数可以作为查询语句的一部分来调用，而存储过程则一般需要通过CALL语句来调用。</span><br><span class="line">存储函数只能有输入参数（且参数名不能带IN关键字），而存储过程可以有输入、输出或输入输出参数。</span><br><span class="line"></span><br><span class="line">存储过程的功能更强大，可以实现复杂的业务逻辑，包括数据修改操作（如INSERT、UPDATE、DELETE），而存储函数则主要用于计算和返回一个值，对数据库表的直接操作较少。</span><br></pre></td></tr></table></figure>



<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110058710.png" alt="image-20240111005826523"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110101296.png" alt="image-20240111010116757"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">报错是因为版本问题</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110102825.png" alt="image-20240111010215465"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110102852.png" alt="image-20240111010240659"></p>
<h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/439273702">参考</a></p>
<h3 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">触发器是与表有关的数据库对象，指在insert/update/delete之前或之后，触发并执行触发器中定义的SQL语句集合。触发器的这种特性可以协助应用在数据库端确保数据的完整性，日志记录，数据校验等操作。</span><br><span class="line"></span><br><span class="line">使用别名OLD和NEW来引用触发器中发生变化的记录内容，这与其他的数据库是相似的。现在触发器还只支持行级触发，不支持语句级触发。</span><br><span class="line"></span><br><span class="line">行级触发器：影响多少行就触发多少次</span><br><span class="line">语句级触发器：不管影响多少行数据，只触发一次</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110124814.png" alt="image-20240111012402634"></p>
<h3 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110129093.png" alt="image-20240111012950606"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TRIGGER trigger_name</span><br><span class="line">BEFORE/AFTER INSERT/UPDATE/DELETE ON tbl_name FOR EACH ROW --行级触发器</span><br><span class="line">BEGIN</span><br><span class="line">	trigger_stmt;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW TRIGGERS;  --当前数据库触发器</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP TRIGGER.[schema_name.]trigger_name;</span><br></pre></td></tr></table></figure>

<h3 id="insert类型"><a href="#insert类型" class="headerlink" title="insert类型"></a>insert类型</h3><h4 id="insert插入之后在其它表插入相关信息"><a href="#insert插入之后在其它表插入相关信息" class="headerlink" title="insert插入之后在其它表插入相关信息"></a>insert插入之后在其它表插入相关信息</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110135726.png" alt="image-20240111013509019"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110140129.png" alt="image-20240111014019456"></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110140303.png" alt="image-20240111014032948"  />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER //</span><br><span class="line">CREATE TRIGGER customer_status_records</span><br><span class="line">AFTER INSERT</span><br><span class="line">ON customers</span><br><span class="line">FOR EACH ROW</span><br><span class="line">Insert into customer_status(customer_id, status_notes) VALUES(NEW.customer_id, &#x27;账户创建成功&#x27;)//</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AFTER INSERT 特别适合这种状态变更的关联写入操作。比如开户、暂停、注销等各类状态变更。</span><br></pre></td></tr></table></figure>

<h4 id="insert插入之前检查数据是否符合规范"><a href="#insert插入之前检查数据是否符合规范" class="headerlink" title="insert插入之前检查数据是否符合规范"></a>insert插入之前检查数据是否符合规范</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER //</span><br><span class="line">CREATE TRIGGER validate_sales_amount</span><br><span class="line">BEFORE INSERT</span><br><span class="line">ON sales</span><br><span class="line">FOR EACH ROW</span><br><span class="line">IF NEW.sales_amount&gt;10000 THEN</span><br><span class="line">SIGNAL SQLSTATE &#x27;45000&#x27;</span><br><span class="line">SET MESSAGE_TEXT = &quot;你输入的销售总额超过 10000 元。&quot;;</span><br><span class="line">END IF//</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>



<h3 id="update类型"><a href="#update类型" class="headerlink" title="update类型"></a>update类型</h3><h4 id="before-update"><a href="#before-update" class="headerlink" title="before update"></a>before update</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BEFORE UPDATE触发器与BEFORE INSERT 触发器非常类似，我们可以使用BEFORE UPDATE 触发器在更新数据之前，先做一次业务逻辑检测，避免发生误操作。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER //</span><br><span class="line">CREATE TRIGGER validate_customer_level</span><br><span class="line">BEFORE UPDATE</span><br><span class="line">ON customers</span><br><span class="line">FOR EACH ROW</span><br><span class="line">IF OLD.level=&#x27;VIP&#x27; THEN</span><br><span class="line">SIGNAL SQLSTATE &#x27;45000&#x27;</span><br><span class="line">SET MESSAGE_TEXT = &#x27;VIP 级别客户不能降级为普通级别客户&#x27;;</span><br><span class="line">END IF //</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<h4 id="after-update"><a href="#after-update" class="headerlink" title="after update"></a>after update</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AFTER UPDATE 多用于 log 记录，在管理系统多操作者使用的环境中，管理员需要设置操作 log 记录，以便在出问题时，可以查看操作者对表编辑的操作，可追根溯源。</span><br></pre></td></tr></table></figure>

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110147174.png" alt="image-20240111014714830"  />

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110148956.png" alt="image-20240111014827947"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">下面的就是前面说的行级触发器问题了，影响多少行就触发多少次</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110150266.png" alt="image-20240111015039380"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110151932.png" alt="image-20240111015108795"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">触发器将监测用户 ID 、更新前的销售总额、更新后的销售总额、操作者 ID、修改时间等信息，作为 log 存入 audit_log 表中。</span><br><span class="line"></span><br><span class="line">使用以下命令建立这个 log 记录触发器：</span><br><span class="line">DELIMITER //</span><br><span class="line">CREATE TRIGGER log_sales_updates</span><br><span class="line">AFTER UPDATE</span><br><span class="line">ON sales</span><br><span class="line">FOR EACH ROW</span><br><span class="line">Insert into audit_log(sales_id, previous_amount, new_amount, updated_by, updated_on) VALUES (NEW.sales_id,OLD.sales_amount, NEW.sales_amount,(SELECT USER()), NOW() )//</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<h3 id="delete类型"><a href="#delete类型" class="headerlink" title="delete类型"></a>delete类型</h3><h4 id="after-delete"><a href="#after-delete" class="headerlink" title="after delete"></a>after delete</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110157970.png" alt="image-20240111015757656"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110158554.png" alt="image-20240111015858232"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">AFTER DELETE触发器的另一个用途是在删除主表中的数据后，与这个主表关联的数据，一起自动删除。</span><br><span class="line"></span><br><span class="line">我们来看一下这个触发器如何创建：</span><br><span class="line">DELIMITER //</span><br><span class="line">CREATE TRIGGER delete_related_info</span><br><span class="line">AFTER DELETE</span><br><span class="line">ON sales</span><br><span class="line">FOR EACH ROW</span><br><span class="line">Delete from customers where customer_id=OLD.customer_id;//</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>



<h4 id="before-delete"><a href="#before-delete" class="headerlink" title="before delete"></a>before delete</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">这些类型的触发器通常用于在不同的相关表上强制执行参照完整性。</span><br><span class="line">BEFORE DELETE 的应用场景通常是确保有关联的数据不被错误的误删除掉。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">例如：sales 表通过customer_id 与customers表相关联。如果操作者删除了customers 表中的一条数据，那么 sales 表中某些数据就失去了关联线索。</span><br><span class="line"></span><br><span class="line">为了避免这种情况的发生，我们需要创建一个 BEFORE DELETE触发器，防止记录被误删除。</span><br><span class="line"></span><br><span class="line">DELIMITER //</span><br><span class="line">CREATE TRIGGER validate_related_records</span><br><span class="line">BEFORE DELETE</span><br><span class="line">ON customers</span><br><span class="line">FOR EACH ROW</span><br><span class="line">IF OLD.customer_id in (select customer_id from sales) THEN</span><br><span class="line">SIGNAL SQLSTATE &#x27;45000&#x27;</span><br><span class="line">SET MESSAGE_TEXT = &#x27;这位客户有相关联的销售记录，不能删除。&#x27;;</span><br><span class="line">END IF//</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">不过有时候，我们需要删除主数据后，再让系统自动帮我们删除与之相关联的其他所有数据。这时，我们就要用到 AFTER DELETE 这个触发器了。</span><br></pre></td></tr></table></figure>

<h2 id="变量-1"><a href="#变量-1" class="headerlink" title="变量"></a>变量</h2><h3 id="系统变量"><a href="#系统变量" class="headerlink" title="系统变量"></a>系统变量</h3><h4 id="会话变量"><a href="#会话变量" class="headerlink" title="会话变量"></a>会话变量</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">会话变量是由系统提供的，只在当前会话（连接）中有效。</span><br></pre></td></tr></table></figure>

<h5 id="查看-1"><a href="#查看-1" class="headerlink" title="查看"></a>查看</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 查看所有会话变量</span><br><span class="line">show session variables;</span><br><span class="line"></span><br><span class="line"># 查看指定的会话变量</span><br><span class="line">select @@session.val_name;</span><br><span class="line"></span><br><span class="line"># 修改指定的会话变量</span><br><span class="line">set @@session.val_name = 0;</span><br></pre></td></tr></table></figure>

<h5 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SET [SESSION|GLOBAL] 系统变量名=值;</span><br><span class="line">SET @@[SESSION|GLOBAL].系统变量名=值;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">注意:</span><br><span class="line">如果没有指定SESSION/GLOBAL，默认是SESSION，会话变量。</span><br><span class="line">mysql服务重新启动之后，所设置的全局参数会失效，要想不失效，可以在 /etc/my.cnf 中配置。</span><br></pre></td></tr></table></figure>

<h4 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">全局变量由系统提供，整个MySQL服务器内有效。</span><br><span class="line"></span><br><span class="line">语法： @@global.val_name</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查看全局变量中变量名有char的记录</span><br><span class="line">show global variables like &#x27;%char%&#x27; </span><br><span class="line"></span><br><span class="line"># 查看全局变量character_set_client的值</span><br><span class="line">select @@global.character_set_client </span><br></pre></td></tr></table></figure>



<h3 id="用户自定义变量"><a href="#用户自定义变量" class="headerlink" title="用户自定义变量"></a>用户自定义变量</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">用户变量不用提前声明，使用即为声明。其作用域为当前连接(会话)。</span><br></pre></td></tr></table></figure>

<h5 id="赋值"><a href="#赋值" class="headerlink" title="赋值"></a>赋值</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SET @var_name=expr[,@var_name=expr] ...;</span><br><span class="line"></span><br><span class="line">SET @var_name:=expr[,@var_name:= expr] ...;</span><br><span class="line"></span><br><span class="line">SELECT @var_name:=expr[,@var_name:= expr]...;</span><br><span class="line"></span><br><span class="line">SELECT 字段名 INTO @var_name FROM 表名;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401102202114.png" alt="image-20240110220247083"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401102206325.png" alt="image-20240110220607263"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql中没有==比较运算符，赋值和比较运算符都是=</span><br><span class="line">这里建议用:=</span><br></pre></td></tr></table></figure>

<h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select @var_name;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401102203768.png" alt="image-20240110220318820"></p>
<h5 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意:</span><br><span class="line">用户定义的变量无需对其进行声明或初始化，只不过获取到的值为NULL。</span><br></pre></td></tr></table></figure>

<h5 id="案例-3"><a href="#案例-3" class="headerlink" title="案例"></a>案例</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">create procedure val_in(in val_name varchar(32))</span><br><span class="line">begin</span><br><span class="line">     # 使用用户变量出参(为用户变量赋参数值)</span><br><span class="line">     set @val_name1 = val_name;</span><br><span class="line">end //</span><br><span class="line"> </span><br><span class="line"># 调用函数</span><br><span class="line"> call val_in(&#x27;DK&#x27;) //</span><br><span class="line"># 查询该用户变量</span><br><span class="line">select @val_name1 //</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line"># 创建一个入参和出参的存储过程</span><br><span class="line">create procedure val_out(in val_id int,out val_name varchar(32))</span><br><span class="line">begin</span><br><span class="line">    # 传入参数val_id查询员工返回name值(查询出的name值用出参接收并返回)</span><br><span class="line">    select name into val_name from employee where id = val_id;</span><br><span class="line">end //</span><br><span class="line"></span><br><span class="line"># 调用函数传入参数并声明传入一个用户变量</span><br><span class="line">call val_out(1, @n) //</span><br><span class="line"></span><br><span class="line"># 查询用户变量</span><br><span class="line">select @n //</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line"> create procedure val_inout(in val_name varchar(32), inout val_age int)</span><br><span class="line"> begin</span><br><span class="line">     # 声明一个a变量</span><br><span class="line">     declare a int;</span><br><span class="line">     # 将传入的参数赋值给a变量</span><br><span class="line">     set a = val_age;</span><br><span class="line">     # 通过name查询age并返回val_age</span><br><span class="line">     select age into val_age from employee where name = val_name;</span><br><span class="line">    # 将传入的a与-和查询age结果字符串做拼接并查询出来(concat——拼接字符串)</span><br><span class="line">    select concat(a, &#x27;-&#x27;, val_age);</span><br><span class="line">end //</span><br><span class="line"></span><br><span class="line"># 声明一个用户变量并赋予参数为40</span><br><span class="line">set @ages = &#x27;40&#x27; //</span><br><span class="line"># 调用函数并传入参数值</span><br><span class="line">call val_inout(&#x27;Ziph&#x27;, @ages) //</span><br><span class="line"># 执行结果</span><br><span class="line"># 40-18</span><br></pre></td></tr></table></figure>



<h3 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">局部变量是根据需要定义的在局部生效的变量，访问之前，需要DECLARE声明。可用作存储过程内的局部变量，局部变量的范围是在其内声明的BEGIN...END块</span><br></pre></td></tr></table></figure>

<h5 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DECLARE 变量名 变量类型[DEFAULT ...];</span><br><span class="line"></span><br><span class="line">变量类型就是数据库字段类型:INT、BIGINT、CHAR、VARCHAR、DATE、TIME等</span><br></pre></td></tr></table></figure>

<h5 id="赋值-1"><a href="#赋值-1" class="headerlink" title="赋值"></a>赋值</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET 变量名=值</span><br><span class="line">SET 变量名:=值</span><br><span class="line">SELECT 字段名 INTO 变量名 FROM 表名 ...;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401102215496.png" alt="image-20240110221513243"></p>
<h2 id="IF条件判断"><a href="#IF条件判断" class="headerlink" title="IF条件判断"></a>IF条件判断</h2><h4 id="语法-3"><a href="#语法-3" class="headerlink" title="语法"></a>语法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">IF 条件1 THEN</span><br><span class="line">...</span><br><span class="line">ELSEIF 条件2 THEN  --可选</span><br><span class="line">...</span><br><span class="line">ELSE  --可选</span><br><span class="line">...</span><br><span class="line">END IF;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401102220413.png" alt="image-20240110222047760"></p>
<h3 id="参数-1"><a href="#参数-1" class="headerlink" title="参数"></a>参数</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401102223938.png" alt="image-20240110222312861"></p>
<h4 id="用法-1"><a href="#用法-1" class="headerlink" title="用法"></a>用法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE 存储过程名称([IN/OUT/INOUT 参数名 参数类型])</span><br><span class="line">BEGIN</span><br><span class="line">-- SQL语句</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401102229437.png" alt="image-20240110222949445"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401102233157.png" alt="image-20240110223357171"></p>
<h2 id="case"><a href="#case" class="headerlink" title="case"></a>case</h2><h4 id="语法一"><a href="#语法一" class="headerlink" title="语法一"></a>语法一</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CASE case_value</span><br><span class="line">WHEN when_value1 THEN statement_list1</span><br><span class="line">[WHEN when_value2 THEN statement_list2]...</span><br><span class="line">[ELSE statement_list]</span><br><span class="line">END CASE;</span><br></pre></td></tr></table></figure>

<h4 id="语法二"><a href="#语法二" class="headerlink" title="语法二"></a>语法二</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CASE</span><br><span class="line">WHEN search_condition1 THEN statement_list1</span><br><span class="line">[WHEN search_condition2 THEN statement_lis选2]...</span><br><span class="line">[ELSE statement_list]</span><br><span class="line">END CASE;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401102243047.png" alt="image-20240110224333069"></p>
<h2 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">leave和iterate与break和continue类似</span><br></pre></td></tr></table></figure>



<h4 id="while"><a href="#while" class="headerlink" title="while"></a>while</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[别名] WHILE 条件 DO</span><br><span class="line">    循环语句</span><br><span class="line">END WHILE [别名]</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401102247336.png" alt="image-20240110224700400"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">create procedure s_while()</span><br><span class="line">begin</span><br><span class="line">    declare i int default 1;</span><br><span class="line">    declare str varchar(256) default &#x27;1&#x27;;</span><br><span class="line">    # 开始while循环</span><br><span class="line">    num:</span><br><span class="line">    # 指定while循环结束条件</span><br><span class="line">    while i &lt; 10 do</span><br><span class="line">        set i = i + 1;</span><br><span class="line">        set str = concat(str, &#x27;+&#x27;, i);</span><br><span class="line">    # while循环结束</span><br><span class="line">    end while num;</span><br><span class="line">    # 查询while循环拼接字符串</span><br><span class="line">    select str;</span><br><span class="line">end //</span><br><span class="line"></span><br><span class="line">call s_while();</span><br></pre></td></tr></table></figure>



<h4 id="repeat"><a href="#repeat" class="headerlink" title="repeat"></a>repeat</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">repeat循环类似Java中的do while循环</span><br><span class="line"></span><br><span class="line">repeat是有条件的循环控制语句,当满足条件的时候退出循环。具体语法为:</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[别名:] REPEAT</span><br><span class="line">    循环语句</span><br><span class="line">UNTIL 条件</span><br><span class="line">END REPEAT [别名]</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401102250860.png" alt="image-20240110225051485"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">create procedure s_repeat()</span><br><span class="line">begin</span><br><span class="line">    declare i int default 1;</span><br><span class="line">    declare str varchar(256) default &#x27;1&#x27;;</span><br><span class="line">    # 开始repeat循环</span><br><span class="line">    num:</span><br><span class="line">    repeat</span><br><span class="line">        set i = i + 1;</span><br><span class="line">        set str = concat(str, &#x27;-&#x27;, i);</span><br><span class="line">    # until 结束条件</span><br><span class="line">    # end repeat 结束num 结束repeat循环</span><br><span class="line">    until i &gt;= 10 end repeat num;</span><br><span class="line">    # 查询字符串拼接结果</span><br><span class="line">    select str;</span><br><span class="line">end //</span><br><span class="line"></span><br><span class="line">call s_repeat();</span><br></pre></td></tr></table></figure>

<h4 id="loop"><a href="#loop" class="headerlink" title="loop"></a>loop</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loop为死循环，需要手动退出循环，我们可以使用 leave 来退出循环</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LOOP 实现简单的循环，如果不在SQL逻辑中增加退出循环的条件，可以用其来实现简单的死循环。LOOP可以配合一下两个语句使用:</span><br><span class="line">LEAVE:配合循环使用，退出循环。</span><br><span class="line">ITERATE:必须用在循环中，作用是跳过当前循环剩下的语句，直接进入下一次循环。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[别名:] LOOP</span><br><span class="line">    循环语句</span><br><span class="line">END LOOP [别名]</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110009696.png" alt="image-20240111000914488"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/ttyong/hexoBlog/raw/master/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/202401110012878.png" alt="image-20240111001248674"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">create procedure s_loop()</span><br><span class="line">begin</span><br><span class="line">    # 声明计数器</span><br><span class="line">    declare i int default 1;</span><br><span class="line">    # 开始循环</span><br><span class="line">    num:</span><br><span class="line">    loop</span><br><span class="line">        # 查询计数器记录的值</span><br><span class="line">        select i;</span><br><span class="line">        # 判断大于等于停止计数</span><br><span class="line">        if i &gt;= 10 then</span><br><span class="line">            leave num;</span><br><span class="line">        end if;</span><br><span class="line">        # 计数器自增1</span><br><span class="line">        set i = i + 1;</span><br><span class="line">    # 结束循环</span><br><span class="line">    end loop num;</span><br><span class="line">end //</span><br><span class="line"></span><br><span class="line">call s_loop();</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line">create procedure s_loop1()</span><br><span class="line">begin</span><br><span class="line">    # 声明变量i计数器</span><br><span class="line">    declare i int default 1;</span><br><span class="line">    # 声明字符串容器</span><br><span class="line">    declare str varchar(256) default &#x27;1&#x27;;</span><br><span class="line">    # 开始循环</span><br><span class="line">    num:</span><br><span class="line">    loop</span><br><span class="line">        # 计数器自增1</span><br><span class="line">        set i = i + 1;</span><br><span class="line">        # 字符串容器拼接计数器结果</span><br><span class="line">        set str = concat(str, &#x27;-&#x27;, i);</span><br><span class="line">        # 计数器i如果小于10就继续执行</span><br><span class="line">        if i &lt; 10 then</span><br><span class="line">           iterate num;</span><br><span class="line">        end if;</span><br><span class="line">        # 计数器i如果大于10就停止循环</span><br><span class="line">        leave num;</span><br><span class="line">    # 停止循环</span><br><span class="line">    end loop num;</span><br><span class="line">    # 查询字符串容器的拼接结果</span><br><span class="line">    select str;</span><br><span class="line">end //</span><br><span class="line"></span><br><span class="line">call s_loop1();</span><br></pre></td></tr></table></figure>

<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">视图是一个虚拟表，其内容由查询定义。数据库中只存放了视图的定义，而并没有存放视图中的数据，这些数据存放在原来的表中。使用视图查询数据时，数据库系统会从原来的表中取出对应的数据。因此，视图中的数据是依赖于原来的表中的数据的。一旦表中的数据发生改变，显示在视图中的数据也会发生改变。同样对视图的更新，会影响到原来表的数据。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">安全原因，视图可以隐藏一些数据，例如，员工信息表，可以用视图只显示姓名、工龄、地址，而不显示社会保险号和工资数等。这个视图就像一个窗口，从中只能看到你想看的数据列。</span><br></pre></td></tr></table></figure>

<h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><h4 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.使操作简单化</span><br><span class="line">视图需要达到的目的就是所见即所需。视图不仅可以简化用户对数据的理解，也可以简化他们的操作。那些被经常使用的查询可以被定义为视图，从而使得用户不必为以后的操作每次指定全部的条件。</span><br><span class="line"></span><br><span class="line">2.增加数据的安全性</span><br><span class="line">通过视图，用户只能查询和修改指定的数据。指定数据之外的信息，用户根本接触不到。这样可以防止敏感信息被未授权的用户查看，增强机密信息的安全性。</span><br><span class="line"></span><br><span class="line">3.提高表的逻辑独立性</span><br><span class="line">视图可以屏蔽原有表结构变化带来的影响。例如原有表增加列和删除未被引用的列，对视图不会造成影响。同样，如果修改表中的某些列，可以使用修改视图来解决这些列带来的影响。</span><br></pre></td></tr></table></figure>

<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在实际数据表的基础上创建视图，那么如果实际数据表的结构变更了，我们就需要及时对相关的视图进行相应的维护。特别是嵌套的视图（就是在视图的基础上创建视图），维护会变得比较复杂， 可读性不好，容易变成系统的潜在隐患。因为创建视图的SQL查询可能会对字段重命名，也可能包含复杂的逻辑，这些都会增加维护的成本。实际项目中，如果视图过多，会导致数据库维护成本的问题。</span><br><span class="line"></span><br><span class="line">所以，在创建视图的时候，你要结合实际项目需求，综合考虑视图的优点和不足，这样才能正确使用视图，使系统整体达到最优。</span><br></pre></td></tr></table></figure>

<h3 id="语法-4"><a href="#语法-4" class="headerlink" title="语法"></a>语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">创建视图是指在已经存在的数据库表上建立视图。视图可以建立在一张表中，也可以建立在多张表中</span><br><span class="line"></span><br><span class="line">创建视图需要具有CREATE VIEW的权限。同时应该具有查询涉及的列的SELECT权限。可以使用SELECT语句来查询这些权限信息。查询语法如下：</span><br><span class="line">SELECT Select_priv,Create_view_priv FROM mysql.user WHERE user=&#x27;用户名&#x27;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE [OR REPLACE] [ALGORITHM=&#123;UNDEFINED|MERGE|TEMPTABLE&#125;]</span><br><span class="line">VIEW 视图名[(属性清单)]</span><br><span class="line">AS SELECT语句</span><br><span class="line">[WITH [CASCADED|LOCAL] CHECK OPTION];</span><br><span class="line"></span><br><span class="line">-ALGORITHM：可选项，表示视图选择的算法。</span><br><span class="line">-OR REPLACE:若加了[or replace]时，还需要用户具有删除视图（drop view）的权限。表示替换已经创建的视图。</span><br><span class="line">-WITH CHECK OPTION：可选项，表示更新视图时要保证在该视图的权限范围之内。CASCADE 与LOCAL为可选参数，CASCADE为默认值，表示更新视图时要满足所有相关视图和表的条件；LOCAL表示更新视图时满足该视图本身定义的条件即可。</span><br></pre></td></tr></table></figure>

<h3 id="创建-1"><a href="#创建-1" class="headerlink" title="创建"></a>创建</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">针对别名的处理，可以在创建视图的子查询中指定对应的别名</span><br><span class="line"></span><br><span class="line">CREATE VIEW v_student1</span><br><span class="line">AS </span><br><span class="line">SELECT id stu_id,name stu_name,sex gender</span><br><span class="line">FROM student ;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">也可以在创建视图的视图名称后添加对应的别名字段</span><br><span class="line"></span><br><span class="line">CREATE VIEW v_student2(stu_id,stu_name,gender)</span><br><span class="line">AS </span><br><span class="line">SELECT id ,name ,sex </span><br><span class="line">FROM student ;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">可以基于视图创建视图</span><br><span class="line">CREATE VIEW v_student_score1 AS </span><br><span class="line">SELECT *  FROM</span><br><span class="line"> v_student_score </span><br><span class="line">WHERE grade &gt; 80;</span><br></pre></td></tr></table></figure>



<h3 id="通过视图变更数据"><a href="#通过视图变更数据" class="headerlink" title="通过视图变更数据"></a>通过视图变更数据</h3><h4 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">首先v_order是很多张表连接得到的视图</span><br><span class="line"></span><br><span class="line">成功</span><br><span class="line">INSERT INTO v_order(pid,pname,price) VALUES(&#x27;p010&#x27;,&#x27;柴油&#x27;,&#x27;34&#x27;);</span><br><span class="line"></span><br><span class="line">报错</span><br><span class="line">INSERT INTO v_order(oid,pid,pname,price,quantity) VALUES(&#x27;D00021&#x27;,&#x27;P011&#x27;,&#x27;一号柴油&#x27;,&#x27;35&#x27;,&#x27;12&#x27;)</span><br><span class="line"></span><br><span class="line">第一条语句成功对Product表进行插入数据</span><br><span class="line">可以通过视图插入数据，但是只能基于一个基础表进行插入，不能跨表更新数据</span><br></pre></td></tr></table></figure>

<h4 id="WITH-CHECK-OPTION"><a href="#WITH-CHECK-OPTION" class="headerlink" title="WITH CHECK OPTION"></a>WITH CHECK OPTION</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如果在创建视图的时候制定了“WITH CHECK OPTION”，那么更新数据时不能插入或更新不符合视图限制条件的记录。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create view v_price3000up</span><br><span class="line">as</span><br><span class="line">select * from product where price &gt;=3000</span><br><span class="line">with check option</span><br><span class="line"></span><br><span class="line">insert into v_price3000up(pid,pname,price) value(&#x27;p011&#x27;,&#x27;机油&#x27;,&#x27;42&#x27;)</span><br><span class="line">此时插入不符合视图条件的会报错</span><br><span class="line"></span><br><span class="line">update v_price3000up set price=1000 where pid=&#x27;p007&#x27;</span><br><span class="line">此时更新结果不符合视图条件的会报错</span><br></pre></td></tr></table></figure>

<h4 id="删除-1"><a href="#删除-1" class="headerlink" title="删除"></a>删除</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP VIEW IF EXISTS view_student;</span><br></pre></td></tr></table></figure>

<h4 id="注意-2"><a href="#注意-2" class="headerlink" title="注意"></a>注意</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-在定义视图的SELECT语句中包含了子查询，而子查询中引用了FROM后面的表，视图将不支持 INSERT、UPDATE、DELETE；</span><br><span class="line">-在定义视图的SELECT语句后的字段列表中使用DISTINCT、聚合函数、GROUP BY、HAVING、UNION等，视图将不支持INSERT、UPDATE、DELETE；</span><br><span class="line">-在定义视图的SELECT语句后的字段列表中使用了数学表达式或子查询 ，视图将不支持INSERT，也不支持UPDATE使用了数学表达式、子查询的字段值；</span><br><span class="line">-在定义视图的时候指定了“ALGORITHM = TEMPTABLE”，视图将不支持INSERT和DELETE操作；</span><br><span class="line">-视图中不包含基表中所有被定义为非空又未指定默认值的列，视图将不支持INSERT操作；</span><br><span class="line">-在定义视图的SELECT语句中使用了 JOIN联合查询 ，视图将不支持INSERT和DELETE操作；</span><br></pre></td></tr></table></figure>

<h2 id="临时表"><a href="#临时表" class="headerlink" title="临时表"></a>临时表</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在MySQL中，临时表是一种特殊的表，它用于在当前会话中存储临时数据集。这些表在会话结束时自动销毁，非常适合存储中间结果集或进行复杂查询时使用。</span><br></pre></td></tr></table></figure>

<h3 id="语法-5"><a href="#语法-5" class="headerlink" title="语法"></a>语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TEMPORARY TABLE temp_table_name (</span><br><span class="line">column1 datatype,</span><br><span class="line">column2 datatype,</span><br><span class="line"></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">也可以通过查询结果来创建临时表，这样可以直接将查询结果集存储在临时表中，而不需要单独插入数据。例如：</span><br><span class="line">CREATE TEMPORARY TABLE temp_table_name AS</span><br><span class="line">SELECT column1, column2,</span><br><span class="line">FROM source_table</span><br><span class="line">WHERE condition;</span><br></pre></td></tr></table></figure>

<h3 id="注意-3"><a href="#注意-3" class="headerlink" title="注意"></a>注意</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">一旦临时表被创建，你就可以像使用普通表一样对其进行各种操作，包括插入、查询、修改和删除数据</span><br><span class="line"></span><br><span class="line">临时表只在创建它的会话中可见，其他会话无法访问。如果你需要在多个会话之间共享数据，应该使用普通表而不是临时表。此外，临时表不应与永久表共享相同的名称，以避免混淆和数据丢失的风险。</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">智汇君</div><div class="post-copyright__author_desc">路漫漫其修远兮，吾将上下而求索！</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/01/17/%E6%95%B0%E6%8D%AE%E5%BA%93%20%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-%E5%9F%BA%E7%A1%80%E7%AF%87%202/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/01/17/数据库 黑马MySQL数据库从入门到精通-基础篇 2/')">黑马MySQL数据库从入门到精通-基础篇 2</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="/img/%E5%BE%AE%E4%BF%A1%E6%94%B6%E6%AC%BE%E7%A0%81.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E5%BE%AE%E4%BF%A1%E6%94%B6%E6%AC%BE%E7%A0%81.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%B6%E6%AC%BE%E7%A0%81.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%B6%E6%AC%BE%E7%A0%81.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/01/17/%E6%95%B0%E6%8D%AE%E5%BA%93%20%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-%E5%9F%BA%E7%A1%80%E7%AF%87%202/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Tech智汇站</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>大数据<span class="tagsPageCount">31</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/01/17/%E6%95%B0%E6%8D%AE%E5%BA%93%20%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-%E8%BF%90%E7%BB%B4%E7%AF%87%201/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">黑马MySQL数据库从入门到精通-运维篇 1</div></div></a></div><div class="next-post pull-right"><a href="/2025/01/17/%E6%95%B0%E6%8D%AE%E5%BA%93%20%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-%E5%9F%BA%E7%A1%80%E7%AF%87%20%E4%BA%8B%E5%8A%A1/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">黑马MySQL数据库从入门到精通-基础篇 事务</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/01/17/Hudi%202022%E9%BB%91%E9%A9%AC%E6%95%B0%E6%8D%AE%E6%B9%96%E6%9E%B6%E6%9E%84%E5%BC%80%E5%8F%91Hudi-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E7%AF%87%201/" title="2022黑马数据湖架构开发Hudi"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-17</div><div class="title">2022黑马数据湖架构开发Hudi</div></div></a></div><div><a href="/2025/01/17/Hudi%202022%E9%BB%91%E9%A9%AC%E6%95%B0%E6%8D%AE%E6%B9%96%E6%9E%B6%E6%9E%84%E5%BC%80%E5%8F%91Hudi-%E5%BA%94%E7%94%A8%E8%BF%9B%E9%98%B6%E7%AF%87%20flink%E9%9B%86%E6%88%90%201/" title="2022黑马数据湖架构开发Hudi-应用进阶篇 flink集成 1"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-17</div><div class="title">2022黑马数据湖架构开发Hudi-应用进阶篇 flink集成 1</div></div></a></div><div><a href="/2025/01/17/Hudi%202022%E9%BB%91%E9%A9%AC%E6%95%B0%E6%8D%AE%E6%B9%96%E6%9E%B6%E6%9E%84%E5%BC%80%E5%8F%91Hudi-%E5%BA%94%E7%94%A8%E8%BF%9B%E9%98%B6%E7%AF%87%20spark%E9%9B%86%E6%88%90%201/" title="2022黑马数据湖架构开发Hudi-应用进阶篇 1"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-17</div><div class="title">2022黑马数据湖架构开发Hudi-应用进阶篇 1</div></div></a></div><div><a href="/2025/01/17/Hudi%20%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi-1/" title="尚硅谷大数据技术之数据湖Hudi-1"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-17</div><div class="title">尚硅谷大数据技术之数据湖Hudi-1</div></div></a></div><div><a href="/2025/01/17/Hudi%20%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi-2/" title="尚硅谷大数据技术之数据湖Hudi-2"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-17</div><div class="title">尚硅谷大数据技术之数据湖Hudi-2</div></div></a></div><div><a href="/2025/01/17/Hudi%20%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi-3/" title="尚硅谷大数据技术之数据湖Hudi-3"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-17</div><div class="title">尚硅谷大数据技术之数据湖Hudi-3</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">智汇君</h1><div class="author-info__desc">路漫漫其修远兮，吾将上下而求索！</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="/contact/" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来看我的博客鸭~</div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(/img/博客微信公众号图片.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%B8%E6%A0%87"><span class="toc-number">1.</span> <span class="toc-text">游标</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%B3%95"><span class="toc-number">1.1.</span> <span class="toc-text">用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B1"><span class="toc-number">1.2.</span> <span class="toc-text">案例1</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F"><span class="toc-number">1.2.1.</span> <span class="toc-text">异常处理程序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B2"><span class="toc-number">1.3.</span> <span class="toc-text">案例2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B3"><span class="toc-number">1.4.</span> <span class="toc-text">案例3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B4-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F"><span class="toc-number">1.5.</span> <span class="toc-text">案例4 异常处理程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B5-%E5%B8%A6%E8%BE%93%E5%85%A5%E5%8F%82%E6%95%B0-in"><span class="toc-number">1.6.</span> <span class="toc-text">案例5 带输入参数 in</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B6-%E5%B8%A6%E8%BE%93%E5%87%BA%E5%8F%82%E6%95%B0-out"><span class="toc-number">1.7.</span> <span class="toc-text">案例6 带输出参数 out</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B7-%E5%B8%A6%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA%E5%8F%82%E6%95%B0-in-out"><span class="toc-number">1.8.</span> <span class="toc-text">案例7 带输入和输出参数 in out</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B8-inout"><span class="toc-number">1.9.</span> <span class="toc-text">案例8 inout</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B9-%E4%BA%8B%E5%8A%A1-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F"><span class="toc-number">1.10.</span> <span class="toc-text">案例9 事务 异常处理程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B10-%E5%A4%8D%E6%9D%82%E6%A1%88%E4%BE%8B-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86-%E5%9B%9E%E6%BB%9A"><span class="toc-number">1.11.</span> <span class="toc-text">案例10 复杂案例 异常处理 回滚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">1.12.</span> <span class="toc-text">案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-1"><span class="toc-number">1.13.</span> <span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-number">2.2.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">2.3.</span> <span class="toc-text">基本语法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA"><span class="toc-number">2.3.1.</span> <span class="toc-text">创建</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">变量</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">参数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#delimiter"><span class="toc-number">2.3.2.</span> <span class="toc-text">delimiter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E7%94%A8"><span class="toc-number">2.3.3.</span> <span class="toc-text">调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B"><span class="toc-number">2.3.4.</span> <span class="toc-text">查看</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4"><span class="toc-number">2.3.5.</span> <span class="toc-text">删除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F"><span class="toc-number">2.3.6.</span> <span class="toc-text">注意</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86handler"><span class="toc-number">2.4.</span> <span class="toc-text">存储过程异常处理handler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Prepare%E3%80%81execute%E3%80%81deallocate"><span class="toc-number">2.5.</span> <span class="toc-text">Prepare、execute、deallocate</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-number">2.5.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%82%B9"><span class="toc-number">2.5.2.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%96%91%E6%83%91%E8%A7%A3%E7%AD%94"><span class="toc-number">2.5.3.</span> <span class="toc-text">疑惑解答</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-2"><span class="toc-number">2.5.4.</span> <span class="toc-text">案例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0"><span class="toc-number">3.</span> <span class="toc-text">存储函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-1"><span class="toc-number">3.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">3.2.</span> <span class="toc-text">与存储过程的区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">4.</span> <span class="toc-text">触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">4.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-2"><span class="toc-number">4.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#insert%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.3.</span> <span class="toc-text">insert类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#insert%E6%8F%92%E5%85%A5%E4%B9%8B%E5%90%8E%E5%9C%A8%E5%85%B6%E5%AE%83%E8%A1%A8%E6%8F%92%E5%85%A5%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF"><span class="toc-number">4.3.1.</span> <span class="toc-text">insert插入之后在其它表插入相关信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#insert%E6%8F%92%E5%85%A5%E4%B9%8B%E5%89%8D%E6%A3%80%E6%9F%A5%E6%95%B0%E6%8D%AE%E6%98%AF%E5%90%A6%E7%AC%A6%E5%90%88%E8%A7%84%E8%8C%83"><span class="toc-number">4.3.2.</span> <span class="toc-text">insert插入之前检查数据是否符合规范</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#update%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.4.</span> <span class="toc-text">update类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#before-update"><span class="toc-number">4.4.1.</span> <span class="toc-text">before update</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#after-update"><span class="toc-number">4.4.2.</span> <span class="toc-text">after update</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#delete%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.5.</span> <span class="toc-text">delete类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#after-delete"><span class="toc-number">4.5.1.</span> <span class="toc-text">after delete</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#before-delete"><span class="toc-number">4.5.2.</span> <span class="toc-text">before delete</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F-1"><span class="toc-number">5.</span> <span class="toc-text">变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F"><span class="toc-number">5.1.</span> <span class="toc-text">系统变量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D%E5%8F%98%E9%87%8F"><span class="toc-number">5.1.1.</span> <span class="toc-text">会话变量</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B-1"><span class="toc-number">5.1.1.1.</span> <span class="toc-text">查看</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE"><span class="toc-number">5.1.1.2.</span> <span class="toc-text">设置</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="toc-number">5.1.2.</span> <span class="toc-text">全局变量</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F"><span class="toc-number">5.2.</span> <span class="toc-text">用户自定义变量</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B5%8B%E5%80%BC"><span class="toc-number">5.2.0.1.</span> <span class="toc-text">赋值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">5.2.0.2.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F-1"><span class="toc-number">5.2.0.3.</span> <span class="toc-text">注意</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-3"><span class="toc-number">5.2.0.4.</span> <span class="toc-text">案例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F"><span class="toc-number">5.3.</span> <span class="toc-text">局部变量</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E"><span class="toc-number">5.3.0.1.</span> <span class="toc-text">声明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B5%8B%E5%80%BC-1"><span class="toc-number">5.3.0.2.</span> <span class="toc-text">赋值</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IF%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD"><span class="toc-number">6.</span> <span class="toc-text">IF条件判断</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-3"><span class="toc-number">6.0.1.</span> <span class="toc-text">语法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0-1"><span class="toc-number">6.1.</span> <span class="toc-text">参数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%B3%95-1"><span class="toc-number">6.1.1.</span> <span class="toc-text">用法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#case"><span class="toc-number">7.</span> <span class="toc-text">case</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E4%B8%80"><span class="toc-number">7.0.1.</span> <span class="toc-text">语法一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E4%BA%8C"><span class="toc-number">7.0.2.</span> <span class="toc-text">语法二</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF"><span class="toc-number">8.</span> <span class="toc-text">循环</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#while"><span class="toc-number">8.0.1.</span> <span class="toc-text">while</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#repeat"><span class="toc-number">8.0.2.</span> <span class="toc-text">repeat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#loop"><span class="toc-number">8.0.3.</span> <span class="toc-text">loop</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-number">9.</span> <span class="toc-text">视图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8"><span class="toc-number">9.1.</span> <span class="toc-text">作用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%82%B9-1"><span class="toc-number">9.1.1.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9"><span class="toc-number">9.1.2.</span> <span class="toc-text">缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-4"><span class="toc-number">9.2.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-1"><span class="toc-number">9.3.</span> <span class="toc-text">创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E8%A7%86%E5%9B%BE%E5%8F%98%E6%9B%B4%E6%95%B0%E6%8D%AE"><span class="toc-number">9.4.</span> <span class="toc-text">通过视图变更数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%92%E5%85%A5"><span class="toc-number">9.4.1.</span> <span class="toc-text">插入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#WITH-CHECK-OPTION"><span class="toc-number">9.4.2.</span> <span class="toc-text">WITH CHECK OPTION</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4-1"><span class="toc-number">9.4.3.</span> <span class="toc-text">删除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F-2"><span class="toc-number">9.4.4.</span> <span class="toc-text">注意</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%B4%E6%97%B6%E8%A1%A8"><span class="toc-number">10.</span> <span class="toc-text">临时表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-5"><span class="toc-number">10.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F-3"><span class="toc-number">10.2.</span> <span class="toc-text">注意</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/07/14/python%E5%B8%B8%E7%94%A8%E7%94%A8%E6%B3%95%E7%A7%AF%E7%B4%AF/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2025/07/14/python%E5%B8%B8%E7%94%A8%E7%94%A8%E6%B3%95%E7%A7%AF%E7%B4%AF/" title="无题">无题</a><time datetime="2025-07-14T08:25:16.017Z" title="发表于 2025-07-14 16:25:16">2025-07-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/11/%E9%9D%A2%E8%AF%95%20Hbase/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2025/07/11/%E9%9D%A2%E8%AF%95%20Hbase/" title="无题">无题</a><time datetime="2025-07-11T09:24:44.656Z" title="发表于 2025-07-11 17:24:44">2025-07-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/02/%E5%A4%A7%E6%95%B0%E6%8D%AE-hive/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2025/07/02/%E5%A4%A7%E6%95%B0%E6%8D%AE-hive/" title="无题">无题</a><time datetime="2025-07-02T10:28:32.791Z" title="发表于 2025-07-02 18:28:32">2025-07-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/17/Hudi%202022%E9%BB%91%E9%A9%AC%E6%95%B0%E6%8D%AE%E6%B9%96%E6%9E%B6%E6%9E%84%E5%BC%80%E5%8F%91Hudi-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E7%AF%87%201/" title="2022黑马数据湖架构开发Hudi"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2022黑马数据湖架构开发Hudi"/></a><div class="content"><a class="title" href="/2025/01/17/Hudi%202022%E9%BB%91%E9%A9%AC%E6%95%B0%E6%8D%AE%E6%B9%96%E6%9E%B6%E6%9E%84%E5%BC%80%E5%8F%91Hudi-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E7%AF%87%201/" title="2022黑马数据湖架构开发Hudi">2022黑马数据湖架构开发Hudi</a><time datetime="2025-01-17T09:35:02.000Z" title="发表于 2025-01-17 17:35:02">2025-01-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/17/Hudi%202022%E9%BB%91%E9%A9%AC%E6%95%B0%E6%8D%AE%E6%B9%96%E6%9E%B6%E6%9E%84%E5%BC%80%E5%8F%91Hudi-%E5%BA%94%E7%94%A8%E8%BF%9B%E9%98%B6%E7%AF%87%20flink%E9%9B%86%E6%88%90%201/" title="2022黑马数据湖架构开发Hudi-应用进阶篇 flink集成 1"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2022黑马数据湖架构开发Hudi-应用进阶篇 flink集成 1"/></a><div class="content"><a class="title" href="/2025/01/17/Hudi%202022%E9%BB%91%E9%A9%AC%E6%95%B0%E6%8D%AE%E6%B9%96%E6%9E%B6%E6%9E%84%E5%BC%80%E5%8F%91Hudi-%E5%BA%94%E7%94%A8%E8%BF%9B%E9%98%B6%E7%AF%87%20flink%E9%9B%86%E6%88%90%201/" title="2022黑马数据湖架构开发Hudi-应用进阶篇 flink集成 1">2022黑马数据湖架构开发Hudi-应用进阶篇 flink集成 1</a><time datetime="2025-01-17T09:35:02.000Z" title="发表于 2025-01-17 17:35:02">2025-01-17</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-上班摸鱼中.svg" alt="距离月入25k也就还差一个大佬带我~" title="距离月入25k也就还差一个大佬带我~"/><div id="runtimeTextTip"></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2024 - 2025 By <a class="footer-bar-link" href="/" title="智汇君" target="_blank">智汇君</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">97</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">42</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://video-b2g.pages.dev/" title="视频解析"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/视频.png" alt="视频解析"/><span class="back-menu-item-text">视频解析</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://md5-uir.pages.dev/" title="md5值解密"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/MD5.png" alt="md5值解密"/><span class="back-menu-item-text">md5值解密</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://screencheck.pages.dev/#welcome" title="屏幕坏点检查"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/屏幕外观.png" alt="屏幕坏点检查"/><span class="back-menu-item-text">屏幕坏点检查</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://htmleditor-9lo.pages.dev/" title="在线html编辑器"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/html编辑器.png" alt="在线html编辑器"/><span class="back-menu-item-text">在线html编辑器</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">博客</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://ttyong-github-io.pages.dev/" title="旧博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/博客.png" alt="旧博客"/><span class="back-menu-item-text">旧博客</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Git/" style="font-size: 0.88rem;">Git<sup>1</sup></a><a href="/tags/GitHub/" style="font-size: 0.88rem;">GitHub<sup>1</sup></a><a href="/tags/Hexo/" style="font-size: 0.88rem;">Hexo<sup>1</sup></a><a href="/tags/NodeJs/" style="font-size: 0.88rem;">NodeJs<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>3</sup></a><a href="/tags/github/" style="font-size: 0.88rem;">github<sup>1</sup></a><a href="/tags/idea/" style="font-size: 0.88rem;">idea<sup>1</sup></a><a href="/tags/%E5%85%AC%E8%80%83%E6%9D%A8%E8%80%81%E5%B8%88/" style="font-size: 0.88rem;">公考杨老师<sup>10</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 0.88rem;">博客<sup>1</sup></a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 0.88rem;">大数据<sup>31</sup></a><a href="/tags/%E5%AE%89%E7%9F%A5%E9%B1%BC%E4%B8%BB%E9%A2%98/" style="font-size: 0.88rem;">安知鱼主题<sup>1</sup></a><a href="/tags/%E5%BB%96%E9%9B%AA%E5%B3%B0/" style="font-size: 0.88rem;">廖雪峰<sup>15</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">计算机网络<sup>1</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 0.88rem;">面试<sup>10</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("24/12/2024 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2024 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 智汇君 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("24/12/2024 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-下班啦.svg";
        img.title = "下班了就该开开心心的玩耍，嘿嘿~";
        img.alt = "下班了就该开开心心的玩耍，嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script async src="https://at.alicdn.com/t/c/font_4792307_02gxbpyxcpwp.js?spm=a313x.manage_type_myprojects.i1.10.56323a81KZGFDE&amp;file=font_4792307_02gxbpyxcpwp.js# 阿里图标symbol 引用链接，主题会进行加载 symbol 引用"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>