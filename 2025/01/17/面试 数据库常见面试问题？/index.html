<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>面试 数据库常见面试问题？ | Tech智汇站</title><meta name="keywords" content="面试"><meta name="author" content="智汇君"><meta name="copyright" content="智汇君"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="面试 数据库常见面试问题？"><meta name="application-name" content="面试 数据库常见面试问题？"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="面试 数据库常见面试问题？"><meta property="og:url" content="http://example.com/2025/01/17/面试 数据库常见面试问题？/index.html"><meta property="og:site_name" content="Tech智汇站"><meta property="og:description" content="数据库常见面试问题？mysql课程1234567891011121314151617181920212223常用的存储引擎？InnoDB与MyISAM的区别？什么是事务,以及事务的四大特性?事务的隔离级别有哪些,MySQL默认是哪个?内连接与左外连接的区别是什么?MySQL默认InnoDB引擎的索引"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http://example.com/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg"><meta property="article:author" content="智汇君"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://example.com/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg"><meta name="description" content="数据库常见面试问题？mysql课程1234567891011121314151617181920212223常用的存储引擎？InnoDB与MyISAM的区别？什么是事务,以及事务的四大特性?事务的隔离级别有哪些,MySQL默认是哪个?内连接与左外连接的区别是什么?MySQL默认InnoDB引擎的索引"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/01/17/%E9%9D%A2%E8%AF%95%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%EF%BC%9F/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css#fontawesome_animation 如果有就会加载，示例值：https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"与数百名博主无限进步","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":270},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: 智汇君","link":"链接: ","source":"来源: Tech智汇站","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Tech智汇站',
  title: '面试 数据库常见面试问题？',
  postAI: '',
  pageFillDescription: '数据库常见面试问题？, mysql, 课程, 稀土掘金, 什么是幻读脏读不可重复读呢？, limit 1000000 加载很慢的话你是怎么解决的呢？, 在高并发情况下如何做到安全的修改同一行数据？, 使用悲观锁, 使用乐观锁, CSDN案例, 案例一, 1.1, 1.2, 1.3, 3 EXISTS, 7 having的一个使用技巧, 8, 9, 13 avg() over(partition by), 14, 15  变量的使用, 16 dense_rank()、变量的使用, 17 区域段 case when then  concat, 22 like, 25, 33 变量的使用 limit, 34  变量的使用, 41 current_day()substring()year()now(), 42 week, 43 month, 44 month, 案例二, 9 !外连接实现except, 10, 11, 13, 法一, 法二, 法一, 法二, COUNT(1) COUNT(*) COUNT(列名)的区别, COUNT(1)包含忽略所有列用1代表代码行统计时不会忽略列值为NULL, COUNT(*)包含所有列相当于行数统计时不会忽略列值为NULL, COUNT(列名)只包含列名那一列统计时忽略列为NULL(某字段为NULL不计数), Write your MySQL query statement below, Write your MySQL query statement below, Write your MySQL query statement below, 精彩, Write your MySQL query statement below, Write your MySQL query statement below, Write your MySQL query statement below, Write your MySQL query statement below, Write your MySQL query statement below, Write your MySQL query statement below, Write your MySQL query statement below数据库常见面试问题课程常用的存储引擎与的区别什么是事务以及事务的四大特性事务的隔离级别有哪些默认是哪个内连接与左外连接的区别是什么默认引擎的索引是什么数据结构如何查看的执行计划索引失效的情况有哪些什么是回表查询什么是主从复制的原理是什么主从复制之后的读写分离如何实现数据库的分库分表如何实现性能优化经验优化大多依赖索引进行聚集索引和二级索引对于理解优化很关键能使用聚集使用过滤就不使用二级索引效率更高满足业务需求的情况下尽量降低主键的长度因为二级索引叶子节点会存储主键会导致索引数据大插入数据时尽量选择顺序插入选择使用自增主键避免页分裂尽量不要使用做主键或者是其他自然主键如身份证号长度长且无序批量插入数据执行频率慢查询执行计划详情可以从这几个维度回答这个问题加索引避免返回不必要的数据适当分批量进行优化结构分库分表读写分离数据库优化经验四五千万条记录时就可能要考虑分库分表了这是运维篇的内容建立索引的优劣势优缺点优势提高数据检索的效率降低数据库的成本通过索引列对数据进行排序降低数据排序的成本降低的消耗劣势索引列也是要占用空间的索引大大提高了查询效率同时却也降低更新表的速度如对表进行时效率降低为什么存储引擎选择使用索引结构相对于二叉树层级更少搜索效率高对于无论是叶子节点还是非叶子节点都会保存数据这样导致一页中存储的键值减少指针跟着减少要同样保存大量数据只能增加树的高度导致性能降低相对索引支持范围匹配及排序操作估算主键索引树层时大概能存储多少行数据只要给出主键什么类型多大然后一行数据多大就可以估算先算一个页最大能存储多少个主键然后算出指针数再乘以一个页最大能存储多少行数据就行索引使用有哪些注意事项呢讲的条在索引列上使用的内置函数索引失效对索引列运算如索引失效索引字段上使用或者时可能会导致索引失效左连接查询或者右连接查询查询关联的字段编码格式不一样可能导致索引失效索引不适合哪些场景数据量少的不适合加索引更新比较频繁的也不适合加索引区分度低的字段不适合加索引如性别针对于数据量较大条且查询比较频繁的表建立索引针对于常作为查询条件排序分组操作的字段建立索引尽量选择区分度高的列作为索引尽量建立唯一索引区分度越高使用索引的效率越高如果是字符串类型的字段字段的长度较长可以针对于字段的特点建立前缀索引尽量使用联合索引减少单列索引查询时联合索引很多时候可以覆盖索引节省存储空间避免回表提高查询效率要控制素引的数量索引并不是多多益善索引越多维护索引结构的代价也就越大会影响增删改的效率如果索引列不能存储值请在创建表时使用约束它当优化器知道每列是否包含值时它可以更好地确定哪个索引最有效地用于查询遇到过死锁问题吗你是如何解决的我排查死锁的一般步骤是酱紫的查看死锁日志找出死锁分析加锁情况模拟死锁案发分析死锁日志分析死锁结果聚集索引与非聚集索引的区别稀土掘金什么是幻读脏读不可重复读呢脏读幻读数据量不一样不可重复读数据值不一样加载很慢的话你是怎么解决的呢方案一如果是连续的可以这样返回上次查询的最大记录偏移量再往下复制代码方案二在业务允许的情况下限制页数建议跟业务讨论有没有必要查这么后的分页啦因为绝大多数用户都不会往后翻太多页方案三索引为索引复制代码方案四利用延迟关联或者子查询优化超多分页场景先快速定位需要获取的段然后再关联复制代码条件在高并发情况下如何做到安全的修改同一行数据要安全的修改同一行数据就要保证一个线程在修改时其它线程无法更新这行记录一般有悲观锁和乐观锁两种方案使用悲观锁悲观锁思想就是当前线程要进来修改数据时别的线程都得拒之门外比如可以使用以上这条语句会锁定了表中所有符合检索条件的记录本次事务提交之前别的线程都无法修改这些记录使用乐观锁乐观锁思想就是有线程过来先放过去修改如果看到别的线程没修改过就可以修改成功如果别的线程修改过就修改失败或者重试实现方式乐观锁一般会使用版本号机制或算法实现案例案例一链接学生表教师表科目表成绩表查询同时存在课程和课程的情况查询存在课程但可能不存在课程的情况不存在时显示为查询不存在课程但存在课程的学生情况查询平均成绩大于等于分的学生编号和学生姓名和平均成绩查询在表存在成绩的学生信息查询所有同学的学生编号学生姓名选课总数所有课程的总成绩没成绩的显示为查询李姓老师的数量查询学过张三老师授课的同学信息难度系数查询没有学全所有课程的同学的信息查询至少有一门课学号与的同学所学相同的同学信息查询和号同学学习的课程完全相同的其他同学的信息查询没学过张三老师讲授的任一门课程的学生姓名查询两门及其以上不及格课程的同学的学号姓名及其平均成绩检索课程分数小于按分数降序排列的学生信息按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩查询各科成绩最高分最低分和平均分按各科成绩进行排名并显示排名重复时继续排序查询学生的总成绩并进行排名总分重复时保留名次空缺统计各科成绩分数段人数课程编号课程名称及所占百分比查询各科成绩前三名的记录查询每门课程被选修的学生数查询出只选修两门课程的学生学号和姓名查询男生女生人数查询名字中含有风字的学生信息查询同名同姓学生名单并统计同名同性人数查询年出生的学生名单查询每门课程的平均成绩结果按平均成绩降序排列平均成绩相同按课程编号升序排列查询平均成绩大于等于的所有学生的学号姓名和平均成绩查询课程名称为数学且分数低于的学生姓名和分数查询所有学生的课程及分数情况存在学生没成绩没选课的情况查询任何一门课程成绩在分以上的姓名课程名称和分数查询不及格的课程查询课程编号为且课程成绩在分以上的学生的学号和姓名求每门课程的学生人数假设成绩不重复查询选修张三老师所授课程的学生中成绩最高的学生信息及成绩假设成绩有重复查询选修张三老师所授课程的学生中成绩最高的学生信息及成绩查询不同课程成绩相同的学生的学生编号课程编号学生成绩查询每门科目成绩最好的前两名查询存在课程但可能不存在课程的情况不存在时显示为查询不存在课程但存在课程的学生情况的一个使用技巧查询没有学全所有课程的同学的信息选课数目选课数目查询至少有一门课学号与的同学所学相同的同学信息查询和号同学学习的课程完全相同的其他同学的信息按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩学生姓名课程名称成绩平均成绩平均成绩查询各科成绩最高分最低分和平均分课程名称最高分最低分平均分保留两位小数关联课程名称按课程分组避免课程名重复按课程名称排序变量的使用按各科成绩进行排名并显示排名重复时继续排序它这个使用变量的方法也不对如图片自定义变量定义变量用来标识变量使用变量定义并使用变量修改或者重新赋值变量的使用查询学生的总成绩并进行排名总分重复时保留名次空缺排序会有重复的会出现不连续的排序排序相同时会重复但是各个排序序号都是连续的排序不会重复且序号连续区域段统计各科成绩分数段人数课程编号课程名称及所占百分比课程编号课程名称选修人数查询名字中含有风字的学生信息风变量的使用假设成绩不重复查询选修张三老师所授课程的学生中成绩最高的学生信息及成绩法一张三法二先查询张三老师所带的课程编号和张三将以上结果与成绩表关联张三将以上结果与学生表关联学号学生姓名课程教师姓名成绩张三变量的使用假设成绩有重复查询选修张三老师所授课程的学生中成绩最高的学生信息及成绩张三张三按照出生日期来算当前月日出生年月的月日则年龄减一查询本周过生日的学生分析使用函数查询本月过生日的学生分析使用函数查询下月过生日的学生案例二字段名学生编号学生姓名出生年月学生性别字段名科目编号科目名称任课老师编号字段名任课教师标号任课老师姓名字段名学生编号科目编号成绩查询课程比课程成绩高的学生的信息及课程分数查询同时存在课程和课程的情况查询存在课程但可能不存在课程的情况不存在时显示为查询不存在课程但存在课程的情况查询平均成绩大于等于分的同学的学生编号和学生姓名和平均成绩查询在表存在成绩的学生信息查询所有同学的学生编号学生姓名选课总数所有课程的总成绩没成绩的显示为查有成绩的学生信息查询李姓老师的数量查询学过张三老师授课的同学的信息查询没有学全所有课程的同学的信息查询至少有一门课与学号为的同学所学相同的同学的信息查询和号的同学学习的课程完全相同的其他同学的信息查询没学过张三老师讲授的任一门课程的学生姓名查询两门及其以上不及格课程的同学的学号姓名及其平均成绩检索课程分数小于按分数降序排列的学生信息按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩查询各科成绩最高分最低分和平均分以如下形式显示课程课程最高分最低分平均分及格率中等率优良率优秀率及格为中等为优良为优秀为还要求选修人数查询结果按人数降序排列若人数相同按课程号升序排列按各科成绩进行排序并显示排名重复时保留名次空缺按各科成绩进行排序并显示排名重复时合并名次查询学生的总成绩并进行排名总分重复时保留名次空缺查询学生的总成绩并进行排名总分重复时不保留名次空缺统计各科成绩各分数段人数课程编号课程名称及所占百分比查询各科成绩前三名的记录查询每门课程被选修的学生数查询出只选修两门课程的学生学号和姓名查询男生女生人数查询名字中含有风字的学生信息查询同名同性学生名单并统计同名人数查询年出生的学生名单查询每门课程的平均成绩结果按平均成绩降序排列平均成绩相同时按课程编号升序排列查询平均成绩大于等于的所有学生的学号姓名和平均成绩查询课程名称为数学且分数低于的学生姓名和分数查询所有学生的课程及分数情况存在学生没成绩没选课的情况查询任何一门课程成绩在分以上的姓名课程名称和分数查询不及格的课程查询课程编号为且课程成绩在分以上的学生的学号和姓名求每门课程的学生人数成绩不重复查询选修张三老师所授课程的学生中成绩最高的学生信息及其成绩成绩有重复的情况下查询选修张三老师所授课程的学生中成绩最高的学生信息及其成绩查询不同课程成绩相同的学生的学生编号课程编号学生成绩查询每门功成绩最好的前两名统计每门课程的学生选修人数超过人的课程才统计检索至少选修两门课程的学生学号查询选修了全部课程的学生信息查询各学生的年龄只按年份来算按照出生日期来算当前月日出生年月的月日则年龄减一查询本周过生日的学生查询下周过生日的学生查询本月过生日的学生查询下月过生日的学生外连接实现先查询出选修了张三老师讲授课程的张三与学生表关联筛选出不在以上结果内的张三值得注意及格率中等率优良率优秀率尚硅谷大数据技术之数据湖最高分最低分平均分选修人数及格率中等率优良率优秀率下面那个案例值得注意尚硅谷大数据技术之数据湖在上述查询中是最终的排序它确保结果首先按课程号排序然后按分数降序排序如果你只关心排名而不关心最终排序顺序可以省略此子句案例案例尚硅谷大数据技术之数据湖变量的使用法一没看懂法二法六值得注意尚硅谷大数据技术之数据湖法一学生的总成绩名次排序法二法二法五是的例子但用了这里的数据把行数据理解成是总成绩结果有莫名错误尚硅谷大数据技术之数据湖这样接正确了奇怪等同于窗口函数实现的结果尚硅谷大数据技术之数据湖法三法二法五是的例子但用了这里的数据把行数据理解成是总成绩尚硅谷大数据技术之数据湖法四法二法五是的例子但用了这里的数据把行数据理解成是总成绩尚硅谷大数据技术之数据湖法五法二法五是的例子但用了这里的数据把行数据理解成是总成绩尚硅谷大数据技术之数据湖法六法二法五是的例子但用了这里的数据把行数据理解成是总成绩错误写法法二法五是的例子但用了这里的数据把行数据理解成是总成绩值得注意不会课程编号课程名称选修人数的作用是将两个字符拼接起来不会好像有点问题学生编号学生姓名选课数量学生编号学生姓名选课数量风姓名性别同名人数尚硅谷大数据技术之数据湖这里有错误了变量尚硅谷大数据技术之数据湖法一张三法二先查询张三老师所带的课程编号和张三将以上结果与成绩表关联张三将以上结果与学生表关联学号学生姓名课程教师姓名成绩张三也行张三法一选修人数法二选修人数知识点补充列名的区别包含忽略所有列用代表代码行统计时不会忽略列值为包含所有列相当于行数统计时不会忽略列值为列名只包含列名那一列统计时忽略列为某字段为不计数分析使用日期函数进行相减年龄年龄尚硅谷大数据技术之数据湖尚硅谷大数据技术之数据湖尚硅谷大数据技术之数据湖分析日期相减函数参数参数分析使用函数分析使用函数案例三案例第高的薪水函数分数排名表是该表的主键有不同值的列该表的每一行都包含了一场比赛的分数是一个有两位小数点的浮点值编写一个解决方案来查询分数的排名排名按以下规则计算分数应按从高到低排列如果两个分数相等那么两个分数的排名应该相同在排名相同的分数后排名数应该是下一个连续的整数换句话说排名之间不应该有空缺的数字统计表符合条件的不重复的分数的数量作为排名条件是这个分数不小于我因为表数据相同所以排名值最小是表中每个数据都进行排名最后按分数跟排名一样降序排列连续出现的数字变量多同表连接表在中是该表的主键是一个自增列找出所有至少连续出现三次的数字返回的结果表中的数据可以按任意顺序排列结果格式如下面的例子所示示例输入表输出表解释是唯一连续出现至少三次的数字部门工资最高的员工部门工资前三高的所有员工表是该表的主键列具有唯一值的列是表中的外键列该表的每一行都表示员工的姓名和工资它还包含了他们部门的表是该表的主键列具有唯一值的列该表的每一行表示部门和部门名公司的主管们感兴趣的是公司每个部门中谁赚的钱最多一个部门的高收入者是指一个员工的工资在该部门的不同工资中排名前三编写解决方案找出每个部门中收入高的员工以任意顺序返回结果表返回结果格式如下所示删除重复的电子邮箱连表表是该表的主键列具有唯一值的列该表的每一行包含一封电子邮件电子邮件将不包含大写字母编写解决方案删除所有重复的电子邮件只保留一个具有最小的唯一电子邮件上升的温度表是该表具有唯一值的列没有具有相同的不同行该表包含特定日期的温度信息编写解决方案找出与之前昨天的日期相比温度更高的所有日期的行程和用户表是这张表的主键具有唯一值的列这张表中存所有出租车的行程信息每段行程有唯一其中和是表中的外键是一个表示行程状态的枚举类型枚举成员为表是这张表的主键具有唯一值的列这张表中存所有用户每个用户都有一个唯一的是一个表示用户身份的枚举类型枚举成员为是一个表示用户是否被禁止的枚举类型枚举成员为取消率的计算方式如下被司机或乘客取消的非禁止用户生成的订单数量非禁止用户生成的订单总数编写解决方案找出至期间有至少一次行程的非禁止用户乘客和司机都必须未被禁止的取消率非禁止用户即为的用户禁止用户即为的用户其中取消率需要四舍五入保留两位小数返回结果表中的数据无顺序要求精彩用法精彩游戏玩法分析表是此表的主键具有唯一值的列这张表显示了某些游戏的玩家的活动情况每一行是一个玩家的记录他在某一天使用某个设备注销之前登录并玩了很多游戏可能是编写一个解决方案同时报告每组玩家和日期以及玩家到目前为止玩了多少游戏也就是说玩家在该日期之前所玩的游戏总数详细情况请查看示例以任意顺序返回结果表结果格式如下所示示例输入输出方案一关联当前时间之前的数据方案二难游戏玩法分析中位数尚硅谷大数据技术之数据湖尚硅谷大数据技术之数据湖方法一注意事项排序时用会有排名相同的情况中位数的逻辑了解不论个数是奇数偶数中位数在总数除以和总数除以加之间给定数字的频率查询中位数表保存数字的值及其频率在此表中数字为所以中位数是请编写一个查询来查找所有数字的中位数并将结果命名为体育馆的人流量同一天的第一个电话和最后一个电话难编写一个查询来找出那些们在任意一天的第一个电话和最后一个电话都是和同一个人的这些电话不论是拨打者还是接收者都会被记录结果请放在一个任意次序约束的表中查询结果格式如下所示尚硅谷大数据技术之数据湖选出所有在某个时间跟另一个通话的按和每天分组对标号便于找到每天第一个和最后的一通电话某天第一次通话某天最后一次通话对某人某天第一次和最后一次通话的去重计数值为就是题中需求结果尚硅谷大数据技术之数据湖注释问题在中注释不应该使用井号在语句的中间部分尤其是在列表或其他语句结构中井号在中通常用于行尾来标记注释的开始直到行末如果您想在语句的某部分添加注释您应该使用两个连字符后跟空格或者如果注释跨越多行您可以使用注释内容修改列数据类型表是该表的主键此表包含了一些学校的容纳能力容纳能力指的是学校能够接纳学生的最大数量表是该表的主键表中每一行表示有名学生在考试中至少获得了分表中的数据在逻辑上是正确的即记录了高的行相比记录了低的行拥有相同或更少的也就是说对于表中的行与行如果那么每年学校会公布学生申请所需的最低分数要求学校根据所有学生的考试成绩来决定其最低分数要求学校希望确保即使每一个满足分数要求的学生都申请该学校学校也有足够的能力接纳每一个学生学校也希望尽可能多的学生能申请该学校学校必须使用在表中的来作为最低分数要求编写一个查询来查询每所学校的最低分数要求如果同时有多个值满足上述要求则选择其中最小的一个如果数据不足以决定最低分数要求那么输出返回的结果表可以按任意顺序排序查询结果格式如下例所示示例输入表表输出解释学校的容纳能力为选择作为最低分数要求因为学校最多会收到份申请这在学校的容纳能力以内学校的容纳能力为可以选择或作为最低分数要求因为学校最多会收到份申请这在学校的容纳能力以内又因为是所有可选项中最小的因此我们选择学校的容纳能力为选择作为最低分数要求因为学校最多会收到份申请这在学校的容纳能力以内给出的数据不足以确定最低分数要求如果选择作为最低分数要求学校可能会收到份申请然而学校的容纳能力只有我们没有关于更高分数的信息因此我们返回问题三个实验平台中每种实验完成的次数请注意每一对实验平台实验名称都应包含在输出中包括平台上实验次数是零的表是这个表的主键是枚举类型的取值是这三种之一也是枚举类型的取值是这三种之一这个表包含有关随机实验人员进行的实验的用于做实验的平台以及实验名称的信息结果可以以任意顺序给出查询的结果如下所示示例输入输出解释在安卓平台上我们只做了一个实验在平台上我们做了一个实验和一个实验在平台上我们做了两个实验和一个实验笛卡尔积架构表是此表的主键列经验是包含一个值高级初级的枚举类型此表的每一行都显示候选人的月薪和经验一家公司想雇佣新员工公司的工资预算是美元公司的招聘标准是雇佣最多的高级员工在雇佣最多的高级员工后使用剩余预算雇佣最多的初级员工编写一个查询查找根据上述标准雇佣的高级员工和初级员工的数量按任意顺序返回结果表查询结果格式如下例所示示例输入输出说明我们可以雇佣名为的高级员工由于预算是万美元他们的工资总额是万美元我们还有万美元但他们不足以雇佣为的高级员工我们可以雇佣名为的初级员工由于剩下的预算是万美元他们的工资总额是万美元我们还有万美元但他们不足以雇佣为的初级员工按分组开窗按生序排列逐一求和然后就是能招聘的员工能招聘的等级员工上下两表拼接就是题中需求能招聘的等级员工自己思路找出高级和低级的生成临时表然后用变量然后对高级和低级临时表的工资逐行加再筛选出低于预备工资的数据得到高级多少人并且一共花多少再和低级临时表连接条件是高级的总工资低级总工资预算得到低级多少人和低级总工资简单在这里插入图片描述尚硅谷大数据技术之数据湖简单别人的答案用函数子查询就可以了简单简单但我只想到了是算出比率然后再在这里插入图片描述尚硅谷大数据技术之数据湖这里不要用四舍五入简单简单尚硅谷大数据技术之数据湖在这里插入图片描述尚硅谷大数据技术之数据湖尚硅谷大数据技术之数据湖尚硅谷大数据技术之数据湖常用积累删除重复邮件保留最小的来自如果不要貌似多余的会报错不允许在语句的子句中直接使用正在被更新的表尚硅谷大数据技术之数据湖是表的别名这个语句会删除表中所有满足条件和条件的行所以答案这样写的意思是最终会在中而不是在笛卡尔积的表里是吗日期相关函数返回两个日期之间的时间天数月数年数结果把示例的换成就是按年计算参数参数能干什么可以计算相差天数小时分钟和秒相比于函数要灵活很多格式是时间小的前时间大的放在后面计算相差天数其中处可以是以下值之一尚硅谷大数据技术之数据湖缩写月名月数值月的天数值月的天数值年位年位小时小时分钟数值或时间小时微秒从日期增加指定的时间间隔返回的是一个字符串参数是合法的日期表达式参数是您希望添加的时间间隔参数可以是下列值二使用函数为获取当前时间加天当前日期向前推天加小时加分钟加秒加毫秒加周加月加季加年函数可以用来替代略和这两个函数可以查询我们得到的结果集上下偏移相应行数的相应的结果函数查询当前行向上偏移行对应的结果该函数有三个参数第一个为待查询的参数列名第二个为向上偏移的位数第三个参数为超出最上面边界的默认值函数查询当前行向下偏移行对应的结果该函数有三个参数第一个为待查询的参数列名第二个为向下偏移的位数第三个参数为超出最下面边界的默认值语句查询定义在查询中经常会遇到需要重复使用的子查询为了简化查询语句并提高可读性引入了语法通过使用我们可以创建临时表或视图将子查询的结果保存起来并在主查询中使用本文将通过示例介绍中的特点展示其在查询中的优势简化复杂查询提高查询性能使用可以避免在主查询中重复执行相同的子查询从而提高查询性能临时表的结果会被缓存主查询只需要引用临时表即可避免了重复计算子查询的开销一个参数两个参数第一个参数表示从第几行开始取第二个表示取几行其实这个实现分页也是可以的分页例如把结果集分页每页条记录要获取第页的记录可以使用上述查询表示对结果集从号记录开始最多取条注意记录集的索引从开始如果要查询第页那么我们只需要跳过头条记录也就是对结果集从号记录开始查询把设定为总是设定为计算公式为函数的使用如果的值为则返回的值如果的值不为则返回的值输出结果输出结果函数的使用如果成立那么返回值为否则返回值为的值输出结果输出结果函数的使用如果的值为则返回如果的值不为则返回输出结果输出结果安全等于提供了和这两个操作符它们专门用于检查字段是否为当我们使用时如果字段的值为查询将返回如果字段的值不是包括字段中有值和字段为空查询将返回同样地用于检查字段值是否不是普通的不能用于的比较两个式子中有一个或者两个结果为安全等于可以用于包含的比较除了等于等于中两个字符串比较按照字符串规则来字符串和数字比较字符串转换成数字比较尚硅谷大数据技术之数据湖尚硅谷大数据技术之数据湖尚硅谷大数据技术之数据湖安全等于可以用于比较同为一个则为其它情况和类似输入表找出那些没有被的客户推荐的客户的姓名法一法二笛卡尔积笛卡尔积中的笛卡尔积是指两个表的所有可能的组合当两个表没有关联条件时数据库系统会对这两个表进行笛卡尔积操作这会导致性能下降和资源浪费和一样的都是笛卡尔积取余函数不是下标为开始新奇这里的是截取的不能再后面截取截取后也不能重命名这里能因为这里同分组下相同自定义变量表窗口函数时开始支持参考通常将常用的窗口函数分为两大类聚合窗口函数与专用窗口函数求和求平均值求数量求最大值求最小值函数名分类说明排序函数类似于排名并列的结果序号可以重复序号不连续排序函数类似于排名并列的结果序号可以重复序号连续排序函数对该分组下的所有结果作一个排序基于该分组给一个行数你要的操作用于分组的列名按序叠加的列名窗口滑动的数据范围窗口函数参数分组列排序列开始行结束行窗口滑动的数据范围用来限定你要的操作所运用的数据的范围具体有如下这些当前行之前的行之后的行无界限表示从前面的起点表示到后面的终点举例理解一下取当前行和前五行共行取当前行和后五行共行取前五行和后五行共行从当前行到最后的数据表示的是具体的值比这个值小的行比这个值大的行是以当前值为锚点进行计算比如表示如果当前值为的话就取前后的值在到之间的数据则通过字段差值来进行选择如当前行的字段值是那么这个窗口大小的定义就会选择分区中字段值落在至区间的记录行语句格式一语句在执行时将后的表达式的值与各子句的表达式值比较如果相等则执行后面的表达式或语句然后跳出语句否则返回后面的表达式语句格式二后面没有表达式多个子句中的表达式依次执行如果表达式结果为真则执行相应关键字后面的表达式或语句执行完毕之后跳出语句如果所有语句都为则执行子句中的语句小在交换数据和列转行时可以考虑使用语句尚硅谷大数据技术之数据湖可以指定自定义的分隔符不指定的情况下默认是正则表达式语句中符号表示连接符比如其结果就是关闭模式的弊端结果的不确定性关闭可能导致分组查询返回不确定的结果特别是当列表中包含非聚合列且这些列没有包含在子句中时将从每个分组中任意选择一个值作为结果这可能导致结果难以预测和解释调试复杂性在没有的约束下编写的查询可能在逻辑上不那么明确尤其是当查询变得复杂时这可能使得调试和维护查询变得更加困难性能问题虽然不是直接结果但关闭并依赖从分组中随机选择数据可能导致查询效率不是最优的特别是在处理大量数据时标准的偏离更接近于标准对分组操作的定义关闭它可能意味着编写的在其他遵循标准的数据库系统中可能不会工作或者产生不同的结果行转列列转行行转列一般使用或语句聚合函数而列转行一般使用多个查询的方法尚硅谷大数据技术之数据湖尚硅谷大数据技术之数据湖左右外连接当连接键不唯一时还是可以正常连接不用去笛卡尔积然后过滤尚硅谷大数据技术之数据湖尚硅谷大数据技术之数据湖全外连接不支持可以用实现这里需要去重和会去重不会去重从索引开始读取个含义是跳过条取出条数据后面是从第条开始读读取条信息即读取第条数据含义是从下标开始取出条数据后面跟的是条数据即读取第条我们在设计列族的时候可以把经常读取的列存储到一个列族中不经常读取的列放到另一个列族中这样我们在读取部分列的数据的时候就只需要读取对应列族文件中的数据提高读取效率在中数据块大小和大小是两个不同的概念它们具有不同的功能和调整目的数据块大小主要影响中的数据存储和访问性能数据块由多个对集合组成每个数据块的大小在创建表的列族时可以指定数据块大小的设定影响数据块索引的大小数据块越小索引越大从而占用更大内存空间因此在随机查找性能和数据块索引内存占用之间需要权衡如果需要更好的随机查找性能可以将数据块设置为较小的值而如果需要更好的序列扫描性能则可以考虑增大数据块的大小而是中用于保存修改数据即对的内存结构当的大小达到一个阈值默认是时会被到文件即以释放内存空间的大小设置主要影响的写入性能和内存使用如果太小可能导致频繁的操作影响写入性能如果太大则可能消耗过多的内存资源因此数据块大小和大小不一样它们是中两个不同的参数需要根据具体的应用场景和性能需求进行独立调整',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-06-17 10:39:04',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://video-b2g.pages.dev/" title="视频解析"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/视频.png" alt="视频解析"/><span class="back-menu-item-text">视频解析</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://md5-uir.pages.dev/" title="md5值解密"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/MD5.png" alt="md5值解密"/><span class="back-menu-item-text">md5值解密</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://screencheck.pages.dev/#welcome" title="屏幕坏点检查"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/屏幕外观.png" alt="屏幕坏点检查"/><span class="back-menu-item-text">屏幕坏点检查</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://htmleditor-9lo.pages.dev/" title="在线html编辑器"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/html编辑器.png" alt="在线html编辑器"/><span class="back-menu-item-text">在线html编辑器</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">博客</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://ttyong-github-io.pages.dev/" title="旧博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/博客.png" alt="旧博客"/><span class="back-menu-item-text">旧博客</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">Tech智汇站</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/img/%E5%BE%AE%E4%BF%A1%E6%94%B6%E6%AC%BE%E7%A0%81.jpg" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E5%BE%AE%E4%BF%A1%E6%94%B6%E6%AC%BE%E7%A0%81.jpg"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%B6%E6%AC%BE%E7%A0%81.jpg" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%B6%E6%AC%BE%E7%A0%81.jpg"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Git/" style="font-size: 1.05rem;">Git<sup>1</sup></a><a href="/tags/GitHub/" style="font-size: 1.05rem;">GitHub<sup>1</sup></a><a href="/tags/Hexo/" style="font-size: 1.05rem;">Hexo<sup>1</sup></a><a href="/tags/NodeJs/" style="font-size: 1.05rem;">NodeJs<sup>1</sup></a><a href="/tags/git/" style="font-size: 1.05rem;">git<sup>3</sup></a><a href="/tags/github/" style="font-size: 1.05rem;">github<sup>1</sup></a><a href="/tags/idea/" style="font-size: 1.05rem;">idea<sup>1</sup></a><a href="/tags/%E5%85%AC%E8%80%83%E6%9D%A8%E8%80%81%E5%B8%88/" style="font-size: 1.05rem;">公考杨老师<sup>10</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 1.05rem;">博客<sup>1</sup></a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 1.05rem;">大数据<sup>26</sup></a><a href="/tags/%E5%AE%89%E7%9F%A5%E9%B1%BC%E4%B8%BB%E9%A2%98/" style="font-size: 1.05rem;">安知鱼主题<sup>1</sup></a><a href="/tags/%E5%BB%96%E9%9B%AA%E5%B3%B0/" style="font-size: 1.05rem;">廖雪峰<sup>9</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">计算机网络<sup>1</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 1.05rem;">面试<sup>12</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">五月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">四月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">74</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%B1%82%E8%81%8C/" itemprop="url">求职</a><i class="anzhiyufont anzhiyu-icon-angle-right post-meta-separator"></i><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%B1%82%E8%81%8C/%E9%9D%A2%E8%AF%95/" itemprop="url">面试</a></span></div></div><h1 class="post-title" itemprop="name headline">面试 数据库常见面试问题？</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="post-meta-icon anzhiyufont anzhiyu-icon-calendar-days"></i><span class="post-meta-label">发表于</span><time itemprop="dateCreated datePublished" datetime="2025-01-17T09:35:02.000Z" title="发表于 2025-01-17 17:35:02">2025-01-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为重庆"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>重庆</span></div></div></div><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/01/17/%E9%9D%A2%E8%AF%95%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%EF%BC%9F/"><header><a class="post-meta-categories" href="/categories/%E6%B1%82%E8%81%8C/" itemprop="url">求职</a><a class="post-meta-categories" href="/categories/%E6%B1%82%E8%81%8C/%E9%9D%A2%E8%AF%95/" itemprop="url">面试</a><h1 id="CrawlerTitle" itemprop="name headline">面试 数据库常见面试问题？</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">智汇君</span><time itemprop="dateCreated datePublished" datetime="2025-01-17T09:35:02.000Z" title="undefined 2025-01-17 17:35:02">2025-01-17</time></header><h1 id="数据库常见面试问题？"><a href="#数据库常见面试问题？" class="headerlink" title="数据库常见面试问题？"></a>数据库常见面试问题？</h1><h2 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h2><h3 id="课程"><a href="#课程" class="headerlink" title="课程"></a>课程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">常用的存储引擎？InnoDB与MyISAM的区别？</span><br><span class="line"></span><br><span class="line">什么是事务,以及事务的四大特性?</span><br><span class="line"></span><br><span class="line">事务的隔离级别有哪些,MySQL默认是哪个?</span><br><span class="line"></span><br><span class="line">内连接与左外连接的区别是什么?</span><br><span class="line"></span><br><span class="line">MySQL默认InnoDB引擎的索引是什么数据结构?</span><br><span class="line"></span><br><span class="line">如何查看MySQL的执行计划?</span><br><span class="line"></span><br><span class="line">索引失效的情况有哪些?</span><br><span class="line"></span><br><span class="line">什么是回表查询?</span><br><span class="line"></span><br><span class="line">什么是MVCC?</span><br><span class="line"></span><br><span class="line">MySQL主从复制的原理是什么?</span><br><span class="line"></span><br><span class="line">主从复制之后的读写分离如何实现?</span><br><span class="line"></span><br><span class="line">数据库的分库分表如何实现?</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">SQL性能优化经验</span><br><span class="line"></span><br><span class="line">1.sql优化大多依赖索引进行</span><br><span class="line">2.聚集索引和二级索引对于理解sql优化很关键(能使用聚集使用过滤就不使用二级索引，效率更高)</span><br><span class="line">3.满足业务需求的情况下，尽量降低主键的长度 --因为二级索引叶子节点会存储主键，会导致索引数据大</span><br><span class="line">插入数据时，尽量选择顺序插入，选择使用AUTO_INCREMENT自增主键。 --避免页分裂</span><br><span class="line">尽量不要使用UUID做主键或者是其他自然主键，如身份证号  --长度长且无序</span><br><span class="line">4.load data批量插入数据</span><br><span class="line">5.sql执行频率</span><br><span class="line">6.慢查询</span><br><span class="line">7.执行计划</span><br><span class="line">8.profile详情</span><br><span class="line"></span><br><span class="line">可以从这几个维度回答这个问题：</span><br><span class="line">加索引</span><br><span class="line">避免返回不必要的数据</span><br><span class="line">适当分批量进行</span><br><span class="line">优化sql结构</span><br><span class="line">分库分表</span><br><span class="line">读写分离</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">数据库优化经验</span><br><span class="line"></span><br><span class="line">四五千万条记录时，就可能要考虑分库分表了，这是运维篇的内容</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">建立索引的优劣势</span><br><span class="line"></span><br><span class="line">优缺点</span><br><span class="line">优势</span><br><span class="line">提高数据检索的效率，降低数据库的IO成本</span><br><span class="line">通过索引列对数据进行排序，降低数据排序的成本，降低CPU的消耗。</span><br><span class="line"></span><br><span class="line">劣势</span><br><span class="line">索引列也是要占用空间的</span><br><span class="line">索引大大提高了查询效率，同时却也降低更新表的速度，如对表进行INSERT、UPDATE、DELETE时，效率降低。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">为什么InnoDB存储引擎选择使用B+tree索引结构?</span><br><span class="line"></span><br><span class="line">相对于二叉树，层级更少，搜索效率高;</span><br><span class="line">对于B-tree，无论是叶子节点还是非叶子节点，都会保存数据，这样导致一页中存储的键值减少，指针跟着减少，要同样保存大量数据，只能增加树的高度，导致性能降低</span><br><span class="line">相对Hash索引，B+tree支持范围匹配及排序操作</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">估算主键索引树2，3层时，大概能存储多少行数据？</span><br><span class="line"></span><br><span class="line">只要给出主键什么类型，多大，然后一行数据多大？就可以估算</span><br><span class="line">1.先算一个页最大能存储多少个主键 2.然后算出指针数，再乘以一个页最大能存储多少行数据就行</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MySQL 索引使用有哪些注意事项呢？</span><br><span class="line"></span><br><span class="line">讲的10条</span><br><span class="line">+</span><br><span class="line">在索引列上使用mysql的内置函数，索引失效。</span><br><span class="line">对索引列运算（如，+、-、*、/），索引失效。</span><br><span class="line">索引字段上使用（！= 或者 &lt; &gt;，not in）时，可能会导致索引失效。</span><br><span class="line">左连接查询或者右连接查询查询关联的字段编码格式不一样，可能导致索引失效。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">索引不适合哪些场景</span><br><span class="line"></span><br><span class="line">数据量少的不适合加索引</span><br><span class="line">更新比较频繁的也不适合加索引</span><br><span class="line">区分度低的字段不适合加索引（如性别）</span><br><span class="line"></span><br><span class="line">针对于数据量较大(300w条)，且查询比较频繁的表建立索引。</span><br><span class="line">针对于常作为查询条件(where)、排序 (order by)、分组 (group by)操作的字段建立索引。</span><br><span class="line">尽量选择区分度高的列作为索引，尽量建立唯一索引，区分度越高，使用索引的效率越高。</span><br><span class="line">如果是字符串类型的字段，字段的长度较长，可以针对于字段的特点，建立前缀索引。</span><br><span class="line">尽量使用联合索引，减少单列索引，查询时，联合索引很多时候可以覆盖索引，节省存储空间，避免回表，提高查询效率。要控制素引的数量，索引并不是多多益善，索引越多，维护索引结构的代价也就越大，会影响增删改的效率。</span><br><span class="line">如果索引列不能存储NULL值，请在创建表时使用NOT NULL约束它。当优化器知道每列是否包含NULL值时，它可以更好地确定哪个索引最有效地用于查询。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MySQL 遇到过死锁问题吗，你是如何解决的？</span><br><span class="line">我排查死锁的一般步骤是酱紫的：</span><br><span class="line"></span><br><span class="line">查看死锁日志show engine innodb status;</span><br><span class="line">找出死锁Sql</span><br><span class="line">分析sql加锁情况</span><br><span class="line">模拟死锁案发</span><br><span class="line">分析死锁日志</span><br><span class="line">分析死锁结果</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">聚集索引与非聚集索引的区别</span><br></pre></td></tr></table></figure>

<h3 id="稀土掘金"><a href="#稀土掘金" class="headerlink" title="稀土掘金"></a>稀土掘金</h3><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904166939164680">url</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904177261363213">url</a></p>
<h4 id="什么是幻读，脏读，不可重复读呢？"><a href="#什么是幻读，脏读，不可重复读呢？" class="headerlink" title="什么是幻读，脏读，不可重复读呢？"></a>什么是幻读，脏读，不可重复读呢？</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">脏读  x</span><br><span class="line">幻读  数据量不一样</span><br><span class="line">不可重复读 数据值不一样</span><br></pre></td></tr></table></figure>

<h4 id="limit-1000000-加载很慢的话，你是怎么解决的呢？"><a href="#limit-1000000-加载很慢的话，你是怎么解决的呢？" class="headerlink" title="limit 1000000 加载很慢的话，你是怎么解决的呢？"></a>limit 1000000 加载很慢的话，你是怎么解决的呢？</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">方案一：如果id是连续的，可以这样，返回上次查询的最大记录(偏移量)，再往下limit</span><br><span class="line">复制代码select id，name from employee where id&gt;1000000 limit 10.</span><br><span class="line"></span><br><span class="line">方案二：在业务允许的情况下限制页数：</span><br><span class="line">建议跟业务讨论，有没有必要查这么后的分页啦。因为绝大多数用户都不会往后翻太多页。</span><br><span class="line"></span><br><span class="line">方案三：order by + 索引（id为索引）</span><br><span class="line">复制代码select id，name from employee order by id  limit 1000000，10</span><br><span class="line"></span><br><span class="line">方案四：利用延迟关联或者子查询优化超多分页场景。（先快速定位需要获取的id段，然后再关联）</span><br><span class="line">复制代码SELECT a.* FROM employee a, (select id from employee where 条件 LIMIT 1000000,10 ) b where a.id=b.id</span><br></pre></td></tr></table></figure>

<h4 id="在高并发情况下，如何做到安全的修改同一行数据？"><a href="#在高并发情况下，如何做到安全的修改同一行数据？" class="headerlink" title="在高并发情况下，如何做到安全的修改同一行数据？"></a>在高并发情况下，如何做到安全的修改同一行数据？</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">要安全的修改同一行数据，就要保证一个线程在修改时其它线程无法更新这行记录。一般有悲观锁和乐观锁两种方案~</span><br></pre></td></tr></table></figure>

<h5 id="使用悲观锁"><a href="#使用悲观锁" class="headerlink" title="使用悲观锁"></a>使用悲观锁</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">悲观锁思想就是，当前线程要进来修改数据时，别的线程都得拒之门外~</span><br><span class="line">比如，可以使用select…for update ~</span><br><span class="line">select * from User where name=‘jay’ for update</span><br><span class="line">update xxx</span><br><span class="line"></span><br><span class="line">以上这条sql语句会锁定了User表中所有符合检索条件（name=‘jay’）的记录。本次事务提交之前，别的线程都无法修改这些记录。</span><br></pre></td></tr></table></figure>

<h5 id="使用乐观锁"><a href="#使用乐观锁" class="headerlink" title="使用乐观锁"></a>使用乐观锁</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">乐观锁思想就是，有线程过来，先放过去修改，如果看到别的线程没修改过，就可以修改成功，如果别的线程修改过，就修改失败或者重试。实现方式：乐观锁一般会使用版本号机制或CAS算法实现。</span><br></pre></td></tr></table></figure>

<h4 id="CSDN案例"><a href="#CSDN案例" class="headerlink" title="CSDN案例"></a>CSDN案例</h4><h5 id="案例一"><a href="#案例一" class="headerlink" title="案例一"></a>案例一</h5><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42444823/article/details/122565671">csdn链接</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"># 学生表 Student：</span><br><span class="line"> </span><br><span class="line">create table Student(</span><br><span class="line"> </span><br><span class="line">SId varchar(10) ,</span><br><span class="line"> </span><br><span class="line">Sname varchar(10),</span><br><span class="line"> </span><br><span class="line">Sage datetime,</span><br><span class="line"> </span><br><span class="line">Ssex varchar(10));</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># 教师表 Teacher</span><br><span class="line"> </span><br><span class="line">create table Teacher(</span><br><span class="line"> </span><br><span class="line">TId varchar(10),</span><br><span class="line"> </span><br><span class="line">Tname varchar(10)); </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># 科目表 Course</span><br><span class="line"> </span><br><span class="line">create table Course(</span><br><span class="line"> </span><br><span class="line">CId varchar(10),</span><br><span class="line"> </span><br><span class="line">Cname nvarchar(10),</span><br><span class="line"> </span><br><span class="line">TId varchar(10)); </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># 成绩表 SC</span><br><span class="line"> </span><br><span class="line">create table SC(</span><br><span class="line"> </span><br><span class="line">SId varchar(10),</span><br><span class="line"> </span><br><span class="line">CId varchar(10),</span><br><span class="line"> </span><br><span class="line">score decimal(18,1)); </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1.1查询同时存在01课程和02课程的情况</span><br><span class="line"></span><br><span class="line">1.2查询存在01课程但可能不存在02课程的情况（不存在时显示为null）</span><br><span class="line"></span><br><span class="line">1.3查询不存在01课程但存在02课程的学生情况</span><br><span class="line"></span><br><span class="line">2.0查询平均成绩大于等于60分的学生编号和学生姓名和平均成绩</span><br><span class="line">where group by having</span><br><span class="line"></span><br><span class="line">3.0查询在sc表存在成绩的学生信息</span><br><span class="line"></span><br><span class="line">4.0查询所有同学的学生编号、学生姓名、选课总数、所有课程的总成绩（没成绩的显示为nulll）</span><br><span class="line">IFNULL(a,b)</span><br><span class="line">sum(case when then else)</span><br><span class="line">5.0查询[李]姓老师的数量</span><br><span class="line"></span><br><span class="line">6.0查询学过[张三]老师授课的同学信息(难度系数★★★)</span><br><span class="line"></span><br><span class="line">7.0查询没有学全所有课程的同学的信息</span><br><span class="line"></span><br><span class="line">8.0查询至少有一门课学号与01的同学所学相同的同学信息</span><br><span class="line"></span><br><span class="line">9.0查询和01号同学学习的课程完全相同的其他同学的信息</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">10.查询没学过[张三]老师讲授的任一门课程的学生姓名</span><br><span class="line"></span><br><span class="line">11.查询两门及其以上不及格课程的同学的学号，姓名及其平均成绩</span><br><span class="line"></span><br><span class="line">12.检索01课程分数小于60，按分数降序排列的学生信息</span><br><span class="line"></span><br><span class="line">13.按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩1</span><br><span class="line"></span><br><span class="line">14.查询各科成绩最高分、最低分和平均分</span><br><span class="line"></span><br><span class="line">15.按各科成绩进行排名，并显示排名，score重复时继续排序</span><br><span class="line"></span><br><span class="line">16.查询学生的总成绩，并进行排名，总分重复时保留名次空缺</span><br><span class="line"></span><br><span class="line">17.统计各科成绩分数段人数，课程编号，课程名称，[100-85][85-70][70-60][60-0]及所占百分比</span><br><span class="line"></span><br><span class="line">18.查询各科成绩前三名的记录</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">19.查询每门课程被选修的学生数</span><br><span class="line"></span><br><span class="line">20.查询出只选修两门课程的学生学号和姓名</span><br><span class="line"></span><br><span class="line">21.查询男生、女生人数</span><br><span class="line"></span><br><span class="line">22.查询名字中含有[风]字的学生信息</span><br><span class="line"></span><br><span class="line">23.查询同名同姓学生名单，并统计同名同性人数</span><br><span class="line"></span><br><span class="line">24.查询1990年出生的学生名单</span><br><span class="line"></span><br><span class="line">25.查询每门课程的平均成绩，结果按平均成绩降序排列，平均成绩相同，按课程编号升序排列</span><br><span class="line"></span><br><span class="line">26.查询平均成绩大于等于85的所有学生的学号、姓名和平均成绩</span><br><span class="line"></span><br><span class="line">27.查询课程名称为[数学]，且分数低于60的学生姓名和分数</span><br><span class="line"></span><br><span class="line">28.查询所有学生的课程及分数情况（存在学生没成绩没选课的情况）</span><br><span class="line"></span><br><span class="line">29.查询任何一门课程成绩在70分以上的姓名、课程名称和分数</span><br><span class="line"></span><br><span class="line">30.查询不及格的课程 </span><br><span class="line"></span><br><span class="line">31.查询课程编号为01且课程成绩在80分以上的学生的学号和姓名 </span><br><span class="line"></span><br><span class="line">32.求每门课程的学生人数 </span><br><span class="line"></span><br><span class="line">33.假设成绩不重复，查询选修[张三]老师所授课程的学生中，成绩最高的学生信息及成绩 </span><br><span class="line"></span><br><span class="line">34.假设成绩有重复，查询选修[张三]老师所授课程的学生中，成绩最高的学生信息及成绩 </span><br><span class="line"></span><br><span class="line">35.查询不同课程成绩相同的学生的学生编号、课程编号、学生成绩 </span><br><span class="line"></span><br><span class="line">36.查询每门科目成绩最好的前两名 </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="1-1"><a href="#1-1" class="headerlink" title="1.1"></a>1.1</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1.</span><br><span class="line">SELECT a.Sid,a.score 01_score,b.score 02_score</span><br><span class="line">FROM (SELECT * FROM sc WHERE Cid = 01) AS a,(SELECT * FROM sc WHERE Cid = 02) AS b </span><br><span class="line">WHERE a.Sid = b.Sid ;</span><br><span class="line"></span><br><span class="line">2.</span><br><span class="line">SELECT C1.sid, C3.sname, C3.sage, C3.ssex, C1.score AS score1, </span><br><span class="line">	C2.score AS score2 </span><br><span class="line">FROM (SELECT * FROM SC WHERE Cid = &#x27;01&#x27;) AS C1 </span><br><span class="line">	INNER JOIN (SELECT * FROM SC WHERE Cid = &#x27;02&#x27;) AS C2 </span><br><span class="line">ON C1.sid = C2.sid </span><br><span class="line">	INNER JOIN Student AS C3 </span><br><span class="line">    ON C1.sid = C3.sid ;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h6 id="1-2"><a href="#1-2" class="headerlink" title="1.2"></a>1.2</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">查询存在01课程但可能不存在02课程的情况（不存在时显示为null）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM (SELECT * FROM sc WHERE cid = &#x27;01&#x27;) a</span><br><span class="line">LEFT JOIN sc </span><br><span class="line">ON a.sid = sc.sid AND sc.cid = &#x27;02&#x27;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">----</span><br><span class="line">SELECT *</span><br><span class="line">FROM (SELECT * FROM sc WHERE cid = &#x27;01&#x27;) a</span><br><span class="line">LEFT JOIN (SELECT * FROM sc WHERE cid = &#x27;02&#x27;) b</span><br><span class="line">ON a.sid = b.sid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">SELECT *</span><br><span class="line">FROM sc a</span><br><span class="line">LEFT JOIN sc b</span><br><span class="line">ON a.sid = b.sid AND b.cid = &#x27;02&#x27;</span><br><span class="line">WHERE a.cid = &#x27;01&#x27;;</span><br></pre></td></tr></table></figure>

<h6 id="1-3"><a href="#1-3" class="headerlink" title="1.3"></a>1.3</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">查询不存在01课程但存在02课程的学生情况</span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM sc s1</span><br><span class="line">WHERE s1.CId=&#x27;02&#x27; AND s1.SId not in (</span><br><span class="line">SELECT s2.SId</span><br><span class="line">FROM sc s2</span><br><span class="line">WHERE s2.CId=&#x27;01&#x27;);</span><br></pre></td></tr></table></figure>

<h5 id="3-EXISTS"><a href="#3-EXISTS" class="headerlink" title="3 EXISTS"></a>3 EXISTS</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT s.student id,s.name,s.age, s.genderFRoM student s</span><br><span class="line">JOIN SC sc ON s.student id= sc.student id</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SELECT s.student id,s.name, s.age, s.genderFROM student s</span><br><span class="line">WHERE EXISTS(</span><br><span class="line">SELECT 1</span><br><span class="line">FROM SC SC</span><br><span class="line">WHERE sc.student id=s.student id</span><br></pre></td></tr></table></figure>



<h6 id="7-having的一个使用技巧"><a href="#7-having的一个使用技巧" class="headerlink" title="7 having的一个使用技巧"></a>7 having的一个使用技巧</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">查询没有学全所有课程的同学的信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SELECT SC.SId,COUNT(cid) 选课数目</span><br><span class="line">			FROM sc</span><br><span class="line">			GROUP BY sid</span><br><span class="line">			HAVING 选课数目 &lt; (SELECT COUNT(cid)FROM course c)</span><br></pre></td></tr></table></figure>

<h6 id="8"><a href="#8" class="headerlink" title="8"></a>8</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">查询至少有一门课学号与01的同学所学相同的同学信息</span><br><span class="line"></span><br><span class="line">SELECT DISTINCT a.*</span><br><span class="line">FROM student a</span><br><span class="line">INNER JOIN (SELECT *</span><br><span class="line">			FROM sc</span><br><span class="line">			WHERE cid IN (SELECT cid FROM sc WHERE sid = &quot;01&quot;)) b</span><br><span class="line">ON a.sid = b.sid;</span><br><span class="line"> </span><br><span class="line">----</span><br><span class="line">SELECT DISTINCT s.*</span><br><span class="line">FROM sc</span><br><span class="line">INNER JOIN student s</span><br><span class="line">ON sc.sid = s.sid</span><br><span class="line">WHERE sc.cid IN (SELECT cid FROM sc WHERE sid = &quot;01&quot;);</span><br></pre></td></tr></table></figure>





<h6 id="9"><a href="#9" class="headerlink" title="9"></a>9</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">查询和01号同学学习的课程完全相同的其他同学的信息</span><br><span class="line"></span><br><span class="line">SELECT SId,COUNT(*) num</span><br><span class="line">FROM </span><br><span class="line">(</span><br><span class="line">SELECT s1.SId,s1.CId</span><br><span class="line">FROM sc s1</span><br><span class="line">INNER JOIN</span><br><span class="line">(</span><br><span class="line">SELECT sc.*</span><br><span class="line">FROM sc</span><br><span class="line">WHERE sc.SId=&#x27;01&#x27;) s2</span><br><span class="line">WHERE s1.CId=s2.CId</span><br><span class="line">) t</span><br><span class="line">GROUP BY SId</span><br><span class="line">HAVING num = (SELECT COUNT(*) FROM sc WHERE sc.SId=&#x27;01&#x27;)</span><br></pre></td></tr></table></figure>

<h6 id="13-avg-over-partition-by"><a href="#13-avg-over-partition-by" class="headerlink" title="13 avg() over(partition by)"></a>13 avg() over(partition by)</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩</span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM sc s1</span><br><span class="line">INNER JOIN</span><br><span class="line">(</span><br><span class="line">SELECT SId,AVG(score) as avg</span><br><span class="line">FROM sc</span><br><span class="line">GROUP BY SId</span><br><span class="line">) s2</span><br><span class="line">on s1.SId=s2.SId</span><br><span class="line">ORDER BY avg DESC,s1.SId</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    s.student_name AS 学生姓名,</span><br><span class="line">    c.course_name AS 课程名称,</span><br><span class="line">    g.score AS 成绩,</span><br><span class="line">    AVG(g.score) OVER (PARTITION BY s.student_id) AS 平均成绩</span><br><span class="line">FROM</span><br><span class="line">    grades g</span><br><span class="line">JOIN students s ON g.student_id = s.student_id</span><br><span class="line">JOIN courses c ON g.course_id = c.course_id</span><br><span class="line">ORDER BY</span><br><span class="line">    平均成绩 DESC,</span><br><span class="line">    s.student_name,</span><br><span class="line">    c.course_name;</span><br></pre></td></tr></table></figure>

<h6 id="14"><a href="#14" class="headerlink" title="14"></a>14</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">查询各科成绩最高分、最低分和平均分</span><br><span class="line"></span><br><span class="line">SELECT</span><br><span class="line">    c.course_name AS 课程名称,</span><br><span class="line">    MAX(g.score) AS 最高分,</span><br><span class="line">    MIN(g.score) AS 最低分,</span><br><span class="line">    ROUND(AVG(g.score), 2) AS 平均分  -- 保留两位小数</span><br><span class="line">FROM</span><br><span class="line">    grades g</span><br><span class="line">JOIN courses c ON g.course_id = c.course_id  -- 关联课程名称</span><br><span class="line">GROUP BY</span><br><span class="line">    c.course_id  -- 按课程分组（避免课程名重复）</span><br><span class="line">ORDER BY c.course_name;  -- 按课程名称排序</span><br></pre></td></tr></table></figure>



<h6 id="15-变量的使用"><a href="#15-变量的使用" class="headerlink" title="15  变量的使用"></a>15  变量的使用</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">按各科成绩进行排名，并显示排名，score重复时继续排序</span><br><span class="line"></span><br><span class="line">SELECT sc.* ,DENSE_RANK() over(PARTITION by CId ORDER BY score DESC) r</span><br><span class="line">FROM sc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-----  它这个使用变量的方法也不对 如图片</span><br><span class="line">SELECT sid,</span><br><span class="line">	   cid,</span><br><span class="line">	   score,</span><br><span class="line">	   @rank:=@rank+1 as rk</span><br><span class="line">FROM sc,(SELECT @rank:=0) as t</span><br><span class="line">ORDER BY score DESC;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 自定义变量 --</span><br><span class="line"># ① 定义变量 set @a:=2 (@用来标识变量),使用变量select @a</span><br><span class="line"># ② 定义并使用变量 select @b:=4 </span><br><span class="line"># 修改或者重新赋值 select @b:=6</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202410130953637.png" alt="image-20241013095305533"></p>
<h6 id="16-dense-rank-、变量的使用"><a href="#16-dense-rank-、变量的使用" class="headerlink" title="16 dense_rank()、变量的使用"></a>16 dense_rank()、变量的使用</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">查询学生的总成绩，并进行排名，总分重复时保留名次空缺</span><br><span class="line"></span><br><span class="line">SELECT SId,totalscore,DENSE_RANK()over(ORDER BY totalscore DESC) r</span><br><span class="line">FROM</span><br><span class="line">(</span><br><span class="line">SELECT SId,SUM(score) totalscore</span><br><span class="line">FROM sc</span><br><span class="line">GROUP BY SId</span><br><span class="line">) t</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT a.*,</span><br><span class="line">		@rank:=IF(@sco=sum_score,@rank+0,@rank+1) rk</span><br><span class="line">FROM (SELECT sid,</span><br><span class="line">			 SUM(score) sum_score</span><br><span class="line">	  FROM sc</span><br><span class="line">	  GROUP BY sid</span><br><span class="line">	  ORDER BY sum_score DESC) a,(select @sco:=null,@rank:=0) b</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rank()排序会有重复的，会出现不连续的排序</span><br><span class="line">dense_rank()排序相同时会重复，但是各个排序序号都是连续的</span><br><span class="line">row_number()排序不会重复，且序号连续</span><br></pre></td></tr></table></figure>



<h6 id="17-区域段-case-when-then-concat"><a href="#17-区域段-case-when-then-concat" class="headerlink" title="17 区域段 case when then  concat"></a>17 区域段 case when then  concat</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">统计各科成绩分数段人数，课程编号，课程名称，[100-85][85-70][70-60][60-0]及所占百分比</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SELECT sc.CId 课程编号,c.Cname 课程名称,COUNT(1) 选修人数</span><br><span class="line">	   ,CONCAT(ROUND(SUM(CASE WHEN sc.score &gt;=0 AND sc.score &lt;= 60 THEN 1 ELSE 0 END)/COUNT(1),2),&#x27;%&#x27;) AS &#x27;(0-60]&#x27;</span><br><span class="line">       ,CONCAT(ROUND(SUM(CASE WHEN sc.score &gt;=60 AND sc.score &lt;= 70 THEN 1 ELSE 0 END)/COUNT(1),2),&#x27;%&#x27;) AS &#x27;(60-70]&#x27;</span><br><span class="line">       ,CONCAT(ROUND(SUM(CASE WHEN sc.score &gt;= 70 AND sc.score &lt;= 85 THEN 1 ELSE 0 END)/COUNT(1),2),&#x27;%&#x27;) AS &#x27;(70-85]&#x27;</span><br><span class="line">       ,CONCAT(ROUND(SUM(CASE WHEN sc.score &gt;= 85 AND sc.score &lt;= 100 THEN 1 ELSE 0 END)/COUNT(1),2),&#x27;%&#x27;) AS &#x27;(85-100]&#x27;</span><br><span class="line">FROM sc</span><br><span class="line">LEFT JOIN course c</span><br><span class="line">ON sc.cId = c.CId</span><br><span class="line">GROUP BY sc.CId,c.Cname</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h6 id="22-like"><a href="#22-like" class="headerlink" title="22 like"></a>22 like</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">查询名字中含有[风]字的学生信息</span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM student </span><br><span class="line">WHERE sname LIKE &#x27;%风%&#x27;;</span><br></pre></td></tr></table></figure>

<h6 id="25"><a href="#25" class="headerlink" title="25"></a>25</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT CId,AVG(score) avg</span><br><span class="line">FROM sc</span><br><span class="line">GROUP BY CId</span><br><span class="line">ORDER BY avg desc,CId</span><br></pre></td></tr></table></figure>

<h6 id="33-变量的使用-limit"><a href="#33-变量的使用-limit" class="headerlink" title="33 变量的使用 limit"></a>33 变量的使用 limit</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">假设成绩不重复，查询选修[张三]老师所授课程的学生中，成绩最高的学生信息及成绩 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 法一</span><br><span class="line">SELECT *</span><br><span class="line">FROM teacher t</span><br><span class="line">LEFT JOIN course c</span><br><span class="line">ON t.tid = c.tid</span><br><span class="line">LEFT JOIN sc</span><br><span class="line">ON c.cid = sc.cid</span><br><span class="line">LEFT JOIN student s</span><br><span class="line">ON s.sid = sc.sid</span><br><span class="line">WHERE t.tname = &quot;张三&quot;</span><br><span class="line">ORDER BY sc.score DESC</span><br><span class="line">LIMIT 1;</span><br><span class="line"> </span><br><span class="line"># 法二</span><br><span class="line">-- 1.先查询[张三]老师所带的课程编号cid和tid --</span><br><span class="line">SELECT *</span><br><span class="line">FROM teacher t</span><br><span class="line">LEFT JOIN course c</span><br><span class="line">ON t.tid = c.tid</span><br><span class="line">WHERE t.tname = &quot;张三&quot;;</span><br><span class="line">-- 2.将以上结果与成绩表sc关联 --</span><br><span class="line">SELECT sc.sid,a.cid,a.cname,a.tname,sc.score</span><br><span class="line">FROM (SELECT t.tid,t.tname,c.cid,c.cname</span><br><span class="line">	  FROM teacher t</span><br><span class="line">	  LEFT JOIN course c</span><br><span class="line">	  ON t.tid = c.tid</span><br><span class="line">	  WHERE t.tname = &quot;张三&quot;) a </span><br><span class="line">LEFT JOIN sc</span><br><span class="line">ON a.cid = sc.cid</span><br><span class="line">ORDER BY sc.score DESC</span><br><span class="line">LIMIT 1;</span><br><span class="line">-- 3.将以上结果与学生表student关联 --</span><br><span class="line">SELECT s.sid 学号,s.sname 学生姓名,a.cname 课程,a.tname 教师姓名,a.score 成绩</span><br><span class="line">FROM (SELECT sc.sid,a.cid,a.cname,a.tname,sc.score</span><br><span class="line">	  FROM (SELECT t.tid,t.tname,c.cid,c.cname</span><br><span class="line">			FROM teacher t</span><br><span class="line">			LEFT JOIN course c</span><br><span class="line">			ON t.tid = c.tid</span><br><span class="line">			WHERE t.tname = &quot;张三&quot;) a </span><br><span class="line">		LEFT JOIN sc</span><br><span class="line">		ON a.cid = sc.cid</span><br><span class="line">ORDER BY sc.score DESC</span><br><span class="line">LIMIT 1) a</span><br><span class="line">LEFT JOIN student s</span><br><span class="line">ON a.sid = s.sid;</span><br></pre></td></tr></table></figure>



<h6 id="34-变量的使用"><a href="#34-变量的使用" class="headerlink" title="34  变量的使用"></a>34  变量的使用</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">假设成绩有重复，查询选修[张三]老师所授课程的学生中，成绩最高的学生信息及成绩 </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">SET @score:=NULL,@rank:=0;</span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM </span><br><span class="line">(SELECT a.*,</span><br><span class="line">		CASE WHEN @score=score THEN @rank</span><br><span class="line">			 ELSE @score:=score AND @rank:=@rank+1 END rk</span><br><span class="line">FROM </span><br><span class="line">(SELECT s.sid,s.sname,sc.score,c.cid,c.cname</span><br><span class="line"> FROM teacher t</span><br><span class="line"> LEFT JOIN course c</span><br><span class="line"> ON t.tid = c.tid</span><br><span class="line"> LEFT JOIN sc</span><br><span class="line"> ON c.cid = sc.cid</span><br><span class="line"> LEFT JOIN student s</span><br><span class="line"> ON s.sid = sc.sid</span><br><span class="line"> WHERE t.tname = &quot;张三&quot;) a) s</span><br><span class="line"> ORDER BY rk DESC</span><br><span class="line">LIMIT 1;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM </span><br><span class="line">(SELECT a.*,</span><br><span class="line">		CASE WHEN @score=score THEN @rank</span><br><span class="line">			 ELSE @score:=score AND @rank:=@rank+1 END rk</span><br><span class="line">FROM </span><br><span class="line">(SELECT s.sid,s.sname,sc.score,c.cid,c.cname</span><br><span class="line"> FROM teacher t</span><br><span class="line"> LEFT JOIN course c</span><br><span class="line"> ON t.tid = c.tid</span><br><span class="line"> LEFT JOIN sc</span><br><span class="line"> ON c.cid = sc.cid</span><br><span class="line"> LEFT JOIN student s</span><br><span class="line"> ON s.sid = sc.sid</span><br><span class="line"> WHERE t.tname = &quot;张三&quot;) a,(SELECT @score:=NULL,@rank:=0) t) s</span><br><span class="line"> ORDER BY rk DESC</span><br><span class="line">LIMIT 1;</span><br></pre></td></tr></table></figure>

<h6 id="41-current-day-substring-year-now"><a href="#41-current-day-substring-year-now" class="headerlink" title="41 current_day(),substring(),year(),now()"></a>41 current_day(),substring(),year(),now()</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">current_day()	2024-10-14</span><br><span class="line"></span><br><span class="line">now()	2024-10-14 11:01:11</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">按照出生日期来算，当前月日 &lt; 出生年月的月日 则年龄减一 </span><br><span class="line"></span><br><span class="line">SELECT student.SId,CASE </span><br><span class="line">	WHEN SUBSTRING(CURRENT_DATE(),6,10)-SUBSTRING(Sage,6,10)&gt;=0</span><br><span class="line">	THEN</span><br><span class="line">		YEAR(CURRENT_DATE())-YEAR(Sage)</span><br><span class="line">	ELSE</span><br><span class="line">		YEAR(CURRENT_DATE())-YEAR(Sage)-1</span><br><span class="line">END age</span><br><span class="line">FROM student</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">    Sno, </span><br><span class="line">    Sname, </span><br><span class="line">    YEAR(CURDATE()) - YEAR(Sage) - </span><br><span class="line">    (DATE_FORMAT(CURDATE(), &#x27;%m%d&#x27;) &lt; DATE_FORMAT(Sage, &#x27;%m%d&#x27;)) AS Age</span><br><span class="line">FROM </span><br><span class="line">    student;</span><br></pre></td></tr></table></figure>



<h6 id="42-week"><a href="#42-week" class="headerlink" title="42 week"></a>42 week</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">查询本周过生日的学生</span><br><span class="line"></span><br><span class="line">-- 【分析】使用week()函数</span><br><span class="line">SELECT *,</span><br><span class="line">       WEEK(sage),</span><br><span class="line">       WEEK(NOW())</span><br><span class="line">FROM student</span><br><span class="line">WHERE WEEK(sage)=WEEK(NOW());</span><br></pre></td></tr></table></figure>

<h6 id="43-month"><a href="#43-month" class="headerlink" title="43 month"></a>43 month</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">查询本月过生日的学生</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 【分析】使用month()函数 --</span><br><span class="line">SELECT *,</span><br><span class="line">       MONTH(sage),</span><br><span class="line">       MONTH(NOW())</span><br><span class="line">FROM student</span><br><span class="line">WHERE MONTH(sage)=MONTH(NOW());</span><br></pre></td></tr></table></figure>



<h6 id="44-month"><a href="#44-month" class="headerlink" title="44 month"></a>44 month</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">查询下月过生日的学生 </span><br><span class="line"></span><br><span class="line">SELECT *,</span><br><span class="line">       MONTH(sage),</span><br><span class="line">       MONTH(NOW())</span><br><span class="line">FROM student</span><br><span class="line">WHERE MONTH(sage)=MONTH(NOW())+1;</span><br></pre></td></tr></table></figure>





<h5 id="案例二"><a href="#案例二" class="headerlink" title="案例二"></a>案例二</h5><p><a target="_blank" rel="noopener" href="http://www.360doc.com/content/24/0424/09/41302653_1121296713.shtml">url</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/72223558">url</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">student</span><br><span class="line"></span><br><span class="line">字段名	</span><br><span class="line">Sno	学生编号</span><br><span class="line">Sname	学生姓名</span><br><span class="line">Sage	出生年月</span><br><span class="line">Ssex	学生性别</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">course</span><br><span class="line"></span><br><span class="line">字段名	--</span><br><span class="line">Cno	科目编号</span><br><span class="line">Cname	科目名称</span><br><span class="line">Tno	任课老师编号</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">teacher</span><br><span class="line"></span><br><span class="line">字段名	--</span><br><span class="line">Tno	任课教师标号</span><br><span class="line">Tname	任课老师姓名</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SC</span><br><span class="line"></span><br><span class="line">字段名	--</span><br><span class="line">Sno	学生编号</span><br><span class="line">Cno	科目编号</span><br><span class="line">score	成绩</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">1. 查询&quot; 01 &quot;课程比&quot; 02 &quot;课程成绩高的学生的信息及课程分数</span><br><span class="line"></span><br><span class="line">1.1 查询同时存在&quot; 01 &quot;课程和&quot; 02 &quot;课程的情况</span><br><span class="line"></span><br><span class="line">1.2 查询存在&quot;01&quot;课程但可能不存在&quot;02&quot;课程的情况(不存在时显示为 null )</span><br><span class="line"></span><br><span class="line">1.3 查询不存在&quot;01&quot;课程但存在&quot;02&quot;课程的情况</span><br><span class="line"></span><br><span class="line">2. 查询平均成绩大于等于 60 分的同学的学生编号和学生姓名和平均成绩</span><br><span class="line"></span><br><span class="line">3. 查询在 SC 表存在成绩的学生信息</span><br><span class="line"></span><br><span class="line">4. 查询所有同学的学生编号、学生姓名、选课总数、所有课程的总成绩(没成绩的显示为 null )</span><br><span class="line"></span><br><span class="line">4.1 查有成绩的学生信息</span><br><span class="line"></span><br><span class="line">5. 查询「李」姓老师的数量 </span><br><span class="line"></span><br><span class="line">6. 查询学过「张三」老师授课的同学的信息 </span><br><span class="line"></span><br><span class="line">7. 查询没有学全所有课程的同学的信息 </span><br><span class="line"></span><br><span class="line">8. 查询至少有一门课与学号为&quot;01&quot;的同学所学相同的同学的信息 </span><br><span class="line"></span><br><span class="line">9. 查询和&quot;01&quot;号的同学学习的课程完全相同的其他同学的信息 </span><br><span class="line"></span><br><span class="line">10. 查询没学过&quot;张三&quot;老师讲授的任一门课程的学生姓名 </span><br><span class="line"></span><br><span class="line">11. 查询两门及其以上不及格课程的同学的学号，姓名及其平均成绩 </span><br><span class="line"></span><br><span class="line">12. 检索&quot;01&quot;课程分数小于60，按分数降序排列的学生信息</span><br><span class="line"></span><br><span class="line">13. 按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩</span><br><span class="line"></span><br><span class="line">14. 查询各科成绩最高分、最低分和平均分：</span><br><span class="line">    以如下形式显示：课程 ID，课程 name，最高分，最低分，平均分，及格率，中等率，优良率，优秀率</span><br><span class="line">    及格为&gt;=60，中等为：70-80，优良为：80-90，优秀为：&gt;=90</span><br><span class="line">    还要求选修人数，查询结果按人数降序排列，若人数相同，按课程号升序排列</span><br><span class="line"></span><br><span class="line">15. 按各科成绩进行排序，并显示排名，Score重复时保留名次空缺</span><br><span class="line"></span><br><span class="line">15.1 按各科成绩进行排序，并显示排名， Score 重复时合并名次</span><br><span class="line"></span><br><span class="line">16.  查询学生的总成绩，并进行排名，总分重复时保留名次空缺</span><br><span class="line"></span><br><span class="line">16.1 查询学生的总成绩，并进行排名，总分重复时不保留名次空缺</span><br><span class="line"></span><br><span class="line">17. 统计各科成绩各分数段人数：课程编号，课程名称，[100-85]，[85-70]，[70-60]，[60-0] 及所占百分比</span><br><span class="line"></span><br><span class="line">18. 查询各科成绩前三名的记录</span><br><span class="line"></span><br><span class="line">19. 查询每门课程被选修的学生数 </span><br><span class="line"></span><br><span class="line">20. 查询出只选修两门课程的学生学号和姓名 </span><br><span class="line"></span><br><span class="line">21. 查询男生、女生人数</span><br><span class="line"></span><br><span class="line">22. 查询名字中含有「风」字的学生信息</span><br><span class="line"></span><br><span class="line">23. 查询同名同性学生名单，并统计同名人数</span><br><span class="line"></span><br><span class="line">24. 查询 1990 年出生的学生名单</span><br><span class="line"></span><br><span class="line">25. 查询每门课程的平均成绩，结果按平均成绩降序排列，平均成绩相同时，按课程编号升序排列</span><br><span class="line"></span><br><span class="line">26. 查询平均成绩大于等于 85 的所有学生的学号、姓名和平均成绩 </span><br><span class="line"></span><br><span class="line">27. 查询课程名称为「数学」，且分数低于 60 的学生姓名和分数 </span><br><span class="line"></span><br><span class="line">28. 查询所有学生的课程及分数情况（存在学生没成绩，没选课的情况）</span><br><span class="line"></span><br><span class="line">29. 查询任何一门课程成绩在 70 分以上的姓名、课程名称和分数</span><br><span class="line"></span><br><span class="line">30. 查询不及格的课程</span><br><span class="line"></span><br><span class="line">31. 查询课程编号为 01 且课程成绩在 80 分以上的学生的学号和姓名</span><br><span class="line"></span><br><span class="line">32. 求每门课程的学生人数 </span><br><span class="line"></span><br><span class="line">33. 成绩不重复，查询选修「张三」老师所授课程的学生中，成绩最高的学生信息及其成绩</span><br><span class="line"></span><br><span class="line">34. 成绩有重复的情况下，查询选修「张三」老师所授课程的学生中，成绩最高的学生信息及其成绩</span><br><span class="line"></span><br><span class="line">35. 查询不同课程成绩相同的学生的学生编号、课程编号、学生成绩 </span><br><span class="line"></span><br><span class="line">36. 查询每门功成绩最好的前两名</span><br><span class="line"></span><br><span class="line">37. 统计每门课程的学生选修人数（超过 5 人的课程才统计）。</span><br><span class="line"></span><br><span class="line">38. 检索至少选修两门课程的学生学号 </span><br><span class="line"></span><br><span class="line">39. 查询选修了全部课程的学生信息</span><br><span class="line"></span><br><span class="line">40. 查询各学生的年龄，只按年份来算 </span><br><span class="line"></span><br><span class="line">41. 按照出生日期来算，当前月日 &lt; 出生年月的月日则，年龄减一</span><br><span class="line"></span><br><span class="line">42. 查询本周过生日的学生</span><br><span class="line"></span><br><span class="line">43. 查询下周过生日的学生</span><br><span class="line"></span><br><span class="line">44. 查询本月过生日的学生</span><br><span class="line"></span><br><span class="line">45. 查询下月过生日的学生</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h6 id="9-外连接实现except"><a href="#9-外连接实现except" class="headerlink" title="9 !外连接实现except"></a>9 !外连接实现except</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">SELECT Sno</span><br><span class="line">from sc</span><br><span class="line">where Cno and Sno=&#x27;01&#x27; in (</span><br><span class="line">    SELECT Cno</span><br><span class="line">    from sc</span><br><span class="line">    where Sno=&#x27;01&#x27;)</span><br><span class="line">    group by Sno</span><br><span class="line">) t1</span><br><span class="line">left join</span><br><span class="line">(</span><br><span class="line">SELECT Sno</span><br><span class="line">from sc</span><br><span class="line">where Cno not in (</span><br><span class="line">    SELECT Cno</span><br><span class="line">    from sc</span><br><span class="line">    where Sno=&#x27;01&#x27;)</span><br><span class="line">    group by Sno</span><br><span class="line">) t2</span><br><span class="line">on t1.Sno=t2.Sno</span><br><span class="line">where t2.Sno is null</span><br></pre></td></tr></table></figure>



<h6 id="10"><a href="#10" class="headerlink" title="10"></a>10</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">-- 1.先查询出选修了张三老师讲授课程的sid -- </span><br><span class="line">SELECT s.sid</span><br><span class="line">FROM  teacher t</span><br><span class="line">LEFT JOIN course c</span><br><span class="line">ON t.tid = c.tid</span><br><span class="line">LEFT JOIN sc</span><br><span class="line">ON c.cid = sc.cid</span><br><span class="line">LEFT JOIN student s</span><br><span class="line">ON sc.sid = s.sid</span><br><span class="line">WHERE tname = &quot;张三&quot;;</span><br><span class="line">-- 2.与学生表student关联,筛选出不在以上结果内的sid --</span><br><span class="line">SELECT s.*</span><br><span class="line">FROM student s</span><br><span class="line">WHERE sid NOT IN (SELECT s.sid</span><br><span class="line">				  FROM  teacher t</span><br><span class="line">				  LEFT JOIN course c</span><br><span class="line">				  ON t.tid = c.tid</span><br><span class="line">				  LEFT JOIN sc</span><br><span class="line">				  ON c.cid = sc.cid</span><br><span class="line">				  LEFT JOIN student s</span><br><span class="line">				  ON sc.sid = s.sid</span><br><span class="line">				  WHERE tname = &quot;张三&quot;);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">select sid</span><br><span class="line">from student</span><br><span class="line">where sid not in</span><br><span class="line">(</span><br><span class="line">select sid</span><br><span class="line">from sc</span><br><span class="line">where cid in</span><br><span class="line">(</span><br><span class="line">select cid</span><br><span class="line">from teacher t</span><br><span class="line">inner join course c</span><br><span class="line">on t.tid=c.tid</span><br><span class="line">)</span><br><span class="line">group by sid</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h6 id="11"><a href="#11" class="headerlink" title="11"></a>11</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select a.sid,b.sname,avg(a.score) as avg_score</span><br><span class="line">from sc a</span><br><span class="line">left join student b</span><br><span class="line">on a.sid = b.sid</span><br><span class="line">where a.score &lt; 60</span><br><span class="line">group by a.sid</span><br><span class="line">having count(a.cid) &gt;= 2;</span><br></pre></td></tr></table></figure>

<h6 id="13"><a href="#13" class="headerlink" title="13"></a>13</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~~~</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###### 14</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###### 14 case when round 值得注意</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>SELECT MIN(score) min_score<br>            ,MAX(score) max_score<br>            ,AVG(score) avg_score<br>            ,COUNT(1) stu_number<br>            ,SUM(CASE WHEN score &gt;&#x3D; 60 THEN 1 ELSE 0 END)&#x2F;COUNT(1) 及格率<br>            ,SUM(CASE WHEN score &gt;&#x3D; 70 AND score &lt; 80 THEN 1 ELSE 0 END)&#x2F;COUNT(1) 中等率<br>            ,SUM(CASE WHEN score &gt;&#x3D; 80 AND score &lt; 90 THEN 1 ELSE 0 END)&#x2F;COUNT(1) 优良率<br>            ,SUM(CASE WHEN score &gt;&#x3D; 90 THEN 1 ELSE 0 END)&#x2F;COUNT(1) 优秀率<br>FROM sc<br>LEFT JOIN course c<br>ON sc.cid &#x3D; c.cid<br>GROUP BY sc.cid<br>ORDER BY stu_number DESC ,sc.cid ASC;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20240512122430632](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202405121224020.png)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>SELECT courseid,MAX(score) AS ‘最高分’, MIN(score)AS ‘最低分’ ,AVG(score) AS ‘平均分’ ,COUNT(<em>) AS ‘选修人数’,<br>     SUM(CASE WHEN student_score.score &gt;&#x3D; 60 THEN 1 ELSE 0 END)&#x2F;COUNT(</em>) AS ‘及格率’,<br>     SUM(CASE WHEN student_score.score &gt;&#x3D; 70 AND student_score.score&lt; 80 THEN 1 ELSE 0 END)&#x2F;COUNT(<em>) AS ‘中等率’,<br>     SUM(CASE WHEN student_score.score &gt;&#x3D; 80 AND student_score.score&lt;90 THEN 1 ELSE 0 END)&#x2F;COUNT(*) AS ‘优良率’,<br>     SUM(CASE WHEN student_score.score &gt;&#x3D; 90 THEN 1 ELSE 0 END)&#x2F;COUNT(</em>) AS ‘优秀率’<br>FROM student_score GROUP BY courseid ORDER BY COUNT(*)DESC,student_score.courseid ASC ;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###### 15 PARTITION BY  下面那个with案例值得注意</span><br><span class="line"></span><br><span class="line">![image-20240512120328077](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202405121203192.png)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>SELECT<br>    Sno,<br>    Cno,<br>    score,<br>    DENSE_RANK() OVER (PARTITION BY Cno ORDER BY score DESC) AS ranking<br>FROM<br>    sc<br>ORDER BY<br>    Cno, score DESC;</p>
<pre><code>在上述查询中，ORDER BY Cno, score DESC是最终的排序，它确保结果首先按课程号排序，然后按分数降序排序。如果你只关心排名而不关心最终排序顺序，可以省略此ORDER BY子句。
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>案例</p>
<p>select Department, Employee, Salary<br>from (<br>    select d.name Department, ee.name Employee, ee.salary Salary, dense_rank() over(partition by departmentId order by salary desc) ranks<br>    from Employee ee<br>    left join Department d<br>    on ee.departmentId &#x3D; d.id<br>) t<br>where ranks &lt;&#x3D; 3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>案例</p>
<p>WITH t AS (<br>    SELECT<br>        employee_id,<br>        department_id,<br>        primary_flag,<br>        COUNT(*) OVER(PARTITION BY employee_id) AS count_over<br>    FROM Employee<br>            )<br>SELECT employee_id,department_id<br>FROM t<br>WHERE count_over &#x3D; 1 or primary_flag &#x3D; ‘Y’</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20240528124147664](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202405281241827.png)</span><br><span class="line"></span><br><span class="line">###### 16 变量的使用 法一没看懂 法二法六 值得注意</span><br><span class="line"></span><br><span class="line">![image-20240510104752646](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202405101047904.png)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>!16 法一<br>– 1、学生的总成绩 –<br>SELECT sid,SUM(score) sum_score<br>FROM sc<br>GROUP BY sid<br>ORDER BY sum_score DESC;</p>
<p>– 2、名次排序 –<br>SELECT a.*,<br>        @rank:&#x3D;IF(@sco&#x3D;sum_score,’ ‘,@rank+1) rk<br>FROM (SELECT sid,<br>             SUM(score) sum_score<br>      FROM sc<br>      GROUP BY sid<br>      ORDER BY sum_score DESC) a,(select @sco:&#x3D;null,@rank:&#x3D;0) b</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>法二 (法二-法五是leecode的例子，但用了这里的数据，把sc行数据理解成是总成绩)<br>select a.Sno, a.score,(select count(b.score)+1 –结果有莫名错误<br>from sc as b<br>where b.score&gt;a.score)  as ‘r’<br>from sc as a<br>order by ‘r’;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20240510105708868](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202405101057067.png)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>select a.Sno, a.score,(select count(b.score)+1 –这样接正确了，奇怪<br>from sc as b<br>where b.score&gt;a.score)  as r<br>from sc as a<br>order by r;</p>
<p>–等同于rank窗口函数实现的结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20240510105912068](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202405101059106.png)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>法三 (法二-法五是leecode的例子，但用了这里的数据，把sc行数据理解成是总成绩)</p>
<p>select sc.Sno, sc.score,DENSE_RANK() OVER(ORDER BY sc.score desc) as r<br>from sc;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20240510110824177](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202405101108470.png)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>法四 (法二-法五是leecode的例子，但用了这里的数据，把sc行数据理解成是总成绩)</p>
<p>select sc.Sno, sc.score,RANK() OVER(ORDER BY sc.score desc) as r<br>from sc;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20240510110926212](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202405101109512.png)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>法五 (法二-法五是leecode的例子，但用了这里的数据，把sc行数据理解成是总成绩)</p>
<p>select sc.Sno, sc.score,ROW_NUMBER() OVER(ORDER BY sc.score desc) as r<br>from sc;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20240510111228079](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202405101112131.png)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>法六 (法二-法五是leecode的例子，但用了这里的数据，把sc行数据理解成是总成绩)</p>
<p>select a.id, a.score, count(*) as r<br>from scores a<br>left join scores b<br>on a.score &lt; b.score<br>group by id, score<br>order by score DESC</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>错误写法 (法二-法五是leecode的例子，但用了这里的数据，把sc行数据理解成是总成绩)</p>
<p>select *<br>from sc as a<br>where EXISTS (<br>select b.score<br>from sc as b<br>where a.Sno!&#x3D;b.Sno and a.score&lt;&#x3D;b.score<br>);</p>
<p>select a.Sno, count(*) as coun<br>from SC as a<br>where a.score&lt;&#x3D;(<br>select b.score<br>from SC as b<br>where a.Sno!&#x3D;b.Sno<br>)<br>group by a.Sno<br>order by coun;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>SELECT<br>    s.Sno,<br>    s.Sname,<br>    SUM(sc.score) AS TotalScore,<br>    DENSE_RANK() OVER (ORDER BY SUM(sc.score) DESC) AS Rank<br>FROM<br>    student s<br>JOIN<br>    SC sc ON s.Sno &#x3D; sc.Sno<br>GROUP BY<br>    s.Sno, s.Sname<br>ORDER BY<br>    TotalScore DESC;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###### 17 18值得注意 22 ROUND\CASE\CONCAT</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>！17 不会<br>SELECT sc.cid 课程编号,c.cname 课程名称,COUNT(1) 选修人数<br>       ,CONCAT(ROUND(SUM(CASE WHEN sc.score &gt;&#x3D;0 AND sc.score &lt;&#x3D; 60 THEN 1 ELSE 0 END)&#x2F;COUNT(1),2),’%’) AS ‘(0-60]’<br>       ,CONCAT(ROUND(SUM(CASE WHEN sc.score &gt;&#x3D;60 AND sc.score &lt;&#x3D; 70 THEN 1 ELSE 0 END)&#x2F;COUNT(1),2),’%’) AS ‘(60-70]’<br>       ,CONCAT(ROUND(SUM(CASE WHEN sc.score &gt;&#x3D; 70 AND sc.score &lt;&#x3D; 85 THEN 1 ELSE 0 END)&#x2F;COUNT(1),2),’%’) AS ‘(70-85]’<br>       ,CONCAT(ROUND(SUM(CASE WHEN sc.score &gt;&#x3D; 85 AND sc.score &lt;&#x3D; 100 THEN 1 ELSE 0 END)&#x2F;COUNT(1),2),’%’) AS ‘(85-100]’<br>FROM sc<br>LEFT JOIN course c<br>ON sc.cid &#x3D; c.cid<br>GROUP BY sc.cid;</p>
<p>– concat的作用是将两个字符拼接起来 –</p>
<p>！18  不会 好像有点问题<br>SELECT a.*,c.cname<br>FROM sc a<br>LEFT JOIN course c<br>ON a.cid &#x3D; c.cid<br>WHERE (SELECT COUNT(1)<br>       FROM sc b<br>       WHERE b.cid &#x3D; a.cid AND b.score &gt; a.score) &lt; 3<br>ORDER BY cid DESC,score DESC;</p>
<p>19<br>SELECT sc.sid 学生编号,s.sname 学生姓名,COUNT(sc.cid) 选课数量<br>FROM sc<br>LEFT JOIN student s<br>ON sc.sid &#x3D; s.sid<br>GROUP BY sc.sid,s.sname<br>HAVING COUNT(sc.cid) &#x3D; 2;</p>
<p>20<br>SELECT sc.sid 学生编号,s.sname 学生姓名,COUNT(sc.cid) 选课数量<br>FROM sc<br>LEFT JOIN student s<br>ON sc.sid &#x3D; s.sid<br>GROUP BY sc.sid，s.sname<br>HAVING COUNT(sc.cid) &#x3D; 2;</p>
<p>21 x</p>
<p>!22<br>SELECT *<br>FROM student<br>WHERE sname LIKE ‘%风%’;</p>
<p>23<br>SELECT sname 姓名,ssex 性别,COUNT(*) 同名人数<br>FROM student<br>GROUP BY sname,ssex;</p>
<p>24 x+</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![image-20240508232354558](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202405082323141.png)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>25 !<br>select a.Cno,b.Cname,avg(a.score) as avg_score – 这里有b.Cname错误了<br>from SC a<br>left join Course b<br>on a.Cno &#x3D; b.Cno<br>group by a.Cno<br>order by avg_score desc,a.Cno asc;</p>
<p>26<br>select a.sid,b.sname,avg(a.score) as avg_score<br>from sc a<br>left join student b<br>on a.sid &#x3D; b.sid<br>group by a.sid<br>having avg_score &gt;&#x3D; 85;</p>
<p>27 x</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###### ！33 34 35 36 37 39 40 HAVING 变量</span><br><span class="line"></span><br><span class="line">![image-20240508225527786](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202405082255245.png)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>28 x</p>
<p>29 x</p>
<p>30 x</p>
<p>31 x</p>
<p>32 x</p>
<p>33</p>
<h1 id="法一"><a href="#法一" class="headerlink" title="法一"></a>法一</h1><p>SELECT *<br>FROM teacher t<br>LEFT JOIN course c<br>ON t.tid &#x3D; c.tid<br>LEFT JOIN sc<br>ON c.cid &#x3D; sc.cid<br>LEFT JOIN student s<br>ON s.sid &#x3D; sc.sid<br>WHERE t.tname &#x3D; “张三”<br>ORDER BY sc.score DESC<br>LIMIT 1;</p>
<h1 id="法二"><a href="#法二" class="headerlink" title="法二"></a>法二</h1><p>– 1.先查询[张三]老师所带的课程编号cid和tid –<br>SELECT *<br>FROM teacher t<br>LEFT JOIN course c<br>ON t.tid &#x3D; c.tid<br>WHERE t.tname &#x3D; “张三”;<br>– 2.将以上结果与成绩表sc关联 –<br>SELECT sc.sid,a.cid,a.cname,a.tname,sc.score<br>FROM (SELECT t.tid,t.tname,c.cid,c.cname<br>      FROM teacher t<br>      LEFT JOIN course c<br>      ON t.tid &#x3D; c.tid<br>      WHERE t.tname &#x3D; “张三”) a<br>LEFT JOIN sc<br>ON a.cid &#x3D; sc.cid<br>ORDER BY sc.score DESC<br>LIMIT 1;<br>– 3.将以上结果与学生表student关联 –<br>SELECT s.sid 学号,s.sname 学生姓名,a.cname 课程,a.tname 教师姓名,a.score 成绩<br>FROM (SELECT sc.sid,a.cid,a.cname,a.tname,sc.score<br>      FROM (SELECT t.tid,t.tname,c.cid,c.cname<br>            FROM teacher t<br>            LEFT JOIN course c<br>            ON t.tid &#x3D; c.tid<br>            WHERE t.tname &#x3D; “张三”) a<br>        LEFT JOIN sc<br>        ON a.cid &#x3D; sc.cid<br>ORDER BY sc.score DESC<br>LIMIT 1) a<br>LEFT JOIN student s<br>ON a.sid &#x3D; s.sid;</p>
<p>34 ! rank dense_rank也行<br>SELECT *<br>FROM<br>(SELECT a.*,<br>        CASE WHEN @score&#x3D;score THEN @rank<br>             WHEN @score:&#x3D;score THEN @rank:&#x3D;@rank+1 END rk<br>FROM<br>(SELECT s.sid,s.sname,sc.score,c.cid,c.cname<br> FROM teacher t<br> LEFT JOIN course c<br> ON t.tid &#x3D; c.tid<br> LEFT JOIN sc<br> ON c.cid &#x3D; sc.cid<br> LEFT JOIN student s<br> ON s.sid &#x3D; sc.sid<br> WHERE t.tname &#x3D; “张三”) a,(SELECT @score:&#x3D;NULL,@rank:&#x3D;0) t) s<br>WHERE rk&#x3D;1;</p>
<p>35<br>SELECT a.sid,a.cid,a.score<br>FROM sc a<br>INNER JOIN sc b<br>ON a.sid &#x3D; b.sid<br>WHERE a.cid !&#x3D; b.cid AND a.score &#x3D; b.score<br>GROUP BY a.cid,a.sid;</p>
<p>36 !<br>SELECT sid,cid,score,rk<br>FROM(<br>    SELECT sc.*,<br>           @rank:&#x3D;if(@c_cid&#x3D;cid,if(@sco&#x3D;score,@rank,@rank+1),1) rk,<br>           @sco:&#x3D;score,<br>           @c_cid:&#x3D;cid<br>        FROM sc,(SELECT @sco&#x3D;null,@rank:&#x3D;0,@c_cid:&#x3D;null) b<br>ORDER BY cid,score DESC) a<br>where a.rk&lt;3;</p>
<p>37</p>
<h1 id="法一-1"><a href="#法一-1" class="headerlink" title="法一"></a>法一</h1><p>SELECT cid,COUNT(sid) 选修人数<br>FROM sc<br>GROUP BY cid<br>HAVING COUNT(sid) &gt; 5;</p>
<h1 id="法二-1"><a href="#法二-1" class="headerlink" title="法二"></a>法二</h1><p>SELECT cid,COUNT(1) 选修人数<br>FROM sc<br>GROUP BY cid<br>HAVING COUNT(1) &gt; 5;</p>
<p>– 知识点补充 –</p>
<h1 id="COUNT-1-COUNT-COUNT-列名-的区别"><a href="#COUNT-1-COUNT-COUNT-列名-的区别" class="headerlink" title="COUNT(1) COUNT(*) COUNT(列名)的区别"></a>COUNT(1) COUNT(*) COUNT(列名)的区别</h1><h1 id="COUNT-1-包含忽略所有列，用1代表代码行，统计时不会忽略列值为NULL"><a href="#COUNT-1-包含忽略所有列，用1代表代码行，统计时不会忽略列值为NULL" class="headerlink" title="COUNT(1)包含忽略所有列，用1代表代码行，统计时不会忽略列值为NULL"></a>COUNT(1)包含忽略所有列，用1代表代码行，统计时不会忽略列值为NULL</h1><h1 id="COUNT-包含所有列，相当于行数，统计时，不会忽略列值为NULL"><a href="#COUNT-包含所有列，相当于行数，统计时，不会忽略列值为NULL" class="headerlink" title="COUNT(*)包含所有列，相当于行数，统计时，不会忽略列值为NULL"></a>COUNT(*)包含所有列，相当于行数，统计时，不会忽略列值为NULL</h1><h1 id="COUNT-列名-只包含列名那一列，统计时忽略列为NULL-某字段为NULL-不计数"><a href="#COUNT-列名-只包含列名那一列，统计时忽略列为NULL-某字段为NULL-不计数" class="headerlink" title="COUNT(列名)只包含列名那一列，统计时忽略列为NULL(某字段为NULL,不计数)"></a>COUNT(列名)只包含列名那一列，统计时忽略列为NULL(某字段为NULL,不计数)</h1><p>38 x</p>
<p>39<br>SELECT s.*<br>FROM sc<br>INNER JOIN student s<br>ON sc.sid &#x3D; s.sid<br>GROUP BY sid<br>HAVING COUNT(1) &#x3D; (SELECT COUNT(1) FROM course);</p>
<p>SELECT s.*<br>FROM sc<br>INNER JOIN student s<br>ON sc.sid &#x3D; s.sid<br>GROUP BY sid<br>HAVING COUNT(sc.cid) &#x3D; (SELECT COUNT(cid) FROM course);</p>
<p>40<br>– 【分析】使用日期函数进行相减 –<br>SELECT *,YEAR(CURDATE())-YEAR(sage) 年龄<br>FROM student;</p>
<p>SELECT *,YEAR(NOW())-YEAR(sage) 年龄<br>FROM student;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###### ！timestampdiff()\week()\month()\NOW()\YEAR(x)\CURDATE()</span><br><span class="line"></span><br><span class="line">![image-20240508223729648](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202405082237227.png)</span><br><span class="line"></span><br><span class="line">![image-20240508223754306](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202405082237869.png)</span><br><span class="line"></span><br><span class="line">![image-20240508223813282](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202405082238568.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###### 41</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>41 !<br>– 【分析】日期相减函数timestampdiff(year,参数1,参数2) –<br>SELECT *,<br>      TIMESTAMPDIFF(YEAR,sage,NOW()) age<br>FROM student;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>SELECT<br>    Sno,<br>    Sname,<br>    YEAR(CURDATE()) - YEAR(Sage) -<br>    (DATE_FORMAT(CURDATE(), ‘%m%d’) &lt; DATE_FORMAT(Sage, ‘%m%d’)) AS Age<br>FROM<br>    student;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>SELECT<br>    Sno,<br>    Sname,<br>    Sage,<br>    CASE<br>        WHEN DATE_FORMAT(CURDATE(), ‘%m%d’) &lt; DATE_FORMAT(Sage, ‘%m%d’)<br>        THEN YEAR(CURDATE()) - YEAR(Sage) - 1<br>        ELSE YEAR(CURDATE()) - YEAR(Sage)<br>    END as actual_age<br>FROM student;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###### 42</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>42<br>– 【分析】使用week()函数<br>SELECT *,<br>       WEEK(sage),<br>       WEEK(NOW())<br>FROM student<br>WHERE WEEK(sage)&#x3D;WEEK(NOW());</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###### 43</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>43<br>SELECT *,<br>       WEEK(sage),<br>       WEEK(NOW())<br>FROM student<br>WHERE WEEK(sage)&#x3D;WEEK(NOW())+1;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###### 44</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>44<br>– 【分析】使用month()函数 –<br>SELECT *,<br>       MONTH(sage),<br>       MONTH(NOW())<br>FROM student<br>WHERE MONTH(sage)&#x3D;MONTH(NOW());</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###### 45</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>45<br>SELECT *,<br>       MONTH(sage),<br>       MONTH(NOW())<br>FROM student<br>WHERE MONTH(sage)&#x3D;MONTH(NOW())+1;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### 案例三</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_16099270/8081043">https://blog.51cto.com/u_16099270/8081043</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/abend11/article/details/136830750">https://blog.csdn.net/abend11/article/details/136830750</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/pattyi/article/details/116146698">https://blog.csdn.net/pattyi/article/details/116146698</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### LEECODE案例</span><br><span class="line"></span><br><span class="line">#### 177.第N高的薪水  函数 dense_rank limit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT<br>BEGIN<br>  RETURN (<br>      # Write your MySQL query statement below.<br>      select (<br>          select distinct salary from (<br>              select salary, dense_rank() over (order by salary desc) rnk from employee<br>          )t<br>          where rnk&#x3D;N<br>      )getNthHighestSalary<br>  );<br>END</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT<br>BEGIN<br>    SET N&#x3D;N-1;<br>  RETURN (<br>        SELECT distinct salary FROM Employee ORDER BY salary DESC LIMIT N, 1<br>  );<br>END</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT<br>BEGIN<br>  RETURN (<br>      # Write your MySQL query statement below.<br>            with t1 as (<br>          select * ,dense_rank() over (order by Salary desc) as rk<br>          from Employee<br>      )<br>      select distinct ifnull(Salary ,null)<br>      from t1<br>      where rk &#x3D; N<br>  );<br>END</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT<br>BEGIN<br>DECLARE M INT;<br>    SET M &#x3D; N-1;<br>  RETURN (<br>      SELECT DISTINCT salary<br>      FROM Employee<br>      ORDER BY salary DESC<br>      LIMIT M, 1<br>  );<br>END</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 178.分数排名 dense_rank b.score &gt;= a.score</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>表: Scores</p>
<p>+————-+———+<br>| Column Name | Type    |<br>+————-+———+<br>| id          | int     |<br>| score       | decimal |<br>+————-+———+<br>id 是该表的主键（有不同值的列）。<br>该表的每一行都包含了一场比赛的分数。Score 是一个有两位小数点的浮点值。</p>
<p>编写一个解决方案来查询分数的排名。排名按以下规则计算:</p>
<p>分数应按从高到低排列。<br>如果两个分数相等，那么两个分数的排名应该相同。<br>在排名相同的分数后，排名数应该是下一个连续的整数。换句话说，排名之间不应该有空缺的数字。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>select<br>a.score as Score,<br>count(DISTINCT b.score) AS Rank # 统计b表符合条件的不重复的分数的数量作为排名<br>FROM scores a join scores b<br>where b.score &gt;&#x3D; a.score # 条件是这个分数不小于我，因为a、b表数据相同，所以排名值最小是1<br>group by a.id # a表中每个数据都进行排名<br>order by a.score DESC # 最后按分数（跟排名一样）降序排列</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>dense_rank</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 180.连续出现的数字 lag lead with 变量 多同表连接</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>表：Logs</p>
<p>+————-+———+<br>| Column Name | Type    |<br>+————-+———+<br>| id          | int     |<br>| num         | varchar |<br>+————-+———+<br>在 SQL 中，id 是该表的主键。<br>id 是一个自增列。</p>
<p>找出所有至少连续出现三次的数字。</p>
<p>返回的结果表中的数据可以按 任意顺序 排列。</p>
<p>结果格式如下面的例子所示：</p>
<p>示例 1:</p>
<p>输入：<br>Logs 表：<br>+—-+—–+<br>| id | num |<br>+—-+—–+<br>| 1  | 1   |<br>| 2  | 1   |<br>| 3  | 1   |<br>| 4  | 2   |<br>| 5  | 1   |<br>| 6  | 2   |<br>| 7  | 2   |<br>+—-+—–+<br>输出：<br>Result 表：<br>+—————–+<br>| ConsecutiveNums |<br>+—————–+<br>| 1               |<br>+—————–+<br>解释：1 是唯一连续出现至少三次的数字。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>select<br>distinct p.num as ConsecutiveNums<br>from(<br>    select<br>    id,<br>    num,<br>    lag(num,1)over(order by id) num1,<br>    lag(num,2)over(order by id) num2<br>    from<br>    Logs<br>) p<br>where<br>p.num &#x3D; p.num1 and p.num1  &#x3D; p.num2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Write-your-MySQL-query-statement-below"><a href="#Write-your-MySQL-query-statement-below" class="headerlink" title="Write your MySQL query statement below"></a>Write your MySQL query statement below</h1><p>with p as(<br>    (<br>    select<br>    id,<br>    num,<br>    lag(num,1)over(order by id) num1,<br>    lag(num,2)over(order by id) num2,<br>    lead(num,1)over(order by id) num3,<br>    lead(num,2)over(order by id) num4<br>    from Logs<br>) </p>
<p>)<br>select<br>distinct p.num as ConsecutiveNums<br>from p<br>where<br>p.num &#x3D; p.num1 and p.num1  &#x3D; p.num2 || p.num1 &#x3D; p.num &#x3D; p.num3 || p.num &#x3D; p.num3 &#x3D; p.num4</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>select distinct Num as ConsecutiveNums<br>from (<br>  select Num,<br>    case<br>      when @prev &#x3D; Num then @count :&#x3D; @count + 1<br>      when (@prev :&#x3D; Num) is not null then @count :&#x3D; 1<br>    end as CNT<br>  from Logs, (select @prev :&#x3D; null,@count :&#x3D; null) as t<br>) as temp<br>where temp.CNT &gt;&#x3D; 3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>select distinct a.Num as ConsecutiveNums<br>from Logs as a,Logs as b,Logs as c<br>where a.Num&#x3D;b.Num and b.Num&#x3D;c.Num and a.id&#x3D;b.id-1 and b.id&#x3D;c.id-1;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 184.部门工资最高的员工</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>SELECT<br>    d.name AS Department,<br>    e.name AS Employee,<br>    e.salary AS Salary<br>FROM (<br>    SELECT<br>    name,<br>    salary,<br>    departmentId,<br>    RANK() OVER(PARTITION BY departmentId ORDER BY salary DESC) AS <code>rank</code><br>    FROM Employee<br>) e<br>LEFT JOIN Department d<br>    ON e.departmentId &#x3D; d.id<br>WHERE e.<code>rank</code> &#x3D; 1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Write-your-MySQL-query-statement-below-1"><a href="#Write-your-MySQL-query-statement-below-1" class="headerlink" title="Write your MySQL query statement below"></a>Write your MySQL query statement below</h1><p>select<br>    d.Name as Department,<br>    e.Name as Employee,<br>    e.Salary<br>from<br>    Employee e,Department d<br>where<br>    e.DepartmentId&#x3D;d.id<br>    and<br>    (e.Salary,e.DepartmentId) in (select max(Salary),DepartmentId from Employee group by DepartmentId);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 185.部门工资前三高的所有员工</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>表: Employee</p>
<p>+————–+———+<br>| Column Name  | Type    |<br>+————–+———+<br>| id           | int     |<br>| name         | varchar |<br>| salary       | int     |<br>| departmentId | int     |<br>+————–+———+<br>id 是该表的主键列(具有唯一值的列)。<br>departmentId 是 Department 表中 ID 的外键（reference 列）。<br>该表的每一行都表示员工的ID、姓名和工资。它还包含了他们部门的ID。</p>
<p>表: Department</p>
<p>+————-+———+<br>| Column Name | Type    |<br>+————-+———+<br>| id          | int     |<br>| name        | varchar |<br>+————-+———+<br>id 是该表的主键列(具有唯一值的列)。<br>该表的每一行表示部门ID和部门名。</p>
<p>公司的主管们感兴趣的是公司每个部门中谁赚的钱最多。一个部门的 高收入者 是指一个员工的工资在该部门的 不同 工资中 排名前三 。<br>编写解决方案，找出每个部门中 收入高的员工 。<br>以 任意顺序 返回结果表。<br>返回结果格式如下所示。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Write-your-MySQL-query-statement-below-2"><a href="#Write-your-MySQL-query-statement-below-2" class="headerlink" title="Write your MySQL query statement below"></a>Write your MySQL query statement below</h1><p>with t as(<br>select e1.departmentId,count(distinct e2.Salary) as r,e1.id<br>from Employee e1 join Employee e2<br>on e1.departmentId &#x3D; e2.departmentId and e1.salary &lt;&#x3D; e2.salary<br>group by e1.id<br>having r&lt;3<br>)</p>
<p>select d.name as Department,e.name as Employee,e.salary as Salary<br>from Department as d,t,Employee as e<br>where t.departmentId &#x3D; d.id and t.id &#x3D; e.id</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>dense_rank()</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>SELECT<br>    d.Name AS ‘Department’, e1.Name AS ‘Employee’, e1.Salary<br>FROM<br>    Employee e1<br>        JOIN<br>    Department d ON e1.DepartmentId &#x3D; d.Id<br>WHERE<br>    3 &gt; (SELECT<br>            COUNT(DISTINCT e2.Salary)<br>        FROM<br>            Employee e2<br>        WHERE<br>            e2.Salary &gt; e1.Salary<br>                AND e1.DepartmentId &#x3D; e2.DepartmentId<br>        )<br>;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 196.删除重复的电子邮箱  连表delete</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>表: Person</p>
<p>+————-+———+<br>| Column Name | Type    |<br>+————-+———+<br>| id          | int     |<br>| email       | varchar |<br>+————-+———+<br>id 是该表的主键列(具有唯一值的列)。<br>该表的每一行包含一封电子邮件。电子邮件将不包含大写字母。</p>
<p>编写解决方案 删除 所有重复的电子邮件，只保留一个具有最小 id 的唯一电子邮件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>delete b from person a join person b<br>on  a.email &#x3D; b.email and b.id &gt; a.id</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>with t as<br>(select min(id) id,email<br>from Person<br>group by email<br>having count(*) &gt; 1)</p>
<p>delete Person<br>from Person,t<br>where Person.id !&#x3D;t.id and Person.email &#x3D; t.email</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 197.上升的温度 datediff lag date_add</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>表： Weather</p>
<p>+—————+———+<br>| Column Name   | Type    |<br>+—————+———+<br>| id            | int     |<br>| recordDate    | date    |<br>| temperature   | int     |<br>+—————+———+<br>id 是该表具有唯一值的列。<br>没有具有相同 recordDate 的不同行。<br>该表包含特定日期的温度信息</p>
<p>编写解决方案，找出与之前（昨天的）日期相比温度更高的所有日期的 id 。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>select a.id<br>from weather a, weather b<br>where a.temperature &gt; b.temperature<br>and datediff(a.recordDate, b.recordDate) &#x3D; 1; </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>lag()</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 262.行程和用户 IF Case</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>表：Trips<br>+————-+———-+<br>| Column Name | Type     |<br>+————-+———-+<br>| id          | int      |<br>| client_id   | int      |<br>| driver_id   | int      |<br>| city_id     | int      |<br>| status      | enum     |<br>| request_at  | varchar  |<br>+————-+———-+<br>id 是这张表的主键（具有唯一值的列）。<br>这张表中存所有出租车的行程信息。每段行程有唯一 id ，其中 client_id 和 driver_id 是 Users 表中 users_id 的外键。<br>status 是一个表示行程状态的枚举类型，枚举成员为(‘completed’, ‘cancelled_by_driver’, ‘cancelled_by_client’) 。<br>表：Users</p>
<p>+————-+———-+<br>| Column Name | Type     |<br>+————-+———-+<br>| users_id    | int      |<br>| banned      | enum     |<br>| role        | enum     |<br>+————-+———-+<br>users_id 是这张表的主键（具有唯一值的列）。<br>这张表中存所有用户，每个用户都有一个唯一的 users_id ，role 是一个表示用户身份的枚举类型，枚举成员为 (‘client’, ‘driver’, ‘partner’) 。<br>banned 是一个表示用户是否被禁止的枚举类型，枚举成员为 (‘Yes’, ‘No’) 。<br>取消率 的计算方式如下：(被司机或乘客取消的非禁止用户生成的订单数量) &#x2F; (非禁止用户生成的订单总数)。</p>
<p>编写解决方案找出 “2013-10-01” 至 “2013-10-03” 期间有 至少 一次行程的非禁止用户（乘客和司机都必须未被禁止）的 取消率。非禁止用户即 banned 为 No 的用户，禁止用户即 banned 为 Yes 的用户。其中取消率 Cancellation Rate 需要四舍五入保留 两位小数 。</p>
<p>返回结果表中的数据 无顺序要求 。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>SELECT T.request_at AS <code>Day</code>,<br>    ROUND(<br>            SUM(<br>                IF(T.STATUS &#x3D; ‘completed’,0,1)<br>            )<br>            &#x2F;<br>            COUNT(T.STATUS),<br>            2<br>    ) AS <code>Cancellation Rate</code><br>FROM Trips AS T<br>JOIN Users AS U1 ON (T.client_id &#x3D; U1.users_id AND U1.banned &#x3D;’No’)<br>JOIN Users AS U2 ON (T.driver_id &#x3D; U2.users_id AND U2.banned &#x3D;’No’)<br>WHERE T.request_at BETWEEN ‘2013-10-01’ AND ‘2013-10-03’<br>GROUP BY T.request_at</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>case when</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##### avg精彩用法</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="精彩"><a href="#精彩" class="headerlink" title="精彩"></a>精彩</h1><h1 id="Write-your-MySQL-query-statement-below-3"><a href="#Write-your-MySQL-query-statement-below-3" class="headerlink" title="Write your MySQL query statement below"></a>Write your MySQL query statement below</h1><p>SELECT<br>    request_at as ‘Day’, round(avg(Status!&#x3D;’completed’), 2) as ‘Cancellation Rate’<br>FROM<br>    trips t JOIN users u1 ON (t.client_id &#x3D; u1.users_id AND u1.banned &#x3D; ‘No’)<br>    JOIN users u2 ON (t.driver_id &#x3D; u2.users_id AND u2.banned &#x3D; ‘No’)<br>WHERE	<br>    request_at BETWEEN ‘2013-10-01’ AND ‘2013-10-03’<br>GROUP BY<br>    request_at</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 534.游戏玩法分析 III  sum() over(partition by</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>表：Activity</p>
<p>+————–+———+<br>| Column Name  | Type    |<br>+————–+———+<br>| player_id    | int     |<br>| device_id    | int     |<br>| event_date   | date    |<br>| games_played | int     |<br>+————–+———+<br>（player_id，event_date）是此表的主键（具有唯一值的列）。<br>这张表显示了某些游戏的玩家的活动情况。<br>每一行是一个玩家的记录，他在某一天使用某个设备注销之前登录并玩了很多游戏（可能是 0 ）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>编写一个解决方案，同时报告每组玩家和日期，以及玩家到 目前为止 玩了多少游戏。也就是说，玩家在该日期之前所玩的游戏总数。详细情况请查看示例。</p>
<p>以 任意顺序 返回结果表。</p>
<p>结果格式如下所示。</p>
<p>示例 1：</p>
<p>输入：<br>Activity table:<br>+———–+———–+————+————–+<br>| player_id | device_id | event_date | games_played |<br>+———–+———–+————+————–+<br>| 1         | 2         | 2016-03-01 | 5            |<br>| 1         | 2         | 2016-05-02 | 6            |<br>| 1         | 3         | 2017-06-25 | 1            |<br>| 3         | 1         | 2016-03-02 | 0            |<br>| 3         | 4         | 2018-07-03 | 5            |<br>+———–+———–+————+————–+<br>输出：<br>+———–+————+———————+<br>| player_id | event_date | games_played_so_far |<br>+———–+————+———————+<br>| 1         | 2016-03-01 | 5                   |<br>| 1         | 2016-05-02 | 11                  |<br>| 1         | 2017-06-25 | 12                  |<br>| 3         | 2016-03-02 | 0                   |<br>| 3         | 2018-07-03 | 5                   |<br>+———–+————+———————+</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>– 方案一：<br>select<br>    a1.player_id,<br>    a1.event_date,<br>    sum(a2.games_played) as games_played_so_far<br>from Activity a1<br>join Activity a2<br>on a1.player_id&#x3D;a2.player_id and a1.event_date&gt;&#x3D;a2.event_date  – 关联当前时间之前的数据<br>group by a1.player_id,a1.event_date;</p>
<p>– 方案二：<br>select<br>    player_id,<br>    event_date,<br>    sum(games_played) over(partition by player_id order by event_date)  games_played_so_far<br>from Activity;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 难 569.游戏玩法分析 IV  partition by 中位数 </span><br><span class="line"></span><br><span class="line">![image-20240812183309415](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202408121833571.png)</span><br><span class="line"></span><br><span class="line">![image-20240812183353125](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202408121833868.png)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>SELECT Id, Company, salary<br>FROM Employee<br>WHERE Id in<br>(SELECT E1.Id<br>FROM Employee AS E1<br>JOIN<br>Employee AS E2<br>ON E1.company &#x3D; E2.Company<br>GROUP BY E1.Id<br>HAVING SUM(IF(E1.Salary &gt;&#x3D;E2.Salary,1,0))&gt;&#x3D; COUNT(<em>)&#x2F; 2<br>AND SUM(IF(E1.Salary&lt;&#x3D;E2.salary,1,0))&gt;&#x3D; COUNT(</em>)&#x2F; 2)<br>GROUP BY Company,Salary<br>ORDER BY Company</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>–方法一：<br>–注意事项：排序时用row_number,会有排名相同的情况<br>–中位数的逻辑了解：不论个数是奇数偶数，中位数在总数除以2和总数除以2加1之间<br>select id ,company,salary<br>from (<br>    select *<br>    ,row_number() over(partition by company order by salary) as rnk<br>    ,count(<em>) over(partition by company ) as cnt<br>    from Employee) a<br>where  rnk BETWEEN cnt</em>1.0&#x2F;2 AND cnt*1.0&#x2F;2 + 1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 571.给定数字的频率查询中位数</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Numbers 表保存数字的值及其频率。</p>
<p>+———-+————-+<br>|  Number  |  Frequency  |<br>+———-+————-|<br>|  0       |  7          |<br>|  1       |  1          |<br>|  2       |  3          |<br>|  3       |  1          |<br>+———-+————-+<br>在此表中，数字为 0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 3，所以中位数是 (0 + 0) &#x2F; 2 &#x3D; 0。</p>
<p>+——–+<br>| median |<br>+——–|<br>| 0.0000 |<br>+——–+<br>请编写一个查询来查找所有数字的中位数并将结果命名为 median 。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 601.体育馆的人流量  lag() lead()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>with people as<br>(<br>    select id, visit_date, people,<br>    Lag(people,2) over(order by id) as pprvPeople,<br>    Lag(people,1) over(order by id) as prvPeople,<br>    Lead(people,1) over(order by id) as nextPeople,<br>    Lead(people,2) over(order by id) as nnextPeople<br>    from stadium<br>)<br>select id, visit_date, people from people<br>where<br>(people &gt;&#x3D; 100 and prvPeople&gt;&#x3D;100 and pprvPeople&gt;&#x3D;100) ||<br>(people &gt;&#x3D; 100 and nextPeople&gt;&#x3D;100 and nnextPeople&gt;&#x3D;100) ||<br>(people &gt;&#x3D; 100 and nextPeople&gt;&#x3D;100 and prvPeople&gt;&#x3D;100) </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>select distinct s1.*<br>from stadium s1, stadium s2, stadium s3<br>where s1.people &gt;&#x3D; 100 and s2.people&gt;&#x3D; 100 and s3.people &gt;&#x3D; 100<br>and<br>(<br>    (s1.id - s2.id &#x3D; 1 and s2.id - s3.id &#x3D;1)<br>   or<br>   (s2.id - s1.id &#x3D; 1 and s1.id - s3.id &#x3D;1)<br>   or<br>   (s3.id - s2.id &#x3D; 1 and s2.id - s1.id &#x3D; 1)<br>) order by s1.id;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 602 case when</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>select case when requester_id is not null then requester_id else accepter_id end  as id, if(c1 is null,0,c1)+if(c2 is null,0,c2) as num<br>from<br>(select requester_id,count(<em>) c1<br>from RequestAccepted<br>group by requester_id) t1<br>left join<br>(select accepter_id,count(</em>) c2<br>from RequestAccepted<br>group by accepter_id) t2<br>on t1.requester_id&#x3D;t2.accepter_id<br>order by num desc limit 1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 608 union</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Write-your-MySQL-query-statement-below-4"><a href="#Write-your-MySQL-query-statement-below-4" class="headerlink" title="Write your MySQL query statement below"></a>Write your MySQL query statement below</h1><p>select id,’Root’ as type<br>from Tree<br>where p_id is null<br>union<br>select id,’Inner’ as type<br>from Tree<br>where p_id is not null and id not in(<br>select t2.id<br>from Tree t1<br>right join Tree t2<br>on t1.p_id&#x3D;t2.id<br>where t1.id is null and t2.id is not null and t2.p_id is not null)<br>union<br>select t2.id, ‘Leaf’ as type<br>from Tree t1<br>right join Tree t2<br>on t1.p_id&#x3D;t2.id<br>where t1.id is null and t2.id is not null and t2.p_id is not null</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 1070</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>select product_id,year as first_year,quantity,price<br>from(<br>select product_id,year,quantity,price,ROW_NUMBER() over(partition by product_id order by year) as r<br>from Sales<br>) t<br>where t.r&#x3D;1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 1972  同一天的第一个电话和最后一个电话 难</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>编写一个 SQL 查询来找出那些ID们在任意一天的第一个电话和最后一个电话都是和同一个人的。这些电话不论是拨打者还是接收者都会被记录。<br>结果请放在一个任意次序约束的表中。<br>查询结果格式如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20240812190332249](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202408121903084.png)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>–MySQL<br>with temp as (select * from calls<br>            union all<br>            select recipient_id caller_id, caller_id recipient_id, call_time from calls<br>    ),</p>
<p>temp1 as (select<br>            *,<br>            dense_rank() over (partition by date_format(call_time,”%Y-%m-%d”),caller_id order by call_time asc) rk1,<br>            dense_rank() over (partition by date_format(call_time,”%Y-%m-%d”),caller_id order by call_time desc) rk2<br>        from temp<br>    )</p>
<p>select<br>    distinct caller_id as user_id<br>from temp1<br>where rk1 &#x3D; 1 or rk2 &#x3D; 1<br>group by caller_id, date_format(call_time,”%Y-%m-%d”)<br>having count(distinct recipient_id) &#x3D; 1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p>with t1 as (select<br>caller_id,recipient_id,call_time #选出 所有id 在某个时间 跟另一个通话的id<br>from<br>Calls</p>
<p>union all</p>
<p>select<br>recipient_id,caller_id,call_time<br>from<br>Calls<br>),<br>t2 as (<br>select#按 caller_id 和 每天 分组  对 call_time标号 便于 找到 每天 第一个 和最后的一通电话<br>caller_id,recipient_id,call_time,row_number() over(partition by caller_id,date_format(call_time,’%Y-%m-%d’) order by call_time) rn,row_number() over(partition by caller_id,date_format(call_time,’%Y-%m-%d’) order by call_time desc) rn2<br>from<br>t1<br>),<br>t3 as (<br>select<br>caller_id,recipient_id,date_format(call_time,’%Y-%m-%d’) day #某天第一次通话<br>from<br>t2<br>where rn &#x3D; 1<br>union all<br>select<br>caller_id,recipient_id,date_format(call_time,’%Y-%m-%d’) day#某天最后一次通话<br>from<br>t2<br>where rn2 &#x3D; 1<br>)<br>select<br>distinct caller_id user_id<br>from</p>
<p>t3<br>group by<br>caller_id,day #对 某人某天第一次 和最后一次通话的id 去重计数  值为1就是题中需求<br>having<br>count(distinct recipient_id)&#x3D;1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>t2结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20240813173733417](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202408131737800.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##### mysql注释问题</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在MySQL中，注释不应该使用井号（#）在SQL语句的中间部分，尤其是在SELECT列表或其他语句结构中。井号（#）在MySQL中通常用于行尾来标记注释的开始，直到行末。如果您想在SQL语句的某部分添加注释，您应该使用两个连字符（–）后跟空格，或者如果注释跨越多行，您可以使用&#x2F;* 注释内容 *&#x2F;。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### mysql修改列数据类型</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>MySQL<br>alter table name modify column col1 int;</p>
<p>sql server<br>alter table name alter column col1 int;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 1988</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>表： Schools</p>
<p>+————-+——+<br>| Column Name | Type |<br>+————-+——+<br>| school_id   | int  |<br>| capacity    | int  |<br>+————-+——+<br>school_id 是该表的主键。<br>此表包含了一些学校的容纳能力。容纳能力指的是学校能够接纳学生的最大数量。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>表： Exam</p>
<p>+—————+——+<br>| Column Name   | Type |<br>+—————+——+<br>| score         | int  |<br>| student_count | int  |<br>+—————+——+<br>score 是该表的主键。<br>表中每一行表示有 student_count 名学生在考试中至少获得了 score 分。<br>表中的数据在逻辑上是正确的，即记录了高score的行相比记录了低score的行拥有相同或更少的student_count。<br>也就是说，对于表中的i行与j行，如果scorei &gt; scorej，那么student_counti &lt;&#x3D; student_countj</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>每年，学校会公布学生申请所需的最低分数要求。学校根据所有学生的考试成绩来决定其最低分数要求。</p>
<p>学校希望确保即使每一个满足分数要求的学生都申请该学校，学校也有足够的能力接纳每一个学生。<br>学校也希望尽可能多的学生能申请该学校。<br>学校必须使用在 Exam 表中的 score 来作为最低分数要求。</p>
<p>编写一个SQL查询来查询每所学校的最低分数要求。如果同时有多个score值满足上述要求，则选择其中最小的一个。如果数据不足以决定最低分数要求，那么输出 -1。</p>
<p>返回的结果表可以按任意顺序排序。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>查询结果格式如下例所示：</p>
<p>示例：</p>
<p>输入:<br>Schools 表:<br>+———–+———-+<br>| school_id | capacity |<br>+———–+———-+<br>| 11        | 151      |<br>| 5         | 48       |<br>| 9         | 9        |<br>| 10        | 99       |<br>+———–+———-+<br>Exam 表:<br>+——-+—————+<br>| score | student_count |<br>+——-+—————+<br>| 975   | 10            |<br>| 966   | 60            |<br>| 844   | 76            |<br>| 749   | 76            |<br>| 744   | 100           |<br>+——-+—————+<br>输出:<br>+———–+——-+<br>| school_id | score |<br>+———–+——-+<br>| 5         | 975   |<br>| 9         | -1    |<br>| 10        | 749   |<br>| 11        | 744   |<br>+———–+——-+<br>解释： </p>
<ul>
<li>School 5：学校的容纳能力为 48 。选择 975 作为最低分数要求，因为学校最多会收到 10 份申请，这在学校的容纳能力以内。</li>
<li>School 10：学校的容纳能力为 99 。可以选择 844 或 749 作为最低分数要求，因为学校最多会收到 76 份申请，这在学校的容纳能力以内。又因为 749 是所有可选项中最小的，因此我们选择 749 。</li>
<li>School 11：学校的容纳能力为 151 。选择 744 作为最低分数要求，因为学校最多会收到 100 份申请，这在学校的容纳能力以内。</li>
<li>School 9：给出的数据不足以确定最低分数要求。如果选择 975 作为最低分数要求，学校可能会收到 10 份申请，然而学校的容纳能力只有 9 。我们没有关于更高分数的信息，因此我们返回 -1 。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
select<br>  school_id,<br>  ifnull(min(score),-1) as score<br>from Schools<br>left join Exam<br>on capacity&gt;&#x3D;student_count<br>group by school_id;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 1990</span><br><span class="line"></span><br></pre></td></tr></table></figure>
问题：<br>三个实验平台中每种实验完成的次数<br>请注意，每一对（实验平台、实验名称）都应包含在输出中，包括平台上实验次数是零的。</li>
</ul>
<p>表: Experiments</p>
<p>+—————–+——+<br>| Column Name     | Type |<br>+—————–+——+<br>| experiment_id   | int  |<br>| platform        | enum |<br>| experiment_name | enum |<br>+—————–+——+</p>
<p>experiment_id 是这个表的主键.<br>platform 是枚举类型的，取值是这三种 (‘Android’, ‘IOS’, ‘Web’) 之一.<br>experiment_name 也是枚举类型的，取值是这三种 (‘Reading’, ‘Sports’, ‘Programming’) 之一.<br>这个表包含有关随机实验人员进行的实验的 ID、用于做实验的平台以及实验名称的信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>结果可以以任意顺序给出。<br>查询的结果如下所示：</p>
<p>示例：<br>输入：<br>Experiments table:<br>+—————+———-+—————–+<br>| experiment_id | platform | experiment_name |<br>+—————+———-+—————–+<br>| 4             | IOS      | Programming     |<br>| 13            | IOS      | Sports          |<br>| 14            | Android  | Reading         |<br>| 8             | Web      | Reading         |<br>| 12            | Web      | Reading         |<br>| 18            | Web      | Programming     |<br>+—————+———-+—————–+<br>输出：<br>+———-+—————–+—————–+<br>| platform | experiment_name | num_experiments |<br>+———-+—————–+—————–+<br>| Android  | Reading         | 1               |<br>| Android  | Sports          | 0               |<br>| Android  | Programming     | 0               |<br>| IOS      | Reading         | 0               |<br>| IOS      | Sports          | 1               |<br>| IOS      | Programming     | 1               |<br>| Web      | Reading         | 2               |<br>| Web      | Sports          | 0               |<br>| Web      | Programming     | 1               |<br>+———-+—————–+—————–+<br>解释：<br>在安卓平台上, 我们只做了一个”Reading” 实验.<br>在 “IOS” 平台上，我们做了一个”Sports” 实验和一个”Programming” 实验.<br>在 “Web” 平台上，我们做了两个”Reading” 实验和一个”Programming” 实验.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>– <a target="_blank" rel="noopener" href="https://leetcode.cn/problems/count-the-number-of-experiments">https://leetcode.cn/problems/count-the-number-of-experiments</a><br>drop table if EXISTS Experiments;<br>Create table If Not Exists Experiments (experiment_id int, platform enum(‘Android’,’IOS’,’Web’), experiment_name enum(‘Programming’,’Sports’,’Reading’));<br>insert into Experiments values (4,’IOS’,’Programming’);<br>insert into Experiments values (13,’IOS’,’Sports’);<br>insert into Experiments values (14,’Android’,’Reading’);<br>insert into Experiments values (8,’Web’,’Reading’);<br>insert into Experiments values (12,’Web’,’Reading’);<br>insert into Experiments values (18,’Web’,’Programming’);<br>select * from Experiments;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>with pe as<br>(   select * from<br>    (<br>    select ‘IOS’ platform union all<br>    select ‘Android’ platform union all<br>    select ‘Web’ platform<br>    )p<br>cross join<br>(<br>    select ‘Programming’ experiment_name union all<br>    select ‘Sports’ experiment_name union all<br>    select ‘Reading’ experiment_name<br>)e<br>)<br>– select * from pe;<br>select pe.platform,pe.experiment_name,count(w.platform) as num_experiments<br>from pe left join Experiments as w using(platform,experiment_name)<br>group by platform,experiment_name;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Write-your-MySQL-query-statement-below-5"><a href="#Write-your-MySQL-query-statement-below-5" class="headerlink" title="Write your MySQL query statement below"></a>Write your MySQL query statement below</h1><p>with new_table as(<br>    select ‘Android’ platform<br>    union select ‘IOS’<br>    union select ‘Web’<br>),<br>other_table as(<br>    select ‘Reading’ experiment_name<br>    union select ‘Sports’<br>    union select ‘Programming’<br>)<br>select new_table.platform ,other_table.experiment_name,count(experiment_id)num_experiments<br>from new_table join other_table #笛卡尔积<br>left join Experiments E<br>on E.platform &#x3D; new_table.platform<br>AND other_table.experiment_name &#x3D; E.experiment_name<br>group by new_table.platform ,other_table.experiment_name</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 2004</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>SQL架构</p>
<p>表: Candidates</p>
<p>+————-+——+<br>| Column Name | Type |<br>+————-+——+<br>| employee_id | int  |<br>| experience  | enum |<br>| salary      | int  |<br>+————-+——+<br>employee_id是此表的主键列。<br>经验是包含一个值（“高级”、“初级”）的枚举类型。<br>此表的每一行都显示候选人的id、月薪和经验。<br>一家公司想雇佣新员工。公司的工资预算是 70000 美元。公司的招聘标准是：</p>
<p>雇佣最多的高级员工。<br>在雇佣最多的高级员工后，使用剩余预算雇佣最多的初级员工。<br>编写一个SQL查询，查找根据上述标准雇佣的高级员工和初级员工的数量。<br>按 任意顺序 返回结果表。<br>查询结果格式如下例所示。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>示例 1:</p>
<p>输入:<br>Candidates table:<br>+————-+————+——–+<br>| employee_id | experience | salary |<br>+————-+————+——–+<br>| 1           | Junior     | 10000  |<br>| 9           | Junior     | 10000  |<br>| 2           | Senior     | 20000  |<br>| 11          | Senior     | 20000  |<br>| 13          | Senior     | 50000  |<br>| 4           | Junior     | 40000  |<br>+————-+————+——–+<br>输出:<br>+————+———————+<br>| experience | accepted_candidates |<br>+————+———————+<br>| Senior     | 2                   |<br>| Junior     | 2                   |<br>+————+———————+<br>说明：<br>我们可以雇佣2名ID为（2,11）的高级员工。由于预算是7万美元，他们的工资总额是4万美元，我们还有3万美元，但他们不足以雇佣ID为13的高级员工。<br>我们可以雇佣2名ID为（1,9）的初级员工。由于剩下的预算是3万美元，他们的工资总额是2万美元，我们还有1万美元，但他们不足以雇佣ID为4的初级员工。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>with t1 as (select<br>employee_id,experience,salary,sum(salary) over(partition by experience order by salary rows between unbounded preceding and current row) so<br>#按 experience 分组开窗,按salary 生序排列逐一求和   然后 &lt;&#x3D;70000 就是能招聘的 员工<br>from<br>Candidates<br>),<br>t2 as (<br>select<br>“Senior” experience,count(employee_id) accepted_candidates,70000-ifnull(max(so),0) m   # 能招聘的 Senior 等级员工<br>from<br>t1<br>where<br>experience &#x3D; “Senior” and so&lt;&#x3D;70000</p>
<p>)</p>
<p>select<br>experience,accepted_candidates<br>from<br>t2<br>union all #上下两表拼接 就是题中需求<br>select<br>“Junior” experience,count(employee_id) accepted_candidates # 能招聘的 Junior 等级员工<br>from<br>t1<br>where<br>experience &#x3D; “Junior” and so&lt;&#x3D;(select m from t2)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>自己思路：找出高级和低级的生成临时表，然后用变量from t,@var&#x3D;0,然后对高级和低级临时表的工资逐行加，再筛选出低于预备工资的数据，得到高级多少人并且一共花多少，再和低级临时表连接，条件是高级的总工资+低级总工资&lt;预算，得到低级多少人和低级总工资</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 2020 简单</span><br><span class="line"></span><br><span class="line">![在这里插入图片描述](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202406111501368.png)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>简单 别人的答案</p>
<h1 id="Write-your-MySQL-query-statement-below-6"><a href="#Write-your-MySQL-query-statement-below-6" class="headerlink" title="Write your MySQL query statement below"></a>Write your MySQL query statement below</h1><p>with new_table as(<br>    select  DISTINCT account_id from Subscriptions where<br>    date_format(start_date,’%Y’) &#x3D; ‘2021’ or<br>    date_format(end_date,’%Y’) &#x3D; ‘2021’<br>)<br>select count(*) accounts_count<br>from Streams S right join new_table N<br>on N.account_id &#x3D; S.account_id<br>where substring(stream_date,1,4) &lt;&gt; ‘2021’</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>用year函数，or, not in，子查询就可以了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 2026 简单</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>简单 但我只想到了select是算出比率，然后再select</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![在这里插入图片描述](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202406111507021.png)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Write-your-MySQL-query-statement-below-7"><a href="#Write-your-MySQL-query-statement-below-7" class="headerlink" title="Write your MySQL query statement below"></a>Write your MySQL query statement below</h1><p>SELECT problem_id<br>FROM Problems<br>#这里不要用round四舍五入<br>WHERE likes&#x2F;(likes+dislikes)&lt;0.60<br>order by problem_id asc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 2041 简单</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>简单</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202406111511919.png)</span><br><span class="line"></span><br><span class="line">#### 2051</span><br><span class="line"></span><br><span class="line">![在这里插入图片描述](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202406111530105.png)</span><br><span class="line"></span><br><span class="line">![](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202406111529019.png)</span><br><span class="line"></span><br><span class="line">![](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202406111528723.png)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Write-your-MySQL-query-statement-below-8"><a href="#Write-your-MySQL-query-statement-below-8" class="headerlink" title="Write your MySQL query statement below"></a>Write your MySQL query statement below</h1><p>select M.member_id,M.name,(<br>case<br>    when count(V.visit_id) &#x3D; 0 then ‘Bronze’<br>    when count(P.visit_id)&#x2F;count(V.visit_id) &lt; 0.5 then ‘Silver’<br>    when count(P.visit_id)&#x2F;count(V.visit_id) &lt;0.8 then ‘Gold’<br>    else ‘Diamond’<br>    end) AS category<br>from Members M left join Visits V<br>on M.member_id &#x3D; V.member_id<br>left join Purchases P<br>on P.visit_id &#x3D; V.visit_id<br>group by M.member_id</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 常用积累</span><br><span class="line"></span><br><span class="line">#### Delete</span><br><span class="line"></span><br><span class="line">##### 1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>删除重复邮件，保留最小的id email 来自leecode</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Write-your-MySQL-query-statement-below-9"><a href="#Write-your-MySQL-query-statement-below-9" class="headerlink" title="Write your MySQL query statement below"></a>Write your MySQL query statement below</h1><p>delete from Person where Person.id not in (<br>select t.id from (<br>select p2.id<br>from Person p2<br>where p2.email in (select p1.email<br>from Person p1<br>group by p1.email<br>having count(*)&#x3D;1)<br>) t<br>)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>如果不要貌似多余的select t.id from ( 会报错</p>
<p>–MySQL 不允许在 DELETE 语句的 WHERE 子句中直接使用正在被更新的表。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20240516100028199](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202405161000539.png)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>delete from Person where id not in (<br>    select a.id from (<br>        select min(id) from Person group by email a<br>    )<br>)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>DELETE p1 FROM Person p1,<br>    Person p2<br>WHERE<br>    p1.Email &#x3D; p2.Email AND p1.Id &gt; p2.Id</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>p1是Person表的别名，这个DELETE语句会删除Person表中所有满足JOIN条件和WHERE条件的行</p>
<p>所以答案这样写的意思是，最终会在P1中delete，而不是在笛卡尔积的表里delete是吗？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 日期相关</span><br><span class="line"></span><br><span class="line">##### DATEDIFF()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>DATEDIFF() 函数返回两个日期之间的时间。天数、月数、年数</p>
<p>结果：day&#x3D;DiffDate&#x3D;enddate−startdate&#x3D;1day&#x3D;DiffDate&#x3D;enddate-startdate&#x3D;1day&#x3D;DiffDate&#x3D;enddate−startdate&#x3D;1，把示例的day换成year，就是按年计算</p>
<p>select<br>    b.Id<br>from<br>    weather a<br>inner join<br>    weather b<br>where<br>    DATEDIFF(b.recordDate,a.recordDate)&#x3D;1<br>and b.Temperature &gt; a.Temperature;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### TIMESTAMPDIFF()  |  NOW()</span><br><span class="line"></span><br><span class="line">[timestampdiff](https://www.php.cn/faq/631801.html)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>timestampdiff(year,参数1,参数2) </p>
<p>TIMESTAMPDIFF能干什么，可以计算相差天数、小时、分钟和秒，相比于datediff函数要灵活很多。格式是时间小的前，时间大的放在后面。 计算相差天数：</p>
<p>其中，year处可以是以下值之一：<br>MICROSECOND<br>SECOND<br>MINUTE<br>HOUR<br>DAY<br>WEEK<br>MONTH<br>QUARTER<br>YEAR</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>select w1.Id<br>from Weather as w1, Weather as w2<br>where TIMESTAMPDIFF(DAY, w2.RecordDate, w1.RecordDate) &#x3D; 1<br>AND w1.Temperature &gt; w2.Temperature</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>SELECT TIMESTAMPDIFF(YEAR,’1999-11-02’,NOW()) age;<br>24</p>
<p>now()<br>+———————+<br>| 2024-11-01 22:46:28</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20241101225020808](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202411012250530.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##### DATE_FORMAT()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>%b	缩写月名<br>%m	月，数值(00-12)<br>%d	月的天，数值(00-31)<br>%e	月的天，数值(0-31)<br>%Y	年，4 位<br>%y	年，2 位<br>%H	小时 (00-23)<br>%h	小时 (01-12)<br>%i	分钟，数值(00-59)<br>%p	AM 或 PM<br>%T	时间, 24-小时 (hh:mm:ss)<br>%f	微秒</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>–2018-12-18</p>
<p>DATE_FORMAT(trans_date, ‘%Y-%m’)</p>
<p>–2018-12</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### DATE_ADD()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>DATE_ADD() ：从日期增加指定的时间间隔，返回的是一个字符串</p>
<p>DATE_ADD(date,INTERVAL expr type)</p>
<p>date 参数是合法的日期表达式。expr 参数是您希望添加的时间间隔。</p>
<p>type 参数可以是下列值</p>
<p>二、使用<br>now() &#x2F;&#x2F;now函数为获取当前时间</p>
<p>select date_add(now(), interval 1 day); - 加1天<br>select date_add(now(),INTERVAL -1 DAY);-当前日期向前推1天<br>select date_add(now(), interval 1 hour); -加1小时<br>select date_add(now(), interval 1 minute); - 加1分钟<br>select date_add(now(), interval 1 second); -加1秒<br>select date_add(now(), interval 1 microsecond);-加1毫秒<br>select date_add(now(), interval 1 week);-加1周<br>select date_add(now(), interval 1 month);-加1月<br>select date_add(now(), interval 1 quarter);-加1季<br>select date_add(now(), interval 1 year);-加1年<br>MySQL adddate(), addtime()函数，可以用date_add() 来替代。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>select IFNULL(round(count(distinct(Result.player_id)) &#x2F; count(distinct(Activity.player_id)), 2), 0) as fraction<br>from (<br>  select Activity.player_id as player_id<br>  from (<br>    select player_id, DATE_ADD(MIN(event_date), INTERVAL 1 DAY) as second_date<br>    from Activity<br>    group by player_id<br>  ) as Expected, Activity<br>  where Activity.event_date &#x3D; Expected.second_date and Activity.player_id &#x3D; Expected.player_id<br>) as Result, Activity</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### CURDATE()，NOW()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>mysql&gt; select curdate();<br>+————+<br>| curdate()  |<br>+————+<br>| 2024-11-01 |<br>+————+</p>
<p>mysql&gt; select now();<br>+———————+<br>| now()               |<br>+———————+<br>| 2024-11-01 22:46:28 |<br>+———————+</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### month(),week(),year()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>略</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### lag()、lead()、with</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>lag()和lead()这两个函数可以查询我们得到的结果集上下偏移相应行数的相应的结果。</p>
<p>lag()函数：<br>查询当前行向上偏移n行对应的结果<br>该函数有三个参数：第一个为待查询的参数列名，第二个为向上偏移的位数，第三个参数为超出最上面边界的默认值。</p>
<p>lead()函数：<br>查询当前行向下偏移n行对应的结果<br>该函数有三个参数：第一个为待查询的参数列名，第二个为向下偏移的位数，第三个参数为超出最下面边界的默认值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>with people as<br>(<br>    select id, visit_date, people,<br>    Lag(people,2) over(order by id) as pprvPeople,<br>    Lag(people,1) over(order by id) as prvPeople,<br>    Lead(people,1) over(order by id) as nextPeople,<br>    Lead(people,2) over(order by id) as nnextPeople<br>    from stadium<br>)<br>select id, visit_date, people from people<br>where<br>(people &gt;&#x3D; 100 and prvPeople&gt;&#x3D;100 and pprvPeople&gt;&#x3D;100) ||<br>(people &gt;&#x3D; 100 and nextPeople&gt;&#x3D;100 and nnextPeople&gt;&#x3D;100) ||<br>(people &gt;&#x3D; 100 and nextPeople&gt;&#x3D;100 and prvPeople&gt;&#x3D;100) </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### with语句</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>WITH BaseSalary AS (<br>    SELECT employee_id, salary * 12 AS annual_base_salary<br>    FROM employees<br>),<br>Bonus AS (<br>    SELECT employee_id, SUM(amount) AS total_bonus<br>    FROM bonuses<br>    GROUP BY employee_id<br>),<br>Commission AS (<br>    SELECT employee_id, SUM(amount) AS total_commission<br>    FROM commissions<br>    GROUP BY employee_id<br>)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>WITH cte_name (column_name1, column_name2, …) AS (<br>– CTE查询定义<br>SELECT column1, column2,<br>FROM table_name<br>WHERE condition<br>)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在SQL查询中，经常会遇到需要重复使用的子查询。为了简化查询语句并提高可读性，SQL引入了WITH AS语法。通过使用WITH AS，我们可以创建临时表或视图，将子查询的结果保存起来，并在主查询中使用。本文将通过示例介绍SQL中WITH AS的特点，展示其在查询中的优势。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>简化复杂查询</li>
</ol>
<p>WITH customer_orders (customer_id, total_amount) AS (<br>   SELECT customer_id, SUM(order_amount) AS total_amount<br>   FROM orders<br>   GROUP BY customer_id<br>)<br>SELECT customer_id, total_amount<br>FROM customer_orders<br>WHERE total_amount &gt; 1000;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>提高查询性能：使用WITH AS可以避免在主查询中重复执行相同的子查询，从而提高查询性能。临时表的结果会被缓存，主查询只需要引用临时表即可，避免了重复计算子查询的开销。</li>
</ol>
<p>WITH average_salary AS (<br>   SELECT AVG(salary) AS avg_salary<br>   FROM employees<br>)<br>SELECT employee_id, first_name, last_name, salary<br>FROM employees<br>WHERE salary &gt; (SELECT avg_salary FROM average_salary)<br>ORDER BY salary DESC;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### roud()、if()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>SELECT T.request_at AS <code>Day</code>,<br>    ROUND(<br>            SUM(<br>                IF(T.STATUS &#x3D; ‘completed’,0,1)<br>            )<br>            &#x2F;<br>            COUNT(T.STATUS),<br>            2<br>    ) AS <code>Cancellation Rate</code><br>FROM Trips AS T<br>JOIN Users AS U1 ON (T.client_id &#x3D; U1.users_id AND U1.banned &#x3D;’No’)<br>JOIN Users AS U2 ON (T.driver_id &#x3D; U2.users_id AND U2.banned &#x3D;’No’)<br>WHERE T.request_at BETWEEN ‘2013-10-01’ AND ‘2013-10-03’<br>GROUP BY T.request_at</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### limit()</span><br><span class="line"></span><br><span class="line">[](https://www.jb51.net/database/3070058yf.htm)</span><br><span class="line"></span><br><span class="line">##### 一个参数</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>limit 10</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### 两个参数</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>limit 0,2 第一个参数表示从第几行开始取，第二个表示取几行</p>
<p>–其实这个实现分页也是可以的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### 分页offset</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>例如，把结果集分页，每页3条记录。要获取第1页的记录，可以使用LIMIT 3 OFFSET 0：<br>SELECT * FROM student LIMIT 3 OFFSET 0;<br>上述查询LIMIT 3 OFFSET 0表示，对结果集从0号记录开始，最多取3条。注意SQL记录集的索引从0开始。</p>
<p>如果要查询第2页，那么我们只需要“跳过”头3条记录，也就是对结果集从3号记录开始查询，把OFFSET设定为3：<br>SELECT * FROM student LIMIT 3 OFFSET 3;</p>
<p>LIMIT总是设定为pageSize<br>OFFSET计算公式为pageSize * (pageIndex - 1)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### IF</span><br><span class="line"></span><br><span class="line">##### if()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>IF(T.STATUS &#x3D; ‘completed’,0,1)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### IFNULL()、NULLIF()、ISNULL()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>IFNULL()函数的使用<br>IFNULL(expr1,expr2)，如果expr1的值为null，则返回expr2的值，如果expr1的值不为null，则返回expr1的值。</p>
<p>SELECT IFNULL(NULL,’B’); – 输出结果：B</p>
<p>SELECT IFNULL(‘HELLO’,’B’); – 输出结果：HELLO</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">~~~~</span><br><span class="line">NULLIF()函数的使用</span><br><span class="line">NULLIF(expr1,expr2)，如果expr1=expr2成立，那么返回值为null，否则返回值为expr1的值。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">SELECT NULLIF(&#x27;A&#x27;,&#x27;A&#x27;); -- 输出结果：null</span><br><span class="line"> </span><br><span class="line">SELECT NULLIF(&#x27;A&#x27;,&#x27;B&#x27;); -- 输出结果：A</span><br><span class="line"></span><br><span class="line">~~~~</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ISNULL()函数的使用</p>
<p>ISNULL(expr)，如果expr的值为null，则返回1，如果expr1的值不为null，则返回0。</p>
<p>SELECT ISNULL(NULL); – 输出结果：1</p>
<p>SELECT ISNULL(‘HELLO’); – 输出结果：0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### &lt;&gt;、!=、&lt;=&gt;、NULL、TRUE、FALSE、UNKNOWN、is null、is not null</span><br><span class="line"></span><br><span class="line">[安全等于](https://deepinout.com/mysql/mysql-questions/68_tk_1702767681.html)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>MySQL提供了IS NULL和IS NOT NULL这两个操作符，它们专门用于检查字段是否为NULL。当我们使用IS NULL时，如果字段的值为NULL，查询将返回TRUE；如果字段的值不是NULL（包括字段中有值和字段为空），查询将返回FALSE。 同样地，IS NOT NULL用于检查字段值是否不是NULL。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>普通的&#x3D;，不能用于null的比较，两个式子中有一个或者两个null结果为null<br>安全等于&lt;&#x3D;&gt;，可以用于包含null的比较，除了null&lt;&#x3D;&gt;null等于1,null&lt;&#x3D;&gt;1等于0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">~~~~</span><br><span class="line">1&lt;=&gt;0	‘2’&lt;=&gt;2	2&lt;=&gt;2	‘b’&lt;=&gt;‘b’	(1+3)&lt;=&gt;(2+2)	NULL&lt;=&gt;NULL	NULL&lt;=&gt;‘1234’	NULL&lt;=&gt;123	‘456’&lt;=&gt;NULL</span><br><span class="line">0	1	1	1	1	1	0	0	0</span><br><span class="line">~~~~</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>mysql中两个字符串比较按照字符串规则来，字符串和数字比较，字符串转换成数字比较 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20240517153247499](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202405171532529.png)</span><br><span class="line"></span><br><span class="line">![image-20240517153306278](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202405171533625.png)</span><br><span class="line"></span><br><span class="line">![image-20240517153424876](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202405171534845.png)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>安全等于可以用于比较null,同null为1，一个则为0。其它情况和&#x3D;类似</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>输入：<br>Customer 表:<br>+—-+——+————+<br>| id | name | referee_id |<br>+—-+——+————+<br>| 1  | Will | null       |<br>| 2  | Jane | null       |<br>| 3  | Alex | 2          |<br>| 4  | Bill | null       |<br>| 5  | Zack | 1          |<br>| 6  | Mark | 2          |<br>+—-+——+————+</p>
<p>找出那些 没有被 id &#x3D; 2 的客户 推荐 的客户的姓名。</p>
<p>法一<br>SELECT name<br>FROM customer<br>WHERE NOT referee_id &lt;&#x3D;&gt; 2;</p>
<p>法二<br>SELECT name FROM customer WHERE referee_id !&#x3D; 2 OR referee_id IS NULL;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 笛卡尔积、CROSS JOIN</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>sql笛卡尔积<br>SQL中的笛卡尔积（Cartesian Product）是指两个表的所有可能的组合。当两个表没有关联条件时，数据库系统会对这两个表进行笛卡尔积操作，这会导致性能下降和资源浪费。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>SELECT<br>    *<br>FROM<br>    Students s<br>CROSS JOIN<br>    Subjects sub</p>
<p>和<br>from Students,Subjects</p>
<p>一样的，都是笛卡尔积</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### WITH</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>with people as<br>(<br>    select id, visit_date, people,<br>    Lag(people,2) over(order by id) as pprvPeople,<br>    Lag(people,1) over(order by id) as prvPeople,<br>    Lead(people,1) over(order by id) as nextPeople,<br>    Lead(people,2) over(order by id) as nnextPeople<br>    from stadium<br>)<br>select id, visit_date, people from people<br>where<br>(people &gt;&#x3D; 100 and prvPeople&gt;&#x3D;100 and pprvPeople&gt;&#x3D;100) ||<br>(people &gt;&#x3D; 100 and nextPeople&gt;&#x3D;100 and nnextPeople&gt;&#x3D;100) ||<br>(people &gt;&#x3D; 100 and nextPeople&gt;&#x3D;100 and prvPeople&gt;&#x3D;100) </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### mod(M,N)</span><br><span class="line"></span><br><span class="line">```sql</span><br><span class="line">取余函数</span><br><span class="line">mod(id,2)</span><br><span class="line">id%2</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">#### substring()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>不是下标为0开始</p>
<p>–2018-12-18<br>substring(trans_date,1,7)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">#### group by 新奇</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>SELECT DATE_FORMAT(trans_date, ‘%Y-%m’) AS month,<br>    country,<br>    COUNT(*) AS trans_count,<br>    COUNT(IF(state &#x3D; ‘approved’, 1, NULL)) AS approved_count,<br>    SUM(amount) AS trans_total_amount,<br>    SUM(IF(state &#x3D; ‘approved’, amount, 0)) AS approved_total_amount<br>FROM Transactions<br>GROUP BY month, country –这里的month是截取的，不能再group by后面截取，截取后也不能重命名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>select e.student_id,student_name,count(*) attended_exams<br>from Students s ,Examinations e<br>where s.student_id&#x3D;e.student_id<br>group by student_id,student_name</p>
<p>– 这里能select student_name,因为这里同分组下student_name相同</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 自定义变量</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Queue 表<br>+———–+————-+——–+——+<br>| person_id | person_name | weight | turn |<br>+———–+————-+——–+——+<br>| 5         | Alice       | 250    | 1    |<br>| 4         | Bob         | 175    | 5    |<br>| 3         | Alex        | 350    | 2    |<br>| 6         | John Cena   | 400    | 3    |<br>| 1         | Winston     | 500    | 6    |<br>| 2         | Marie       | 200    | 4    |<br>+———–+————-+——–+——+</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>SELECT a.person_name<br>FROM (<br>    SELECT person_name, @pre :&#x3D; @pre + weight AS weight<br>    FROM Queue, (SELECT @pre :&#x3D; 0) tmp<br>    ORDER BY turn<br>) a<br>WHERE a.weight &lt;&#x3D; 1000<br>ORDER BY a.weight DESC<br>LIMIT 1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 窗口函数</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>mysql8.0时开始支持</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[参考](https://blog.csdn.net/CoderSharry/article/details/135063960)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>通常将常用的窗口函数分为两大类：聚合窗口函数与专用窗口函数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">| SUM   | 求和     |</span><br><span class="line">| ----- | -------- |</span><br><span class="line">| AVG   | 求平均值 |</span><br><span class="line">| COUNT | 求数量   |</span><br><span class="line">| MAX   | 求最大值 |</span><br><span class="line">| MIN   | 求最小值 |</span><br><span class="line"></span><br><span class="line">函数名	分类	说明</span><br><span class="line">RANK	排序函数	类似于排名，并列的结果序号可以重复，序号不连续</span><br><span class="line">DENSE_RANK	排序函数	类似于排名，并列的结果序号可以重复，序号连续</span><br><span class="line">ROW_NUMBER	排序函数	对该分组下的所有结果作一个排序，基于该分组给一个行数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>[你要的操作] OVER ( PARTITION BY  &lt;用于分组的列名&gt;<br>                    ORDER BY &lt;按序叠加的列名&gt;<br>                    ROWS &lt;窗口滑动的数据范围&gt; )</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>窗口函数([参数]) OVER (<br>  [PARTITION BY &lt;分组列&gt;]<br>  [ORDER BY &lt;排序列 ASC&#x2F;DESC&gt;]<br>  [ROWS BETWEEN 开始行 AND 结束行]<br>)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### rows between and</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>&lt;窗口滑动的数据范围&gt; 用来限定[ 你要的操作] 所运用的数据的范围，具体有如下这些：</p>
<p>当前行 - current row<br>之前的行 - preceding<br>之后的行 - following<br>无界限 - unbounded<br>表示从前面的起点 - unbounded preceding<br>表示到后面的终点 - unbounded following</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>举例理解一下：</p>
<p>取当前行和前五行：ROWS between 5 preceding and current row –共6行<br>取当前行和后五行：ROWS between current row and 5 following –共6行<br>取前五行和后五行：ROWS between 5 preceding and 5 folowing –共11行</p>
<p>&#x2F;&#x2F; 从当前行到最后的数据<br>sum(sales_volume) over(partition by id rows between current row and unbounded following) sum_sales</p>
<p>sum(sales_volume) over(partition by id rows between unbounded preceding and current row) sum_sales</p>
<p>sum(sales_volume) over(partition by id rows between current row and 2 following) sum_sales</p>
<p>sum(sales_volume) over(partition by id rows between 1 preceding and current row) sum_sales</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### range between and</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>range表示的是 具体的值，比这个值小n的行，比这个值大n的行<br>range between是以当前值为锚点进行计算</p>
<p>比如<br>range between 4 preceding AND 7 following<br>1<br>表示：如果当前值为10的话就取前后的值在6到17之间的数据。</p>
<p>sum(close) range between 100 preceding and 200 following<br>1<br>则通过字段差值来进行选择。如当前行的 close 字段值是 200，那么这个窗口大小的定义就会选择分区中 close 字段值落在 100 至 400 区间的记录（行）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##### dense_rank() over</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>SELECT SId,totalscore,DENSE_RANK()over(ORDER BY totalscore DESC) r<br>FROM<br>(<br>SELECT SId,SUM(score) totalscore<br>FROM sc<br>GROUP BY SId<br>) t</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### avg(x) over()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>SELECT<br>  sales.*,<br>  AVG( revenue ) OVER ( PARTITION BY category ) AS avg_revenue<br>FROM<br>    sales</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### CASE</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>case语句格式一</p>
<p>CASE语句在执行时，将CASE后的表达式的值与各WHEN子句的表达式值比较，如果相等，则执行THEN后面的表达式或语句，然后跳出CASE语句；否则，返回ELSE后面的表达式。</p>
<p>CASE input_expression<br>    WHEN expression1 THEN result_expression1<br>    WHEN expression2 THEN result_expression2<br>    […n]<br>    ELSE result_expression<br>    END</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>case语句格式二</p>
<p>CASE<br>    WHEN expression1 THEN result_expression1<br>    WHEN expression2 THEN result_expression2<br>    […n]<br>    ELSE result_expression<br>    END</p>
<p>CASE后面没有表达式，多个WHEN子句中的表达式依次执行，如果表达式结果为真，则执行相应THEN关键字后面的表达式或语句，执行完毕之后跳出CASE语句。如果所有WHEN语句都为FALSE，则执行ELSE子句中的语句。</p>
<p>小tips：在交换数据和列转行时可以考虑使用case语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>case when … then x else x end</p>
<p>\</p>
<p>case when then x<br>when then x else x end</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>case when sc.cid&#x3D;’01’ then sc.score end</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### GROUP_CONCAT()</span><br><span class="line"></span><br><span class="line">![image-20240523175304465](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202405231753919.png)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>SELECT sell_date,<br>       COUNT(DISTINCT product) num_sold,<br>       GROUP_CONCAT(DISTINCT product) products<br>FROM Activities<br>GROUP BY sell_date</p>
<p>可以指定自定义的分隔符，不指定的情况下，默认是 ‘,’ GROUP_CONCAT(DISTINCT product ORDER BY product ASC SEPARATOR ‘,’)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 正则表达式</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### ||</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>sql语句中“||”符号表示，连接符。比如’111’||’222’其结果就是’111222’。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### ONLY_FULL_GROUP_BY</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>关闭ONLY_FULL_GROUP_BY模式的弊端</p>
<p>结果的不确定性：关闭 ONLY_FULL_GROUP_BY 可能导致分组查询返回不确定的结果。特别是当 SELECT 列表中包含非聚合列，且这些列没有包含在 GROUP BY 子句中时，MySQL 将从每个分组中任意选择一个值作为结果，这可能导致结果难以预测和解释。<br>调试复杂性：在没有 ONLY_FULL_GROUP_BY 的约束下，编写的查询可能在逻辑上不那么明确，尤其是当查询变得复杂时。这可能使得调试和维护查询变得更加困难。<br>性能问题：虽然不是直接结果，但关闭 ONLY_FULL_GROUP_BY 并依赖 MySQL 从分组中随机选择数据可能导致查询效率不是最优的，特别是在处理大量数据时。<br>标准SQL的偏离：ONLY_FULL_GROUP_BY 更接近于 SQL 标准对分组操作的定义。关闭它可能意味着编写的 SQL 在其他遵循 SQL 标准的数据库系统中可能不会工作或者产生不同的结果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 行转列、列转行</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>行转列一般使用 IF 或 CASE WHEN 语句 + GROUP BY + 聚合函数。而列转行一般使用 UNION + 多个查询 的方法</p>
<p>SELECT<br>  product_id,<br>  SUM(IF(store &#x3D; ‘store1’, price, NULL)) ‘store1’,<br>  SUM(IF(store &#x3D; ‘store2’, price, NULL)) ‘store2’,<br>  SUM(IF(store &#x3D; ‘store3’, price, NULL)) ‘store3’<br>FROM<br>  Products1<br>GROUP BY product_id ;</p>
<p>SELECT product_id, ‘store1’ store, store1 price FROM products WHERE store1 IS NOT NULL<br>UNION<br>SELECT product_id, ‘store2’ store, store2 price FROM products WHERE store2 IS NOT NULL<br>UNION<br>SELECT product_id, ‘store3’ store, store3 price FROM products WHERE store3 IS NOT NULL;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20240528130754538](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202405281307874.png)</span><br><span class="line"></span><br><span class="line">![image-20240528130802977](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202405281308365.png)</span><br><span class="line"></span><br><span class="line">#### 左右外连接当连接键不唯一时</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>还是可以正常连接</p>
<p>不用去笛卡尔积，然后过滤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20240602143811747](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202406021438298.png)</span><br><span class="line"></span><br><span class="line">![image-20240602143830263](https://raw.githubusercontent.com/ttyong/hexoBlog/master/尚硅谷大数据技术之数据湖Hudi/202406021438977.png)</span><br><span class="line"></span><br><span class="line">#### mysql全外连接</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>mysql不支持<br>可以用left + right +union实现(这里需要去重)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### union和union all</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>union会去重<br>union all不会去重</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### limit</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>limit  2 &#x3D;&#x3D;&gt;从0索引开始读取2个</p>
<p>select * from table limit 2,1;<br>&#x2F;&#x2F;含义是跳过2条取出1条数据，limit后面是从第2条开始读，读取1条信息，即读取第3条数据</p>
<p>select * from table limit 2 offset 1;<br>&#x2F;&#x2F;含义是从下标1开始取出2条数据，limit后面跟的是2条数据，即读取第2,3条</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### where (player_id, event_date) in select a,b</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>select player_id, device_id<br>from activity<br>where (player_id, event_date) in<br>(select player_id, min(event_date)<br>from activity<br>group by player_id)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## Hbase</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>1.我们在设计列族的时候，可以把经常读取的列存储到一个列族中，不经常读取的列放到另一个列族中。<br>这样我们在读取部分列的数据的时候，就只需要读取对应列族文件中的数据，提高读取效率。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>在HBase中，数据块大小和MemStore大小是两个不同的概念，它们具有不同的功能和调整目的。</p>
<p>数据块大小主要影响HBase中的数据存储和访问性能。数据块由多个cell（key-value对）集合组成，每个数据块的大小在创建表的列族时可以指定。数据块大小的设定影响数据块索引的大小，数据块越小，索引越大，从而占用更大内存空间。因此，在随机查找性能和数据块索引内存占用之间需要权衡。如果需要更好的随机查找性能，可以将数据块设置为较小的值；而如果需要更好的序列扫描性能，则可以考虑增大数据块的大小。</p>
<p>而MemStore是HBase中用于保存修改数据（即key-value对）的内存结构。当MemStore的大小达到一个阈值（默认是128MB）时，MemStore会被Flush到文件（即StoreFile），以释放内存空间。MemStore的大小设置主要影响HBase的写入性能和内存使用。如果MemStore太小，可能导致频繁的Flush操作，影响写入性能；如果MemStore太大，则可能消耗过多的内存资源。</p>
<p>因此，hbase数据块大小和memstore大小不一样，它们是HBase中两个不同的参数，需要根据具体的应用场景和性能需求进行独立调整。</p>
<pre><code>
</code></pre>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">智汇君</div><div class="post-copyright__author_desc">路漫漫其修远兮，吾将上下而求索！</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/01/17/%E9%9D%A2%E8%AF%95%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%EF%BC%9F/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/01/17/面试 数据库常见面试问题？/')">面试 数据库常见面试问题？</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="/img/%E5%BE%AE%E4%BF%A1%E6%94%B6%E6%AC%BE%E7%A0%81.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E5%BE%AE%E4%BF%A1%E6%94%B6%E6%AC%BE%E7%A0%81.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%B6%E6%AC%BE%E7%A0%81.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%B6%E6%AC%BE%E7%A0%81.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/01/17/%E9%9D%A2%E8%AF%95%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%EF%BC%9F/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Tech智汇站</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E9%9D%A2%E8%AF%95/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>面试<span class="tagsPageCount">12</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/01/17/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-%E5%9F%BA%E7%A1%80%E7%AF%87%201/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">黑马MySQL数据库从入门到精通-基础篇 事务</div></div></a></div><div class="next-post pull-right"><a href="/2025/01/17/%E9%BB%91%E9%A9%AC-2022%E6%95%B0%E6%8D%AE%E6%B9%96%E6%9E%B6%E6%9E%84%E5%BC%80%E5%8F%91Hudi(%E6%B6%B5%E7%9B%96HDFS+Spark+Flink+Hive%E7%AD%89%E7%9F%A5%E8%AF%86%E7%82%B9%E7%BB%93%E5%90%88)/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">黑马-2022数据湖架构开发Hudi(涵盖HDFS+Spark+Flink+Hive等知识点结合)</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/01/17/%E5%B0%9A%E8%A7%82%E4%BA%91%E8%AE%A1%E7%AE%97%E4%B9%8Boracle%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86%201/" title="尚观云计算之oracle数据库 基础部分 1"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-17</div><div class="title">尚观云计算之oracle数据库 基础部分 1</div></div></a></div><div><a href="/2025/01/17/%E9%9D%A2%E8%AF%95%20ES%E9%9D%A2%E8%AF%951/" title="面试 ES面试1"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-17</div><div class="title">面试 ES面试1</div></div></a></div><div><a href="/2025/01/17/%E9%9D%A2%E8%AF%95%20Hadoop%E9%9D%A2%E8%AF%95/" title="面试 Hadoop面试"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-17</div><div class="title">面试 Hadoop面试</div></div></a></div><div><a href="/2025/01/17/%E9%9D%A2%E8%AF%95%20hive%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%982/" title="面试 hive常见面试题2"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-17</div><div class="title">面试 hive常见面试题2</div></div></a></div><div><a href="/2025/01/17/%E9%9D%A2%E8%AF%95%20hive%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%981/" title="面试 hive常见面试题1"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-17</div><div class="title">面试 hive常见面试题1</div></div></a></div><div><a href="/2025/01/17/%E9%9D%A2%E8%AF%95%20linux%E9%9D%A2%E8%AF%952/" title="面试 SHELL脚本开发"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-17</div><div class="title">面试 SHELL脚本开发</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">智汇君</h1><div class="author-info__desc">路漫漫其修远兮，吾将上下而求索！</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="/contact/" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来看我的博客鸭~</div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(/img/博客微信公众号图片.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">数据库常见面试问题？</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql"><span class="toc-number">1.1.</span> <span class="toc-text">mysql</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">课程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%80%E5%9C%9F%E6%8E%98%E9%87%91"><span class="toc-number">1.1.2.</span> <span class="toc-text">稀土掘金</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%B9%BB%E8%AF%BB%EF%BC%8C%E8%84%8F%E8%AF%BB%EF%BC%8C%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E5%91%A2%EF%BC%9F"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">什么是幻读，脏读，不可重复读呢？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#limit-1000000-%E5%8A%A0%E8%BD%BD%E5%BE%88%E6%85%A2%E7%9A%84%E8%AF%9D%EF%BC%8C%E4%BD%A0%E6%98%AF%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%E7%9A%84%E5%91%A2%EF%BC%9F"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">limit 1000000 加载很慢的话，你是怎么解决的呢？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E9%AB%98%E5%B9%B6%E5%8F%91%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E5%A6%82%E4%BD%95%E5%81%9A%E5%88%B0%E5%AE%89%E5%85%A8%E7%9A%84%E4%BF%AE%E6%94%B9%E5%90%8C%E4%B8%80%E8%A1%8C%E6%95%B0%E6%8D%AE%EF%BC%9F"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">在高并发情况下，如何做到安全的修改同一行数据？</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%82%B2%E8%A7%82%E9%94%81"><span class="toc-number">1.1.2.3.1.</span> <span class="toc-text">使用悲观锁</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%B9%90%E8%A7%82%E9%94%81"><span class="toc-number">1.1.2.3.2.</span> <span class="toc-text">使用乐观锁</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CSDN%E6%A1%88%E4%BE%8B"><span class="toc-number">1.1.2.4.</span> <span class="toc-text">CSDN案例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%B8%80"><span class="toc-number">1.1.2.4.1.</span> <span class="toc-text">案例一</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1"><span class="toc-number">1.1.2.4.2.</span> <span class="toc-text">1.1</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-2"><span class="toc-number">1.1.2.4.2.1.</span> <span class="toc-text">1.2</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#1-3"><span class="toc-number">1.1.2.4.2.2.</span> <span class="toc-text">1.3</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-EXISTS"><span class="toc-number">1.1.2.4.3.</span> <span class="toc-text">3 EXISTS</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#7-having%E7%9A%84%E4%B8%80%E4%B8%AA%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7"><span class="toc-number">1.1.2.4.3.1.</span> <span class="toc-text">7 having的一个使用技巧</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#8"><span class="toc-number">1.1.2.4.3.2.</span> <span class="toc-text">8</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#9"><span class="toc-number">1.1.2.4.3.3.</span> <span class="toc-text">9</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#13-avg-over-partition-by"><span class="toc-number">1.1.2.4.3.4.</span> <span class="toc-text">13 avg() over(partition by)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#14"><span class="toc-number">1.1.2.4.3.5.</span> <span class="toc-text">14</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#15-%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.1.2.4.3.6.</span> <span class="toc-text">15  变量的使用</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#16-dense-rank-%E3%80%81%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.1.2.4.3.7.</span> <span class="toc-text">16 dense_rank()、变量的使用</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#17-%E5%8C%BA%E5%9F%9F%E6%AE%B5-case-when-then-concat"><span class="toc-number">1.1.2.4.3.8.</span> <span class="toc-text">17 区域段 case when then  concat</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#22-like"><span class="toc-number">1.1.2.4.3.9.</span> <span class="toc-text">22 like</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#25"><span class="toc-number">1.1.2.4.3.10.</span> <span class="toc-text">25</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#33-%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%BF%E7%94%A8-limit"><span class="toc-number">1.1.2.4.3.11.</span> <span class="toc-text">33 变量的使用 limit</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#34-%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.1.2.4.3.12.</span> <span class="toc-text">34  变量的使用</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#41-current-day-substring-year-now"><span class="toc-number">1.1.2.4.3.13.</span> <span class="toc-text">41 current_day(),substring(),year(),now()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#42-week"><span class="toc-number">1.1.2.4.3.14.</span> <span class="toc-text">42 week</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#43-month"><span class="toc-number">1.1.2.4.3.15.</span> <span class="toc-text">43 month</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#44-month"><span class="toc-number">1.1.2.4.3.16.</span> <span class="toc-text">44 month</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%BA%8C"><span class="toc-number">1.1.2.4.4.</span> <span class="toc-text">案例二</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#9-%E5%A4%96%E8%BF%9E%E6%8E%A5%E5%AE%9E%E7%8E%B0except"><span class="toc-number">1.1.2.4.4.1.</span> <span class="toc-text">9 !外连接实现except</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#10"><span class="toc-number">1.1.2.4.4.2.</span> <span class="toc-text">10</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#11"><span class="toc-number">1.1.2.4.4.3.</span> <span class="toc-text">11</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#13"><span class="toc-number">1.1.2.4.4.4.</span> <span class="toc-text">13</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%95%E4%B8%80"><span class="toc-number">2.</span> <span class="toc-text">法一</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C"><span class="toc-number">3.</span> <span class="toc-text">法二</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%95%E4%B8%80-1"><span class="toc-number">4.</span> <span class="toc-text">法一</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C-1"><span class="toc-number">5.</span> <span class="toc-text">法二</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#COUNT-1-COUNT-COUNT-%E5%88%97%E5%90%8D-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">6.</span> <span class="toc-text">COUNT(1) COUNT(*) COUNT(列名)的区别</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#COUNT-1-%E5%8C%85%E5%90%AB%E5%BF%BD%E7%95%A5%E6%89%80%E6%9C%89%E5%88%97%EF%BC%8C%E7%94%A81%E4%BB%A3%E8%A1%A8%E4%BB%A3%E7%A0%81%E8%A1%8C%EF%BC%8C%E7%BB%9F%E8%AE%A1%E6%97%B6%E4%B8%8D%E4%BC%9A%E5%BF%BD%E7%95%A5%E5%88%97%E5%80%BC%E4%B8%BANULL"><span class="toc-number">7.</span> <span class="toc-text">COUNT(1)包含忽略所有列，用1代表代码行，统计时不会忽略列值为NULL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#COUNT-%E5%8C%85%E5%90%AB%E6%89%80%E6%9C%89%E5%88%97%EF%BC%8C%E7%9B%B8%E5%BD%93%E4%BA%8E%E8%A1%8C%E6%95%B0%EF%BC%8C%E7%BB%9F%E8%AE%A1%E6%97%B6%EF%BC%8C%E4%B8%8D%E4%BC%9A%E5%BF%BD%E7%95%A5%E5%88%97%E5%80%BC%E4%B8%BANULL"><span class="toc-number">8.</span> <span class="toc-text">COUNT(*)包含所有列，相当于行数，统计时，不会忽略列值为NULL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#COUNT-%E5%88%97%E5%90%8D-%E5%8F%AA%E5%8C%85%E5%90%AB%E5%88%97%E5%90%8D%E9%82%A3%E4%B8%80%E5%88%97%EF%BC%8C%E7%BB%9F%E8%AE%A1%E6%97%B6%E5%BF%BD%E7%95%A5%E5%88%97%E4%B8%BANULL-%E6%9F%90%E5%AD%97%E6%AE%B5%E4%B8%BANULL-%E4%B8%8D%E8%AE%A1%E6%95%B0"><span class="toc-number">9.</span> <span class="toc-text">COUNT(列名)只包含列名那一列，统计时忽略列为NULL(某字段为NULL,不计数)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Write-your-MySQL-query-statement-below"><span class="toc-number">10.</span> <span class="toc-text">Write your MySQL query statement below</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Write-your-MySQL-query-statement-below-1"><span class="toc-number">11.</span> <span class="toc-text">Write your MySQL query statement below</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Write-your-MySQL-query-statement-below-2"><span class="toc-number">12.</span> <span class="toc-text">Write your MySQL query statement below</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B2%BE%E5%BD%A9"><span class="toc-number">13.</span> <span class="toc-text">精彩</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Write-your-MySQL-query-statement-below-3"><span class="toc-number">14.</span> <span class="toc-text">Write your MySQL query statement below</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Write-your-MySQL-query-statement-below-4"><span class="toc-number">15.</span> <span class="toc-text">Write your MySQL query statement below</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Write-your-MySQL-query-statement-below-5"><span class="toc-number">16.</span> <span class="toc-text">Write your MySQL query statement below</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Write-your-MySQL-query-statement-below-6"><span class="toc-number">17.</span> <span class="toc-text">Write your MySQL query statement below</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Write-your-MySQL-query-statement-below-7"><span class="toc-number">18.</span> <span class="toc-text">Write your MySQL query statement below</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Write-your-MySQL-query-statement-below-8"><span class="toc-number">19.</span> <span class="toc-text">Write your MySQL query statement below</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Write-your-MySQL-query-statement-below-9"><span class="toc-number">20.</span> <span class="toc-text">Write your MySQL query statement below</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/05/14/%E5%BB%96%E9%9B%AA%E5%B3%B0PythonJava%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2025/05/14/%E5%BB%96%E9%9B%AA%E5%B3%B0PythonJava%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/" title="无题">无题</a><time datetime="2025-05-14T04:06:50.987Z" title="发表于 2025-05-14 12:06:50">2025-05-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/14/%E5%BB%96%E9%9B%AA%E5%B3%B0Python/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2025/05/14/%E5%BB%96%E9%9B%AA%E5%B3%B0Python/" title="无题">无题</a><time datetime="2025-05-14T04:02:32.996Z" title="发表于 2025-05-14 12:02:32">2025-05-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/16/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2025/04/16/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0/" title="无题">无题</a><time datetime="2025-04-16T02:11:28.562Z" title="发表于 2025-04-16 10:11:28">2025-04-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/17/2022%E9%BB%91%E9%A9%AC%E6%95%B0%E6%8D%AE%E6%B9%96%E6%9E%B6%E6%9E%84%E5%BC%80%E5%8F%91Hudi-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E7%AF%87%201/" title="2022黑马数据湖架构开发Hudi"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2022黑马数据湖架构开发Hudi"/></a><div class="content"><a class="title" href="/2025/01/17/2022%E9%BB%91%E9%A9%AC%E6%95%B0%E6%8D%AE%E6%B9%96%E6%9E%B6%E6%9E%84%E5%BC%80%E5%8F%91Hudi-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E7%AF%87%201/" title="2022黑马数据湖架构开发Hudi">2022黑马数据湖架构开发Hudi</a><time datetime="2025-01-17T09:35:02.000Z" title="发表于 2025-01-17 17:35:02">2025-01-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/17/2022%E9%BB%91%E9%A9%AC%E6%95%B0%E6%8D%AE%E6%B9%96%E6%9E%B6%E6%9E%84%E5%BC%80%E5%8F%91Hudi-%E5%BA%94%E7%94%A8%E8%BF%9B%E9%98%B6%E7%AF%87%20flink%E9%9B%86%E6%88%90%201/" title="2022黑马数据湖架构开发Hudi-应用进阶篇 flink集成 1"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2022黑马数据湖架构开发Hudi-应用进阶篇 flink集成 1"/></a><div class="content"><a class="title" href="/2025/01/17/2022%E9%BB%91%E9%A9%AC%E6%95%B0%E6%8D%AE%E6%B9%96%E6%9E%B6%E6%9E%84%E5%BC%80%E5%8F%91Hudi-%E5%BA%94%E7%94%A8%E8%BF%9B%E9%98%B6%E7%AF%87%20flink%E9%9B%86%E6%88%90%201/" title="2022黑马数据湖架构开发Hudi-应用进阶篇 flink集成 1">2022黑马数据湖架构开发Hudi-应用进阶篇 flink集成 1</a><time datetime="2025-01-17T09:35:02.000Z" title="发表于 2025-01-17 17:35:02">2025-01-17</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-上班摸鱼中.svg" alt="距离月入25k也就还差一个大佬带我~" title="距离月入25k也就还差一个大佬带我~"/><div id="runtimeTextTip"></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2024 - 2025 By <a class="footer-bar-link" href="/" title="智汇君" target="_blank">智汇君</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">81</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">30</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://video-b2g.pages.dev/" title="视频解析"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/视频.png" alt="视频解析"/><span class="back-menu-item-text">视频解析</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://md5-uir.pages.dev/" title="md5值解密"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/MD5.png" alt="md5值解密"/><span class="back-menu-item-text">md5值解密</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://screencheck.pages.dev/#welcome" title="屏幕坏点检查"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/屏幕外观.png" alt="屏幕坏点检查"/><span class="back-menu-item-text">屏幕坏点检查</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://htmleditor-9lo.pages.dev/" title="在线html编辑器"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/html编辑器.png" alt="在线html编辑器"/><span class="back-menu-item-text">在线html编辑器</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">博客</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://ttyong-github-io.pages.dev/" title="旧博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/博客.png" alt="旧博客"/><span class="back-menu-item-text">旧博客</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Git/" style="font-size: 0.88rem;">Git<sup>1</sup></a><a href="/tags/GitHub/" style="font-size: 0.88rem;">GitHub<sup>1</sup></a><a href="/tags/Hexo/" style="font-size: 0.88rem;">Hexo<sup>1</sup></a><a href="/tags/NodeJs/" style="font-size: 0.88rem;">NodeJs<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>3</sup></a><a href="/tags/github/" style="font-size: 0.88rem;">github<sup>1</sup></a><a href="/tags/idea/" style="font-size: 0.88rem;">idea<sup>1</sup></a><a href="/tags/%E5%85%AC%E8%80%83%E6%9D%A8%E8%80%81%E5%B8%88/" style="font-size: 0.88rem;">公考杨老师<sup>10</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 0.88rem;">博客<sup>1</sup></a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 0.88rem;">大数据<sup>26</sup></a><a href="/tags/%E5%AE%89%E7%9F%A5%E9%B1%BC%E4%B8%BB%E9%A2%98/" style="font-size: 0.88rem;">安知鱼主题<sup>1</sup></a><a href="/tags/%E5%BB%96%E9%9B%AA%E5%B3%B0/" style="font-size: 0.88rem;">廖雪峰<sup>9</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">计算机网络<sup>1</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 0.88rem;">面试<sup>12</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("24/12/2024 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2024 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 智汇君 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("24/12/2024 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-下班啦.svg";
        img.title = "下班了就该开开心心的玩耍，嘿嘿~";
        img.alt = "下班了就该开开心心的玩耍，嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script async src="https://at.alicdn.com/t/c/font_4792307_02gxbpyxcpwp.js?spm=a313x.manage_type_myprojects.i1.10.56323a81KZGFDE&amp;file=font_4792307_02gxbpyxcpwp.js# 阿里图标symbol 引用链接，主题会进行加载 symbol 引用"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>