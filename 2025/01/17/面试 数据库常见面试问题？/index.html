<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>面试 数据库常见面试问题？ | Tech智汇站</title><meta name="keywords" content="面试"><meta name="author" content="智汇君"><meta name="copyright" content="智汇君"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="面试 数据库常见面试问题？"><meta name="application-name" content="面试 数据库常见面试问题？"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="面试 数据库常见面试问题？"><meta property="og:url" content="http://example.com/2025/01/17/面试 数据库常见面试问题？/index.html"><meta property="og:site_name" content="Tech智汇站"><meta property="og:description" content="数据库常见面试问题？mysql课程1234567891011121314151617181920212223常用的存储引擎？InnoDB与MyISAM的区别？什么是事务,以及事务的四大特性?事务的隔离级别有哪些,MySQL默认是哪个?内连接与左外连接的区别是什么?MySQL默认InnoDB引擎的索引"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http://example.com/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg"><meta property="article:author" content="智汇君"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://example.com/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg"><meta name="description" content="数据库常见面试问题？mysql课程1234567891011121314151617181920212223常用的存储引擎？InnoDB与MyISAM的区别？什么是事务,以及事务的四大特性?事务的隔离级别有哪些,MySQL默认是哪个?内连接与左外连接的区别是什么?MySQL默认InnoDB引擎的索引"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/01/17/%E9%9D%A2%E8%AF%95%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%EF%BC%9F/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css#fontawesome_animation 如果有就会加载，示例值：https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"与数百名博主无限进步","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":270},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: 智汇君","link":"链接: ","source":"来源: Tech智汇站","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Tech智汇站',
  title: '面试 数据库常见面试问题？',
  postAI: '',
  pageFillDescription: '数据库常见面试问题？, mysql, 课程, 稀土掘金, 什么是幻读脏读不可重复读呢？, limit 1000000 加载很慢的话你是怎么解决的呢？, 在高并发情况下如何做到安全的修改同一行数据？, 使用悲观锁, 使用乐观锁, CSDN案例, 案例一, 1.1, 1.2, 1.3, 3 EXISTS, 7 having的一个使用技巧, 8, 9, 13 avg() over(partition by), 14, 15  变量的使用, 16 dense_rank()、变量的使用, 17 区域段 case when then  concat, 22 like, 25, 33 变量的使用 limit, 34  变量的使用, 41 current_day()substring()year()now(), 42 week, 43 month, 44 month, 案例二, 9 !外连接实现except, 10, 11, 13, 14, 14 case when round 值得注意, 15 PARTITION BY  下面那个with案例值得注意, 16 变量的使用 法一没看懂 法二法六 值得注意, 17 18值得注意 22 ROUND\CASE\CONCAT, ！33 34 35 36 37 39 40 HAVING 变量, ！timestampdiff()\week()\month()\NOW()\YEAR(x)\CURDATE(), 41, 42, 43, 44, 45, 案例三, LEECODE案例, 177.第N高的薪水  函数 dense_rank limit, 178.分数排名 dense_rank b.score gtx3D a.score, 180.连续出现的数字 lag lead with 变量 多同表连接, 184.部门工资最高的员工, 185.部门工资前三高的所有员工, 196.删除重复的电子邮箱  连表delete, 197.上升的温度 datediff lag date_add, 262.行程和用户 IF Case, avg精彩用法, 534.游戏玩法分析 III  sum() over(partition by, 难 569.游戏玩法分析 IV  partition by 中位数, 难 571.给定数字的频率查询中位数, 578.查询回答率最高的问题, 579.查询员工的累计薪水, 580.统计各专业学生人数, 585.2016年的投资, 597.好友申请1总体通过率, 601.体育馆的人流量  lag() lead() leaset(), 602 case when, 603.连续空余座位 lag lead  ROWS BETWEEN  AND, 608 union, 610.判断三角形, 614.二级关注者, 615.平均工资部门与公司比较, 618.学生地理信息报告 行转列, 626.换座位 换序号, 627.变更性别 update replace, 1070.产品销售分析 川, 1083.销售分析 | sum(表达式), 1097.游戏玩法分析 V  MIN() OVER (PARTITION BY, 1098.小众书籍, 1107.每日新用户统计 MIN() OVER (PARTITION BY, 1127.用户购买平台, 1159.市场分析 I I, 1174.即时食物配送Ⅱ, 1179.重新格式化部门表 行转列, 1193.每月交易| date_format()left()sub_string(), 1194.锦标赛优胜者 列转行, 1204.最后一个能进入巴士的人, 1205.每月交易 | count(1)count(null)sum(0), 1212.查询球队积分 列转行, 1225.报告系统状态的连续日期, 1264.页面推荐, 1270.向公司 CEO 汇报工作的所有人 难, 1280.学生们参加各科测试的次数 ifnull 构造行, 1285.找到连续区间的开始和结束数字, 1321.餐馆营业额变化增长 range  row between and, 1322.广告效果 SUM(action x3D ‘xxx’), 1336.每次访问的交易次数 难 应该是没读懂题目意思, 1369.获取最近第二次的活动, 1384.按年度列出销售总额 难, 1412.查找成绩处于中游的学生, 1435.制作会话柱状图, 1440.计算布尔表达式的值, 1454.活跃用户, 1479.周内每天的销售情况, 1484.按日期分组销售产品 group_concat, 1517.查找拥有有效邮箱的用户 regexp REGEXP_LIKE 正则表达式, 1527.患某种疾病的患者 like REGEXP, 1613.找到遗失的ID 递归 recursive, 1635.Hopper 公司查询! recursive, 1651.Hopper 公司查询 川 RECURSIVE OVER (ROWS BETWEEN), 1661.每台机器的进程平均运行时间, 1667.修复表中的名字 concat left right upper lower, 1683.无效的推文, 1709.访问日期之间最大的空档期  LEAD(xxx) OVER(partition by), 1972  同一天的第一个电话和最后一个电话 难, mysql注释问题, mysql修改列数据类型, 1988, 1990, 2004, 2020 简单, 2026 简单, 2041 简单, 2051, 3421.查找进步的学生, 3436.查找合法邮箱 regexp, 3451.查找无效的 IP 地址  substring_index cast regepx replace, 3465.查找具有有效序列号的产品 REGEXP, 3475.DNA 模式识别  REGEXP LIKE LEFT RIGHT INSTR regexp_like, 3482.分析组织层级 递归, 3554.查找类别推荐对, 3564.季节性销售分析, 3580.寻找持续进步的员工, 3586.寻找 COVID 康复患者, 常用积累, Delete, 1, 日期相关, DATEDIFF(), TIMESTAMPDIFF()  |  NOW(), DATE_FORMAT(), DATE_ADD(), CURDATE()NOW(), month()week()year(), lag()、lead()、with, with语句, roud()、if(), limit(), 一个参数, 两个参数, 分页offset, IF, if(), IFNULL()、NULLIF()、ISNULL(), ltgt、!x3D、ltx3Dgt、NULL、TRUE、FALSE、UNKNOWN、is null、is not null, 笛卡尔积、CROSS JOIN, WITH, mod(MN), substring(), group by 新奇, 自定义变量, 窗口函数, rows between and, range between and, dense_rank() over, avg(x) over(), CASE, GROUP_CONCAT(), 正则表达式 REGEXP  regexp_like, ||, ONLY_FULL_GROUP_BY, 行转列、列转行, 左右外连接当连接键不唯一时, mysql全外连接, union和union all, limit, where (player_id event_date) in select ab, order by和limit一起使用注意事项, sqrt()开平方, count(**)\count(*0)\count(1), ABS(p1.x_value - p2.x_value), UPPER LOWER CONCAT group_concat, TRIM, left right instr, 递归 recursive 题目1613 1270 3482, CAST(expression AS TYPE), substring_index, length, Hbase数据库常见面试问题课程常用的存储引擎与的区别什么是事务以及事务的四大特性事务的隔离级别有哪些默认是哪个内连接与左外连接的区别是什么默认引擎的索引是什么数据结构如何查看的执行计划索引失效的情况有哪些什么是回表查询什么是主从复制的原理是什么主从复制之后的读写分离如何实现数据库的分库分表如何实现性能优化经验优化大多依赖索引进行聚集索引和二级索引对于理解优化很关键能使用聚集使用过滤就不使用二级索引效率更高满足业务需求的情况下尽量降低主键的长度因为二级索引叶子节点会存储主键会导致索引数据大插入数据时尽量选择顺序插入选择使用自增主键避免页分裂尽量不要使用做主键或者是其他自然主键如身份证号长度长且无序批量插入数据执行频率慢查询执行计划详情可以从这几个维度回答这个问题加索引避免返回不必要的数据适当分批量进行优化结构分库分表读写分离数据库优化经验四五千万条记录时就可能要考虑分库分表了这是运维篇的内容建立索引的优劣势优缺点优势提高数据检索的效率降低数据库的成本通过索引列对数据进行排序降低数据排序的成本降低的消耗劣势索引列也是要占用空间的索引大大提高了查询效率同时却也降低更新表的速度如对表进行时效率降低为什么存储引擎选择使用索引结构相对于二叉树层级更少搜索效率高对于无论是叶子节点还是非叶子节点都会保存数据这样导致一页中存储的键值减少指针跟着减少要同样保存大量数据只能增加树的高度导致性能降低相对索引支持范围匹配及排序操作估算主键索引树层时大概能存储多少行数据只要给出主键什么类型多大然后一行数据多大就可以估算先算一个页最大能存储多少个主键然后算出指针数再乘以一个页最大能存储多少行数据就行索引使用有哪些注意事项呢讲的条在索引列上使用的内置函数索引失效对索引列运算如索引失效索引字段上使用或者时可能会导致索引失效左连接查询或者右连接查询查询关联的字段编码格式不一样可能导致索引失效索引不适合哪些场景数据量少的不适合加索引更新比较频繁的也不适合加索引区分度低的字段不适合加索引如性别针对于数据量较大条且查询比较频繁的表建立索引针对于常作为查询条件排序分组操作的字段建立索引尽量选择区分度高的列作为索引尽量建立唯一索引区分度越高使用索引的效率越高如果是字符串类型的字段字段的长度较长可以针对于字段的特点建立前缀索引尽量使用联合索引减少单列索引查询时联合索引很多时候可以覆盖索引节省存储空间避免回表提高查询效率要控制素引的数量索引并不是多多益善索引越多维护索引结构的代价也就越大会影响增删改的效率如果索引列不能存储值请在创建表时使用约束它当优化器知道每列是否包含值时它可以更好地确定哪个索引最有效地用于查询遇到过死锁问题吗你是如何解决的我排查死锁的一般步骤是酱紫的查看死锁日志找出死锁分析加锁情况模拟死锁案发分析死锁日志分析死锁结果聚集索引与非聚集索引的区别稀土掘金什么是幻读脏读不可重复读呢脏读幻读数据量不一样不可重复读数据值不一样加载很慢的话你是怎么解决的呢方案一如果是连续的可以这样返回上次查询的最大记录偏移量再往下复制代码方案二在业务允许的情况下限制页数建议跟业务讨论有没有必要查这么后的分页啦因为绝大多数用户都不会往后翻太多页方案三索引为索引复制代码方案四利用延迟关联或者子查询优化超多分页场景先快速定位需要获取的段然后再关联复制代码条件在高并发情况下如何做到安全的修改同一行数据要安全的修改同一行数据就要保证一个线程在修改时其它线程无法更新这行记录一般有悲观锁和乐观锁两种方案使用悲观锁悲观锁思想就是当前线程要进来修改数据时别的线程都得拒之门外比如可以使用以上这条语句会锁定了表中所有符合检索条件的记录本次事务提交之前别的线程都无法修改这些记录使用乐观锁乐观锁思想就是有线程过来先放过去修改如果看到别的线程没修改过就可以修改成功如果别的线程修改过就修改失败或者重试实现方式乐观锁一般会使用版本号机制或算法实现案例案例一链接学生表教师表科目表成绩表查询同时存在课程和课程的情况查询存在课程但可能不存在课程的情况不存在时显示为查询不存在课程但存在课程的学生情况查询平均成绩大于等于分的学生编号和学生姓名和平均成绩查询在表存在成绩的学生信息查询所有同学的学生编号学生姓名选课总数所有课程的总成绩没成绩的显示为查询李姓老师的数量查询学过张三老师授课的同学信息难度系数查询没有学全所有课程的同学的信息查询至少有一门课学号与的同学所学相同的同学信息查询和号同学学习的课程完全相同的其他同学的信息查询没学过张三老师讲授的任一门课程的学生姓名查询两门及其以上不及格课程的同学的学号姓名及其平均成绩检索课程分数小于按分数降序排列的学生信息按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩查询各科成绩最高分最低分和平均分按各科成绩进行排名并显示排名重复时继续排序查询学生的总成绩并进行排名总分重复时保留名次空缺统计各科成绩分数段人数课程编号课程名称及所占百分比查询各科成绩前三名的记录查询每门课程被选修的学生数查询出只选修两门课程的学生学号和姓名查询男生女生人数查询名字中含有风字的学生信息查询同名同姓学生名单并统计同名同性人数查询年出生的学生名单查询每门课程的平均成绩结果按平均成绩降序排列平均成绩相同按课程编号升序排列查询平均成绩大于等于的所有学生的学号姓名和平均成绩查询课程名称为数学且分数低于的学生姓名和分数查询所有学生的课程及分数情况存在学生没成绩没选课的情况查询任何一门课程成绩在分以上的姓名课程名称和分数查询不及格的课程查询课程编号为且课程成绩在分以上的学生的学号和姓名求每门课程的学生人数假设成绩不重复查询选修张三老师所授课程的学生中成绩最高的学生信息及成绩假设成绩有重复查询选修张三老师所授课程的学生中成绩最高的学生信息及成绩查询不同课程成绩相同的学生的学生编号课程编号学生成绩查询每门科目成绩最好的前两名查询存在课程但可能不存在课程的情况不存在时显示为查询不存在课程但存在课程的学生情况的一个使用技巧查询没有学全所有课程的同学的信息选课数目选课数目查询至少有一门课学号与的同学所学相同的同学信息查询和号同学学习的课程完全相同的其他同学的信息按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩学生姓名课程名称成绩平均成绩平均成绩查询各科成绩最高分最低分和平均分课程名称最高分最低分平均分保留两位小数关联课程名称按课程分组避免课程名重复按课程名称排序变量的使用按各科成绩进行排名并显示排名重复时继续排序它这个使用变量的方法也不对如图片自定义变量定义变量用来标识变量使用变量定义并使用变量修改或者重新赋值变量的使用查询学生的总成绩并进行排名总分重复时保留名次空缺排序会有重复的会出现不连续的排序排序相同时会重复但是各个排序序号都是连续的排序不会重复且序号连续区域段统计各科成绩分数段人数课程编号课程名称及所占百分比课程编号课程名称选修人数查询名字中含有风字的学生信息风变量的使用假设成绩不重复查询选修张三老师所授课程的学生中成绩最高的学生信息及成绩法一张三法二先查询张三老师所带的课程编号和张三将以上结果与成绩表关联张三将以上结果与学生表关联学号学生姓名课程教师姓名成绩张三变量的使用假设成绩有重复查询选修张三老师所授课程的学生中成绩最高的学生信息及成绩张三张三按照出生日期来算当前月日出生年月的月日则年龄减一查询本周过生日的学生分析使用函数查询本月过生日的学生分析使用函数查询下月过生日的学生案例二字段名学生编号学生姓名出生年月学生性别字段名科目编号科目名称任课老师编号字段名任课教师标号任课老师姓名字段名学生编号科目编号成绩查询课程比课程成绩高的学生的信息及课程分数查询同时存在课程和课程的情况查询存在课程但可能不存在课程的情况不存在时显示为查询不存在课程但存在课程的情况查询平均成绩大于等于分的同学的学生编号和学生姓名和平均成绩查询在表存在成绩的学生信息查询所有同学的学生编号学生姓名选课总数所有课程的总成绩没成绩的显示为查有成绩的学生信息查询李姓老师的数量查询学过张三老师授课的同学的信息查询没有学全所有课程的同学的信息查询至少有一门课与学号为的同学所学相同的同学的信息查询和号的同学学习的课程完全相同的其他同学的信息查询没学过张三老师讲授的任一门课程的学生姓名查询两门及其以上不及格课程的同学的学号姓名及其平均成绩检索课程分数小于按分数降序排列的学生信息按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩查询各科成绩最高分最低分和平均分以如下形式显示课程课程最高分最低分平均分及格率中等率优良率优秀率及格为中等为优良为优秀为还要求选修人数查询结果按人数降序排列若人数相同按课程号升序排列按各科成绩进行排序并显示排名重复时保留名次空缺按各科成绩进行排序并显示排名重复时合并名次查询学生的总成绩并进行排名总分重复时保留名次空缺查询学生的总成绩并进行排名总分重复时不保留名次空缺统计各科成绩各分数段人数课程编号课程名称及所占百分比查询各科成绩前三名的记录查询每门课程被选修的学生数查询出只选修两门课程的学生学号和姓名查询男生女生人数查询名字中含有风字的学生信息查询同名同性学生名单并统计同名人数查询年出生的学生名单查询每门课程的平均成绩结果按平均成绩降序排列平均成绩相同时按课程编号升序排列查询平均成绩大于等于的所有学生的学号姓名和平均成绩查询课程名称为数学且分数低于的学生姓名和分数查询所有学生的课程及分数情况存在学生没成绩没选课的情况查询任何一门课程成绩在分以上的姓名课程名称和分数查询不及格的课程查询课程编号为且课程成绩在分以上的学生的学号和姓名求每门课程的学生人数成绩不重复查询选修张三老师所授课程的学生中成绩最高的学生信息及其成绩成绩有重复的情况下查询选修张三老师所授课程的学生中成绩最高的学生信息及其成绩查询不同课程成绩相同的学生的学生编号课程编号学生成绩查询每门功成绩最好的前两名统计每门课程的学生选修人数超过人的课程才统计检索至少选修两门课程的学生学号查询选修了全部课程的学生信息查询各学生的年龄只按年份来算按照出生日期来算当前月日出生年月的月日则年龄减一查询本周过生日的学生查询下周过生日的学生查询本月过生日的学生查询下月过生日的学生外连接实现先查询出选修了张三老师讲授课程的张三与学生表关联筛选出不在以上结果内的张三值得注意及格率中等率优良率优秀率最高分最低分平均分选修人数及格率中等率优良率优秀率下面那个案例值得注意在上述查询中是最终的排序它确保结果首先按课程号排序然后按分数降序排序如果你只关心排名而不关心最终排序顺序可以省略此子句案例案例变量的使用法一没看懂法二法六值得注意法一学生的总成绩名次排序法二法二法五是的例子但用了这里的数据把行数据理解成是总成绩结果有莫名错误这样接正确了奇怪等同于窗口函数实现的结果法三法二法五是的例子但用了这里的数据把行数据理解成是总成绩法四法二法五是的例子但用了这里的数据把行数据理解成是总成绩法五法二法五是的例子但用了这里的数据把行数据理解成是总成绩法六法二法五是的例子但用了这里的数据把行数据理解成是总成绩错误写法法二法五是的例子但用了这里的数据把行数据理解成是总成绩值得注意不会课程编号课程名称选修人数的作用是将两个字符拼接起来不会好像有点问题学生编号学生姓名选课数量学生编号学生姓名选课数量风姓名性别同名人数这里有错误了变量法一张三法二先查询张三老师所带的课程编号和张三将以上结果与成绩表关联张三将以上结果与学生表关联学号学生姓名课程教师姓名成绩张三也行张三法一选修人数法二选修人数知识点补充列名的区别包含忽略所有列用代表代码行统计时不会忽略列值为包含所有列相当于行数统计时不会忽略列值为列名只包含列名那一列统计时忽略列为某字段为不计数分析使用日期函数进行相减年龄年龄分析日期相减函数参数参数分析使用函数分析使用函数案例三案例第高的薪水函数分数排名表是该表的主键有不同值的列该表的每一行都包含了一场比赛的分数是一个有两位小数点的浮点值编写一个解决方案来查询分数的排名排名按以下规则计算分数应按从高到低排列如果两个分数相等那么两个分数的排名应该相同在排名相同的分数后排名数应该是下一个连续的整数换句话说排名之间不应该有空缺的数字统计表符合条件的不重复的分数的数量作为排名条件是这个分数不小于我因为表数据相同所以排名值最小是表中每个数据都进行排名最后按分数跟排名一样降序排列连续出现的数字变量多同表连接表在中是该表的主键是一个自增列找出所有至少连续出现三次的数字返回的结果表中的数据可以按任意顺序排列结果格式如下面的例子所示示例输入表输出表解释是唯一连续出现至少三次的数字部门工资最高的员工部门工资前三高的所有员工表是该表的主键列具有唯一值的列是表中的外键列该表的每一行都表示员工的姓名和工资它还包含了他们部门的表是该表的主键列具有唯一值的列该表的每一行表示部门和部门名公司的主管们感兴趣的是公司每个部门中谁赚的钱最多一个部门的高收入者是指一个员工的工资在该部门的不同工资中排名前三编写解决方案找出每个部门中收入高的员工以任意顺序返回结果表返回结果格式如下所示删除重复的电子邮箱连表表是该表的主键列具有唯一值的列该表的每一行包含一封电子邮件电子邮件将不包含大写字母编写解决方案删除所有重复的电子邮件只保留一个具有最小的唯一电子邮件上升的温度表是该表具有唯一值的列没有具有相同的不同行该表包含特定日期的温度信息编写解决方案找出与之前昨天的日期相比温度更高的所有日期的行程和用户表是这张表的主键具有唯一值的列这张表中存所有出租车的行程信息每段行程有唯一其中和是表中的外键是一个表示行程状态的枚举类型枚举成员为表是这张表的主键具有唯一值的列这张表中存所有用户每个用户都有一个唯一的是一个表示用户身份的枚举类型枚举成员为是一个表示用户是否被禁止的枚举类型枚举成员为取消率的计算方式如下被司机或乘客取消的非禁止用户生成的订单数量非禁止用户生成的订单总数编写解决方案找出至期间有至少一次行程的非禁止用户乘客和司机都必须未被禁止的取消率非禁止用户即为的用户禁止用户即为的用户其中取消率需要四舍五入保留两位小数返回结果表中的数据无顺序要求精彩用法精彩游戏玩法分析表是此表的主键具有唯一值的列这张表显示了某些游戏的玩家的活动情况每一行是一个玩家的记录他在某一天使用某个设备注销之前登录并玩了很多游戏可能是编写一个解决方案同时报告每组玩家和日期以及玩家到目前为止玩了多少游戏也就是说玩家在该日期之前所玩的游戏总数详细情况请查看示例以任意顺序返回结果表结果格式如下所示示例输入输出方案一关联当前时间之前的数据方案二难游戏玩法分析中位数方法一注意事项排序时用会有排名相同的情况中位数的逻辑了解不论个数是奇数偶数中位数在总数除以和总数除以加之间难给定数字的频率查询中位数参考表保存数字的值及其频率在此表中数字为所以中位数是请编写一个查询来查找所有数字的中位数并将结果命名为查询回答率最高的问题从表中获得回答率最高的问题表包含这些列表示用户有以下几种值当值为时非空而值为或者时为空表示当前会话中问题的编号请编写查询来找到具有最高回答率的问题查询员工的累计薪水表保存了一年内的薪水信息请你编写语句对于每个员工查询他除最近一个月即最大月之外剩下每个月的近三个月的累计薪水不足三个月也要计算结果请按升序然后按降序显示累加的总薪水排名好去掉最近一个月统计各专业学生人数题目描述表是该表的主键具有唯一值的列是表中的外键该表的每一行都表示学生的姓名性别和所属系的表是该表的主键具有唯一值的列该表的每一行包含一个部门的和名称编写解决方案为表中的所有部门甚至是没有当前学生的部门报告各自的部门名称和每个部门的学生人数按降序返回结果表如果是平局则按的字母顺序排序所以不用判断年的投资表是这张表的主键具有唯一值的列表中的每一行都包含一条保险信息其中是投保人的投保编号是该投保人在年的总投保金额是该投保人在年的总投保金额是投保人所在城市的纬度题目数据确保不为空是投保人所在城市的经度题目数据确保不为空编写解决方案报告年所有满足下述条件的投保人的投保金额之和他在年的投保额至少跟一个其他投保人在年的投保额相同他所在的城市必须与其他投保人都不同也就是说不能跟其他任何一个投保人完全相同四舍五入的两位小数好友申请总体通过率表该表可能包含重复项换句话说在中该表没有主键该表包含发送请求的用户的接受请求的用户的以及请求的日期表该表可能包含重复项换句话说在中该表没有主键该表包含发送请求的用户的接受请求的用户的以及请求通过的日期求出好友申请的通过率用位小数表示通过率由接受好友申请的数目除以申请总数提示通过的好友申请不一定都在表中你只需要统计总的被通过的申请数不管它们在不在表中并将它除以申请总数得到通过率一个好友申请发送者有可能会给接受者发几条好友申请也有可能一个好友申请会被通过好几次这种情况下重复的好友申请只统计一次如果一个好友申请都没有你应该返回为体育馆的人流量连续空余座位表是该表的自动递增主键列在中存储为整数请使用将其转换为布尔格式该表的每一行表示第个座位是否空闲表示空闲表示被占用查找电影院所有连续可用的座位返回按升序排序的结果表测试用例的生成使得两个以上的座位连续可用判断三角形表在中是该表的主键列该表的每一行包含三个线段的长度对每三个线段报告它们是否可以形成一个三角形二级关注者表是该表的主键具有唯一值的列的组合该表的每一行表示关注者关注了社交网络上的被关注者不会有用户关注他们自己二级关注者是指满足以下条件的用户关注至少一个用户被至少一个用户关注编写一个解决方案来报告二级用户及其关注者的数量返回按字典序排序的结果表平均工资部门与公司比较表列名类型在中是该表的主键列该表的每一行表示一个员工一个月的薪资是来自表的外键列表列名类型在中是该表的主键列该表的每一行表示一个员工所属的部门找出各个部门员工的平均薪资与公司平均薪资之间的比较结果更高更低相同每月每个部门的平均工资和每月公司平均工资比较以任意顺序返回结果表好像两个两个再连接就可以了吧学生地理信息报告行转列表该表可能包含重复的行该表的每一行表示学生的名字和他们来自的大陆一所学校有来自亚洲欧洲和美洲的学生编写解决方案实现对大洲列的透视表操作使得每个学生按照姓名的字母顺序依次排列在对应的大洲下面输出的标题应依次为美洲亚洲和欧洲测试用例的生成保证来自美国的学生人数不少于亚洲或欧洲的学生人数要排序的话提前对里面的字段排序就可以了换座位换序号表是该表的主键唯一值列该表的每一行都表示学生的姓名和序列始终从开始并连续增加编写解决方案来交换每两个连续的学生的座位号如果学生的数量是奇数则最后一个学生的不交换按升序返回结果表查询结果格式如下所示示例输入表输出解释请注意如果学生人数为奇数则不需要更换最后一名学生的座位变更性别表是这个表的主键具有唯一值的列这一列的值是类型只能从中取本表包含公司雇员的信息请你编写一个解决方案来交换所有的和即将所有变为反之亦然仅使用单个语句且不产生中间临时表注意你必须仅使用一条语句且不能使用语句相当于把中与相同的换为空字符串也就是删除了剩下的是对立的性别产品销售分析川销售分析表达式表是该表的主键具有唯一值的列该表的每一行表示每种产品的名称和价格表这个表可能有重复的行是表的外键列永远不会是永远不会是该表的每一行都包含一次销售的一些信息编写一个解决方案报告那些买了而没有买的买家注意和是表中显示的产品游戏玩法分析表是此表的主键具有唯一值的列的组合这张表显示了某些游戏的玩家的活动情况每一行表示一个玩家的记录在某一天使用某个设备注销之前登录并玩了很多游戏可能是玩家的安装日期定义为该玩家的第一个登录日我们将日期的第一天留存率定义为假定安装日期为的玩家的数量为其中在之后的一天重新登录的玩家数量为就是第一天留存率四舍五入到小数点后两位编写解决方案报告所有安装日期当天安装游戏的玩家数量和玩家的第一天留存率以任意顺序返回结果表小众书籍书籍表是这个表的主键具有唯一值的列订单表是这个表的主键具有唯一值的列是表的外键列编写解决方案筛选出过去一年中订单总量少于本的书籍并且不考虑上架距今销售不满一个月的书籍假设今天是返回结果表无顺序要求每日新用户统计表该表可能有重复的行列是类型可能取几个值之一编写解决方案找出从今天起最多天内每个日期该日期首次登录的用户数假设今天是以任意顺序返回结果表用户购买平台支出表这张表记录了用户在一个在线购物网站的支出历史该在线购物平台同时拥有桌面端和手机端的应用程序是这张表的主键具有唯一值的列的组合平台列是一种类型为编写解决方案找出每天仅使用手机端用户仅使用桌面端用户和同时使用桌面端和手机端的用户人数和总支出金额以任意顺序返回结果表示例输入输出但是这样得出来的只有某些某些的题目要求是不存在也要放在结果里面只是结果置而已市场分析表是该表的主键具有唯一值的列表中包含一位在线购物网站用户的个人信息用户可以在该网站出售和购买商品表是该表的主键具有唯一值的列是表的外键列和是表的外键表是该表的主键具有唯一值的列编写一个解决方案为每个用户找出他们出售的第二件商品按日期的品牌是否是他们最喜欢的品牌如果用户售出的商品少于两件则该用户的结果为否保证卖家不会在一天内卖出一件以上的商品以任意顺序返回结果表返回结果格式如下例所示即时食物配送配送表是该表中具有唯一值的列该表保存着顾客的食物配送信息顾客在某个日期下了订单并指定了一个期望的配送日期和下单日期相同或者在那之后如果顾客期望的配送日期和下单日期相同则该订单称为即时订单否则称为计划订单首次订单是顾客最早创建的订单我们保证一个顾客只会有一个首次订单编写解决方案以获取即时订单在所有用户的首次订单中的比例保留两位小数只考虑首次订单重新格式化部门表行转列表在中是表的联合主键这个表格有关于每个部门每月收入的信息月份可以取下列值重新格式化表格使得每个月都有一个部门列和一个收入列以任意顺序返回结果表结果格式如以下示例所示示例输入输出每月交易表是这个表的主键该表包含有关传入事务的信息列类型为之一编写一个查询来查找每个月和每个国家地区的事务数及其总金额已批准的事务数及其总金额以任意顺序返回结果表锦标赛优胜者列转行玩家表是此表的主键具有唯一值的列此表的每一行表示每个玩家的组赛事表是此表的主键具有唯一值的列每一行是一场比赛的记录和表示该场比赛的球员和分别表示和的得分你可以假设在每一场比赛中球员都属于同一组每组的获胜者是在组内累积得分最高的选手如果平局最小的选手获胜编写解决方案来查找每组中的获胜者返回的结果表单没有顺序要求最后一个能进入巴士的人表是这个表具有唯一值的列该表展示了所有候车乘客的信息表中和列将包含从到的所有数字其中是表中的行数决定了候车乘客上巴士的顺序其中表示第一个上巴士表示最后一个上巴士表示候车乘客的体重以千克为单位有一队乘客在等着上巴士然而巴士有千克的重量限制所以其中一部分乘客可能无法上巴士编写解决方案找出最后一个上巴士且不超过重量限制的乘客并报告题目测试用例确保顺位第一的人可以上巴士且不会超重每月交易记录表是这个表的主键该表包含有关传入事务的信息状态列是枚举类型值为其中之一的列表退单包含有关放置在事务表中的某些事务的传入退单的基本信息是表的列的外键列每项退单都对应于之前进行的交易即使未经批准编写一个解决方案找出每个国家地区的每月交易信息已批准交易的数量及其总金额退单的数量及其总金额注意在你的解决方案中只需显示给定月份和国家忽略所有为零的行以任意顺序返回结果表结果格式如下所示示例输入表表输出每个月和每个国家地区的已批准交易的数量每个月和每个国家地区的退单的数量查询球队积分列转行表是该表具有唯一值的列表中的每一行都代表一支独立足球队表是该表具有唯一值的列表中的每一行都代表一场已结束的比赛比赛的主客队分别由它们自己的表示他们的进球由和分别表示你希望在所有比赛之后计算所有球队的比分积分奖励方式如下如果球队赢了比赛即比对手进更多的球就得分如果双方打成平手即与对方得分相同则得分如果球队输掉了比赛例如比对手少进球就不得分编写解决方案以找出每个队的和返回的结果根据降序排序如果有两队积分相同那么这两队按升序排序返回结果格式如下报告系统状态的连续日期表该表主键为具有唯一值的列该表包含失败任务的天数表该表主键为具有唯一值的列该表包含成功任务的天数系统每天运行一个任务每个任务都独立于先前的任务任务的状态可以是失败或是成功编写解决方案找出到期间任务连续同状态的起止日期和即如果任务失败了就是失败状态的起止日期如果任务成功了就是成功状态的起止日期最后结果按照起始日期排序输入输出页面推荐朋友关系列表是这张表具有唯一值的列的组合这张表的每一行代表着和之间存在着朋友关系喜欢列表是这张表具有唯一值的列的组合这张表的每一行代表着喜欢编写解决方案向的用户推荐其朋友们喜欢的页面不要推荐该用户已经喜欢的页面以任意顺序返回结果其中不应当包含重复项向公司汇报工作的所有人难员工表是这个表具有唯一值的列这个表中每一行中表示职工的表示职工的名字表示该职工汇报工作的直线经理这个公司是的人编写解决方案找出所有直接或间接向公司汇报工作的职工的由于公司规模较小经理之间的间接关系不超过个经理可以以任何顺序返回无重复项的结果返回结果示例如下示例输入输出学生们参加各科测试的次数构造行学生表在中主键为学生该表内的每一行都记录有学校一名学生的信息科目表在中主键为科目名称每一行记录学校的一门科目名称考试表这个表可能包含重复数据换句话说在中这个表没有主键学生表里的一个学生修读科目表里的每一门科目这张考试表的每一行记录就表示学生表里的某个学生参加了一次科目表里某门科目的测试查询出每个学生参加每一门科目测试的次数结果按和排序找到连续区间的开始和结束数字表是上表具有唯一值的列上表的每一行包含日志表中的一个编写解决方案得到表中的连续区间的开始数字和结束数字返回结果表按照排序结果格式如下面的例子示例输入表输出餐馆营业额变化增长表在中是该表的主键该表包含一家餐馆的顾客交易数据表示的顾客在那天访问了餐馆是一个顾客某一天的消费总额你是餐馆的老板现在你想分析一下可能的营业额变化增长每天至少有一位顾客计算以天某日期该日期前的天为一个时间段的顾客消费平均值要保留两位小数结果按升序排序返回结果格式的例子如下示例输入表输出因为窗口函数是按照日期计算的所以相同日期的结果也是相同的直接去重即可按照日期排序范围是当前日期和当前日期的前六天同理去除日期不足日的结果其实是先用窗口函数计算指定日期之内的销售总额得到两个号之前的总额再去重因为两个号得到的金额是一样的计算这天的消费平均值这里的计算是针对每个日期的过去天消费进行的无论有多少顾客在这天内消费都将其总消费额平均这里除以就是因为窗口函数其实计算了八个顾客的总金额不能只能除以七天广告效果表是该表的主键具有唯一值的列的组合该表的每一行包含一条广告的用户的和用户对广告采取的行为列是一个枚举类型一家公司正在运营这些广告并想计算每条广告的效果广告效果用点击通过率来衡量公式如下编写解决方案找出每一条广告的要保留两位小数返回结果需要按降序按升序进行排序每次访问的交易次数难应该是没读懂题目意思表是该表的主键具有唯一值的列的组合该表的每行表示在访问了银行表该表可能有重复行该表的每一行表示在完成了一笔数额的交易可以保证用户在访问了银行也就是说表包含行银行想要得到银行客户在一次访问时的交易次数和相应的在一次访问时该交易次数的客户数量的图表编写解决方案找出多少客户访问了银行但没有进行任何交易多少客户访问了银行进行了一次交易等等结果包含两列客户在一次访问中的交易次数在交易次数下相应的一次访问时的客户数量的值从到所有用户一次访问中的结果按排序获取最近第二次的活动表该表可能有重复的行该表包含每个用户在一段时间内进行的活动的信息名为的用户在到日内有一次活动编写解决方案展示每一位用户最近第二次的活动如果用户仅有一次活动返回该活动一个用户不能同时进行超过一项活动以任意顺序返回结果下面是返回结果格式的例子按年度列出销售总额难表是这张表的主键具有唯一值的列是产品的名称表是这张表的主键具有唯一值的列和是该产品销售期的起始日期和结束日期且这两个日期包含在销售期内列存储销售期内该产品的日平均销售额销售日期范围为年到年编写解决方案找出每个产品每年的总销售额并包含以及返回结果并按和排序返回结果格式如下例所示查找成绩处于中游的学生表是该表主键具有唯一值的列学生名字表是该表主键具有唯一值的列的组合学生在测验中得分为成绩处于中游的学生是指至少参加了一次测验且得分既不是最高分也不是最低分的学生编写解决方案找出在所有测验中都处于中游的学生不要返回从来没有参加过测验的学生返回结果表按照排序制作会话柱状图表是该表主键是用户访问应用的时间以秒为单位你想知道用户在你的上的访问时长情况因此你决定统计访问时长区间分别为和的会话数量并以此绘制柱状图写一个解决方案来报告返回结果无顺序要求计算布尔表达式的值表在中是该表主键该表包含了存储的变量及其对应的值表在中是该表主键该表包含了需要计算的布尔表达式是枚举类型取值于和的值保证存在于表单中计算表中的布尔表达式返回的结果表无顺序要求活跃用户表是该表主键具有唯一值的列该表包含账户和账户的用户名表该表可能包含重复项该表包含登录用户的账户和登录日期用户也许一天内登录多次活跃用户是指那些至少连续天登录账户的用户编写解决方案找到活跃用户的和返回的结果表按照排序周内每天的销售情况表是该表主键具有唯一值的列的组合该表包含了订单信息是为的商品被为的消费者订购的日期表是该表主键具有唯一值的列是商品的名字是商品的类别你是企业主想要获得分类商品和周内每天的销售报告编写解决方案报告周内每天每个商品类别下订购了多少单位返回结果表单按商品类别排序这里把换成也可以注意和的不同按日期分组销售产品表列名类型该表没有主键具有唯一值的列它可能包含重复项此表的每一行都包含产品名称和在市场上销售的日期编写解决方案找出每个日期销售的不同产品的数量及其名称每个日期的销售产品名称应按词典序排列返回按排序的结果表结果表结果格式如下例所示示例输入表输出查找拥有有效邮箱的用户正则表达式表是该表的主键具有唯一值的列该表包含了网站已注册用户的信息有一些电子邮件是无效的编写一个解决方案以查找具有有效电子邮件的用户一个有效的电子邮件具有前缀名称和域其中前缀名称是一个字符串可以包含字母大写或小写数字下划线点和或破折号前缀名称必须以字母开头域为以任何顺序返回结果表患某种疾病的患者患者信息表在中患者是该表的主键疾病包含个或以上的疾病代码以空格分隔这个表包含医院中患者的信息查询患有类糖尿病的患者患者姓名以及其患有的所有疾病代码类糖尿病的代码总是包含前缀按任意顺序返回结果表找到遗失的递归表是该表主键该表第一行包含了顾客的名字和编写一个解决方案找到所有遗失的顾客遗失的顾客是指那些不在表中值却处于和表中最大之间的注意最大的值不会超过返回结果按升序排列查询结果格式如下例所示公司查询表是该表的主键具有唯一值的列该表的每一行均包含驾驶员的以及他们加入公司的日期表是该表的主键具有唯一值的列该表的每一行均包含行程用户以及该行程的日期该表中可能有一些不被接受的乘车请求表是该表的主键具有唯一值的列该表的每一行都包含已接受的行程信息表中的行程信息都在表中存在编写解决方案以报告年每个月的以下统计信息截至某月底当前在公司工作的驾驶员数量该月接受的乘车次数返回按升序排列的结果表其中是月份的数字一月是二月是依此类推返回结果格式如下例所示示例输入表表表输出解释截至月底两个活跃的驾驶员没有被接受的行程截至月底三个活跃的驾驶员没有被接受的行程截至月底四个活跃的驾驶员一个被接受的行程截至月底四个活跃的驾驶员没有被接受的行程截至月底五个活跃的驾驶员没有被接受的行程截至月底五个活跃的驾驶员一个被接受的行程截至月底五个活跃的驾驶员一个被接受的行程截至月底五个活跃的驾驶员一位接受的行程截至月底五个活跃的驾驶员没有被接受的行程截至月底六个活跃的驾驶员没有被接受的行程截至月底六个活跃的驾驶员两个被接受的行程截至月底六个活跃的驾驶员一个被接受的行程公司查询川表是该表具有唯一值的列该表的每一行均包含驾驶员的以及他们加入公司的日期表是该表具有唯一值的列该表的每一行均包含行程用户以及该行程的日期该表中可能有一些不被接受的乘车请求表是该表具有唯一值的列该表的每一行都包含已接受的行程信息表中的行程信息都在表中存在编写一个解决方案计算出从年月至月至年月至月的每三个月窗口的和并将和四舍五入至小数点后两位通过将三个月的总相加并除以来计算的计算方法与此类似返回按升序排列的结果表其中是起始月份的编号一月为二月为每台机器的进程平均运行时间表该表展示了一家工厂网站的用户活动是当前表的主键具有唯一值的列的组合是一台机器的号是运行在各机器上的进程号是枚举类型是浮点类型代表当前时间以秒为单位代表该进程在这台机器上的开始运行时间戳代表该进程在这台机器上的终止运行时间戳同一台机器同一个进程都有一对开始时间戳和结束时间戳而且开始时间戳永远在结束时间戳前面现在有一个工厂网站由几台机器运行每台机器上运行着相同数量的进程编写解决方案计算每台机器各自完成一个进程任务的平均耗时完成一个进程任务的时间指进程的时间戳减去时间戳平均耗时通过计算每台机器上所有进程任务的总耗费时间除以机器上的总进程数量获得结果表必须包含机器和对应的平均耗时别名且四舍五入保留位小数以任意顺序返回表修复表中的名字表是该表的主键具有唯一值的列该表包含用户的和名字名字仅由小写和大写字符组成编写解决方案修复名字使得只有第一个字符是大写的其余都是小写的返回按排序的结果表先全部小写处理首字母改成大写和字符串剩下部分进行拼接无效的推文表在中是这个表的主键只包含字母数字字符不包含其它特殊字符这个表包含某社交媒体中所有的推文查询所有无效推文的编号当推文内容中的字符数严格大于时该推文是无效的以任意顺序返回结果表访问日期之间最大的空档期表该表没有主键它可能有重复的行该表包含用户访问某特定零售商的日期日志假设今天的日期是编写解决方案对于每个求出每次访问及其下一个访问若该次访问是最后一次则为今天之间最大的空档期天数返回结果表按用户编号排序同一天的第一个电话和最后一个电话难编写一个查询来找出那些们在任意一天的第一个电话和最后一个电话都是和同一个人的这些电话不论是拨打者还是接收者都会被记录结果请放在一个任意次序约束的表中查询结果格式如下所示选出所有在某个时间跟另一个通话的按和每天分组对标号便于找到每天第一个和最后的一通电话某天第一次通话某天最后一次通话对某人某天第一次和最后一次通话的去重计数值为就是题中需求结果注释问题在中注释不应该使用井号在语句的中间部分尤其是在列表或其他语句结构中井号在中通常用于行尾来标记注释的开始直到行末如果您想在语句的某部分添加注释您应该使用两个连字符后跟空格或者如果注释跨越多行您可以使用注释内容修改列数据类型表是该表的主键此表包含了一些学校的容纳能力容纳能力指的是学校能够接纳学生的最大数量表是该表的主键表中每一行表示有名学生在考试中至少获得了分表中的数据在逻辑上是正确的即记录了高的行相比记录了低的行拥有相同或更少的也就是说对于表中的行与行如果那么每年学校会公布学生申请所需的最低分数要求学校根据所有学生的考试成绩来决定其最低分数要求学校希望确保即使每一个满足分数要求的学生都申请该学校学校也有足够的能力接纳每一个学生学校也希望尽可能多的学生能申请该学校学校必须使用在表中的来作为最低分数要求编写一个查询来查询每所学校的最低分数要求如果同时有多个值满足上述要求则选择其中最小的一个如果数据不足以决定最低分数要求那么输出返回的结果表可以按任意顺序排序查询结果格式如下例所示示例输入表表输出解释学校的容纳能力为选择作为最低分数要求因为学校最多会收到份申请这在学校的容纳能力以内学校的容纳能力为可以选择或作为最低分数要求因为学校最多会收到份申请这在学校的容纳能力以内又因为是所有可选项中最小的因此我们选择学校的容纳能力为选择作为最低分数要求因为学校最多会收到份申请这在学校的容纳能力以内给出的数据不足以确定最低分数要求如果选择作为最低分数要求学校可能会收到份申请然而学校的容纳能力只有我们没有关于更高分数的信息因此我们返回问题三个实验平台中每种实验完成的次数请注意每一对实验平台实验名称都应包含在输出中包括平台上实验次数是零的表是这个表的主键是枚举类型的取值是这三种之一也是枚举类型的取值是这三种之一这个表包含有关随机实验人员进行的实验的用于做实验的平台以及实验名称的信息结果可以以任意顺序给出查询的结果如下所示示例输入输出解释在安卓平台上我们只做了一个实验在平台上我们做了一个实验和一个实验在平台上我们做了两个实验和一个实验笛卡尔积架构表是此表的主键列经验是包含一个值高级初级的枚举类型此表的每一行都显示候选人的月薪和经验一家公司想雇佣新员工公司的工资预算是美元公司的招聘标准是雇佣最多的高级员工在雇佣最多的高级员工后使用剩余预算雇佣最多的初级员工编写一个查询查找根据上述标准雇佣的高级员工和初级员工的数量按任意顺序返回结果表查询结果格式如下例所示示例输入输出说明我们可以雇佣名为的高级员工由于预算是万美元他们的工资总额是万美元我们还有万美元但他们不足以雇佣为的高级员工我们可以雇佣名为的初级员工由于剩下的预算是万美元他们的工资总额是万美元我们还有万美元但他们不足以雇佣为的初级员工按分组开窗按生序排列逐一求和然后就是能招聘的员工能招聘的等级员工上下两表拼接就是题中需求能招聘的等级员工自己思路找出高级和低级的生成临时表然后用变量然后对高级和低级临时表的工资逐行加再筛选出低于预备工资的数据得到高级多少人并且一共花多少再和低级临时表连接条件是高级的总工资低级总工资预算得到低级多少人和低级总工资简单简单别人的答案用函数子查询就可以了简单简单但我只想到了是算出比率然后再这里不要用四舍五入简单简单查找进步的学生表是这张表的主键每一行包含有关学生在特定考试日期特定科目成绩的信息分数范围从到包括边界编写一个解决方案来查找进步的学生如果同时满足以下两个条件则该学生被认为是进步的在同一科目至少参加过两个不同日期的考试他们在该学科最近的分数比他们第一次该学科考试的分数更高返回结果表以升序排序先筛选出一门学科至少参加过两次的人对这些人的这些学科再按照上面那样做也可以查找合法邮箱表是这张表的唯一主键每一行包含用户的唯一和邮箱地址编写一个解决方案来查找所有合法邮箱地址一个合法的邮箱地址符合下述条件只包含一个符号以结尾符号前面的部分只包含字母数字字符和下划线符号后面与前面的部分包含只有字母的域名返回结果表以升序排序查找无效的地址表是这张表的唯一主键每一行包含服务器访问日志信息包括地址和状态码编写一个解决方案来查找无效的地址一个地址如果满足以下任何条件之一则无效任何位字节中包含大于的数字任何位字节中含有前导零如少于或多于个位字节返回结果表分别以降序排序结果格式如下所示示例输入表输出一个的数字字符串匹配字符是这样的无前导零串起来就是这样的个数字三个点拼起来就可以了可以写成一个数字字符串一个点重复三次加一个单独的数字字符串即可即最终做一个正则表达式匹配完了分组输出即可查找具有有效序列号的产品表是这张表的唯一主键这张表的每一行表示一个产品的唯一名字和描述编写一个解决方案来找到所有描述中包含一个有效序列号模式的产品一个有效序列号符合下述规则以字母开头区分大小写后面有恰好位数字接着是一个短横短横后面还有另一组位数字序列号必须在描述内可能不在描述的开头返回结果表以升序排序模式识别表是这张表的唯一主键每一行包含一个序列以一个字符组成的字符串表示以及它所采集自的物种生物学家正在研究序列中的基本模式编写一个解决方案以识别具有以下模式的以开头的序列一个常见的起始密码子以或结尾的序列终止密码子包含基序的序列一个简单重复模式有至少个连续的序列如或返回结果表以升序排序结果格式如下所示示例输入表输出分析组织层级递归表是这张表的唯一主键每一行包含关于一名员工的信息包括他们的姓名他们经理的薪水和部门顶级经理的是空的编写一个解决方案来分析组织层级并回答下列问题层级对于每名员工确定他们在组织中的层级层级为的直接下属员工层级为以此类推团队大小对于每个是经理的员工计算他们手下的直接或间接下属总员工数薪资预算对于每个经理计算他们控制的总薪资预算所有手下员工的工资总和包括间接下属加上自己的工资返回结果表以层级升序排序然后以预算降序排序最后以升序排序查找类别推荐对表是这张表的唯一主键每一行代表用户以特定数量购买的一种产品表是这张表的唯一主键每一行表示一件商品的类别和价格亚马逊想要了解不同产品类别的购物模式编写一个解决方案查找所有类别对其中对于每个类别对确定同时购买了两类别产品的不同用户数量如果至少有个不同的客户购买了两个类别的产品则类别对被视为可报告的返回可报告类别对的结果表以降序排序并且为了防止排序持平以字典序升序排序然后以升序排序季节性销售分析表是这张表的唯一主键每一行包含一件产品的销售信息包括销售日期销售数量以及单价表是这张表的唯一主键每一行包含一件产品的信息包括它的名字和分类编写一个解决方案来找到每个季节最受欢迎的产品分类季节定义如下冬季十二月一月二月春季三月四月五月夏季六月七月八月秋季九月十月十一月一个分类的受欢迎度由某个季节的总销售量决定如果有并列选择总收入最高的类别返回结果表以季节升序排序结果格式如下所示示例输入表表输出寻找持续进步的员工表是这张表的唯一主键每一行包含一名员工的信息表是这张表的唯一主键每一行表示一名员工的绩效评估评分在的范围内分代表优秀分代表较差编写一个解决方案以找到在过去三次评估中持续提高绩效的员工员工至少需要次评估才能被考虑员工过去的次评估评分必须严格递增每次评价都比上一次好根据为每位员工分析最近的次评估进步分数为最后次评估中最后一次评分与最早一次评分之间的差值返回结果表以进步分数降序排序然后以名字升序排序这里理解有点问题它的意思是最近三次是依次增加就行不用全部都是一次增加寻找康复患者表是这张表的唯一主键每一行表示一个患者的信息表是这张表的唯一主键每一行代表一个检测结果结果可以是阳性阴性或不确定编写一个解决方案以找到从中康复的患者那些曾经检测呈阳性但后来检测呈阴性的患者患者如果至少有一次阳性检测结果后在之后的日期至少有一次阴性检测结果则被认为已康复计算从首次阳性检测结果到该阳性检测后的首次阴性检测结果之间的康复时间以天为单位仅包括同时具有阳性及阴性检测结果的患者返回结果表以升序排序然后以升序排序常用积累删除重复邮件保留最小的来自如果不要貌似多余的会报错不允许在语句的子句中直接使用正在被更新的表是表的别名这个语句会删除表中所有满足条件和条件的行所以答案这样写的意思是最终会在中而不是在笛卡尔积的表里是吗日期相关函数返回两个日期之间的时间天数月数年数结果把示例的换成就是按年计算参数参数能干什么可以计算相差天数小时分钟和秒相比于函数要灵活很多格式是时间小的前时间大的放在后面计算相差天数其中处可以是以下值之一缩写月名月数值月的天数值月的天数值年位年位小时小时分钟数值或时间小时微秒从日期增加指定的时间间隔返回的是一个字符串参数是合法的日期表达式参数是您希望添加的时间间隔参数可以是下列值二使用函数为获取当前时间加天当前日期向前推天加小时加分钟加秒加毫秒加周加月加季加年函数可以用来替代略和这两个函数可以查询我们得到的结果集上下偏移相应行数的相应的结果函数查询当前行向上偏移行对应的结果该函数有三个参数第一个为待查询的参数列名第二个为向上偏移的位数第三个参数为超出最上面边界的默认值函数查询当前行向下偏移行对应的结果该函数有三个参数第一个为待查询的参数列名第二个为向下偏移的位数第三个参数为超出最下面边界的默认值当比如第一行取前一行为语句查询定义在查询中经常会遇到需要重复使用的子查询为了简化查询语句并提高可读性引入了语法通过使用我们可以创建临时表或视图将子查询的结果保存起来并在主查询中使用本文将通过示例介绍中的特点展示其在查询中的优势简化复杂查询提高查询性能使用可以避免在主查询中重复执行相同的子查询从而提高查询性能临时表的结果会被缓存主查询只需要引用临时表即可避免了重复计算子查询的开销一个参数两个参数第一个参数表示从第几行开始取第二个表示取几行其实这个实现分页也是可以的分页例如把结果集分页每页条记录要获取第页的记录可以使用上述查询表示对结果集从号记录开始最多取条注意记录集的索引从开始如果要查询第页那么我们只需要跳过头条记录也就是对结果集从号记录开始查询把设定为总是设定为计算公式为函数的使用如果的值为则返回的值如果的值不为则返回的值输出结果输出结果函数的使用如果成立那么返回值为否则返回值为的值输出结果输出结果函数的使用如果的值为则返回如果的值不为则返回输出结果输出结果安全等于提供了和这两个操作符它们专门用于检查字段是否为当我们使用时如果字段的值为查询将返回如果字段的值不是包括字段中有值和字段为空查询将返回同样地用于检查字段值是否不是普通的不能用于的比较两个式子中有一个或者两个结果为安全等于可以用于包含的比较除了等于等于中两个字符串比较按照字符串规则来字符串和数字比较字符串转换成数字比较安全等于可以用于比较同为一个则为其它情况和类似输入表找出那些没有被的客户推荐的客户的姓名法一法二笛卡尔积笛卡尔积中的笛卡尔积是指两个表的所有可能的组合当两个表没有关联条件时数据库系统会对这两个表进行笛卡尔积操作这会导致性能下降和资源浪费和一样的都是笛卡尔积取余函数不是下标为开始新奇这里的是截取的不能再后面截取截取后也不能重命名这里能因为这里同分组下相同自定义变量表窗口函数时开始支持参考通常将常用的窗口函数分为两大类聚合窗口函数与专用窗口函数求和求平均值求数量求最大值求最小值函数名分类说明排序函数类似于排名并列的结果序号可以重复序号不连续排序函数类似于排名并列的结果序号可以重复序号连续排序函数对该分组下的所有结果作一个排序基于该分组给一个行数你要的操作用于分组的列名按序叠加的列名窗口滑动的数据范围窗口函数参数分组列排序列开始行结束行窗口滑动的数据范围用来限定你要的操作所运用的数据的范围具体有如下这些当前行之前的行之后的行无界限表示从前面的起点表示到后面的终点举例理解一下取当前行和前五行共行取当前行和后五行共行取前五行和后五行共行从当前行到最后的数据表示的是具体的值比这个值小的行比这个值大的行是以当前值为锚点进行计算比如表示如果当前值为的话就取前后的值在到之间的数据则通过字段差值来进行选择如当前行的字段值是那么这个窗口大小的定义就会选择分区中字段值落在至区间的记录行语句格式一语句在执行时将后的表达式的值与各子句的表达式值比较如果相等则执行后面的表达式或语句然后跳出语句否则返回后面的表达式语句格式二后面没有表达式多个子句中的表达式依次执行如果表达式结果为真则执行相应关键字后面的表达式或语句执行完毕之后跳出语句如果所有语句都为则执行子句中的语句小在交换数据和列转行时可以考虑使用语句可以指定自定义的分隔符不指定的情况下默认是正则表达式和一样的效果语句中符号表示连接符比如其结果就是关闭模式的弊端结果的不确定性关闭可能导致分组查询返回不确定的结果特别是当列表中包含非聚合列且这些列没有包含在子句中时将从每个分组中任意选择一个值作为结果这可能导致结果难以预测和解释调试复杂性在没有的约束下编写的查询可能在逻辑上不那么明确尤其是当查询变得复杂时这可能使得调试和维护查询变得更加困难性能问题虽然不是直接结果但关闭并依赖从分组中随机选择数据可能导致查询效率不是最优的特别是在处理大量数据时标准的偏离更接近于标准对分组操作的定义关闭它可能意味着编写的在其他遵循标准的数据库系统中可能不会工作或者产生不同的结果行转列列转行行转列一般使用或语句聚合函数而列转行一般使用多个查询的方法左右外连接当连接键不唯一时还是可以正常连接不用去笛卡尔积然后过滤全外连接不支持可以用实现这里需要去重和会去重不会去重从索引开始读取个含义是跳过条取出条数据后面是从第条开始读读取条信息即读取第条数据含义是从下标开始取出条数据后面跟的是条数据即读取第条和一起使用注意事项如果的列有相同的值时会随机选取这些行当的列有重复值时和结果可能不一样可以在后面再加一个字段让两个方法保持结果一致性开平方对开平方根结果是一样的取绝对值将字符串表达式转换为大写将字符串表达式转换为小写将两个或多个字符串连接成一个函数用于从字符串的开头和结尾删除指定字符默认情况下删除空格删除两侧的字符默认删除开头的字符删除结尾的字符要删除的字符集默认为空格删除两侧空格输出删除左侧空格输出删除右侧空格输出删除指定字符输出递归题目有两种递归字段的声明写法第一种是在中声明需要递归的字段第二种是在语句中第一段的初始值内声明变量初始值递归内容终止条件这里注意递归内容中选择的表格是引用的是临时的递归表格生成数字序列树状或者层级结构比如公司员工表用一个员工表另一个员工表可以得到上下级关系再但是又时不知道有多少个层级就得用了函数可以将任何类型的值转换为具有指定类型的值利用该函数可以直接在数据库层处理部分因数据类型引起的问题支持的类型描述二进制型字符型日期格式为日期加具体的时间格式为时间格式为型型无符号是中的一个非常实用的字符串截取函数它的基本用法是其中是要截取的原始字符串是作为分隔符的字符而指定了分隔符出现的次数这个函数返回中在第次出现之前的子字符串如果是正数它返回从左边开始到的所有内容如果是负数它则返回从右边开始之后的所有内容获取第一个逗号前的字符串结果获取第二个逗号前的字符串结果获取最后一个逗号后的字符串结果获取倒数第二个逗号前的字符串中最后一个逗号后的部分结果获取倒数第二个逗号后的字符串中第一个逗号前的部分结果字符串字符数我们在设计列族的时候可以把经常读取的列存储到一个列族中不经常读取的列放到另一个列族中这样我们在读取部分列的数据的时候就只需要读取对应列族文件中的数据提高读取效率在中数据块大小和大小是两个不同的概念它们具有不同的功能和调整目的数据块大小主要影响中的数据存储和访问性能数据块由多个对集合组成每个数据块的大小在创建表的列族时可以指定数据块大小的设定影响数据块索引的大小数据块越小索引越大从而占用更大内存空间因此在随机查找性能和数据块索引内存占用之间需要权衡如果需要更好的随机查找性能可以将数据块设置为较小的值而如果需要更好的序列扫描性能则可以考虑增大数据块的大小而是中用于保存修改数据即对的内存结构当的大小达到一个阈值默认是时会被到文件即以释放内存空间的大小设置主要影响的写入性能和内存使用如果太小可能导致频繁的操作影响写入性能如果太大则可能消耗过多的内存资源因此数据块大小和大小不一样它们是中两个不同的参数需要根据具体的应用场景和性能需求进行独立调整',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-07-03 23:55:21',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://video-b2g.pages.dev/" title="视频解析"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/视频.png" alt="视频解析"/><span class="back-menu-item-text">视频解析</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://md5-uir.pages.dev/" title="md5值解密"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/MD5.png" alt="md5值解密"/><span class="back-menu-item-text">md5值解密</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://screencheck.pages.dev/#welcome" title="屏幕坏点检查"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/屏幕外观.png" alt="屏幕坏点检查"/><span class="back-menu-item-text">屏幕坏点检查</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://htmleditor-9lo.pages.dev/" title="在线html编辑器"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/html编辑器.png" alt="在线html编辑器"/><span class="back-menu-item-text">在线html编辑器</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">博客</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://ttyong-github-io.pages.dev/" title="旧博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/博客.png" alt="旧博客"/><span class="back-menu-item-text">旧博客</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">Tech智汇站</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/img/%E5%BE%AE%E4%BF%A1%E6%94%B6%E6%AC%BE%E7%A0%81.jpg" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E5%BE%AE%E4%BF%A1%E6%94%B6%E6%AC%BE%E7%A0%81.jpg"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%B6%E6%AC%BE%E7%A0%81.jpg" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%B6%E6%AC%BE%E7%A0%81.jpg"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Git/" style="font-size: 1.05rem;">Git<sup>1</sup></a><a href="/tags/GitHub/" style="font-size: 1.05rem;">GitHub<sup>1</sup></a><a href="/tags/Hexo/" style="font-size: 1.05rem;">Hexo<sup>1</sup></a><a href="/tags/NodeJs/" style="font-size: 1.05rem;">NodeJs<sup>1</sup></a><a href="/tags/git/" style="font-size: 1.05rem;">git<sup>3</sup></a><a href="/tags/github/" style="font-size: 1.05rem;">github<sup>1</sup></a><a href="/tags/idea/" style="font-size: 1.05rem;">idea<sup>1</sup></a><a href="/tags/%E5%85%AC%E8%80%83%E6%9D%A8%E8%80%81%E5%B8%88/" style="font-size: 1.05rem;">公考杨老师<sup>10</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 1.05rem;">博客<sup>1</sup></a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 1.05rem;">大数据<sup>27</sup></a><a href="/tags/%E5%AE%89%E7%9F%A5%E9%B1%BC%E4%B8%BB%E9%A2%98/" style="font-size: 1.05rem;">安知鱼主题<sup>1</sup></a><a href="/tags/%E5%BB%96%E9%9B%AA%E5%B3%B0/" style="font-size: 1.05rem;">廖雪峰<sup>9</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">计算机网络<sup>1</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 1.05rem;">面试<sup>12</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">五月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">四月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">75</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9D%A2%E8%AF%95/" itemprop="url">面试</a><i class="anzhiyufont anzhiyu-icon-angle-right post-meta-separator"></i><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9D%A2%E8%AF%95/%E6%B1%82%E8%81%8C/" itemprop="url">求职</a></span></div></div><h1 class="post-title" itemprop="name headline">面试 数据库常见面试问题？</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="post-meta-icon anzhiyufont anzhiyu-icon-calendar-days"></i><span class="post-meta-label">发表于</span><time itemprop="dateCreated datePublished" datetime="2025-01-17T09:35:02.000Z" title="发表于 2025-01-17 17:35:02">2025-01-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为重庆"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>重庆</span></div></div></div><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/01/17/%E9%9D%A2%E8%AF%95%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%EF%BC%9F/"><header><a class="post-meta-categories" href="/categories/%E9%9D%A2%E8%AF%95/" itemprop="url">面试</a><a class="post-meta-categories" href="/categories/%E9%9D%A2%E8%AF%95/%E6%B1%82%E8%81%8C/" itemprop="url">求职</a><h1 id="CrawlerTitle" itemprop="name headline">面试 数据库常见面试问题？</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">智汇君</span><time itemprop="dateCreated datePublished" datetime="2025-01-17T09:35:02.000Z" title="undefined 2025-01-17 17:35:02">2025-01-17</time></header><h1 id="数据库常见面试问题？"><a href="#数据库常见面试问题？" class="headerlink" title="数据库常见面试问题？"></a>数据库常见面试问题？</h1><h2 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h2><h3 id="课程"><a href="#课程" class="headerlink" title="课程"></a>课程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">常用的存储引擎？InnoDB与MyISAM的区别？</span><br><span class="line"></span><br><span class="line">什么是事务,以及事务的四大特性?</span><br><span class="line"></span><br><span class="line">事务的隔离级别有哪些,MySQL默认是哪个?</span><br><span class="line"></span><br><span class="line">内连接与左外连接的区别是什么?</span><br><span class="line"></span><br><span class="line">MySQL默认InnoDB引擎的索引是什么数据结构?</span><br><span class="line"></span><br><span class="line">如何查看MySQL的执行计划?</span><br><span class="line"></span><br><span class="line">索引失效的情况有哪些?</span><br><span class="line"></span><br><span class="line">什么是回表查询?</span><br><span class="line"></span><br><span class="line">什么是MVCC?</span><br><span class="line"></span><br><span class="line">MySQL主从复制的原理是什么?</span><br><span class="line"></span><br><span class="line">主从复制之后的读写分离如何实现?</span><br><span class="line"></span><br><span class="line">数据库的分库分表如何实现?</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">SQL性能优化经验</span><br><span class="line"></span><br><span class="line">1.sql优化大多依赖索引进行</span><br><span class="line">2.聚集索引和二级索引对于理解sql优化很关键(能使用聚集使用过滤就不使用二级索引，效率更高)</span><br><span class="line">3.满足业务需求的情况下，尽量降低主键的长度 --因为二级索引叶子节点会存储主键，会导致索引数据大</span><br><span class="line">插入数据时，尽量选择顺序插入，选择使用AUTO_INCREMENT自增主键。 --避免页分裂</span><br><span class="line">尽量不要使用UUID做主键或者是其他自然主键，如身份证号  --长度长且无序</span><br><span class="line">4.load data批量插入数据</span><br><span class="line">5.sql执行频率</span><br><span class="line">6.慢查询</span><br><span class="line">7.执行计划</span><br><span class="line">8.profile详情</span><br><span class="line"></span><br><span class="line">可以从这几个维度回答这个问题：</span><br><span class="line">加索引</span><br><span class="line">避免返回不必要的数据</span><br><span class="line">适当分批量进行</span><br><span class="line">优化sql结构</span><br><span class="line">分库分表</span><br><span class="line">读写分离</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">数据库优化经验</span><br><span class="line"></span><br><span class="line">四五千万条记录时，就可能要考虑分库分表了，这是运维篇的内容</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">建立索引的优劣势</span><br><span class="line"></span><br><span class="line">优缺点</span><br><span class="line">优势</span><br><span class="line">提高数据检索的效率，降低数据库的IO成本</span><br><span class="line">通过索引列对数据进行排序，降低数据排序的成本，降低CPU的消耗。</span><br><span class="line"></span><br><span class="line">劣势</span><br><span class="line">索引列也是要占用空间的</span><br><span class="line">索引大大提高了查询效率，同时却也降低更新表的速度，如对表进行INSERT、UPDATE、DELETE时，效率降低。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">为什么InnoDB存储引擎选择使用B+tree索引结构?</span><br><span class="line"></span><br><span class="line">相对于二叉树，层级更少，搜索效率高;</span><br><span class="line">对于B-tree，无论是叶子节点还是非叶子节点，都会保存数据，这样导致一页中存储的键值减少，指针跟着减少，要同样保存大量数据，只能增加树的高度，导致性能降低</span><br><span class="line">相对Hash索引，B+tree支持范围匹配及排序操作</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">估算主键索引树2，3层时，大概能存储多少行数据？</span><br><span class="line"></span><br><span class="line">只要给出主键什么类型，多大，然后一行数据多大？就可以估算</span><br><span class="line">1.先算一个页最大能存储多少个主键 2.然后算出指针数，再乘以一个页最大能存储多少行数据就行</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MySQL 索引使用有哪些注意事项呢？</span><br><span class="line"></span><br><span class="line">讲的10条</span><br><span class="line">+</span><br><span class="line">在索引列上使用mysql的内置函数，索引失效。</span><br><span class="line">对索引列运算（如，+、-、*、/），索引失效。</span><br><span class="line">索引字段上使用（！= 或者 &lt; &gt;，not in）时，可能会导致索引失效。</span><br><span class="line">左连接查询或者右连接查询查询关联的字段编码格式不一样，可能导致索引失效。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">索引不适合哪些场景</span><br><span class="line"></span><br><span class="line">数据量少的不适合加索引</span><br><span class="line">更新比较频繁的也不适合加索引</span><br><span class="line">区分度低的字段不适合加索引（如性别）</span><br><span class="line"></span><br><span class="line">针对于数据量较大(300w条)，且查询比较频繁的表建立索引。</span><br><span class="line">针对于常作为查询条件(where)、排序 (order by)、分组 (group by)操作的字段建立索引。</span><br><span class="line">尽量选择区分度高的列作为索引，尽量建立唯一索引，区分度越高，使用索引的效率越高。</span><br><span class="line">如果是字符串类型的字段，字段的长度较长，可以针对于字段的特点，建立前缀索引。</span><br><span class="line">尽量使用联合索引，减少单列索引，查询时，联合索引很多时候可以覆盖索引，节省存储空间，避免回表，提高查询效率。要控制素引的数量，索引并不是多多益善，索引越多，维护索引结构的代价也就越大，会影响增删改的效率。</span><br><span class="line">如果索引列不能存储NULL值，请在创建表时使用NOT NULL约束它。当优化器知道每列是否包含NULL值时，它可以更好地确定哪个索引最有效地用于查询。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MySQL 遇到过死锁问题吗，你是如何解决的？</span><br><span class="line">我排查死锁的一般步骤是酱紫的：</span><br><span class="line"></span><br><span class="line">查看死锁日志show engine innodb status;</span><br><span class="line">找出死锁Sql</span><br><span class="line">分析sql加锁情况</span><br><span class="line">模拟死锁案发</span><br><span class="line">分析死锁日志</span><br><span class="line">分析死锁结果</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">聚集索引与非聚集索引的区别</span><br></pre></td></tr></table></figure>

<h3 id="稀土掘金"><a href="#稀土掘金" class="headerlink" title="稀土掘金"></a>稀土掘金</h3><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904166939164680">url</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904177261363213">url</a></p>
<h4 id="什么是幻读，脏读，不可重复读呢？"><a href="#什么是幻读，脏读，不可重复读呢？" class="headerlink" title="什么是幻读，脏读，不可重复读呢？"></a>什么是幻读，脏读，不可重复读呢？</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">脏读  x</span><br><span class="line">幻读  数据量不一样</span><br><span class="line">不可重复读 数据值不一样</span><br></pre></td></tr></table></figure>

<h4 id="limit-1000000-加载很慢的话，你是怎么解决的呢？"><a href="#limit-1000000-加载很慢的话，你是怎么解决的呢？" class="headerlink" title="limit 1000000 加载很慢的话，你是怎么解决的呢？"></a>limit 1000000 加载很慢的话，你是怎么解决的呢？</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">方案一：如果id是连续的，可以这样，返回上次查询的最大记录(偏移量)，再往下limit</span><br><span class="line">复制代码select id，name from employee where id&gt;1000000 limit 10.</span><br><span class="line"></span><br><span class="line">方案二：在业务允许的情况下限制页数：</span><br><span class="line">建议跟业务讨论，有没有必要查这么后的分页啦。因为绝大多数用户都不会往后翻太多页。</span><br><span class="line"></span><br><span class="line">方案三：order by + 索引（id为索引）</span><br><span class="line">复制代码select id，name from employee order by id  limit 1000000，10</span><br><span class="line"></span><br><span class="line">方案四：利用延迟关联或者子查询优化超多分页场景。（先快速定位需要获取的id段，然后再关联）</span><br><span class="line">复制代码SELECT a.* FROM employee a, (select id from employee where 条件 LIMIT 1000000,10 ) b where a.id=b.id</span><br></pre></td></tr></table></figure>

<h4 id="在高并发情况下，如何做到安全的修改同一行数据？"><a href="#在高并发情况下，如何做到安全的修改同一行数据？" class="headerlink" title="在高并发情况下，如何做到安全的修改同一行数据？"></a>在高并发情况下，如何做到安全的修改同一行数据？</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">要安全的修改同一行数据，就要保证一个线程在修改时其它线程无法更新这行记录。一般有悲观锁和乐观锁两种方案~</span><br></pre></td></tr></table></figure>

<h5 id="使用悲观锁"><a href="#使用悲观锁" class="headerlink" title="使用悲观锁"></a>使用悲观锁</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">悲观锁思想就是，当前线程要进来修改数据时，别的线程都得拒之门外~</span><br><span class="line">比如，可以使用select…for update ~</span><br><span class="line">select * from User where name=‘jay’ for update</span><br><span class="line">update xxx</span><br><span class="line"></span><br><span class="line">以上这条sql语句会锁定了User表中所有符合检索条件（name=‘jay’）的记录。本次事务提交之前，别的线程都无法修改这些记录。</span><br></pre></td></tr></table></figure>

<h5 id="使用乐观锁"><a href="#使用乐观锁" class="headerlink" title="使用乐观锁"></a>使用乐观锁</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">乐观锁思想就是，有线程过来，先放过去修改，如果看到别的线程没修改过，就可以修改成功，如果别的线程修改过，就修改失败或者重试。实现方式：乐观锁一般会使用版本号机制或CAS算法实现。</span><br></pre></td></tr></table></figure>

<h4 id="CSDN案例"><a href="#CSDN案例" class="headerlink" title="CSDN案例"></a>CSDN案例</h4><h5 id="案例一"><a href="#案例一" class="headerlink" title="案例一"></a>案例一</h5><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42444823/article/details/122565671">csdn链接</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"># 学生表 Student：</span><br><span class="line"> </span><br><span class="line">create table Student(</span><br><span class="line"> </span><br><span class="line">SId varchar(10) ,</span><br><span class="line"> </span><br><span class="line">Sname varchar(10),</span><br><span class="line"> </span><br><span class="line">Sage datetime,</span><br><span class="line"> </span><br><span class="line">Ssex varchar(10));</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># 教师表 Teacher</span><br><span class="line"> </span><br><span class="line">create table Teacher(</span><br><span class="line"> </span><br><span class="line">TId varchar(10),</span><br><span class="line"> </span><br><span class="line">Tname varchar(10)); </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># 科目表 Course</span><br><span class="line"> </span><br><span class="line">create table Course(</span><br><span class="line"> </span><br><span class="line">CId varchar(10),</span><br><span class="line"> </span><br><span class="line">Cname nvarchar(10),</span><br><span class="line"> </span><br><span class="line">TId varchar(10)); </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># 成绩表 SC</span><br><span class="line"> </span><br><span class="line">create table SC(</span><br><span class="line"> </span><br><span class="line">SId varchar(10),</span><br><span class="line"> </span><br><span class="line">CId varchar(10),</span><br><span class="line"> </span><br><span class="line">score decimal(18,1)); </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1.1查询同时存在01课程和02课程的情况</span><br><span class="line"></span><br><span class="line">1.2查询存在01课程但可能不存在02课程的情况（不存在时显示为null）</span><br><span class="line"></span><br><span class="line">1.3查询不存在01课程但存在02课程的学生情况</span><br><span class="line"></span><br><span class="line">2.0查询平均成绩大于等于60分的学生编号和学生姓名和平均成绩</span><br><span class="line">where group by having</span><br><span class="line"></span><br><span class="line">3.0查询在sc表存在成绩的学生信息</span><br><span class="line"></span><br><span class="line">4.0查询所有同学的学生编号、学生姓名、选课总数、所有课程的总成绩（没成绩的显示为nulll）</span><br><span class="line">IFNULL(a,b)</span><br><span class="line">sum(case when then else)</span><br><span class="line">5.0查询[李]姓老师的数量</span><br><span class="line"></span><br><span class="line">6.0查询学过[张三]老师授课的同学信息(难度系数★★★)</span><br><span class="line"></span><br><span class="line">7.0查询没有学全所有课程的同学的信息</span><br><span class="line"></span><br><span class="line">8.0查询至少有一门课学号与01的同学所学相同的同学信息</span><br><span class="line"></span><br><span class="line">9.0查询和01号同学学习的课程完全相同的其他同学的信息</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">10.查询没学过[张三]老师讲授的任一门课程的学生姓名</span><br><span class="line"></span><br><span class="line">11.查询两门及其以上不及格课程的同学的学号，姓名及其平均成绩</span><br><span class="line"></span><br><span class="line">12.检索01课程分数小于60，按分数降序排列的学生信息</span><br><span class="line"></span><br><span class="line">13.按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩1</span><br><span class="line"></span><br><span class="line">14.查询各科成绩最高分、最低分和平均分</span><br><span class="line"></span><br><span class="line">15.按各科成绩进行排名，并显示排名，score重复时继续排序</span><br><span class="line"></span><br><span class="line">16.查询学生的总成绩，并进行排名，总分重复时保留名次空缺</span><br><span class="line"></span><br><span class="line">17.统计各科成绩分数段人数，课程编号，课程名称，[100-85][85-70][70-60][60-0]及所占百分比</span><br><span class="line"></span><br><span class="line">18.查询各科成绩前三名的记录</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">19.查询每门课程被选修的学生数</span><br><span class="line"></span><br><span class="line">20.查询出只选修两门课程的学生学号和姓名</span><br><span class="line"></span><br><span class="line">21.查询男生、女生人数</span><br><span class="line"></span><br><span class="line">22.查询名字中含有[风]字的学生信息</span><br><span class="line"></span><br><span class="line">23.查询同名同姓学生名单，并统计同名同性人数</span><br><span class="line"></span><br><span class="line">24.查询1990年出生的学生名单</span><br><span class="line"></span><br><span class="line">25.查询每门课程的平均成绩，结果按平均成绩降序排列，平均成绩相同，按课程编号升序排列</span><br><span class="line"></span><br><span class="line">26.查询平均成绩大于等于85的所有学生的学号、姓名和平均成绩</span><br><span class="line"></span><br><span class="line">27.查询课程名称为[数学]，且分数低于60的学生姓名和分数</span><br><span class="line"></span><br><span class="line">28.查询所有学生的课程及分数情况（存在学生没成绩没选课的情况）</span><br><span class="line"></span><br><span class="line">29.查询任何一门课程成绩在70分以上的姓名、课程名称和分数</span><br><span class="line"></span><br><span class="line">30.查询不及格的课程 </span><br><span class="line"></span><br><span class="line">31.查询课程编号为01且课程成绩在80分以上的学生的学号和姓名 </span><br><span class="line"></span><br><span class="line">32.求每门课程的学生人数 </span><br><span class="line"></span><br><span class="line">33.假设成绩不重复，查询选修[张三]老师所授课程的学生中，成绩最高的学生信息及成绩 </span><br><span class="line"></span><br><span class="line">34.假设成绩有重复，查询选修[张三]老师所授课程的学生中，成绩最高的学生信息及成绩 </span><br><span class="line"></span><br><span class="line">35.查询不同课程成绩相同的学生的学生编号、课程编号、学生成绩 </span><br><span class="line"></span><br><span class="line">36.查询每门科目成绩最好的前两名 </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="1-1"><a href="#1-1" class="headerlink" title="1.1"></a>1.1</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1.</span><br><span class="line">SELECT a.Sid,a.score 01_score,b.score 02_score</span><br><span class="line">FROM (SELECT * FROM sc WHERE Cid = 01) AS a,(SELECT * FROM sc WHERE Cid = 02) AS b </span><br><span class="line">WHERE a.Sid = b.Sid ;</span><br><span class="line"></span><br><span class="line">2.</span><br><span class="line">SELECT C1.sid, C3.sname, C3.sage, C3.ssex, C1.score AS score1, </span><br><span class="line">	C2.score AS score2 </span><br><span class="line">FROM (SELECT * FROM SC WHERE Cid = &#x27;01&#x27;) AS C1 </span><br><span class="line">	INNER JOIN (SELECT * FROM SC WHERE Cid = &#x27;02&#x27;) AS C2 </span><br><span class="line">ON C1.sid = C2.sid </span><br><span class="line">	INNER JOIN Student AS C3 </span><br><span class="line">    ON C1.sid = C3.sid ;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h6 id="1-2"><a href="#1-2" class="headerlink" title="1.2"></a>1.2</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">查询存在01课程但可能不存在02课程的情况（不存在时显示为null）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM (SELECT * FROM sc WHERE cid = &#x27;01&#x27;) a</span><br><span class="line">LEFT JOIN sc </span><br><span class="line">ON a.sid = sc.sid AND sc.cid = &#x27;02&#x27;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">----</span><br><span class="line">SELECT *</span><br><span class="line">FROM (SELECT * FROM sc WHERE cid = &#x27;01&#x27;) a</span><br><span class="line">LEFT JOIN (SELECT * FROM sc WHERE cid = &#x27;02&#x27;) b</span><br><span class="line">ON a.sid = b.sid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">SELECT *</span><br><span class="line">FROM sc a</span><br><span class="line">LEFT JOIN sc b</span><br><span class="line">ON a.sid = b.sid AND b.cid = &#x27;02&#x27;</span><br><span class="line">WHERE a.cid = &#x27;01&#x27;;</span><br></pre></td></tr></table></figure>

<h6 id="1-3"><a href="#1-3" class="headerlink" title="1.3"></a>1.3</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">查询不存在01课程但存在02课程的学生情况</span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM sc s1</span><br><span class="line">WHERE s1.CId=&#x27;02&#x27; AND s1.SId not in (</span><br><span class="line">SELECT s2.SId</span><br><span class="line">FROM sc s2</span><br><span class="line">WHERE s2.CId=&#x27;01&#x27;);</span><br></pre></td></tr></table></figure>

<h5 id="3-EXISTS"><a href="#3-EXISTS" class="headerlink" title="3 EXISTS"></a>3 EXISTS</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT s.student id,s.name,s.age, s.genderFRoM student s</span><br><span class="line">JOIN SC sc ON s.student id= sc.student id</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SELECT s.student id,s.name, s.age, s.genderFROM student s</span><br><span class="line">WHERE EXISTS(</span><br><span class="line">SELECT 1</span><br><span class="line">FROM SC SC</span><br><span class="line">WHERE sc.student id=s.student id</span><br></pre></td></tr></table></figure>



<h6 id="7-having的一个使用技巧"><a href="#7-having的一个使用技巧" class="headerlink" title="7 having的一个使用技巧"></a>7 having的一个使用技巧</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">查询没有学全所有课程的同学的信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SELECT SC.SId,COUNT(cid) 选课数目</span><br><span class="line">			FROM sc</span><br><span class="line">			GROUP BY sid</span><br><span class="line">			HAVING 选课数目 &lt; (SELECT COUNT(cid)FROM course c)</span><br></pre></td></tr></table></figure>

<h6 id="8"><a href="#8" class="headerlink" title="8"></a>8</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">查询至少有一门课学号与01的同学所学相同的同学信息</span><br><span class="line"></span><br><span class="line">SELECT DISTINCT a.*</span><br><span class="line">FROM student a</span><br><span class="line">INNER JOIN (SELECT *</span><br><span class="line">			FROM sc</span><br><span class="line">			WHERE cid IN (SELECT cid FROM sc WHERE sid = &quot;01&quot;)) b</span><br><span class="line">ON a.sid = b.sid;</span><br><span class="line"> </span><br><span class="line">----</span><br><span class="line">SELECT DISTINCT s.*</span><br><span class="line">FROM sc</span><br><span class="line">INNER JOIN student s</span><br><span class="line">ON sc.sid = s.sid</span><br><span class="line">WHERE sc.cid IN (SELECT cid FROM sc WHERE sid = &quot;01&quot;);</span><br></pre></td></tr></table></figure>





<h6 id="9"><a href="#9" class="headerlink" title="9"></a>9</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">查询和01号同学学习的课程完全相同的其他同学的信息</span><br><span class="line"></span><br><span class="line">SELECT SId,COUNT(*) num</span><br><span class="line">FROM </span><br><span class="line">(</span><br><span class="line">SELECT s1.SId,s1.CId</span><br><span class="line">FROM sc s1</span><br><span class="line">INNER JOIN</span><br><span class="line">(</span><br><span class="line">SELECT sc.*</span><br><span class="line">FROM sc</span><br><span class="line">WHERE sc.SId=&#x27;01&#x27;) s2</span><br><span class="line">WHERE s1.CId=s2.CId</span><br><span class="line">) t</span><br><span class="line">GROUP BY SId</span><br><span class="line">HAVING num = (SELECT COUNT(*) FROM sc WHERE sc.SId=&#x27;01&#x27;)</span><br></pre></td></tr></table></figure>

<h6 id="13-avg-over-partition-by"><a href="#13-avg-over-partition-by" class="headerlink" title="13 avg() over(partition by)"></a>13 avg() over(partition by)</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩</span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM sc s1</span><br><span class="line">INNER JOIN</span><br><span class="line">(</span><br><span class="line">SELECT SId,AVG(score) as avg</span><br><span class="line">FROM sc</span><br><span class="line">GROUP BY SId</span><br><span class="line">) s2</span><br><span class="line">on s1.SId=s2.SId</span><br><span class="line">ORDER BY avg DESC,s1.SId</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    s.student_name AS 学生姓名,</span><br><span class="line">    c.course_name AS 课程名称,</span><br><span class="line">    g.score AS 成绩,</span><br><span class="line">    AVG(g.score) OVER (PARTITION BY s.student_id) AS 平均成绩</span><br><span class="line">FROM</span><br><span class="line">    grades g</span><br><span class="line">JOIN students s ON g.student_id = s.student_id</span><br><span class="line">JOIN courses c ON g.course_id = c.course_id</span><br><span class="line">ORDER BY</span><br><span class="line">    平均成绩 DESC,</span><br><span class="line">    s.student_name,</span><br><span class="line">    c.course_name;</span><br></pre></td></tr></table></figure>

<h6 id="14"><a href="#14" class="headerlink" title="14"></a>14</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">查询各科成绩最高分、最低分和平均分</span><br><span class="line"></span><br><span class="line">SELECT</span><br><span class="line">    c.course_name AS 课程名称,</span><br><span class="line">    MAX(g.score) AS 最高分,</span><br><span class="line">    MIN(g.score) AS 最低分,</span><br><span class="line">    ROUND(AVG(g.score), 2) AS 平均分  -- 保留两位小数</span><br><span class="line">FROM</span><br><span class="line">    grades g</span><br><span class="line">JOIN courses c ON g.course_id = c.course_id  -- 关联课程名称</span><br><span class="line">GROUP BY</span><br><span class="line">    c.course_id  -- 按课程分组（避免课程名重复）</span><br><span class="line">ORDER BY c.course_name;  -- 按课程名称排序</span><br></pre></td></tr></table></figure>



<h6 id="15-变量的使用"><a href="#15-变量的使用" class="headerlink" title="15  变量的使用"></a>15  变量的使用</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">按各科成绩进行排名，并显示排名，score重复时继续排序</span><br><span class="line"></span><br><span class="line">SELECT sc.* ,DENSE_RANK() over(PARTITION by CId ORDER BY score DESC) r</span><br><span class="line">FROM sc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-----  它这个使用变量的方法也不对 如图片</span><br><span class="line">SELECT sid,</span><br><span class="line">	   cid,</span><br><span class="line">	   score,</span><br><span class="line">	   @rank:=@rank+1 as rk</span><br><span class="line">FROM sc,(SELECT @rank:=0) as t</span><br><span class="line">ORDER BY score DESC;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 自定义变量 --</span><br><span class="line"># ① 定义变量 set @a:=2 (@用来标识变量),使用变量select @a</span><br><span class="line"># ② 定义并使用变量 select @b:=4 </span><br><span class="line"># 修改或者重新赋值 select @b:=6</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202410130953637.png" alt="image-20241013095305533"></p>
<h6 id="16-dense-rank-、变量的使用"><a href="#16-dense-rank-、变量的使用" class="headerlink" title="16 dense_rank()、变量的使用"></a>16 dense_rank()、变量的使用</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">查询学生的总成绩，并进行排名，总分重复时保留名次空缺</span><br><span class="line"></span><br><span class="line">SELECT SId,totalscore,DENSE_RANK()over(ORDER BY totalscore DESC) r</span><br><span class="line">FROM</span><br><span class="line">(</span><br><span class="line">SELECT SId,SUM(score) totalscore</span><br><span class="line">FROM sc</span><br><span class="line">GROUP BY SId</span><br><span class="line">) t</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT a.*,</span><br><span class="line">		@rank:=IF(@sco=sum_score,@rank+0,@rank+1) rk</span><br><span class="line">FROM (SELECT sid,</span><br><span class="line">			 SUM(score) sum_score</span><br><span class="line">	  FROM sc</span><br><span class="line">	  GROUP BY sid</span><br><span class="line">	  ORDER BY sum_score DESC) a,(select @sco:=null,@rank:=0) b</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rank()排序会有重复的，会出现不连续的排序</span><br><span class="line">dense_rank()排序相同时会重复，但是各个排序序号都是连续的</span><br><span class="line">row_number()排序不会重复，且序号连续</span><br></pre></td></tr></table></figure>



<h6 id="17-区域段-case-when-then-concat"><a href="#17-区域段-case-when-then-concat" class="headerlink" title="17 区域段 case when then  concat"></a>17 区域段 case when then  concat</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">统计各科成绩分数段人数，课程编号，课程名称，[100-85][85-70][70-60][60-0]及所占百分比</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SELECT sc.CId 课程编号,c.Cname 课程名称,COUNT(1) 选修人数</span><br><span class="line">	   ,CONCAT(ROUND(SUM(CASE WHEN sc.score &gt;=0 AND sc.score &lt;= 60 THEN 1 ELSE 0 END)/COUNT(1),2),&#x27;%&#x27;) AS &#x27;(0-60]&#x27;</span><br><span class="line">       ,CONCAT(ROUND(SUM(CASE WHEN sc.score &gt;=60 AND sc.score &lt;= 70 THEN 1 ELSE 0 END)/COUNT(1),2),&#x27;%&#x27;) AS &#x27;(60-70]&#x27;</span><br><span class="line">       ,CONCAT(ROUND(SUM(CASE WHEN sc.score &gt;= 70 AND sc.score &lt;= 85 THEN 1 ELSE 0 END)/COUNT(1),2),&#x27;%&#x27;) AS &#x27;(70-85]&#x27;</span><br><span class="line">       ,CONCAT(ROUND(SUM(CASE WHEN sc.score &gt;= 85 AND sc.score &lt;= 100 THEN 1 ELSE 0 END)/COUNT(1),2),&#x27;%&#x27;) AS &#x27;(85-100]&#x27;</span><br><span class="line">FROM sc</span><br><span class="line">LEFT JOIN course c</span><br><span class="line">ON sc.cId = c.CId</span><br><span class="line">GROUP BY sc.CId,c.Cname</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h6 id="22-like"><a href="#22-like" class="headerlink" title="22 like"></a>22 like</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">查询名字中含有[风]字的学生信息</span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM student </span><br><span class="line">WHERE sname LIKE &#x27;%风%&#x27;;</span><br></pre></td></tr></table></figure>

<h6 id="25"><a href="#25" class="headerlink" title="25"></a>25</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT CId,AVG(score) avg</span><br><span class="line">FROM sc</span><br><span class="line">GROUP BY CId</span><br><span class="line">ORDER BY avg desc,CId</span><br></pre></td></tr></table></figure>

<h6 id="33-变量的使用-limit"><a href="#33-变量的使用-limit" class="headerlink" title="33 变量的使用 limit"></a>33 变量的使用 limit</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">假设成绩不重复，查询选修[张三]老师所授课程的学生中，成绩最高的学生信息及成绩 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 法一</span><br><span class="line">SELECT *</span><br><span class="line">FROM teacher t</span><br><span class="line">LEFT JOIN course c</span><br><span class="line">ON t.tid = c.tid</span><br><span class="line">LEFT JOIN sc</span><br><span class="line">ON c.cid = sc.cid</span><br><span class="line">LEFT JOIN student s</span><br><span class="line">ON s.sid = sc.sid</span><br><span class="line">WHERE t.tname = &quot;张三&quot;</span><br><span class="line">ORDER BY sc.score DESC</span><br><span class="line">LIMIT 1;</span><br><span class="line"> </span><br><span class="line"># 法二</span><br><span class="line">-- 1.先查询[张三]老师所带的课程编号cid和tid --</span><br><span class="line">SELECT *</span><br><span class="line">FROM teacher t</span><br><span class="line">LEFT JOIN course c</span><br><span class="line">ON t.tid = c.tid</span><br><span class="line">WHERE t.tname = &quot;张三&quot;;</span><br><span class="line">-- 2.将以上结果与成绩表sc关联 --</span><br><span class="line">SELECT sc.sid,a.cid,a.cname,a.tname,sc.score</span><br><span class="line">FROM (SELECT t.tid,t.tname,c.cid,c.cname</span><br><span class="line">	  FROM teacher t</span><br><span class="line">	  LEFT JOIN course c</span><br><span class="line">	  ON t.tid = c.tid</span><br><span class="line">	  WHERE t.tname = &quot;张三&quot;) a </span><br><span class="line">LEFT JOIN sc</span><br><span class="line">ON a.cid = sc.cid</span><br><span class="line">ORDER BY sc.score DESC</span><br><span class="line">LIMIT 1;</span><br><span class="line">-- 3.将以上结果与学生表student关联 --</span><br><span class="line">SELECT s.sid 学号,s.sname 学生姓名,a.cname 课程,a.tname 教师姓名,a.score 成绩</span><br><span class="line">FROM (SELECT sc.sid,a.cid,a.cname,a.tname,sc.score</span><br><span class="line">	  FROM (SELECT t.tid,t.tname,c.cid,c.cname</span><br><span class="line">			FROM teacher t</span><br><span class="line">			LEFT JOIN course c</span><br><span class="line">			ON t.tid = c.tid</span><br><span class="line">			WHERE t.tname = &quot;张三&quot;) a </span><br><span class="line">		LEFT JOIN sc</span><br><span class="line">		ON a.cid = sc.cid</span><br><span class="line">ORDER BY sc.score DESC</span><br><span class="line">LIMIT 1) a</span><br><span class="line">LEFT JOIN student s</span><br><span class="line">ON a.sid = s.sid;</span><br></pre></td></tr></table></figure>



<h6 id="34-变量的使用"><a href="#34-变量的使用" class="headerlink" title="34  变量的使用"></a>34  变量的使用</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">假设成绩有重复，查询选修[张三]老师所授课程的学生中，成绩最高的学生信息及成绩 </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">SET @score:=NULL,@rank:=0;</span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM </span><br><span class="line">(SELECT a.*,</span><br><span class="line">		CASE WHEN @score=score THEN @rank</span><br><span class="line">			 ELSE @score:=score AND @rank:=@rank+1 END rk</span><br><span class="line">FROM </span><br><span class="line">(SELECT s.sid,s.sname,sc.score,c.cid,c.cname</span><br><span class="line"> FROM teacher t</span><br><span class="line"> LEFT JOIN course c</span><br><span class="line"> ON t.tid = c.tid</span><br><span class="line"> LEFT JOIN sc</span><br><span class="line"> ON c.cid = sc.cid</span><br><span class="line"> LEFT JOIN student s</span><br><span class="line"> ON s.sid = sc.sid</span><br><span class="line"> WHERE t.tname = &quot;张三&quot;) a) s</span><br><span class="line"> ORDER BY rk DESC</span><br><span class="line">LIMIT 1;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM </span><br><span class="line">(SELECT a.*,</span><br><span class="line">		CASE WHEN @score=score THEN @rank</span><br><span class="line">			 ELSE @score:=score AND @rank:=@rank+1 END rk</span><br><span class="line">FROM </span><br><span class="line">(SELECT s.sid,s.sname,sc.score,c.cid,c.cname</span><br><span class="line"> FROM teacher t</span><br><span class="line"> LEFT JOIN course c</span><br><span class="line"> ON t.tid = c.tid</span><br><span class="line"> LEFT JOIN sc</span><br><span class="line"> ON c.cid = sc.cid</span><br><span class="line"> LEFT JOIN student s</span><br><span class="line"> ON s.sid = sc.sid</span><br><span class="line"> WHERE t.tname = &quot;张三&quot;) a,(SELECT @score:=NULL,@rank:=0) t) s</span><br><span class="line"> ORDER BY rk DESC</span><br><span class="line">LIMIT 1;</span><br></pre></td></tr></table></figure>

<h6 id="41-current-day-substring-year-now"><a href="#41-current-day-substring-year-now" class="headerlink" title="41 current_day(),substring(),year(),now()"></a>41 current_day(),substring(),year(),now()</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">current_day()	2024-10-14</span><br><span class="line"></span><br><span class="line">now()	2024-10-14 11:01:11</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">按照出生日期来算，当前月日 &lt; 出生年月的月日 则年龄减一 </span><br><span class="line"></span><br><span class="line">SELECT student.SId,CASE </span><br><span class="line">	WHEN SUBSTRING(CURRENT_DATE(),6,10)-SUBSTRING(Sage,6,10)&gt;=0</span><br><span class="line">	THEN</span><br><span class="line">		YEAR(CURRENT_DATE())-YEAR(Sage)</span><br><span class="line">	ELSE</span><br><span class="line">		YEAR(CURRENT_DATE())-YEAR(Sage)-1</span><br><span class="line">END age</span><br><span class="line">FROM student</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">    Sno, </span><br><span class="line">    Sname, </span><br><span class="line">    YEAR(CURDATE()) - YEAR(Sage) - </span><br><span class="line">    (DATE_FORMAT(CURDATE(), &#x27;%m%d&#x27;) &lt; DATE_FORMAT(Sage, &#x27;%m%d&#x27;)) AS Age</span><br><span class="line">FROM </span><br><span class="line">    student;</span><br></pre></td></tr></table></figure>



<h6 id="42-week"><a href="#42-week" class="headerlink" title="42 week"></a>42 week</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">查询本周过生日的学生</span><br><span class="line"></span><br><span class="line">-- 【分析】使用week()函数</span><br><span class="line">SELECT *,</span><br><span class="line">       WEEK(sage),</span><br><span class="line">       WEEK(NOW())</span><br><span class="line">FROM student</span><br><span class="line">WHERE WEEK(sage)=WEEK(NOW());</span><br></pre></td></tr></table></figure>

<h6 id="43-month"><a href="#43-month" class="headerlink" title="43 month"></a>43 month</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">查询本月过生日的学生</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 【分析】使用month()函数 --</span><br><span class="line">SELECT *,</span><br><span class="line">       MONTH(sage),</span><br><span class="line">       MONTH(NOW())</span><br><span class="line">FROM student</span><br><span class="line">WHERE MONTH(sage)=MONTH(NOW());</span><br></pre></td></tr></table></figure>



<h6 id="44-month"><a href="#44-month" class="headerlink" title="44 month"></a>44 month</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">查询下月过生日的学生 </span><br><span class="line"></span><br><span class="line">SELECT *,</span><br><span class="line">       MONTH(sage),</span><br><span class="line">       MONTH(NOW())</span><br><span class="line">FROM student</span><br><span class="line">WHERE MONTH(sage)=MONTH(NOW())+1;</span><br></pre></td></tr></table></figure>





<h5 id="案例二"><a href="#案例二" class="headerlink" title="案例二"></a>案例二</h5><p><a target="_blank" rel="noopener" href="http://www.360doc.com/content/24/0424/09/41302653_1121296713.shtml">url</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/72223558">url</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">student</span><br><span class="line"></span><br><span class="line">字段名	</span><br><span class="line">Sno	学生编号</span><br><span class="line">Sname	学生姓名</span><br><span class="line">Sage	出生年月</span><br><span class="line">Ssex	学生性别</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">course</span><br><span class="line"></span><br><span class="line">字段名	--</span><br><span class="line">Cno	科目编号</span><br><span class="line">Cname	科目名称</span><br><span class="line">Tno	任课老师编号</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">teacher</span><br><span class="line"></span><br><span class="line">字段名	--</span><br><span class="line">Tno	任课教师标号</span><br><span class="line">Tname	任课老师姓名</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SC</span><br><span class="line"></span><br><span class="line">字段名	--</span><br><span class="line">Sno	学生编号</span><br><span class="line">Cno	科目编号</span><br><span class="line">score	成绩</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">1. 查询&quot; 01 &quot;课程比&quot; 02 &quot;课程成绩高的学生的信息及课程分数</span><br><span class="line"></span><br><span class="line">1.1 查询同时存在&quot; 01 &quot;课程和&quot; 02 &quot;课程的情况</span><br><span class="line"></span><br><span class="line">1.2 查询存在&quot;01&quot;课程但可能不存在&quot;02&quot;课程的情况(不存在时显示为 null )</span><br><span class="line"></span><br><span class="line">1.3 查询不存在&quot;01&quot;课程但存在&quot;02&quot;课程的情况</span><br><span class="line"></span><br><span class="line">2. 查询平均成绩大于等于 60 分的同学的学生编号和学生姓名和平均成绩</span><br><span class="line"></span><br><span class="line">3. 查询在 SC 表存在成绩的学生信息</span><br><span class="line"></span><br><span class="line">4. 查询所有同学的学生编号、学生姓名、选课总数、所有课程的总成绩(没成绩的显示为 null )</span><br><span class="line"></span><br><span class="line">4.1 查有成绩的学生信息</span><br><span class="line"></span><br><span class="line">5. 查询「李」姓老师的数量 </span><br><span class="line"></span><br><span class="line">6. 查询学过「张三」老师授课的同学的信息 </span><br><span class="line"></span><br><span class="line">7. 查询没有学全所有课程的同学的信息 </span><br><span class="line"></span><br><span class="line">8. 查询至少有一门课与学号为&quot;01&quot;的同学所学相同的同学的信息 </span><br><span class="line"></span><br><span class="line">9. 查询和&quot;01&quot;号的同学学习的课程完全相同的其他同学的信息 </span><br><span class="line"></span><br><span class="line">10. 查询没学过&quot;张三&quot;老师讲授的任一门课程的学生姓名 </span><br><span class="line"></span><br><span class="line">11. 查询两门及其以上不及格课程的同学的学号，姓名及其平均成绩 </span><br><span class="line"></span><br><span class="line">12. 检索&quot;01&quot;课程分数小于60，按分数降序排列的学生信息</span><br><span class="line"></span><br><span class="line">13. 按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩</span><br><span class="line"></span><br><span class="line">14. 查询各科成绩最高分、最低分和平均分：</span><br><span class="line">    以如下形式显示：课程 ID，课程 name，最高分，最低分，平均分，及格率，中等率，优良率，优秀率</span><br><span class="line">    及格为&gt;=60，中等为：70-80，优良为：80-90，优秀为：&gt;=90</span><br><span class="line">    还要求选修人数，查询结果按人数降序排列，若人数相同，按课程号升序排列</span><br><span class="line"></span><br><span class="line">15. 按各科成绩进行排序，并显示排名，Score重复时保留名次空缺</span><br><span class="line"></span><br><span class="line">15.1 按各科成绩进行排序，并显示排名， Score 重复时合并名次</span><br><span class="line"></span><br><span class="line">16.  查询学生的总成绩，并进行排名，总分重复时保留名次空缺</span><br><span class="line"></span><br><span class="line">16.1 查询学生的总成绩，并进行排名，总分重复时不保留名次空缺</span><br><span class="line"></span><br><span class="line">17. 统计各科成绩各分数段人数：课程编号，课程名称，[100-85]，[85-70]，[70-60]，[60-0] 及所占百分比</span><br><span class="line"></span><br><span class="line">18. 查询各科成绩前三名的记录</span><br><span class="line"></span><br><span class="line">19. 查询每门课程被选修的学生数 </span><br><span class="line"></span><br><span class="line">20. 查询出只选修两门课程的学生学号和姓名 </span><br><span class="line"></span><br><span class="line">21. 查询男生、女生人数</span><br><span class="line"></span><br><span class="line">22. 查询名字中含有「风」字的学生信息</span><br><span class="line"></span><br><span class="line">23. 查询同名同性学生名单，并统计同名人数</span><br><span class="line"></span><br><span class="line">24. 查询 1990 年出生的学生名单</span><br><span class="line"></span><br><span class="line">25. 查询每门课程的平均成绩，结果按平均成绩降序排列，平均成绩相同时，按课程编号升序排列</span><br><span class="line"></span><br><span class="line">26. 查询平均成绩大于等于 85 的所有学生的学号、姓名和平均成绩 </span><br><span class="line"></span><br><span class="line">27. 查询课程名称为「数学」，且分数低于 60 的学生姓名和分数 </span><br><span class="line"></span><br><span class="line">28. 查询所有学生的课程及分数情况（存在学生没成绩，没选课的情况）</span><br><span class="line"></span><br><span class="line">29. 查询任何一门课程成绩在 70 分以上的姓名、课程名称和分数</span><br><span class="line"></span><br><span class="line">30. 查询不及格的课程</span><br><span class="line"></span><br><span class="line">31. 查询课程编号为 01 且课程成绩在 80 分以上的学生的学号和姓名</span><br><span class="line"></span><br><span class="line">32. 求每门课程的学生人数 </span><br><span class="line"></span><br><span class="line">33. 成绩不重复，查询选修「张三」老师所授课程的学生中，成绩最高的学生信息及其成绩</span><br><span class="line"></span><br><span class="line">34. 成绩有重复的情况下，查询选修「张三」老师所授课程的学生中，成绩最高的学生信息及其成绩</span><br><span class="line"></span><br><span class="line">35. 查询不同课程成绩相同的学生的学生编号、课程编号、学生成绩 </span><br><span class="line"></span><br><span class="line">36. 查询每门功成绩最好的前两名</span><br><span class="line"></span><br><span class="line">37. 统计每门课程的学生选修人数（超过 5 人的课程才统计）。</span><br><span class="line"></span><br><span class="line">38. 检索至少选修两门课程的学生学号 </span><br><span class="line"></span><br><span class="line">39. 查询选修了全部课程的学生信息</span><br><span class="line"></span><br><span class="line">40. 查询各学生的年龄，只按年份来算 </span><br><span class="line"></span><br><span class="line">41. 按照出生日期来算，当前月日 &lt; 出生年月的月日则，年龄减一</span><br><span class="line"></span><br><span class="line">42. 查询本周过生日的学生</span><br><span class="line"></span><br><span class="line">43. 查询下周过生日的学生</span><br><span class="line"></span><br><span class="line">44. 查询本月过生日的学生</span><br><span class="line"></span><br><span class="line">45. 查询下月过生日的学生</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h6 id="9-外连接实现except"><a href="#9-外连接实现except" class="headerlink" title="9 !外连接实现except"></a>9 !外连接实现except</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">SELECT Sno</span><br><span class="line">from sc</span><br><span class="line">where Cno and Sno=&#x27;01&#x27; in (</span><br><span class="line">    SELECT Cno</span><br><span class="line">    from sc</span><br><span class="line">    where Sno=&#x27;01&#x27;)</span><br><span class="line">    group by Sno</span><br><span class="line">) t1</span><br><span class="line">left join</span><br><span class="line">(</span><br><span class="line">SELECT Sno</span><br><span class="line">from sc</span><br><span class="line">where Cno not in (</span><br><span class="line">    SELECT Cno</span><br><span class="line">    from sc</span><br><span class="line">    where Sno=&#x27;01&#x27;)</span><br><span class="line">    group by Sno</span><br><span class="line">) t2</span><br><span class="line">on t1.Sno=t2.Sno</span><br><span class="line">where t2.Sno is null</span><br></pre></td></tr></table></figure>



<h6 id="10"><a href="#10" class="headerlink" title="10"></a>10</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">-- 1.先查询出选修了张三老师讲授课程的sid -- </span><br><span class="line">SELECT s.sid</span><br><span class="line">FROM  teacher t</span><br><span class="line">LEFT JOIN course c</span><br><span class="line">ON t.tid = c.tid</span><br><span class="line">LEFT JOIN sc</span><br><span class="line">ON c.cid = sc.cid</span><br><span class="line">LEFT JOIN student s</span><br><span class="line">ON sc.sid = s.sid</span><br><span class="line">WHERE tname = &quot;张三&quot;;</span><br><span class="line">-- 2.与学生表student关联,筛选出不在以上结果内的sid --</span><br><span class="line">SELECT s.*</span><br><span class="line">FROM student s</span><br><span class="line">WHERE sid NOT IN (SELECT s.sid</span><br><span class="line">				  FROM  teacher t</span><br><span class="line">				  LEFT JOIN course c</span><br><span class="line">				  ON t.tid = c.tid</span><br><span class="line">				  LEFT JOIN sc</span><br><span class="line">				  ON c.cid = sc.cid</span><br><span class="line">				  LEFT JOIN student s</span><br><span class="line">				  ON sc.sid = s.sid</span><br><span class="line">				  WHERE tname = &quot;张三&quot;);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">select sid</span><br><span class="line">from student</span><br><span class="line">where sid not in</span><br><span class="line">(</span><br><span class="line">select sid</span><br><span class="line">from sc</span><br><span class="line">where cid in</span><br><span class="line">(</span><br><span class="line">select cid</span><br><span class="line">from teacher t</span><br><span class="line">inner join course c</span><br><span class="line">on t.tid=c.tid</span><br><span class="line">)</span><br><span class="line">group by sid</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h6 id="11"><a href="#11" class="headerlink" title="11"></a>11</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select a.sid,b.sname,avg(a.score) as avg_score</span><br><span class="line">from sc a</span><br><span class="line">left join student b</span><br><span class="line">on a.sid = b.sid</span><br><span class="line">where a.score &lt; 60</span><br><span class="line">group by a.sid</span><br><span class="line">having count(a.cid) &gt;= 2;</span><br></pre></td></tr></table></figure>

<h6 id="13"><a href="#13" class="headerlink" title="13"></a>13</h6><h6 id="14-1"><a href="#14-1" class="headerlink" title="14"></a>14</h6><h6 id="14-case-when-round-值得注意"><a href="#14-case-when-round-值得注意" class="headerlink" title="14 case when round 值得注意"></a>14 case when round 值得注意</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SELECT MIN(score) min_score</span><br><span class="line">			,MAX(score) max_score</span><br><span class="line">			,AVG(score) avg_score</span><br><span class="line">			,COUNT(1) stu_number</span><br><span class="line">			,SUM(CASE WHEN score &gt;= 60 THEN 1 ELSE 0 END)/COUNT(1) 及格率</span><br><span class="line">			,SUM(CASE WHEN score &gt;= 70 AND score &lt; 80 THEN 1 ELSE 0 END)/COUNT(1) 中等率</span><br><span class="line">			,SUM(CASE WHEN score &gt;= 80 AND score &lt; 90 THEN 1 ELSE 0 END)/COUNT(1) 优良率</span><br><span class="line">			,SUM(CASE WHEN score &gt;= 90 THEN 1 ELSE 0 END)/COUNT(1) 优秀率</span><br><span class="line">FROM sc</span><br><span class="line">LEFT JOIN course c</span><br><span class="line">ON sc.cid = c.cid </span><br><span class="line">GROUP BY sc.cid</span><br><span class="line">ORDER BY stu_number DESC ,sc.cid ASC;</span><br></pre></td></tr></table></figure>



<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202405121224020.png" alt="image-20240512122430632"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT courseid,MAX(score) AS &#x27;最高分&#x27;, MIN(score)AS &#x27;最低分&#x27; ,AVG(score) AS &#x27;平均分&#x27; ,COUNT(*) AS &#x27;选修人数&#x27;,</span><br><span class="line">     SUM(CASE WHEN student_score.score &gt;= 60 THEN 1 ELSE 0 END)/COUNT(*) AS &#x27;及格率&#x27;,</span><br><span class="line">     SUM(CASE WHEN student_score.score &gt;= 70 AND student_score.score&lt; 80 THEN 1 ELSE 0 END)/COUNT(*) AS &#x27;中等率&#x27;,</span><br><span class="line">     SUM(CASE WHEN student_score.score &gt;= 80 AND student_score.score&lt;90 THEN 1 ELSE 0 END)/COUNT(*) AS &#x27;优良率&#x27;,</span><br><span class="line">     SUM(CASE WHEN student_score.score &gt;= 90 THEN 1 ELSE 0 END)/COUNT(*) AS &#x27;优秀率&#x27;</span><br><span class="line">FROM student_score GROUP BY courseid ORDER BY COUNT(*)DESC,student_score.courseid ASC ;</span><br></pre></td></tr></table></figure>

<h6 id="15-PARTITION-BY-下面那个with案例值得注意"><a href="#15-PARTITION-BY-下面那个with案例值得注意" class="headerlink" title="15 PARTITION BY  下面那个with案例值得注意"></a>15 PARTITION BY  下面那个with案例值得注意</h6><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202405121203192.png" alt="image-20240512120328077"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SELECT   </span><br><span class="line">    Sno,  </span><br><span class="line">    Cno,  </span><br><span class="line">    score,  </span><br><span class="line">    DENSE_RANK() OVER (PARTITION BY Cno ORDER BY score DESC) AS ranking  </span><br><span class="line">FROM   </span><br><span class="line">    sc  </span><br><span class="line">ORDER BY   </span><br><span class="line">    Cno, score DESC;</span><br><span class="line">    </span><br><span class="line">    在上述查询中，ORDER BY Cno, score DESC是最终的排序，它确保结果首先按课程号排序，然后按分数降序排序。如果你只关心排名而不关心最终排序顺序，可以省略此ORDER BY子句。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">案例</span><br><span class="line"></span><br><span class="line">select Department, Employee, Salary</span><br><span class="line">from (</span><br><span class="line">    select d.name Department, ee.name Employee, ee.salary Salary, dense_rank() over(partition by departmentId order by salary desc) ranks</span><br><span class="line">    from Employee ee</span><br><span class="line">    left join Department d</span><br><span class="line">    on ee.departmentId = d.id</span><br><span class="line">) t</span><br><span class="line">where ranks &lt;= 3</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">案例</span><br><span class="line"></span><br><span class="line">WITH t AS (</span><br><span class="line">    SELECT</span><br><span class="line">        employee_id,</span><br><span class="line">        department_id,</span><br><span class="line">        primary_flag,</span><br><span class="line">        COUNT(*) OVER(PARTITION BY employee_id) AS count_over</span><br><span class="line">    FROM Employee</span><br><span class="line">            )</span><br><span class="line">SELECT employee_id,department_id</span><br><span class="line">FROM t</span><br><span class="line">WHERE count_over = 1 or primary_flag = &#x27;Y&#x27;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202405281241827.png" alt="image-20240528124147664"></p>
<h6 id="16-变量的使用-法一没看懂-法二法六-值得注意"><a href="#16-变量的使用-法一没看懂-法二法六-值得注意" class="headerlink" title="16 变量的使用 法一没看懂 法二法六 值得注意"></a>16 变量的使用 法一没看懂 法二法六 值得注意</h6><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202405101047904.png" alt="image-20240510104752646"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">!16 法一</span><br><span class="line">-- 1、学生的总成绩 --</span><br><span class="line">SELECT sid,SUM(score) sum_score</span><br><span class="line">FROM sc</span><br><span class="line">GROUP BY sid</span><br><span class="line">ORDER BY sum_score DESC;</span><br><span class="line"></span><br><span class="line">-- 2、名次排序 --</span><br><span class="line">SELECT a.*,</span><br><span class="line">		@rank:=IF(@sco=sum_score,&#x27; &#x27;,@rank+1) rk</span><br><span class="line">FROM (SELECT sid,</span><br><span class="line">			 SUM(score) sum_score</span><br><span class="line">	  FROM sc</span><br><span class="line">	  GROUP BY sid</span><br><span class="line">	  ORDER BY sum_score DESC) a,(select @sco:=null,@rank:=0) b</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">法二 (法二-法五是leecode的例子，但用了这里的数据，把sc行数据理解成是总成绩)</span><br><span class="line">select a.Sno, a.score,(select count(b.score)+1 --结果有莫名错误</span><br><span class="line">from sc as b</span><br><span class="line">where b.score&gt;a.score)  as &#x27;r&#x27;</span><br><span class="line">from sc as a</span><br><span class="line">order by &#x27;r&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202405101057067.png" alt="image-20240510105708868"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select a.Sno, a.score,(select count(b.score)+1 --这样接正确了，奇怪</span><br><span class="line">from sc as b</span><br><span class="line">where b.score&gt;a.score)  as r</span><br><span class="line">from sc as a</span><br><span class="line">order by r;</span><br><span class="line"></span><br><span class="line">--等同于rank窗口函数实现的结果</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202405101059106.png" alt="image-20240510105912068"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">法三 (法二-法五是leecode的例子，但用了这里的数据，把sc行数据理解成是总成绩)</span><br><span class="line"></span><br><span class="line">select sc.Sno, sc.score,DENSE_RANK() OVER(ORDER BY sc.score desc) as r</span><br><span class="line">from sc;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202405101108470.png" alt="image-20240510110824177"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">法四 (法二-法五是leecode的例子，但用了这里的数据，把sc行数据理解成是总成绩)</span><br><span class="line"></span><br><span class="line">select sc.Sno, sc.score,RANK() OVER(ORDER BY sc.score desc) as r</span><br><span class="line">from sc;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202405101109512.png" alt="image-20240510110926212"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">法五 (法二-法五是leecode的例子，但用了这里的数据，把sc行数据理解成是总成绩)</span><br><span class="line"></span><br><span class="line">select sc.Sno, sc.score,ROW_NUMBER() OVER(ORDER BY sc.score desc) as r</span><br><span class="line">from sc;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202405101112131.png" alt="image-20240510111228079"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">法六 (法二-法五是leecode的例子，但用了这里的数据，把sc行数据理解成是总成绩)</span><br><span class="line"></span><br><span class="line">select a.id, a.score, count(*) as r</span><br><span class="line">from scores a</span><br><span class="line">left join scores b</span><br><span class="line">on a.score &lt; b.score</span><br><span class="line">group by id, score</span><br><span class="line">order by score DESC</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">错误写法 (法二-法五是leecode的例子，但用了这里的数据，把sc行数据理解成是总成绩)</span><br><span class="line"></span><br><span class="line">select *</span><br><span class="line">from sc as a</span><br><span class="line">where EXISTS (</span><br><span class="line">select b.score</span><br><span class="line">from sc as b</span><br><span class="line">where a.Sno!=b.Sno and a.score&lt;=b.score</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">select a.Sno, count(*) as coun</span><br><span class="line">from SC as a</span><br><span class="line">where a.score&lt;=(</span><br><span class="line">select b.score</span><br><span class="line">from SC as b</span><br><span class="line">where a.Sno!=b.Sno</span><br><span class="line">)</span><br><span class="line">group by a.Sno</span><br><span class="line">order by coun;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">    s.Sno, </span><br><span class="line">    s.Sname, </span><br><span class="line">    SUM(sc.score) AS TotalScore,</span><br><span class="line">    DENSE_RANK() OVER (ORDER BY SUM(sc.score) DESC) AS Rank</span><br><span class="line">FROM </span><br><span class="line">    student s</span><br><span class="line">JOIN </span><br><span class="line">    SC sc ON s.Sno = sc.Sno</span><br><span class="line">GROUP BY </span><br><span class="line">    s.Sno, s.Sname</span><br><span class="line">ORDER BY </span><br><span class="line">    TotalScore DESC;</span><br></pre></td></tr></table></figure>





<h6 id="17-18值得注意-22-ROUND-CASE-CONCAT"><a href="#17-18值得注意-22-ROUND-CASE-CONCAT" class="headerlink" title="17 18值得注意 22 ROUND\CASE\CONCAT"></a>17 18值得注意 22 ROUND\CASE\CONCAT</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">！17 不会</span><br><span class="line">SELECT sc.cid 课程编号,c.cname 课程名称,COUNT(1) 选修人数</span><br><span class="line">	   ,CONCAT(ROUND(SUM(CASE WHEN sc.score &gt;=0 AND sc.score &lt;= 60 THEN 1 ELSE 0 END)/COUNT(1),2),&#x27;%&#x27;) AS &#x27;(0-60]&#x27;</span><br><span class="line">       ,CONCAT(ROUND(SUM(CASE WHEN sc.score &gt;=60 AND sc.score &lt;= 70 THEN 1 ELSE 0 END)/COUNT(1),2),&#x27;%&#x27;) AS &#x27;(60-70]&#x27;</span><br><span class="line">       ,CONCAT(ROUND(SUM(CASE WHEN sc.score &gt;= 70 AND sc.score &lt;= 85 THEN 1 ELSE 0 END)/COUNT(1),2),&#x27;%&#x27;) AS &#x27;(70-85]&#x27;</span><br><span class="line">       ,CONCAT(ROUND(SUM(CASE WHEN sc.score &gt;= 85 AND sc.score &lt;= 100 THEN 1 ELSE 0 END)/COUNT(1),2),&#x27;%&#x27;) AS &#x27;(85-100]&#x27;</span><br><span class="line">FROM sc</span><br><span class="line">LEFT JOIN course c</span><br><span class="line">ON sc.cid = c.cid</span><br><span class="line">GROUP BY sc.cid;</span><br><span class="line"> </span><br><span class="line">-- concat的作用是将两个字符拼接起来 --</span><br><span class="line"></span><br><span class="line">！18  不会 好像有点问题</span><br><span class="line">SELECT a.*,c.cname</span><br><span class="line">FROM sc a</span><br><span class="line">LEFT JOIN course c</span><br><span class="line">ON a.cid = c.cid </span><br><span class="line">WHERE (SELECT COUNT(1) </span><br><span class="line">	   FROM sc b</span><br><span class="line">       WHERE b.cid = a.cid AND b.score &gt; a.score) &lt; 3</span><br><span class="line">ORDER BY cid DESC,score DESC;</span><br><span class="line"></span><br><span class="line">19</span><br><span class="line">SELECT sc.sid 学生编号,s.sname 学生姓名,COUNT(sc.cid) 选课数量</span><br><span class="line">FROM sc</span><br><span class="line">LEFT JOIN student s</span><br><span class="line">ON sc.sid = s.sid</span><br><span class="line">GROUP BY sc.sid,s.sname</span><br><span class="line">HAVING COUNT(sc.cid) = 2;</span><br><span class="line"></span><br><span class="line">20   </span><br><span class="line">SELECT sc.sid 学生编号,s.sname 学生姓名,COUNT(sc.cid) 选课数量</span><br><span class="line">FROM sc</span><br><span class="line">LEFT JOIN student s</span><br><span class="line">ON sc.sid = s.sid</span><br><span class="line">GROUP BY sc.sid，s.sname</span><br><span class="line">HAVING COUNT(sc.cid) = 2;</span><br><span class="line"></span><br><span class="line">21 x</span><br><span class="line"></span><br><span class="line">!22 </span><br><span class="line">SELECT *</span><br><span class="line">FROM student </span><br><span class="line">WHERE sname LIKE &#x27;%风%&#x27;;</span><br><span class="line"></span><br><span class="line">23</span><br><span class="line">SELECT sname 姓名,ssex 性别,COUNT(*) 同名人数</span><br><span class="line">FROM student</span><br><span class="line">GROUP BY sname,ssex;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">24 x+</span><br></pre></td></tr></table></figure>



<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202405082323141.png" alt="image-20240508232354558"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">25 !</span><br><span class="line">select a.Cno,b.Cname,avg(a.score) as avg_score -- 这里有b.Cname错误了</span><br><span class="line">from SC a</span><br><span class="line">left join Course b</span><br><span class="line">on a.Cno = b.Cno</span><br><span class="line">group by a.Cno</span><br><span class="line">order by avg_score desc,a.Cno asc;</span><br><span class="line"></span><br><span class="line">26</span><br><span class="line">select a.sid,b.sname,avg(a.score) as avg_score</span><br><span class="line">from sc a</span><br><span class="line">left join student b</span><br><span class="line">on a.sid = b.sid</span><br><span class="line">group by a.sid</span><br><span class="line">having avg_score &gt;= 85;</span><br><span class="line"></span><br><span class="line">27 x</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h6 id="！33-34-35-36-37-39-40-HAVING-变量"><a href="#！33-34-35-36-37-39-40-HAVING-变量" class="headerlink" title="！33 34 35 36 37 39 40 HAVING 变量"></a>！33 34 35 36 37 39 40 HAVING 变量</h6><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202405082255245.png" alt="image-20240508225527786"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line">28 x</span><br><span class="line"></span><br><span class="line">29 x</span><br><span class="line"></span><br><span class="line">30 x</span><br><span class="line"></span><br><span class="line">31 x</span><br><span class="line"></span><br><span class="line">32 x</span><br><span class="line"></span><br><span class="line">33</span><br><span class="line"># 法一</span><br><span class="line">SELECT *</span><br><span class="line">FROM teacher t</span><br><span class="line">LEFT JOIN course c</span><br><span class="line">ON t.tid = c.tid</span><br><span class="line">LEFT JOIN sc</span><br><span class="line">ON c.cid = sc.cid</span><br><span class="line">LEFT JOIN student s</span><br><span class="line">ON s.sid = sc.sid</span><br><span class="line">WHERE t.tname = &quot;张三&quot;</span><br><span class="line">ORDER BY sc.score DESC</span><br><span class="line">LIMIT 1;</span><br><span class="line"> </span><br><span class="line"># 法二</span><br><span class="line">-- 1.先查询[张三]老师所带的课程编号cid和tid --</span><br><span class="line">SELECT *</span><br><span class="line">FROM teacher t</span><br><span class="line">LEFT JOIN course c</span><br><span class="line">ON t.tid = c.tid</span><br><span class="line">WHERE t.tname = &quot;张三&quot;;</span><br><span class="line">-- 2.将以上结果与成绩表sc关联 --</span><br><span class="line">SELECT sc.sid,a.cid,a.cname,a.tname,sc.score</span><br><span class="line">FROM (SELECT t.tid,t.tname,c.cid,c.cname</span><br><span class="line">	  FROM teacher t</span><br><span class="line">	  LEFT JOIN course c</span><br><span class="line">	  ON t.tid = c.tid</span><br><span class="line">	  WHERE t.tname = &quot;张三&quot;) a </span><br><span class="line">LEFT JOIN sc</span><br><span class="line">ON a.cid = sc.cid</span><br><span class="line">ORDER BY sc.score DESC</span><br><span class="line">LIMIT 1;</span><br><span class="line">-- 3.将以上结果与学生表student关联 --</span><br><span class="line">SELECT s.sid 学号,s.sname 学生姓名,a.cname 课程,a.tname 教师姓名,a.score 成绩</span><br><span class="line">FROM (SELECT sc.sid,a.cid,a.cname,a.tname,sc.score</span><br><span class="line">	  FROM (SELECT t.tid,t.tname,c.cid,c.cname</span><br><span class="line">			FROM teacher t</span><br><span class="line">			LEFT JOIN course c</span><br><span class="line">			ON t.tid = c.tid</span><br><span class="line">			WHERE t.tname = &quot;张三&quot;) a </span><br><span class="line">		LEFT JOIN sc</span><br><span class="line">		ON a.cid = sc.cid</span><br><span class="line">ORDER BY sc.score DESC</span><br><span class="line">LIMIT 1) a</span><br><span class="line">LEFT JOIN student s</span><br><span class="line">ON a.sid = s.sid;</span><br><span class="line"></span><br><span class="line">34 ! rank dense_rank也行</span><br><span class="line">SELECT *</span><br><span class="line">FROM </span><br><span class="line">(SELECT a.*,</span><br><span class="line">		CASE WHEN @score=score THEN @rank</span><br><span class="line">			 WHEN @score:=score THEN @rank:=@rank+1 END rk</span><br><span class="line">FROM </span><br><span class="line">(SELECT s.sid,s.sname,sc.score,c.cid,c.cname</span><br><span class="line"> FROM teacher t</span><br><span class="line"> LEFT JOIN course c</span><br><span class="line"> ON t.tid = c.tid</span><br><span class="line"> LEFT JOIN sc</span><br><span class="line"> ON c.cid = sc.cid</span><br><span class="line"> LEFT JOIN student s</span><br><span class="line"> ON s.sid = sc.sid</span><br><span class="line"> WHERE t.tname = &quot;张三&quot;) a,(SELECT @score:=NULL,@rank:=0) t) s</span><br><span class="line">WHERE rk=1;</span><br><span class="line"></span><br><span class="line">35</span><br><span class="line">SELECT a.sid,a.cid,a.score</span><br><span class="line">FROM sc a</span><br><span class="line">INNER JOIN sc b</span><br><span class="line">ON a.sid = b.sid</span><br><span class="line">WHERE a.cid != b.cid AND a.score = b.score</span><br><span class="line">GROUP BY a.cid,a.sid;</span><br><span class="line"></span><br><span class="line">36 !</span><br><span class="line">SELECT sid,cid,score,rk</span><br><span class="line">FROM(</span><br><span class="line">	SELECT sc.*,</span><br><span class="line">		   @rank:=if(@c_cid=cid,if(@sco=score,@rank,@rank+1),1) rk,</span><br><span class="line">		   @sco:=score,</span><br><span class="line">		   @c_cid:=cid</span><br><span class="line">		FROM sc,(SELECT @sco=null,@rank:=0,@c_cid:=null) b</span><br><span class="line">ORDER BY cid,score DESC) a</span><br><span class="line">where a.rk&lt;3;</span><br><span class="line"></span><br><span class="line">37</span><br><span class="line"># 法一</span><br><span class="line">SELECT cid,COUNT(sid) 选修人数</span><br><span class="line">FROM sc </span><br><span class="line">GROUP BY cid</span><br><span class="line">HAVING COUNT(sid) &gt; 5;</span><br><span class="line"> </span><br><span class="line"># 法二</span><br><span class="line">SELECT cid,COUNT(1) 选修人数</span><br><span class="line">FROM sc </span><br><span class="line">GROUP BY cid</span><br><span class="line">HAVING COUNT(1) &gt; 5;</span><br><span class="line"> </span><br><span class="line">-- 知识点补充 --</span><br><span class="line"># COUNT(1) COUNT(*) COUNT(列名)的区别</span><br><span class="line"># COUNT(1)包含忽略所有列，用1代表代码行，统计时不会忽略列值为NULL</span><br><span class="line"># COUNT(*)包含所有列，相当于行数，统计时，不会忽略列值为NULL</span><br><span class="line"># COUNT(列名)只包含列名那一列，统计时忽略列为NULL(某字段为NULL,不计数)</span><br><span class="line"></span><br><span class="line">38 x</span><br><span class="line"></span><br><span class="line">39</span><br><span class="line">SELECT s.*</span><br><span class="line">FROM sc</span><br><span class="line">INNER JOIN student s</span><br><span class="line">ON sc.sid = s.sid</span><br><span class="line">GROUP BY sid</span><br><span class="line">HAVING COUNT(1) = (SELECT COUNT(1) FROM course);</span><br><span class="line"> </span><br><span class="line">SELECT s.*</span><br><span class="line">FROM sc</span><br><span class="line">INNER JOIN student s</span><br><span class="line">ON sc.sid = s.sid</span><br><span class="line">GROUP BY sid</span><br><span class="line">HAVING COUNT(sc.cid) = (SELECT COUNT(cid) FROM course);</span><br><span class="line"></span><br><span class="line">40</span><br><span class="line">-- 【分析】使用日期函数进行相减 --</span><br><span class="line">SELECT *,YEAR(CURDATE())-YEAR(sage) 年龄</span><br><span class="line">FROM student;</span><br><span class="line"> </span><br><span class="line">SELECT *,YEAR(NOW())-YEAR(sage) 年龄</span><br><span class="line">FROM student;</span><br></pre></td></tr></table></figure>



<h6 id="！timestampdiff-week-month-NOW-YEAR-x-CURDATE"><a href="#！timestampdiff-week-month-NOW-YEAR-x-CURDATE" class="headerlink" title="！timestampdiff()\week()\month()\NOW()\YEAR(x)\CURDATE()"></a>！timestampdiff()\week()\month()\NOW()\YEAR(x)\CURDATE()</h6><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202405082237227.png" alt="image-20240508223729648"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202405082237869.png" alt="image-20240508223754306"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202405082238568.png" alt="image-20240508223813282"></p>
<h6 id="41"><a href="#41" class="headerlink" title="41"></a>41</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">41 !</span><br><span class="line">-- 【分析】日期相减函数timestampdiff(year\,参数1,参数2) --</span><br><span class="line">SELECT *,</span><br><span class="line">	  TIMESTAMPDIFF(YEAR,sage,NOW()) age</span><br><span class="line">FROM student;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">    Sno, </span><br><span class="line">    Sname, </span><br><span class="line">    YEAR(CURDATE()) - YEAR(Sage) - </span><br><span class="line">    (DATE_FORMAT(CURDATE(), &#x27;%m%d&#x27;) &lt; DATE_FORMAT(Sage, &#x27;%m%d&#x27;)) AS Age</span><br><span class="line">FROM </span><br><span class="line">    student;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">    Sno,</span><br><span class="line">    Sname,</span><br><span class="line">    Sage,</span><br><span class="line">    CASE </span><br><span class="line">        WHEN DATE_FORMAT(CURDATE(), &#x27;%m%d&#x27;) &lt; DATE_FORMAT(Sage, &#x27;%m%d&#x27;)</span><br><span class="line">        THEN YEAR(CURDATE()) - YEAR(Sage) - 1</span><br><span class="line">        ELSE YEAR(CURDATE()) - YEAR(Sage)</span><br><span class="line">    END as actual_age</span><br><span class="line">FROM student;</span><br></pre></td></tr></table></figure>





<h6 id="42"><a href="#42" class="headerlink" title="42"></a>42</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">42</span><br><span class="line">-- 【分析】使用week()函数</span><br><span class="line">SELECT *,</span><br><span class="line">       WEEK(sage),</span><br><span class="line">       WEEK(NOW())</span><br><span class="line">FROM student</span><br><span class="line">WHERE WEEK(sage)=WEEK(NOW());</span><br></pre></td></tr></table></figure>

<h6 id="43"><a href="#43" class="headerlink" title="43"></a>43</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">43</span><br><span class="line">SELECT *,</span><br><span class="line">       WEEK(sage),</span><br><span class="line">       WEEK(NOW())</span><br><span class="line">FROM student</span><br><span class="line">WHERE WEEK(sage)=WEEK(NOW())+1;</span><br></pre></td></tr></table></figure>

<h6 id="44"><a href="#44" class="headerlink" title="44"></a>44</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">44</span><br><span class="line">-- 【分析】使用month()函数 --</span><br><span class="line">SELECT *,</span><br><span class="line">       MONTH(sage),</span><br><span class="line">       MONTH(NOW())</span><br><span class="line">FROM student</span><br><span class="line">WHERE MONTH(sage)=MONTH(NOW());</span><br></pre></td></tr></table></figure>

<h6 id="45"><a href="#45" class="headerlink" title="45"></a>45</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">45</span><br><span class="line">SELECT *,</span><br><span class="line">       MONTH(sage),</span><br><span class="line">       MONTH(NOW())</span><br><span class="line">FROM student</span><br><span class="line">WHERE MONTH(sage)=MONTH(NOW())+1;</span><br></pre></td></tr></table></figure>

<h5 id="案例三"><a href="#案例三" class="headerlink" title="案例三"></a>案例三</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://blog.51cto.com/u_16099270/8081043</span><br><span class="line">https://blog.csdn.net/abend11/article/details/136830750</span><br><span class="line">https://blog.csdn.net/pattyi/article/details/116146698</span><br></pre></td></tr></table></figure>





<h3 id="LEECODE案例"><a href="#LEECODE案例" class="headerlink" title="LEECODE案例"></a>LEECODE案例</h3><p><a target="_blank" rel="noopener" href="https://leetcode.doocs.org/">LeeCode Wiki</a></p>
<h4 id="177-第N高的薪水-函数-dense-rank-limit"><a href="#177-第N高的薪水-函数-dense-rank-limit" class="headerlink" title="177.第N高的薪水  函数 dense_rank limit"></a>177.第N高的薪水  函数 dense_rank limit</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT</span><br><span class="line">BEGIN</span><br><span class="line">  RETURN (</span><br><span class="line">      # Write your MySQL query statement below.</span><br><span class="line">      select (</span><br><span class="line">          select distinct salary from (</span><br><span class="line">              select salary, dense_rank() over (order by salary desc) rnk from employee</span><br><span class="line">          )t</span><br><span class="line">          where rnk=N</span><br><span class="line">      )getNthHighestSalary</span><br><span class="line">  );</span><br><span class="line">END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT</span><br><span class="line">BEGIN</span><br><span class="line">    SET N=N-1;</span><br><span class="line">  RETURN (</span><br><span class="line">        SELECT distinct salary FROM Employee ORDER BY salary DESC LIMIT N, 1   </span><br><span class="line">  );</span><br><span class="line">END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT</span><br><span class="line">BEGIN</span><br><span class="line">  RETURN (</span><br><span class="line">      # Write your MySQL query statement below.</span><br><span class="line">            with t1 as (</span><br><span class="line">          select * ,dense_rank() over (order by Salary desc) as rk</span><br><span class="line">          from Employee</span><br><span class="line">      )</span><br><span class="line">      select distinct ifnull(Salary ,null)</span><br><span class="line">      from t1</span><br><span class="line">      where rk = N</span><br><span class="line">  );</span><br><span class="line">END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE M INT; </span><br><span class="line">    SET M = N-1; </span><br><span class="line">  RETURN (</span><br><span class="line">      SELECT DISTINCT salary</span><br><span class="line">      FROM Employee</span><br><span class="line">      ORDER BY salary DESC</span><br><span class="line">      LIMIT M, 1</span><br><span class="line">  );</span><br><span class="line">END</span><br></pre></td></tr></table></figure>



<h4 id="178-分数排名-dense-rank-b-score-a-score"><a href="#178-分数排名-dense-rank-b-score-a-score" class="headerlink" title="178.分数排名 dense_rank b.score &gt;&#x3D; a.score"></a>178.分数排名 dense_rank b.score &gt;&#x3D; a.score</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">表: Scores</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| id          | int     |</span><br><span class="line">| score       | decimal |</span><br><span class="line">+-------------+---------+</span><br><span class="line">id 是该表的主键（有不同值的列）。</span><br><span class="line">该表的每一行都包含了一场比赛的分数。Score 是一个有两位小数点的浮点值。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写一个解决方案来查询分数的排名。排名按以下规则计算:</span><br><span class="line"></span><br><span class="line">分数应按从高到低排列。</span><br><span class="line">如果两个分数相等，那么两个分数的排名应该相同。</span><br><span class="line">在排名相同的分数后，排名数应该是下一个连续的整数。换句话说，排名之间不应该有空缺的数字。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">a.score as Score,</span><br><span class="line">count(DISTINCT b.score) AS Rank # 统计b表符合条件的不重复的分数的数量作为排名</span><br><span class="line">FROM scores a join scores b</span><br><span class="line">where b.score &gt;= a.score # 条件是这个分数不小于我，因为a、b表数据相同，所以排名值最小是1</span><br><span class="line">group by a.id # a表中每个数据都进行排名</span><br><span class="line">order by a.score DESC # 最后按分数（跟排名一样）降序排列</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dense_rank</span><br></pre></td></tr></table></figure>



<h4 id="180-连续出现的数字-lag-lead-with-变量-多同表连接"><a href="#180-连续出现的数字-lag-lead-with-变量-多同表连接" class="headerlink" title="180.连续出现的数字 lag lead with 变量 多同表连接"></a>180.连续出现的数字 lag lead with 变量 多同表连接</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">表：Logs</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| id          | int     |</span><br><span class="line">| num         | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">在 SQL 中，id 是该表的主键。</span><br><span class="line">id 是一个自增列。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">找出所有至少连续出现三次的数字。</span><br><span class="line"></span><br><span class="line">返回的结果表中的数据可以按 任意顺序 排列。</span><br><span class="line"></span><br><span class="line">结果格式如下面的例子所示：</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 1:</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Logs 表：</span><br><span class="line">+----+-----+</span><br><span class="line">| id | num |</span><br><span class="line">+----+-----+</span><br><span class="line">| 1  | 1   |</span><br><span class="line">| 2  | 1   |</span><br><span class="line">| 3  | 1   |</span><br><span class="line">| 4  | 2   |</span><br><span class="line">| 5  | 1   |</span><br><span class="line">| 6  | 2   |</span><br><span class="line">| 7  | 2   |</span><br><span class="line">+----+-----+</span><br><span class="line">输出：</span><br><span class="line">Result 表：</span><br><span class="line">+-----------------+</span><br><span class="line">| ConsecutiveNums |</span><br><span class="line">+-----------------+</span><br><span class="line">| 1               |</span><br><span class="line">+-----------------+</span><br><span class="line">解释：1 是唯一连续出现至少三次的数字。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">distinct p.num as ConsecutiveNums</span><br><span class="line">from(</span><br><span class="line">    select</span><br><span class="line">    id,</span><br><span class="line">    num,</span><br><span class="line">    lag(num,1)over(order by id) num1,</span><br><span class="line">    lag(num,2)over(order by id) num2</span><br><span class="line">    from</span><br><span class="line">    Logs</span><br><span class="line">) p</span><br><span class="line">where</span><br><span class="line">p.num = p.num1 and p.num1  = p.num2</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">with p as(</span><br><span class="line">    (</span><br><span class="line">    select</span><br><span class="line">    id,</span><br><span class="line">    num,</span><br><span class="line">    lag(num,1)over(order by id) num1,</span><br><span class="line">    lag(num,2)over(order by id) num2,</span><br><span class="line">    lead(num,1)over(order by id) num3,</span><br><span class="line">    lead(num,2)over(order by id) num4</span><br><span class="line">    from Logs</span><br><span class="line">) </span><br><span class="line"></span><br><span class="line">)</span><br><span class="line">select</span><br><span class="line">distinct p.num as ConsecutiveNums</span><br><span class="line">from p</span><br><span class="line">where</span><br><span class="line">p.num = p.num1 and p.num1  = p.num2 || p.num1 = p.num = p.num3 || p.num = p.num3 = p.num4</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select distinct Num as ConsecutiveNums</span><br><span class="line">from (</span><br><span class="line">  select Num, </span><br><span class="line">    case </span><br><span class="line">      when @prev = Num then @count := @count + 1</span><br><span class="line">      when (@prev := Num) is not null then @count := 1</span><br><span class="line">    end as CNT</span><br><span class="line">  from Logs, (select @prev := null,@count := null) as t</span><br><span class="line">) as temp</span><br><span class="line">where temp.CNT &gt;= 3</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select distinct a.Num as ConsecutiveNums</span><br><span class="line">from Logs as a,Logs as b,Logs as c</span><br><span class="line">where a.Num=b.Num and b.Num=c.Num and a.id=b.id-1 and b.id=c.id-1;</span><br></pre></td></tr></table></figure>





<h4 id="184-部门工资最高的员工"><a href="#184-部门工资最高的员工" class="headerlink" title="184.部门工资最高的员工"></a>184.部门工资最高的员工</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">    d.name AS Department,</span><br><span class="line">    e.name AS Employee,</span><br><span class="line">    e.salary AS Salary</span><br><span class="line">FROM (</span><br><span class="line">    SELECT </span><br><span class="line">    name, </span><br><span class="line">    salary,</span><br><span class="line">    departmentId, </span><br><span class="line">    RANK() OVER(PARTITION BY departmentId ORDER BY salary DESC) AS `rank`</span><br><span class="line">    FROM Employee</span><br><span class="line">) e </span><br><span class="line">LEFT JOIN Department d </span><br><span class="line">    ON e.departmentId = d.id</span><br><span class="line">WHERE e.`rank` = 1</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">select </span><br><span class="line">    d.Name as Department,</span><br><span class="line">    e.Name as Employee,</span><br><span class="line">    e.Salary </span><br><span class="line">from </span><br><span class="line">    Employee e,Department d </span><br><span class="line">where</span><br><span class="line">    e.DepartmentId=d.id </span><br><span class="line">    and</span><br><span class="line">    (e.Salary,e.DepartmentId) in (select max(Salary),DepartmentId from Employee group by DepartmentId);</span><br></pre></td></tr></table></figure>

<h4 id="185-部门工资前三高的所有员工"><a href="#185-部门工资前三高的所有员工" class="headerlink" title="185.部门工资前三高的所有员工"></a>185.部门工资前三高的所有员工</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">表: Employee</span><br><span class="line"></span><br><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| id           | int     |</span><br><span class="line">| name         | varchar |</span><br><span class="line">| salary       | int     |</span><br><span class="line">| departmentId | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">id 是该表的主键列(具有唯一值的列)。</span><br><span class="line">departmentId 是 Department 表中 ID 的外键（reference 列）。</span><br><span class="line">该表的每一行都表示员工的ID、姓名和工资。它还包含了他们部门的ID。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">表: Department</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| id          | int     |</span><br><span class="line">| name        | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">id 是该表的主键列(具有唯一值的列)。</span><br><span class="line">该表的每一行表示部门ID和部门名。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">公司的主管们感兴趣的是公司每个部门中谁赚的钱最多。一个部门的 高收入者 是指一个员工的工资在该部门的 不同 工资中 排名前三 。</span><br><span class="line">编写解决方案，找出每个部门中 收入高的员工 。</span><br><span class="line">以 任意顺序 返回结果表。</span><br><span class="line">返回结果格式如下所示。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">with t as(</span><br><span class="line">select e1.departmentId,count(distinct e2.Salary) as r,e1.id</span><br><span class="line">from Employee e1 join Employee e2 </span><br><span class="line">on e1.departmentId = e2.departmentId and e1.salary &lt;= e2.salary</span><br><span class="line">group by e1.id</span><br><span class="line">having r&lt;3</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">select d.name as Department,e.name as Employee,e.salary as Salary</span><br><span class="line">from Department as d,t,Employee as e</span><br><span class="line">where t.departmentId = d.id and t.id = e.id</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dense_rank()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    d.Name AS &#x27;Department&#x27;, e1.Name AS &#x27;Employee&#x27;, e1.Salary</span><br><span class="line">FROM</span><br><span class="line">    Employee e1</span><br><span class="line">        JOIN</span><br><span class="line">    Department d ON e1.DepartmentId = d.Id</span><br><span class="line">WHERE</span><br><span class="line">    3 &gt; (SELECT</span><br><span class="line">            COUNT(DISTINCT e2.Salary)</span><br><span class="line">        FROM</span><br><span class="line">            Employee e2</span><br><span class="line">        WHERE</span><br><span class="line">            e2.Salary &gt; e1.Salary</span><br><span class="line">                AND e1.DepartmentId = e2.DepartmentId</span><br><span class="line">        )</span><br><span class="line">;</span><br></pre></td></tr></table></figure>



<h4 id="196-删除重复的电子邮箱-连表delete"><a href="#196-删除重复的电子邮箱-连表delete" class="headerlink" title="196.删除重复的电子邮箱  连表delete"></a>196.删除重复的电子邮箱  连表delete</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">表: Person</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| id          | int     |</span><br><span class="line">| email       | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">id 是该表的主键列(具有唯一值的列)。</span><br><span class="line">该表的每一行包含一封电子邮件。电子邮件将不包含大写字母。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写解决方案 删除 所有重复的电子邮件，只保留一个具有最小 id 的唯一电子邮件。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">delete b from person a join person b</span><br><span class="line">on  a.email = b.email and b.id &gt; a.id</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">with t as</span><br><span class="line">(select min(id) id,email</span><br><span class="line">from Person</span><br><span class="line">group by email</span><br><span class="line">having count(*) &gt; 1)</span><br><span class="line"></span><br><span class="line">delete Person</span><br><span class="line">from Person,t</span><br><span class="line">where Person.id !=t.id and Person.email = t.email</span><br></pre></td></tr></table></figure>

<h4 id="197-上升的温度-datediff-lag-date-add"><a href="#197-上升的温度-datediff-lag-date-add" class="headerlink" title="197.上升的温度 datediff lag date_add"></a>197.上升的温度 datediff lag date_add</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">表： Weather</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| recordDate    | date    |</span><br><span class="line">| temperature   | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id 是该表具有唯一值的列。</span><br><span class="line">没有具有相同 recordDate 的不同行。</span><br><span class="line">该表包含特定日期的温度信息</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写解决方案，找出与之前（昨天的）日期相比温度更高的所有日期的 id 。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select a.id</span><br><span class="line">from weather a, weather b</span><br><span class="line">where a.temperature &gt; b.temperature</span><br><span class="line">and datediff(a.recordDate, b.recordDate) = 1; </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lag()</span><br></pre></td></tr></table></figure>

<h4 id="262-行程和用户-IF-Case"><a href="#262-行程和用户-IF-Case" class="headerlink" title="262.行程和用户 IF Case"></a>262.行程和用户 IF Case</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">表：Trips</span><br><span class="line">+-------------+----------+</span><br><span class="line">| Column Name | Type     |</span><br><span class="line">+-------------+----------+</span><br><span class="line">| id          | int      |</span><br><span class="line">| client_id   | int      |</span><br><span class="line">| driver_id   | int      |</span><br><span class="line">| city_id     | int      |</span><br><span class="line">| status      | enum     |</span><br><span class="line">| request_at  | varchar  |     </span><br><span class="line">+-------------+----------+</span><br><span class="line">id 是这张表的主键（具有唯一值的列）。</span><br><span class="line">这张表中存所有出租车的行程信息。每段行程有唯一 id ，其中 client_id 和 driver_id 是 Users 表中 users_id 的外键。</span><br><span class="line">status 是一个表示行程状态的枚举类型，枚举成员为(‘completed’, ‘cancelled_by_driver’, ‘cancelled_by_client’) 。</span><br><span class="line">表：Users</span><br><span class="line"></span><br><span class="line">+-------------+----------+</span><br><span class="line">| Column Name | Type     |</span><br><span class="line">+-------------+----------+</span><br><span class="line">| users_id    | int      |</span><br><span class="line">| banned      | enum     |</span><br><span class="line">| role        | enum     |</span><br><span class="line">+-------------+----------+</span><br><span class="line">users_id 是这张表的主键（具有唯一值的列）。</span><br><span class="line">这张表中存所有用户，每个用户都有一个唯一的 users_id ，role 是一个表示用户身份的枚举类型，枚举成员为 (‘client’, ‘driver’, ‘partner’) 。</span><br><span class="line">banned 是一个表示用户是否被禁止的枚举类型，枚举成员为 (‘Yes’, ‘No’) 。</span><br><span class="line">取消率 的计算方式如下：(被司机或乘客取消的非禁止用户生成的订单数量) / (非禁止用户生成的订单总数)。</span><br><span class="line"></span><br><span class="line">编写解决方案找出 &quot;2013-10-01&quot; 至 &quot;2013-10-03&quot; 期间有 至少 一次行程的非禁止用户（乘客和司机都必须未被禁止）的 取消率。非禁止用户即 banned 为 No 的用户，禁止用户即 banned 为 Yes 的用户。其中取消率 Cancellation Rate 需要四舍五入保留 两位小数 。</span><br><span class="line"></span><br><span class="line">返回结果表中的数据 无顺序要求 。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SELECT T.request_at AS `Day`, </span><br><span class="line">	ROUND(</span><br><span class="line">			SUM(</span><br><span class="line">				IF(T.STATUS = &#x27;completed&#x27;,0,1)</span><br><span class="line">			)</span><br><span class="line">			/ </span><br><span class="line">			COUNT(T.STATUS),</span><br><span class="line">			2</span><br><span class="line">	) AS `Cancellation Rate`</span><br><span class="line">FROM Trips AS T</span><br><span class="line">JOIN Users AS U1 ON (T.client_id = U1.users_id AND U1.banned =&#x27;No&#x27;)</span><br><span class="line">JOIN Users AS U2 ON (T.driver_id = U2.users_id AND U2.banned =&#x27;No&#x27;)</span><br><span class="line">WHERE T.request_at BETWEEN &#x27;2013-10-01&#x27; AND &#x27;2013-10-03&#x27;</span><br><span class="line">GROUP BY T.request_at</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">case when</span><br></pre></td></tr></table></figure>



<h5 id="avg精彩用法"><a href="#avg精彩用法" class="headerlink" title="avg精彩用法"></a>avg精彩用法</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 精彩</span><br><span class="line"># Write your MySQL query statement below</span><br><span class="line">SELECT</span><br><span class="line">    request_at as &#x27;Day&#x27;, round(avg(Status!=&#x27;completed&#x27;), 2) as &#x27;Cancellation Rate&#x27;</span><br><span class="line">FROM </span><br><span class="line">    trips t JOIN users u1 ON (t.client_id = u1.users_id AND u1.banned = &#x27;No&#x27;)</span><br><span class="line">    JOIN users u2 ON (t.driver_id = u2.users_id AND u2.banned = &#x27;No&#x27;)</span><br><span class="line">WHERE	</span><br><span class="line">    request_at BETWEEN &#x27;2013-10-01&#x27; AND &#x27;2013-10-03&#x27;</span><br><span class="line">GROUP BY </span><br><span class="line">    request_at</span><br></pre></td></tr></table></figure>

<h4 id="534-游戏玩法分析-III-sum-over-partition-by"><a href="#534-游戏玩法分析-III-sum-over-partition-by" class="headerlink" title="534.游戏玩法分析 III  sum() over(partition by"></a>534.游戏玩法分析 III  sum() over(partition by</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">表：Activity</span><br><span class="line"></span><br><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| player_id    | int     |</span><br><span class="line">| device_id    | int     |</span><br><span class="line">| event_date   | date    |</span><br><span class="line">| games_played | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">（player_id，event_date）是此表的主键（具有唯一值的列）。</span><br><span class="line">这张表显示了某些游戏的玩家的活动情况。</span><br><span class="line">每一行是一个玩家的记录，他在某一天使用某个设备注销之前登录并玩了很多游戏（可能是 0 ）。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">编写一个解决方案，同时报告每组玩家和日期，以及玩家到 目前为止 玩了多少游戏。也就是说，玩家在该日期之前所玩的游戏总数。详细情况请查看示例。</span><br><span class="line"></span><br><span class="line">以 任意顺序 返回结果表。</span><br><span class="line"></span><br><span class="line">结果格式如下所示。</span><br><span class="line"></span><br><span class="line">示例 1：</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Activity table:</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| player_id | device_id | event_date | games_played |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| 1         | 2         | 2016-03-01 | 5            |</span><br><span class="line">| 1         | 2         | 2016-05-02 | 6            |</span><br><span class="line">| 1         | 3         | 2017-06-25 | 1            |</span><br><span class="line">| 3         | 1         | 2016-03-02 | 0            |</span><br><span class="line">| 3         | 4         | 2018-07-03 | 5            |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">输出：</span><br><span class="line">+-----------+------------+---------------------+</span><br><span class="line">| player_id | event_date | games_played_so_far |</span><br><span class="line">+-----------+------------+---------------------+</span><br><span class="line">| 1         | 2016-03-01 | 5                   |</span><br><span class="line">| 1         | 2016-05-02 | 11                  |</span><br><span class="line">| 1         | 2017-06-25 | 12                  |</span><br><span class="line">| 3         | 2016-03-02 | 0                   |</span><br><span class="line">| 3         | 2018-07-03 | 5                   |</span><br><span class="line">+-----------+------------+---------------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- 方案一：</span><br><span class="line">select </span><br><span class="line">    a1.player_id,</span><br><span class="line">    a1.event_date,</span><br><span class="line">    sum(a2.games_played) as games_played_so_far</span><br><span class="line">from Activity a1</span><br><span class="line">join Activity a2</span><br><span class="line">on a1.player_id=a2.player_id and a1.event_date&gt;=a2.event_date  -- 关联当前时间之前的数据</span><br><span class="line">group by a1.player_id,a1.event_date;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-- 方案二：</span><br><span class="line">select</span><br><span class="line">    player_id,</span><br><span class="line">    event_date,</span><br><span class="line">    sum(games_played) over(partition by player_id order by event_date)  games_played_so_far </span><br><span class="line">from Activity;</span><br></pre></td></tr></table></figure>





<h4 id="难-569-游戏玩法分析-IV-partition-by-中位数"><a href="#难-569-游戏玩法分析-IV-partition-by-中位数" class="headerlink" title="难 569.游戏玩法分析 IV  partition by 中位数"></a>难 569.游戏玩法分析 IV  partition by 中位数</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202408121833571.png" alt="image-20240812183309415"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202408121833868.png" alt="image-20240812183353125"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SELECT Id, Company, salary</span><br><span class="line">FROM Employee</span><br><span class="line">WHERE Id in</span><br><span class="line">(SELECT E1.Id</span><br><span class="line">FROM Employee AS E1</span><br><span class="line">JOIN</span><br><span class="line">Employee AS E2 </span><br><span class="line">ON E1.company = E2.Company</span><br><span class="line">GROUP BY E1.Id</span><br><span class="line">HAVING SUM(IF(E1.Salary &gt;=E2.Salary,1,0))&gt;= COUNT(*)/ 2</span><br><span class="line">AND SUM(IF(E1.Salary&lt;=E2.salary,1,0))&gt;= COUNT(*)/ 2)</span><br><span class="line">GROUP BY Company,Salary</span><br><span class="line">ORDER BY Company</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">--方法一：</span><br><span class="line">--注意事项：排序时用row_number,会有排名相同的情况</span><br><span class="line">--中位数的逻辑了解：不论个数是奇数偶数，中位数在总数除以2和总数除以2加1之间</span><br><span class="line">select id ,company,salary</span><br><span class="line">from (</span><br><span class="line">    select *</span><br><span class="line">    ,row_number() over(partition by company order by salary) as rnk</span><br><span class="line">    ,count(*) over(partition by company ) as cnt</span><br><span class="line">    from Employee) a</span><br><span class="line">where  rnk BETWEEN cnt*1.0/2 AND cnt*1.0/2 + 1</span><br></pre></td></tr></table></figure>

<h4 id="难-571-给定数字的频率查询中位数"><a href="#难-571-给定数字的频率查询中位数" class="headerlink" title="难 571.给定数字的频率查询中位数"></a>难 571.给定数字的频率查询中位数</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Hello_JavaScript/article/details/103332960">参考</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Numbers 表保存数字的值及其频率。</span><br><span class="line"></span><br><span class="line">+----------+-------------+</span><br><span class="line">|  Number  |  Frequency  |</span><br><span class="line">+----------+-------------|</span><br><span class="line">|  0       |  7          |</span><br><span class="line">|  1       |  1          |</span><br><span class="line">|  2       |  3          |</span><br><span class="line">|  3       |  1          |</span><br><span class="line">+----------+-------------+</span><br><span class="line">在此表中，数字为 0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 3，所以中位数是 (0 + 0) / 2 = 0。</span><br><span class="line"></span><br><span class="line">+--------+</span><br><span class="line">| median |</span><br><span class="line">+--------|</span><br><span class="line">| 0.0000 |</span><br><span class="line">+--------+</span><br><span class="line">请编写一个查询来查找所有数字的中位数并将结果命名为 median 。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM </span><br><span class="line">(</span><br><span class="line">	SELECT N1.NUMBER, SUM(IF(N2.frequency IS NULL,0,N2.frequency)) AS `beg`</span><br><span class="line">	FROM numbers AS N1</span><br><span class="line">	LEFT JOIN numbers AS N2 ON (N1.NUMBER &gt; N2.NUMBER)</span><br><span class="line">	GROUP BY N1.number</span><br><span class="line">	ORDER BY N1.NUMBER</span><br><span class="line">) AS A</span><br><span class="line">JOIN </span><br><span class="line">(</span><br><span class="line">	SELECT N1.NUMBER, SUM(IF(N2.frequency IS NULL,0,N2.frequency)) AS `end`</span><br><span class="line">	FROM numbers AS N1</span><br><span class="line">	LEFT JOIN numbers AS N2 ON (N1.NUMBER &gt;= N2.NUMBER)</span><br><span class="line">	GROUP BY N1.number</span><br><span class="line">	ORDER BY N1.number</span><br><span class="line">) AS B</span><br><span class="line">	ON (A.NUMBER = B.NUMBER)</span><br><span class="line">JOIN </span><br><span class="line">(</span><br><span class="line">	SELECT FLOOR((SUM(N.frequency)-1)/2) AS `beg`, if(SUM(N.frequency)%2=1,0,1) AS `cnt`</span><br><span class="line">	FROM numbers AS N</span><br><span class="line">) AS C</span><br><span class="line">	ON (</span><br><span class="line">			(</span><br><span class="line">				(C.beg &lt;= A.beg AND A.beg &lt; (C.beg +C.cnt+1)) </span><br><span class="line">				OR </span><br><span class="line">				(C.beg &lt; B.END AND B.END &lt;= (C.beg +C.cnt+1))</span><br><span class="line">			)</span><br><span class="line">			OR</span><br><span class="line">			(</span><br><span class="line">				(A.beg &lt;= C.beg AND C.beg &lt; B.end) </span><br><span class="line">				OR </span><br><span class="line">				(A.beg &lt; (C.beg+C.cnt+1) AND (C.beg+C.cnt+1) &lt;= B.END)</span><br><span class="line">			)</span><br><span class="line">		)</span><br></pre></td></tr></table></figure>

<h4 id="578-查询回答率最高的问题"><a href="#578-查询回答率最高的问题" class="headerlink" title="578.查询回答率最高的问题"></a>578.查询回答率最高的问题</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">从 survey_log 表中获得回答率最高的问题，survey_log 表包含这些列：id, action, question_id, answer_id, q_num, timestamp。</span><br><span class="line"></span><br><span class="line">id 表示用户 id；action 有以下几种值：“show”，“answer”，“skip”；当 action 值为 “answer” 时 answer_id 非空，而 action 值为 “show” 或者 “skip” 时 answer_id 为空；q_num 表示当前会话中问题的编号。</span><br><span class="line"></span><br><span class="line">请编写 SQL 查询来找到具有最高回答率的问题。</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cloudflare-imgbed-bhx.pages.de/file/1750147571861_6787-20250617-image-20250617160608623.png" alt="image-20250617160608623"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select question_id</span><br><span class="line">from (</span><br><span class="line">    select question_id,</span><br><span class="line">            sum(if(action=&#x27;answer&#x27;,1,0)) as ans_num,</span><br><span class="line">        sum(if(action=&#x27;show&#x27;,1,0)) as cout_num</span><br><span class="line">    from survey_log</span><br><span class="line">    group by question_id</span><br><span class="line">) as temp</span><br><span class="line">order by ans_num / cout_num desc</span><br><span class="line">limit 1;</span><br></pre></td></tr></table></figure>

<h4 id="579-查询员工的累计薪水"><a href="#579-查询员工的累计薪水" class="headerlink" title="579.查询员工的累计薪水"></a>579.查询员工的累计薪水</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Employee 表保存了一年内的薪水信息。</span><br><span class="line"></span><br><span class="line">请你编写 SQL 语句，对于每个员工，查询他除最近一个月（即最大月）之外，剩下每个月的近三个月的累计薪水（不足三个月也要计算）。</span><br><span class="line"></span><br><span class="line">结果请按 Id 升序，然后按 Month 降序显示。</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cloudflare-imgbed-bhx.pages.de/file/1750149791698_44f2-20250617-image-20250617164258892.png" alt="image-20250617164258892"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    temp.Id,</span><br><span class="line">    temp.Month,</span><br><span class="line">    sum( temp.Salary ) over ( PARTITION BY temp.Id ORDER BY temp.Month ) AS salary</span><br><span class="line">FROM</span><br><span class="line">    ( SELECT Id, Month, Salary, DENSE_RANK() over ( PARTITION BY Id ORDER BY Month DESC ) AS rnk FROM employee_579 ) AS temp</span><br><span class="line">WHERE</span><br><span class="line">    temp.rnk &gt; 1</span><br><span class="line">ORDER BY</span><br><span class="line">    temp.Id,</span><br><span class="line">    temp.Month DESC;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">with tmp as(</span><br><span class="line">select</span><br><span class="line">    *,</span><br><span class="line">    rank() over(partition by id order by month desc) as rn</span><br><span class="line">from Employee</span><br><span class="line">)</span><br><span class="line">select id,month,</span><br><span class="line">    sum(salary) over(partition by id order by month range between 2 preceding and current row) as salary</span><br><span class="line"> from tmp</span><br><span class="line"> where rn != 1</span><br><span class="line"> order by id ,month desc;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT t.id, t.`month`, t.salary FROM</span><br><span class="line">(</span><br><span class="line"> SELECT id, `month`, </span><br><span class="line"> SUM(salary) over(PARTITION BY id ORDER BY `month` ROWS 2 PRECEDING) salary, -- 累加的总薪水</span><br><span class="line"> rank() over(PARTITION BY id ORDER BY `month` DESC) ranks   -- 排名好去掉最近一个月</span><br><span class="line"> FROM employee</span><br><span class="line">) t</span><br><span class="line">WHERE t.ranks &gt; 1</span><br></pre></td></tr></table></figure>

<h4 id="580-统计各专业学生人数"><a href="#580-统计各专业学生人数" class="headerlink" title="580.统计各专业学生人数"></a>580.统计各专业学生人数</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">题目描述</span><br><span class="line">表: Student</span><br><span class="line"></span><br><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| student_id   | int     |</span><br><span class="line">| student_name | varchar |</span><br><span class="line">| gender       | varchar |</span><br><span class="line">| dept_id      | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">student_id 是该表的主键（具有唯一值的列）。</span><br><span class="line">dept_id是Department表中dept_id的外键。</span><br><span class="line">该表的每一行都表示学生的姓名、性别和所属系的id。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">表: Department</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| dept_id     | int     |</span><br><span class="line">| dept_name   | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">dept_id是该表的主键（具有唯一值的列）。</span><br><span class="line">该表的每一行包含一个部门的id和名称。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写解决方案，为 Department 表中的所有部门(甚至是没有当前学生的部门)报告各自的部门名称和每个部门的学生人数。</span><br><span class="line"></span><br><span class="line">按 student_number 降序 返回结果表。如果是平局，则按 dept_name 的  字母顺序 排序。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">SELECT dept_name, COUNT(student_id) AS student_number</span><br><span class="line">FROM</span><br><span class="line">    Department</span><br><span class="line">    LEFT JOIN Student USING (dept_id)</span><br><span class="line">GROUP BY dept_id</span><br><span class="line">ORDER BY 2 DESC, 1;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">count(null)=0，所以不用判断</span><br></pre></td></tr></table></figure>

<h4 id="585-2016年的投资"><a href="#585-2016年的投资" class="headerlink" title="585.2016年的投资"></a>585.2016年的投资</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Insurance 表：</span><br><span class="line"></span><br><span class="line">+-------------+-------+</span><br><span class="line">| Column Name | Type  |</span><br><span class="line">+-------------+-------+</span><br><span class="line">| pid         | int   |</span><br><span class="line">| tiv_2015    | float |</span><br><span class="line">| tiv_2016    | float |</span><br><span class="line">| lat         | float |</span><br><span class="line">| lon         | float |</span><br><span class="line">+-------------+-------+</span><br><span class="line">pid 是这张表的主键(具有唯一值的列)。</span><br><span class="line">表中的每一行都包含一条保险信息，其中：</span><br><span class="line">pid 是投保人的投保编号。</span><br><span class="line">tiv_2015 是该投保人在 2015 年的总投保金额，tiv_2016 是该投保人在 2016 年的总投保金额。</span><br><span class="line">lat 是投保人所在城市的纬度。题目数据确保 lat 不为空。</span><br><span class="line">lon 是投保人所在城市的经度。题目数据确保 lon 不为空。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写解决方案报告 2016 年 (tiv_2016) 所有满足下述条件的投保人的投保金额之和：</span><br><span class="line"></span><br><span class="line">他在 2015 年的投保额 (tiv_2015) 至少跟一个其他投保人在 2015 年的投保额相同。</span><br><span class="line">他所在的城市必须与其他投保人都不同（也就是说 (lat, lon) 不能跟其他任何一个投保人完全相同）。</span><br><span class="line">tiv_2016 四舍五入的 两位小数 。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">select round(sum(tiv_2016),2) tiv_2016 </span><br><span class="line">from</span><br><span class="line">(select e1.pid pid,e1.tiv_2016</span><br><span class="line">from Insurance e1,Insurance e2</span><br><span class="line">where e1.tiv_2015=e2.tiv_2015 and e1.pid != e2.pid</span><br><span class="line">group by e1.pid</span><br><span class="line">having count(*)&gt;0</span><br><span class="line">) t1</span><br><span class="line">where pid not in</span><br><span class="line">(select e1.pid</span><br><span class="line">from Insurance e1,Insurance e2</span><br><span class="line">where e1.lat =e2.lat and e1.lon =e2.lon and e1.pid != e2.pid)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SELECT ROUND(SUM(tiv_2016), 2) AS tiv_2016</span><br><span class="line">FROM Insurance</span><br><span class="line">WHERE tiv_2015 IN (</span><br><span class="line">    SELECT tiv_2015</span><br><span class="line">    FROM Insurance</span><br><span class="line">    GROUP BY tiv_2015</span><br><span class="line">    HAVING COUNT(*) &gt; 1</span><br><span class="line">)</span><br><span class="line">AND (lat, lon) NOT IN (</span><br><span class="line">    SELECT lat, lon</span><br><span class="line">    FROM Insurance</span><br><span class="line">    GROUP BY lat, lon</span><br><span class="line">    HAVING COUNT(*) &gt; 1</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="597-好友申请1-总体通过率"><a href="#597-好友申请1-总体通过率" class="headerlink" title="597.好友申请1:总体通过率"></a>597.好友申请1:总体通过率</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">表：FriendRequest</span><br><span class="line"></span><br><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| sender_id      | int     |</span><br><span class="line">| send_to_id     | int     |</span><br><span class="line">| request_date   | date    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">该表可能包含重复项（换句话说，在SQL中，该表没有主键）。</span><br><span class="line">该表包含发送请求的用户的 ID ，接受请求的用户的 ID 以及请求的日期。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">表：RequestAccepted</span><br><span class="line"></span><br><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| requester_id   | int     |</span><br><span class="line">| accepter_id    | int     |</span><br><span class="line">| accept_date    | date    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">该表可能包含重复项（换句话说，在SQL中，该表没有主键）。</span><br><span class="line">该表包含发送请求的用户的 ID ，接受请求的用户的 ID 以及请求通过的日期。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">求出好友申请的通过率，用 2 位小数表示。通过率由接受好友申请的数目除以申请总数。</span><br><span class="line"></span><br><span class="line">提示：</span><br><span class="line"></span><br><span class="line">通过的好友申请不一定都在表 friend_request 中。你只需要统计总的被通过的申请数（不管它们在不在表 FriendRequest 中），并将它除以申请总数，得到通过率</span><br><span class="line">一个好友申请发送者有可能会给接受者发几条好友申请，也有可能一个好友申请会被通过好几次。这种情况下，重复的好友申请只统计一次。</span><br><span class="line">如果一个好友申请都没有，你应该返回 accept_rate 为 0.00 。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">SELECT</span><br><span class="line">    ROUND(</span><br><span class="line">        IFNULL(</span><br><span class="line">            (</span><br><span class="line">                SELECT COUNT(DISTINCT requester_id, accepter_id)</span><br><span class="line">                FROM RequestAccepted</span><br><span class="line">            ) / (SELECT COUNT(DISTINCT sender_id, send_to_id) FROM FriendRequest),</span><br><span class="line">            0</span><br><span class="line">        ),</span><br><span class="line">        2</span><br><span class="line">    ) AS accept_rate;</span><br></pre></td></tr></table></figure>





<h4 id="601-体育馆的人流量-lag-lead-leaset"><a href="#601-体育馆的人流量-lag-lead-leaset" class="headerlink" title="601.体育馆的人流量  lag() lead() leaset()"></a>601.体育馆的人流量  lag() lead() leaset()</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">with people as</span><br><span class="line">(</span><br><span class="line">    select id, visit_date, people,</span><br><span class="line">    Lag(people,2) over(order by id) as pprvPeople,</span><br><span class="line">    Lag(people,1) over(order by id) as prvPeople,</span><br><span class="line">    Lead(people,1) over(order by id) as nextPeople,</span><br><span class="line">    Lead(people,2) over(order by id) as nnextPeople</span><br><span class="line">    from stadium</span><br><span class="line">)</span><br><span class="line">select id, visit_date, people from people</span><br><span class="line">where </span><br><span class="line">(people &gt;= 100 and prvPeople&gt;=100 and pprvPeople&gt;=100) ||</span><br><span class="line">(people &gt;= 100 and nextPeople&gt;=100 and nnextPeople&gt;=100) ||</span><br><span class="line">(people &gt;= 100 and nextPeople&gt;=100 and prvPeople&gt;=100) </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select distinct s1.*</span><br><span class="line">from stadium s1, stadium s2, stadium s3</span><br><span class="line">where s1.people &gt;= 100 and s2.people&gt;= 100 and s3.people &gt;= 100</span><br><span class="line">and</span><br><span class="line">(</span><br><span class="line">    (s1.id - s2.id = 1 and s2.id - s3.id =1)</span><br><span class="line">   or</span><br><span class="line">   (s2.id - s1.id = 1 and s1.id - s3.id =1) </span><br><span class="line">   or</span><br><span class="line">   (s3.id - s2.id = 1 and s2.id - s1.id = 1) </span><br><span class="line">) order by s1.id;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select id, visit_date, people</span><br><span class="line">from </span><br><span class="line">(select id, visit_date, people,</span><br><span class="line">lag(people, 1, 0) over(order by id) as previous1_num,</span><br><span class="line">lag(people, 2, 0) over(order by id) as previous2_num,</span><br><span class="line">lead(people, 1, 0) over(order by id) as next1_num,</span><br><span class="line">lead(people, 2, 0) over(order by id) as next2_num</span><br><span class="line">from Stadium) a</span><br><span class="line">where least(a.people, a.previous1_num, a.previous2_num)&gt;=100</span><br><span class="line">or least(a.people, a.next1_num, a.next2_num)&gt;=100</span><br><span class="line">or least(a.people, a.next1_num, a.previous1_num)&gt;=100</span><br></pre></td></tr></table></figure>



<h4 id="602-case-when"><a href="#602-case-when" class="headerlink" title="602 case when"></a>602 case when</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select case when requester_id is not null then requester_id else accepter_id end  as id, if(c1 is null,0,c1)+if(c2 is null,0,c2) as num</span><br><span class="line">from</span><br><span class="line">(select requester_id,count(*) c1</span><br><span class="line">from RequestAccepted </span><br><span class="line">group by requester_id) t1 </span><br><span class="line">left join </span><br><span class="line">(select accepter_id,count(*) c2 </span><br><span class="line">from RequestAccepted </span><br><span class="line">group by accepter_id) t2</span><br><span class="line">on t1.requester_id=t2.accepter_id</span><br><span class="line">order by num desc limit 1</span><br></pre></td></tr></table></figure>

<h4 id="603-连续空余座位-lag-lead-ROWS-BETWEEN-AND"><a href="#603-连续空余座位-lag-lead-ROWS-BETWEEN-AND" class="headerlink" title="603.连续空余座位 lag lead  ROWS BETWEEN  AND"></a>603.连续空余座位 lag lead  ROWS BETWEEN  AND</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">表: Cinema</span><br><span class="line"></span><br><span class="line">+-------------+------+</span><br><span class="line">| Column Name | Type |</span><br><span class="line">+-------------+------+</span><br><span class="line">| seat_id     | int  |</span><br><span class="line">| free        | bool |</span><br><span class="line">+-------------+------+</span><br><span class="line">Seat_id 是该表的自动递增主键列。</span><br><span class="line">在 PostgreSQL 中，free 存储为整数。请使用 ::boolean 将其转换为布尔格式。</span><br><span class="line">该表的每一行表示第 i 个座位是否空闲。1 表示空闲，0 表示被占用。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">查找电影院所有连续可用的座位。</span><br><span class="line"></span><br><span class="line">返回按 seat_id 升序排序 的结果表。</span><br><span class="line"></span><br><span class="line">测试用例的生成使得两个以上的座位连续可用。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">WITH</span><br><span class="line">    T AS (</span><br><span class="line">        SELECT</span><br><span class="line">            seat_id,</span><br><span class="line">            (free + (LAG(free) OVER (ORDER BY seat_id))) AS a,</span><br><span class="line">            (free + (LEAD(free) OVER (ORDER BY seat_id))) AS b</span><br><span class="line">        FROM Cinema</span><br><span class="line">    )</span><br><span class="line">SELECT seat_id</span><br><span class="line">FROM T</span><br><span class="line">WHERE a = 2 OR b = 2;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">WITH</span><br><span class="line">    T AS (</span><br><span class="line">        SELECT</span><br><span class="line">            *,</span><br><span class="line">            SUM(free = 1) OVER (</span><br><span class="line">                ORDER BY seat_id</span><br><span class="line">                ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING</span><br><span class="line">            ) AS cnt</span><br><span class="line">        FROM Cinema</span><br><span class="line">    )</span><br><span class="line">SELECT seat_id</span><br><span class="line">FROM T</span><br><span class="line">WHERE free = 1 AND cnt &gt; 1</span><br><span class="line">ORDER BY 1;</span><br></pre></td></tr></table></figure>



<h4 id="608-union"><a href="#608-union" class="headerlink" title="608 union"></a>608 union</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">select id,&#x27;Root&#x27; as type</span><br><span class="line">from Tree</span><br><span class="line">where p_id is null</span><br><span class="line">union</span><br><span class="line">select id,&#x27;Inner&#x27; as type</span><br><span class="line">from Tree</span><br><span class="line">where p_id is not null and id not in(</span><br><span class="line">select t2.id</span><br><span class="line">from Tree t1 </span><br><span class="line">right join Tree t2</span><br><span class="line">on t1.p_id=t2.id</span><br><span class="line">where t1.id is null and t2.id is not null and t2.p_id is not null)</span><br><span class="line">union</span><br><span class="line">select t2.id, &#x27;Leaf&#x27; as type</span><br><span class="line">from Tree t1 </span><br><span class="line">right join Tree t2</span><br><span class="line">on t1.p_id=t2.id</span><br><span class="line">where t1.id is null and t2.id is not null and t2.p_id is not null</span><br></pre></td></tr></table></figure>

<h4 id="610-判断三角形"><a href="#610-判断三角形" class="headerlink" title="610.判断三角形"></a>610.判断三角形</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">表: Triangle</span><br><span class="line"></span><br><span class="line">+-------------+------+</span><br><span class="line">| Column Name | Type |</span><br><span class="line">+-------------+------+</span><br><span class="line">| x           | int  |</span><br><span class="line">| y           | int  |</span><br><span class="line">| z           | int  |</span><br><span class="line">+-------------+------+</span><br><span class="line">在 SQL 中，(x, y, z)是该表的主键列。</span><br><span class="line">该表的每一行包含三个线段的长度。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">对每三个线段报告它们是否可以形成一个三角形。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"></span><br><span class="line">select x,y,z,case when x+y&gt;z and x+z&gt;y and y+z&gt;x then &#x27;Yes&#x27; else &#x27;No&#x27; end as triangle</span><br><span class="line">from Triangle</span><br></pre></td></tr></table></figure>

<h4 id="614-二级关注者"><a href="#614-二级关注者" class="headerlink" title="614.二级关注者"></a>614.二级关注者</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">表：Follow</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| followee    | varchar |</span><br><span class="line">| follower    | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">(followee, follower) 是该表的主键(具有唯一值的列的组合)。</span><br><span class="line">该表的每一行表示关注者关注了社交网络上的被关注者。</span><br><span class="line">不会有用户关注他们自己。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">二级关注者 是指满足以下条件的用户:</span><br><span class="line"></span><br><span class="line">关注至少一个用户，</span><br><span class="line">被至少一个用户关注。</span><br><span class="line">编写一个解决方案来报告 二级用户 及其关注者的数量。</span><br><span class="line"></span><br><span class="line">返回按 follower 字典序排序 的结果表。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select followee follower,count(*) num</span><br><span class="line">from Follow f1</span><br><span class="line">where f1.follower in </span><br><span class="line">(</span><br><span class="line">select distint f2.follower</span><br><span class="line">from Follow f2</span><br><span class="line">)</span><br><span class="line">group by followee</span><br></pre></td></tr></table></figure>

<h4 id="615-平均工资-部门与公司比较"><a href="#615-平均工资-部门与公司比较" class="headerlink" title="615.平均工资:部门与公司比较"></a>615.平均工资:部门与公司比较</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">表：Salary</span><br><span class="line"></span><br><span class="line">+-------------+------+</span><br><span class="line">| 列名        | 类型 |</span><br><span class="line">+-------------+------+</span><br><span class="line">| id          | int  |</span><br><span class="line">| employee_id | int  |</span><br><span class="line">| amount      | int  |</span><br><span class="line">| pay_date    | date |</span><br><span class="line">+-------------+------+</span><br><span class="line">在 SQL 中，id 是该表的主键列。</span><br><span class="line">该表的每一行表示一个员工一个月的薪资。</span><br><span class="line">employee_id 是来自 Employee 表的外键（reference 列）。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">表： Employee</span><br><span class="line"></span><br><span class="line">+---------------+------+</span><br><span class="line">| 列名          | 类型 |</span><br><span class="line">+---------------+------+</span><br><span class="line">| employee_id   | int  |</span><br><span class="line">| department_id | int  |</span><br><span class="line">+---------------+------+</span><br><span class="line">在 SQL 中，employee_id 是该表的主键列。</span><br><span class="line">该表的每一行表示一个员工所属的部门。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">找出各个部门员工的平均薪资与公司平均薪资之间的比较结果（更高 / 更低 / 相同）。每月每个部门的平均工资和每月公司平均工资比较</span><br><span class="line"></span><br><span class="line">以 任意顺序 返回结果表。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">好像两个group by 两个select 再连接 就可以了吧</span><br></pre></td></tr></table></figure>

<h4 id="618-学生地理信息报告-行转列"><a href="#618-学生地理信息报告-行转列" class="headerlink" title="618.学生地理信息报告 行转列"></a>618.学生地理信息报告 行转列</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">表： student </span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| name        | varchar |</span><br><span class="line">| continent   | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">该表可能包含重复的行。</span><br><span class="line">该表的每一行表示学生的名字和他们来自的大陆。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">一所学校有来自亚洲、欧洲和美洲的学生。</span><br><span class="line"></span><br><span class="line">编写解决方案实现对大洲（continent）列的 透视表 操作，使得每个学生按照姓名的字母顺序依次排列在对应的大洲下面。输出的标题应依次为美洲（America）、亚洲（Asia）和欧洲（Europe）。</span><br><span class="line"></span><br><span class="line">测试用例的生成保证来自美国的学生人数不少于亚洲或欧洲的学生人数。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    IF(continent = &#x27;America&#x27;, name, NULL) AS &#x27;America&#x27;,</span><br><span class="line">    IF(continent = &#x27;Asia&#x27;, name, NULL) AS &#x27;Asia&#x27;,</span><br><span class="line">    IF(continent = &#x27;Europe&#x27;, name, NULL) AS &#x27;Europe&#x27;</span><br><span class="line">FROM student</span><br><span class="line"></span><br><span class="line">要排序的话提前对student里面的name字段排序就可以了</span><br></pre></td></tr></table></figure>

<h4 id="626-换座位-换序号"><a href="#626-换座位-换序号" class="headerlink" title="626.换座位 换序号"></a>626.换座位 换序号</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">表: Seat</span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| id          | int     |</span><br><span class="line">| student     | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">id 是该表的主键（唯一值）列。</span><br><span class="line">该表的每一行都表示学生的姓名和 ID。</span><br><span class="line">ID 序列始终从 1 开始并连续增加。</span><br><span class="line"></span><br><span class="line">编写解决方案来交换每两个连续的学生的座位号。如果学生的数量是奇数，则最后一个学生的id不交换。</span><br><span class="line">按 id 升序 返回结果表。</span><br><span class="line">查询结果格式如下所示。</span><br><span class="line"></span><br><span class="line">示例 1:</span><br><span class="line">输入: </span><br><span class="line">Seat 表:</span><br><span class="line">+----+---------+</span><br><span class="line">| id | student |</span><br><span class="line">+----+---------+</span><br><span class="line">| 1  | Abbot   |</span><br><span class="line">| 2  | Doris   |</span><br><span class="line">| 3  | Emerson |</span><br><span class="line">| 4  | Green   |</span><br><span class="line">| 5  | Jeames  |</span><br><span class="line">+----+---------+</span><br><span class="line">输出: </span><br><span class="line">+----+---------+</span><br><span class="line">| id | student |</span><br><span class="line">+----+---------+</span><br><span class="line">| 1  | Doris   |</span><br><span class="line">| 2  | Abbot   |</span><br><span class="line">| 3  | Green   |</span><br><span class="line">| 4  | Emerson |</span><br><span class="line">| 5  | Jeames  |</span><br><span class="line">+----+---------+</span><br><span class="line">解释:</span><br><span class="line">请注意，如果学生人数为奇数，则不需要更换最后一名学生的座位。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select if(id=count(*)+1,id-1,id) id,student</span><br><span class="line">from </span><br><span class="line">(select id-1 id,student</span><br><span class="line">from student</span><br><span class="line">where id%2=0)</span><br><span class="line">union</span><br><span class="line">(select id+1 id,student</span><br><span class="line">from student </span><br><span class="line">where id%2=1) u</span><br><span class="line">order by id</span><br></pre></td></tr></table></figure>

<h4 id="627-变更性别-update-replace"><a href="#627-变更性别-update-replace" class="headerlink" title="627.变更性别 update replace"></a>627.变更性别 update replace</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Salary 表：</span><br><span class="line"></span><br><span class="line">+-------------+----------+</span><br><span class="line">| Column Name | Type     |</span><br><span class="line">+-------------+----------+</span><br><span class="line">| id          | int      |</span><br><span class="line">| name        | varchar  |</span><br><span class="line">| sex         | ENUM     |</span><br><span class="line">| salary      | int      |</span><br><span class="line">+-------------+----------+</span><br><span class="line">id 是这个表的主键（具有唯一值的列）。</span><br><span class="line">sex 这一列的值是 ENUM 类型，只能从 (&#x27;m&#x27;, &#x27;f&#x27;) 中取。</span><br><span class="line">本表包含公司雇员的信息。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">请你编写一个解决方案来交换所有的 &#x27;f&#x27; 和 &#x27;m&#x27; （即，将所有 &#x27;f&#x27; 变为 &#x27;m&#x27; ，反之亦然），仅使用 单个 update 语句 ，且不产生中间临时表。</span><br><span class="line"></span><br><span class="line">注意，你必须仅使用一条 update 语句，且 不能 使用 select 语句。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 1.</span><br><span class="line">update salary</span><br><span class="line">set sex = (</span><br><span class="line">    case sex when &#x27;m&#x27; then &#x27;f&#x27; else &#x27;m&#x27; end</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 2.</span><br><span class="line">update salary set sex = if(sex=&#x27;m&#x27;,&#x27;f&#x27;,&#x27;m&#x27;);</span><br><span class="line"></span><br><span class="line"># 3.</span><br><span class="line">update salary set sex = char(ascii(&#x27;m&#x27;) + ascii(&#x27;f&#x27;) - ascii(sex));</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">update Salary</span><br><span class="line">set sex = replace(&quot;mf&quot;, sex, &quot;&quot;);</span><br><span class="line"></span><br><span class="line">相当于把&quot;mf&quot;中与sex相同的换为空字符串，也就是删除了，剩下的是对立的性别</span><br></pre></td></tr></table></figure>



<h4 id="1070-产品销售分析-川"><a href="#1070-产品销售分析-川" class="headerlink" title="1070.产品销售分析 川"></a>1070.产品销售分析 川</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select product_id,year as first_year,quantity,price</span><br><span class="line">from(</span><br><span class="line">select product_id,year,quantity,price,ROW_NUMBER() over(partition by product_id order by year) as r</span><br><span class="line">from Sales</span><br><span class="line">) t</span><br><span class="line">where t.r=1</span><br></pre></td></tr></table></figure>

<h4 id="1083-销售分析-sum-表达式"><a href="#1083-销售分析-sum-表达式" class="headerlink" title="1083.销售分析 | sum(表达式)"></a>1083.销售分析 | sum(表达式)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">表：Product</span><br><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| product_id   | int     |</span><br><span class="line">| product_name | varchar |</span><br><span class="line">| unit_price   | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">Product_id 是该表的主键(具有唯一值的列)。</span><br><span class="line">该表的每一行表示每种产品的名称和价格。</span><br><span class="line">表：Sales</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| seller_id   | int     |</span><br><span class="line">| product_id  | int     |</span><br><span class="line">| buyer_id    | int     |</span><br><span class="line">| sale_date   | date    |</span><br><span class="line">| quantity    | int     |</span><br><span class="line">| price       | int     |</span><br><span class="line">+------ ------+---------+</span><br><span class="line">这个表可能有重复的行。</span><br><span class="line">product_id 是 Product 表的外键(reference 列)。</span><br><span class="line">buyer_id 永远不会是 NULL。</span><br><span class="line">sale_date 永远不会是 NULL。</span><br><span class="line">该表的每一行都包含一次销售的一些信息。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写一个解决方案，报告那些买了 S8 而没有买 iPhone 的 买家。注意，S8 和 iPhone 是 Product 表中显示的产品。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">SELECT buyer_id</span><br><span class="line">FROM</span><br><span class="line">    Sales</span><br><span class="line">    JOIN Product USING (product_id)</span><br><span class="line">GROUP BY 1</span><br><span class="line">HAVING SUM(product_name = &#x27;S8&#x27;) &gt; 0 AND SUM(product_name = &#x27;iPhone&#x27;) = 0;</span><br></pre></td></tr></table></figure>

<h4 id="1097-游戏玩法分析-V-MIN-OVER-PARTITION-BY"><a href="#1097-游戏玩法分析-V-MIN-OVER-PARTITION-BY" class="headerlink" title="1097.游戏玩法分析 V  MIN() OVER (PARTITION BY"></a>1097.游戏玩法分析 V  MIN() OVER (PARTITION BY</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">表：Activity </span><br><span class="line"></span><br><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| player_id    | int     |</span><br><span class="line">| device_id    | int     |</span><br><span class="line">| event_date   | date    |</span><br><span class="line">| games_played | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">（player_id，event_date）是此表的主键(具有唯一值的列的组合)</span><br><span class="line">这张表显示了某些游戏的玩家的活动情况</span><br><span class="line">每一行表示一个玩家的记录，在某一天使用某个设备注销之前，登录并玩了很多游戏（可能是 0）</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">玩家的 安装日期 定义为该玩家的第一个登录日。</span><br><span class="line"></span><br><span class="line">我们将日期 x 的 第一天留存率 定义为：假定安装日期为 X 的玩家的数量为 N ，其中在 X 之后的一天重新登录的玩家数量为 M，M/N 就是第一天留存率，四舍五入到小数点后两位。</span><br><span class="line"></span><br><span class="line">编写解决方案，报告所有安装日期、当天安装游戏的玩家数量和玩家的 第一天留存率。</span><br><span class="line"></span><br><span class="line">以 任意顺序 返回结果表。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">with t as(</span><br><span class="line">select player_id,min(event_date)</span><br><span class="line">from Activity</span><br><span class="line">group by player_id</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">select t.event_date install_dt,count(*) installs,count(a.player_id)/ count(*) Day1_retention </span><br><span class="line">from t left join Activity a</span><br><span class="line">on t.player_id = a.player_id and DATEDIFF(t.event_date,a.event_date)=1</span><br><span class="line">group by t.event_date</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">WITH</span><br><span class="line">    T AS (</span><br><span class="line">        SELECT</span><br><span class="line">            player_id,</span><br><span class="line">            event_date,</span><br><span class="line">            MIN(event_date) OVER (PARTITION BY player_id) AS install_dt</span><br><span class="line">        FROM Activity</span><br><span class="line">    )</span><br><span class="line">SELECT</span><br><span class="line">    install_dt,</span><br><span class="line">    COUNT(DISTINCT player_id) AS installs,</span><br><span class="line">    ROUND(</span><br><span class="line">        SUM(DATEDIFF(event_date, install_dt) = 1) / COUNT(DISTINCT player_id),</span><br><span class="line">        2</span><br><span class="line">    ) AS day1_retention</span><br><span class="line">FROM T</span><br><span class="line">GROUP BY 2;</span><br></pre></td></tr></table></figure>

<h4 id="1098-小众书籍"><a href="#1098-小众书籍" class="headerlink" title="1098.小众书籍"></a>1098.小众书籍</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">书籍表 Books：</span><br><span class="line"></span><br><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| book_id        | int     |</span><br><span class="line">| name           | varchar |</span><br><span class="line">| available_from | date    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">book_id 是这个表的主键（具有唯一值的列）。</span><br><span class="line">订单表 Orders：</span><br><span class="line"></span><br><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| order_id       | int     |</span><br><span class="line">| book_id        | int     |</span><br><span class="line">| quantity       | int     |</span><br><span class="line">| dispatch_date  | date    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">order_id 是这个表的主键（具有唯一值的列）。</span><br><span class="line">book_id  是 Books 表的外键（reference 列）。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写解决方案，筛选出过去一年中订单总量 少于 10 本 的 书籍，并且 不考虑 上架距今销售 不满一个月 的书籍 。假设今天是 2019-06-23 。</span><br><span class="line"></span><br><span class="line">返回结果表 无顺序要求 。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">SELECT book_id, name</span><br><span class="line">FROM</span><br><span class="line">    Books</span><br><span class="line">    LEFT JOIN Orders USING (book_id)</span><br><span class="line">WHERE available_from &lt; &#x27;2019-05-23&#x27;</span><br><span class="line">GROUP BY 1</span><br><span class="line">HAVING SUM(IF(dispatch_date &gt;= &#x27;2018-06-23&#x27;, quantity, 0)) &lt; 10;</span><br></pre></td></tr></table></figure>

<h4 id="1107-每日新用户统计-MIN-OVER-PARTITION-BY"><a href="#1107-每日新用户统计-MIN-OVER-PARTITION-BY" class="headerlink" title="1107.每日新用户统计 MIN() OVER (PARTITION BY"></a>1107.每日新用户统计 MIN() OVER (PARTITION BY</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Traffic 表：</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| activity      | enum    |</span><br><span class="line">| activity_date | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">该表可能有重复的行。</span><br><span class="line">activity 列是 ENUM 类型，可能取 (&#x27;login&#x27;, &#x27;logout&#x27;, &#x27;jobs&#x27;, &#x27;groups&#x27;, &#x27;homepage&#x27;) 几个值之一。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写解决方案，找出从今天起最多 90 天内，每个日期该日期首次登录的用户数。假设今天是 2019-06-30 。</span><br><span class="line"></span><br><span class="line">以 任意顺序 返回结果表。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">with t as(</span><br><span class="line">select user_id,min(activity_date) time</span><br><span class="line">from Traffic</span><br><span class="line">where DATEDIFF(&#x27;2019-06-30&#x27;, activity_date) &lt;= 90 and activity=&#x27;login&#x27;</span><br><span class="line">group by user_id</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">select time login_date,count(*) user_count  </span><br><span class="line">from t</span><br><span class="line">group by time</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">WITH</span><br><span class="line">    T AS (</span><br><span class="line">        SELECT</span><br><span class="line">            user_id,</span><br><span class="line">            MIN(activity_date) OVER (PARTITION BY user_id) AS login_date</span><br><span class="line">        FROM Traffic</span><br><span class="line">        WHERE activity = &#x27;login&#x27;</span><br><span class="line">    )</span><br><span class="line">SELECT login_date, COUNT(DISTINCT user_id) AS user_count</span><br><span class="line">FROM T</span><br><span class="line">WHERE DATEDIFF(&#x27;2019-06-30&#x27;, login_date) &lt;= 90</span><br><span class="line">GROUP BY 2;</span><br></pre></td></tr></table></figure>

<h4 id="1127-用户购买平台"><a href="#1127-用户购买平台" class="headerlink" title="1127.用户购买平台"></a>1127.用户购买平台</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">支出表: Spending</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| user_id     | int     |</span><br><span class="line">| spend_date  | date    |</span><br><span class="line">| platform    | enum    | </span><br><span class="line">| amount      | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">这张表记录了用户在一个在线购物网站的支出历史，该在线购物平台同时拥有桌面端（&#x27;desktop&#x27;）和手机端（&#x27;mobile&#x27;）的应用程序。</span><br><span class="line">(user_id, spend_date, platform) 是这张表的主键(具有唯一值的列的组合)。</span><br><span class="line">平台列 platform 是一种 ENUM ，类型为（&#x27;desktop&#x27;, &#x27;mobile&#x27;）。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写解决方案找出每天 仅 使用手机端用户、仅 使用桌面端用户和 同时 使用桌面端和手机端的用户人数和总支出金额。</span><br><span class="line"></span><br><span class="line">以 任意顺序 返回结果表。</span><br><span class="line"></span><br><span class="line">示例 1：</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Spending table:</span><br><span class="line">+---------+------------+----------+--------+</span><br><span class="line">| user_id | spend_date | platform | amount |</span><br><span class="line">+---------+------------+----------+--------+</span><br><span class="line">| 1       | 2019-07-01 | mobile   | 100    |</span><br><span class="line">| 1       | 2019-07-01 | desktop  | 100    |</span><br><span class="line">| 2       | 2019-07-01 | mobile   | 100    |</span><br><span class="line">| 2       | 2019-07-02 | mobile   | 100    |</span><br><span class="line">| 3       | 2019-07-01 | desktop  | 100    |</span><br><span class="line">| 3       | 2019-07-02 | desktop  | 100    |</span><br><span class="line">+---------+------------+----------+--------+</span><br><span class="line">输出：</span><br><span class="line">+------------+----------+--------------+-------------+</span><br><span class="line">| spend_date | platform | total_amount | total_users |</span><br><span class="line">+------------+----------+--------------+-------------+</span><br><span class="line">| 2019-07-01 | desktop  | 100          | 1           |</span><br><span class="line">| 2019-07-01 | mobile   | 100          | 1           |</span><br><span class="line">| 2019-07-01 | both     | 200          | 1           |</span><br><span class="line">| 2019-07-02 | desktop  | 100          | 1           |</span><br><span class="line">| 2019-07-02 | mobile   | 100          | 1           |</span><br><span class="line">| 2019-07-02 | both     | 0            | 0           |</span><br><span class="line">+------------+----------+--------------+-------------+ </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">select spend_date,platform, sum(amount) as total_amount, count(user_id) total_users</span><br><span class="line">from</span><br><span class="line">(select spend_date, user_id, </span><br><span class="line">(case count(distinct platform)</span><br><span class="line">    when 1 then platform</span><br><span class="line">    when 2 then &#x27;both&#x27;</span><br><span class="line">    end</span><br><span class="line">) as  platform, sum(amount) as amount</span><br><span class="line">from Spending</span><br><span class="line">group by spend_date, user_id</span><br><span class="line">) as temp2</span><br><span class="line">group by spend_date, platform</span><br><span class="line"></span><br><span class="line">但是这样得出来的只有某些spend_date某些user_id</span><br><span class="line">的，题目要求是不存在也要放在结果里面,只是结果置0而已。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">WITH</span><br><span class="line">    P AS (</span><br><span class="line">        SELECT DISTINCT spend_date, &#x27;desktop&#x27; AS platform FROM Spending</span><br><span class="line">        UNION</span><br><span class="line">        SELECT DISTINCT spend_date, &#x27;mobile&#x27; FROM Spending</span><br><span class="line">        UNION</span><br><span class="line">        SELECT DISTINCT spend_date, &#x27;both&#x27; FROM Spending</span><br><span class="line">    ),</span><br><span class="line">    T AS (</span><br><span class="line">        SELECT</span><br><span class="line">            user_id,</span><br><span class="line">            spend_date,</span><br><span class="line">            SUM(amount) AS amount,</span><br><span class="line">            IF(COUNT(platform) = 1, platform, &#x27;both&#x27;) AS platform</span><br><span class="line">        FROM Spending</span><br><span class="line">        GROUP BY 1, 2</span><br><span class="line">    )</span><br><span class="line">SELECT</span><br><span class="line">    p.*,</span><br><span class="line">    IFNULL(SUM(amount), 0) AS total_amount,</span><br><span class="line">    COUNT(t.user_id) AS total_users</span><br><span class="line">FROM</span><br><span class="line">    P AS p</span><br><span class="line">    LEFT JOIN T AS t USING (spend_date, platform)</span><br><span class="line">GROUP BY 1, 2;</span><br></pre></td></tr></table></figure>

<h4 id="1159-市场分析-I-I"><a href="#1159-市场分析-I-I" class="headerlink" title="1159.市场分析 I I"></a>1159.市场分析 I I</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">表: Users</span><br><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| user_id        | int     |</span><br><span class="line">| join_date      | date    |</span><br><span class="line">| favorite_brand | varchar |</span><br><span class="line">+----------------+---------+</span><br><span class="line">user_id 是该表的主键(具有唯一值的列)。</span><br><span class="line">表中包含一位在线购物网站用户的个人信息，用户可以在该网站出售和购买商品。</span><br><span class="line">表: Orders</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| order_id      | int     |</span><br><span class="line">| order_date    | date    |</span><br><span class="line">| item_id       | int     |</span><br><span class="line">| buyer_id      | int     |</span><br><span class="line">| seller_id     | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">order_id 是该表的主键(具有唯一值的列)。</span><br><span class="line">item_id 是 Items 表的外键(reference 列)。</span><br><span class="line">buyer_id 和 seller_id 是 Users 表的外键。</span><br><span class="line">表: Items</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| item_id       | int     |</span><br><span class="line">| item_brand    | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">item_id 是该表的主键(具有唯一值的列)。</span><br><span class="line"></span><br><span class="line">编写一个解决方案，为每个用户找出他们出售的第二件商品(按日期)的品牌是否是他们最喜欢的品牌。如果用户售出的商品少于两件，则该用户的结果为否。保证卖家不会在一天内卖出一件以上的商品。</span><br><span class="line"></span><br><span class="line">以 任意顺序 返回结果表。</span><br><span class="line">返回结果格式如下例所示：</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">SELECT</span><br><span class="line">    u.user_id AS seller_id,</span><br><span class="line">    CASE</span><br><span class="line">        WHEN u.favorite_brand = i.item_brand THEN &#x27;yes&#x27;</span><br><span class="line">        ELSE &#x27;no&#x27;</span><br><span class="line">    END AS 2nd_item_fav_brand</span><br><span class="line">FROM</span><br><span class="line">    users AS u</span><br><span class="line">    LEFT JOIN (</span><br><span class="line">        SELECT</span><br><span class="line">            order_date,</span><br><span class="line">            item_id,</span><br><span class="line">            seller_id,</span><br><span class="line">            RANK() OVER (</span><br><span class="line">                PARTITION BY seller_id</span><br><span class="line">                ORDER BY order_date</span><br><span class="line">            ) AS rk</span><br><span class="line">        FROM orders</span><br><span class="line">    ) AS o</span><br><span class="line">        ON u.user_id = o.seller_id AND o.rk = 2</span><br><span class="line">    LEFT JOIN items AS i ON o.item_id = i.item_id;</span><br></pre></td></tr></table></figure>

<h4 id="1174-即时食物配送Ⅱ"><a href="#1174-即时食物配送Ⅱ" class="headerlink" title="1174.即时食物配送Ⅱ"></a>1174.即时食物配送Ⅱ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">配送表: Delivery</span><br><span class="line"></span><br><span class="line">+-----------------------------+---------+</span><br><span class="line">| Column Name                 | Type    |</span><br><span class="line">+-----------------------------+---------+</span><br><span class="line">| delivery_id                 | int     |</span><br><span class="line">| customer_id                 | int     |</span><br><span class="line">| order_date                  | date    |</span><br><span class="line">| customer_pref_delivery_date | date    |</span><br><span class="line">+-----------------------------+---------+</span><br><span class="line">delivery_id 是该表中具有唯一值的列。</span><br><span class="line">该表保存着顾客的食物配送信息，顾客在某个日期下了订单，并指定了一个期望的配送日期（和下单日期相同或者在那之后）。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">如果顾客期望的配送日期和下单日期相同，则该订单称为 「即时订单」，否则称为「计划订单」。</span><br><span class="line"></span><br><span class="line">「首次订单」是顾客最早创建的订单。我们保证一个顾客只会有一个「首次订单」。</span><br><span class="line"></span><br><span class="line">编写解决方案以获取即时订单在所有用户的首次订单中的比例。保留两位小数。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">with t as</span><br><span class="line">(select customer_id,min(order_date)</span><br><span class="line">from Delivery</span><br><span class="line">group by customer_id</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">select round(count(d.customer_id)/count(t.customer_id)*100,2)</span><br><span class="line">from t left join Delivery d</span><br><span class="line">on t.customer_id = d.customer_id and t.order_date = d.order_date and d.order_date = d.customer_pref_delivery_date </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">WITH FirstOrders AS (</span><br><span class="line">    SELECT</span><br><span class="line">        customer_id,</span><br><span class="line">        order_date,</span><br><span class="line">        customer_pref_delivery_date,</span><br><span class="line">        ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY order_date) AS rn</span><br><span class="line">    FROM</span><br><span class="line">        Delivery</span><br><span class="line">)</span><br><span class="line">SELECT</span><br><span class="line">    ROUND(</span><br><span class="line">        SUM(CASE WHEN order_date = customer_pref_delivery_date THEN 1 ELSE 0 END) * 100.0 / COUNT(*),</span><br><span class="line">        2</span><br><span class="line">    ) AS immediate_percentage</span><br><span class="line">FROM</span><br><span class="line">    FirstOrders</span><br><span class="line">WHERE</span><br><span class="line">    rn = 1; -- 只考虑首次订单</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">round(sum(order_date = customer_pref_delivery_date)/count(*)*100,2) immediate_percentage</span><br><span class="line">from Delivery</span><br><span class="line">where (customer_id,order_date) in </span><br><span class="line">(select customer_id,min(order_date) from Delivery group by customer_id)</span><br></pre></td></tr></table></figure>

<h4 id="1179-重新格式化部门表-行转列"><a href="#1179-重新格式化部门表-行转列" class="headerlink" title="1179.重新格式化部门表 行转列"></a>1179.重新格式化部门表 行转列</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">表 Department：</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| revenue       | int     |</span><br><span class="line">| month         | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">在 SQL 中，(id, month) 是表的联合主键。</span><br><span class="line">这个表格有关于每个部门每月收入的信息。</span><br><span class="line">月份（month）可以取下列值 [&quot;Jan&quot;,&quot;Feb&quot;,&quot;Mar&quot;,&quot;Apr&quot;,&quot;May&quot;,&quot;Jun&quot;,&quot;Jul&quot;,&quot;Aug&quot;,&quot;Sep&quot;,&quot;Oct&quot;,&quot;Nov&quot;,&quot;Dec&quot;]。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">重新格式化表格，使得 每个月 都有一个部门 id 列和一个收入列。</span><br><span class="line"></span><br><span class="line">以 任意顺序 返回结果表。</span><br><span class="line"></span><br><span class="line">结果格式如以下示例所示。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 1：</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Department table:</span><br><span class="line">+------+---------+-------+</span><br><span class="line">| id   | revenue | month |</span><br><span class="line">+------+---------+-------+</span><br><span class="line">| 1    | 8000    | Jan   |</span><br><span class="line">| 2    | 9000    | Jan   |</span><br><span class="line">| 3    | 10000   | Feb   |</span><br><span class="line">| 1    | 7000    | Feb   |</span><br><span class="line">| 1    | 6000    | Mar   |</span><br><span class="line">+------+---------+-------+</span><br><span class="line">输出：</span><br><span class="line">+------+-------------+-------------+-------------+-----+-------------+</span><br><span class="line">| id   | Jan_Revenue | Feb_Revenue | Mar_Revenue | ... | Dec_Revenue |</span><br><span class="line">+------+-------------+-------------+-------------+-----+-------------+</span><br><span class="line">| 1    | 8000        | 7000        | 6000        | ... | null        |</span><br><span class="line">| 2    | 9000        | null        | null        | ... | null        |</span><br><span class="line">| 3    | null        | 10000       | null        | ... | null        |</span><br><span class="line">+------+-------------+-------------+-------------+-----+-------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">    id,</span><br><span class="line">    SUM(IF(month = &#x27;Jan&#x27;, revenue, NULL)) AS Jan_Revenue,</span><br><span class="line">    SUM(IF(month = &#x27;Feb&#x27;, revenue, NULL)) AS Feb_Revenue,</span><br><span class="line">    SUM(IF(month = &#x27;Mar&#x27;, revenue, NULL)) AS Mar_Revenue,</span><br><span class="line">    SUM(IF(month = &#x27;Apr&#x27;, revenue, NULL)) AS Apr_Revenue,</span><br><span class="line">    SUM(IF(month = &#x27;May&#x27;, revenue, NULL)) AS May_Revenue,</span><br><span class="line">    SUM(IF(month = &#x27;Jun&#x27;, revenue, NULL)) AS Jun_Revenue,</span><br><span class="line">    SUM(IF(month = &#x27;Jul&#x27;, revenue, NULL)) AS Jul_Revenue,</span><br><span class="line">    SUM(IF(month = &#x27;Aug&#x27;, revenue, NULL)) AS Aug_Revenue,</span><br><span class="line">    SUM(IF(month = &#x27;Sep&#x27;, revenue, NULL)) AS Sep_Revenue,</span><br><span class="line">    SUM(IF(month = &#x27;Oct&#x27;, revenue, NULL)) AS Oct_Revenue,</span><br><span class="line">    SUM(IF(month = &#x27;Nov&#x27;, revenue, NULL)) AS Nov_Revenue,</span><br><span class="line">    SUM(IF(month = &#x27;Dec&#x27;, revenue, NULL)) AS Dec_Revenue</span><br><span class="line">FROM Department</span><br><span class="line">GROUP BY id</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">id</span><br><span class="line">,sum(case when month = &#x27;Jan&#x27; then revenue else null end) Jan_Revenue</span><br><span class="line">,sum(case when month = &#x27;Feb&#x27; then revenue else null end) Feb_Revenue</span><br><span class="line">,sum(case when month = &#x27;Mar&#x27; then revenue else null end) Mar_Revenue</span><br><span class="line">,sum(case when month = &#x27;Apr&#x27; then revenue else null end) Apr_Revenue</span><br><span class="line">,sum(case when month = &#x27;May&#x27; then revenue else null end) May_Revenue</span><br><span class="line">,sum(case when month = &#x27;Jun&#x27; then revenue else null end) Jun_Revenue</span><br><span class="line">,sum(case when month = &#x27;Jul&#x27; then revenue else null end) Jul_Revenue</span><br><span class="line">,sum(case when month = &#x27;Aug&#x27; then revenue else null end) Aug_Revenue</span><br><span class="line">,sum(case when month = &#x27;Sep&#x27; then revenue else null end) Sep_Revenue</span><br><span class="line">,sum(case when month = &#x27;Oct&#x27; then revenue else null end) Oct_Revenue</span><br><span class="line">,sum(case when month = &#x27;Nov&#x27; then revenue else null end) Nov_Revenue</span><br><span class="line">,sum(case when month = &#x27;Dec&#x27; then revenue else null end) Dec_Revenue</span><br><span class="line">from Department</span><br><span class="line">group by 1</span><br></pre></td></tr></table></figure>

<h4 id="1193-每月交易-date-format-left-sub-string"><a href="#1193-每月交易-date-format-left-sub-string" class="headerlink" title="1193.每月交易| date_format(),left(),sub_string()"></a>1193.每月交易| date_format(),left(),sub_string()</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">表：Transactions</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| country       | varchar |</span><br><span class="line">| state         | enum    |</span><br><span class="line">| amount        | int     |</span><br><span class="line">| trans_date    | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id 是这个表的主键。</span><br><span class="line">该表包含有关传入事务的信息。</span><br><span class="line">state 列类型为 [&quot;approved&quot;, &quot;declined&quot;] 之一。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写一个 sql 查询来查找每个月和每个国家/地区的事务数及其总金额、已批准的事务数及其总金额。</span><br><span class="line"></span><br><span class="line">以 任意顺序 返回结果表。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">select </span><br><span class="line">date_format(trans_date,&#x27;%Y-%m&#x27;) as month,</span><br><span class="line">country,</span><br><span class="line">count(*) as trans_count,</span><br><span class="line">sum(if(state=&#x27;approved&#x27;,1,0)) as approved_count,</span><br><span class="line">sum(amount) as trans_total_amount,</span><br><span class="line">sum(if(state=&#x27;approved&#x27;,amount,0)) as approved_total_amount</span><br><span class="line">from Transactions</span><br><span class="line">group by month,country</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select left(T.trans_date,7) month,</span><br><span class="line">t.country,count(t.state) trans_count ,</span><br><span class="line">sum(if(t.state=&#x27;approved&#x27;,1,0)) approved_count,</span><br><span class="line">sum(t.amount) trans_total_amount ,</span><br><span class="line">sum(if(t.state=&#x27;approved&#x27;,t.amount,0)) approved_total_amount</span><br><span class="line">from Transactions T</span><br><span class="line">group by left(T.trans_date,7),t.country;</span><br></pre></td></tr></table></figure>

<h4 id="1194-锦标赛优胜者-列转行"><a href="#1194-锦标赛优胜者-列转行" class="headerlink" title="1194.锦标赛优胜者 列转行"></a>1194.锦标赛优胜者 列转行</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Players 玩家表</span><br><span class="line">+-------------+-------+</span><br><span class="line">| Column Name | Type  |</span><br><span class="line">+-------------+-------+</span><br><span class="line">| player_id   | int   |</span><br><span class="line">| group_id    | int   |</span><br><span class="line">+-------------+-------+</span><br><span class="line">player_id 是此表的主键(具有唯一值的列)。</span><br><span class="line">此表的每一行表示每个玩家的组。</span><br><span class="line">Matches 赛事表</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| match_id      | int     |</span><br><span class="line">| first_player  | int     |</span><br><span class="line">| second_player | int     | </span><br><span class="line">| first_score   | int     |</span><br><span class="line">| second_score  | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">match_id 是此表的主键(具有唯一值的列)。</span><br><span class="line">每一行是一场比赛的记录，first_player 和 second_player 表示该场比赛的球员 ID。</span><br><span class="line">first_score 和 second_score 分别表示 first_player 和 second_player 的得分。</span><br><span class="line">你可以假设，在每一场比赛中，球员都属于同一组。</span><br><span class="line"></span><br><span class="line">每组的获胜者是在组内累积得分最高的选手。如果平局，player_id 最小 的选手获胜。</span><br><span class="line">编写解决方案来查找每组中的获胜者。</span><br><span class="line">返回的结果表单 没有顺序要求 。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">with t as(</span><br><span class="line">select player,sum(score)scoreall</span><br><span class="line">from</span><br><span class="line">(select first_player player,first_score score</span><br><span class="line">from Matches</span><br><span class="line">union all</span><br><span class="line">select second_player player,second_score score</span><br><span class="line">from Matches) a</span><br><span class="line">group by player</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">with s as(</span><br><span class="line">select group_id,max(scoreall) maxscore</span><br><span class="line">from t,Players </span><br><span class="line">where t.player = Players.player_id</span><br><span class="line">group by group_id</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">select s.group_id,min(player_id ) player_id  </span><br><span class="line">from s,</span><br><span class="line">(select group_id,t.player player,scoreall</span><br><span class="line">from t,Players </span><br><span class="line">where t.player = Players.player_id) r</span><br><span class="line">where s.group_id = r.group.id and s.maxscore = r.scoreall</span><br><span class="line">group by s.group_id</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">WITH</span><br><span class="line">    s AS (</span><br><span class="line">        SELECT first_player AS player_id, first_score AS score, group_id</span><br><span class="line">        FROM</span><br><span class="line">            Matches AS m</span><br><span class="line">            JOIN Players AS p ON m.first_player = p.player_id</span><br><span class="line">        UNION ALL</span><br><span class="line">        SELECT second_player AS player_id, second_score AS score, group_id</span><br><span class="line">        FROM</span><br><span class="line">            Matches AS m</span><br><span class="line">            JOIN Players AS p ON m.second_player = p.player_id</span><br><span class="line">    ),</span><br><span class="line">    t AS (</span><br><span class="line">        SELECT group_id, player_id, SUM(score) AS scores</span><br><span class="line">        FROM s</span><br><span class="line">        GROUP BY player_id</span><br><span class="line">    ),</span><br><span class="line">    p AS (</span><br><span class="line">        SELECT</span><br><span class="line">            group_id,</span><br><span class="line">            player_id,</span><br><span class="line">            RANK() OVER (</span><br><span class="line">                PARTITION BY group_id</span><br><span class="line">                ORDER BY scores DESC, player_id</span><br><span class="line">            ) AS rk</span><br><span class="line">        FROM t</span><br><span class="line">    )</span><br><span class="line">SELECT group_id, player_id</span><br><span class="line">FROM p</span><br><span class="line">WHERE rk = 1;</span><br></pre></td></tr></table></figure>

<h4 id="1204-最后一个能进入巴士的人"><a href="#1204-最后一个能进入巴士的人" class="headerlink" title="1204.最后一个能进入巴士的人"></a>1204.最后一个能进入巴士的人</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">表: Queue</span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| person_id   | int     |</span><br><span class="line">| person_name | varchar |</span><br><span class="line">| weight      | int     |</span><br><span class="line">| turn        | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">person_id 是这个表具有唯一值的列。</span><br><span class="line">该表展示了所有候车乘客的信息。</span><br><span class="line">表中 person_id 和 turn 列将包含从 1 到 n 的所有数字，其中 n 是表中的行数。</span><br><span class="line">turn 决定了候车乘客上巴士的顺序，其中 turn=1 表示第一个上巴士，turn=n 表示最后一个上巴士。</span><br><span class="line">weight 表示候车乘客的体重，以千克为单位。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">有一队乘客在等着上巴士。然而，巴士有1000  千克 的重量限制，所以其中一部分乘客可能无法上巴士。</span><br><span class="line">编写解决方案找出 最后一个 上巴士且不超过重量限制的乘客，并报告 person_name 。题目测试用例确保顺位第一的人可以上巴士且不会超重。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">WITH</span><br><span class="line">    T AS (</span><br><span class="line">        SELECT</span><br><span class="line">            person_name,</span><br><span class="line">            SUM(weight) OVER (ORDER BY turn) AS s</span><br><span class="line">        FROM Queue</span><br><span class="line">    )</span><br><span class="line">SELECT person_name</span><br><span class="line">FROM T</span><br><span class="line">WHERE s &lt;= 1000</span><br><span class="line">ORDER BY s DESC</span><br><span class="line">LIMIT 1;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">SELECT a.person_name</span><br><span class="line">FROM</span><br><span class="line">    Queue AS a,</span><br><span class="line">    Queue AS b</span><br><span class="line">WHERE a.turn &gt;= b.turn</span><br><span class="line">GROUP BY a.person_id</span><br><span class="line">HAVING SUM(b.weight) &lt;= 1000</span><br><span class="line">ORDER BY a.turn DESC</span><br><span class="line">LIMIT 1;</span><br></pre></td></tr></table></figure>

<h4 id="1205-每月交易-count-1-count-null-sum-0"><a href="#1205-每月交易-count-1-count-null-sum-0" class="headerlink" title="1205.每月交易 | count(1),count(null),sum(0)"></a>1205.每月交易 | count(1),count(null),sum(0)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">Transactions 记录表</span><br><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| id             | int     |</span><br><span class="line">| country        | varchar |</span><br><span class="line">| state          | enum    |</span><br><span class="line">| amount         | int     |</span><br><span class="line">| trans_date     | date    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">id 是这个表的主键。</span><br><span class="line">该表包含有关传入事务的信息。</span><br><span class="line">状态列是枚举类型，值为 [approved、declined] 其中之一的列。</span><br><span class="line">Chargebacks 表</span><br><span class="line"></span><br><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| trans_id       | int     |</span><br><span class="line">| trans_date     | date    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">退单包含有关放置在事务表中的某些事务的传入退单的基本信息。</span><br><span class="line">trans_id 是 transactions 表的 id 列的外键（reference 列）。</span><br><span class="line">每项退单都对应于之前进行的交易，即使未经批准。</span><br><span class="line"> </span><br><span class="line">编写一个解决方案，找出每个国家/地区的每月交易信息：已批准交易的数量及其总金额、退单的数量及其总金额。</span><br><span class="line"></span><br><span class="line">注意：在你的解决方案中，只需显示给定月份和国家，忽略所有为零的行。</span><br><span class="line">以 任意顺序 返回结果表。</span><br><span class="line">结果格式如下所示。</span><br><span class="line"></span><br><span class="line">示例 1:</span><br><span class="line">输入：</span><br><span class="line">Transactions 表：</span><br><span class="line">+-----+---------+----------+--------+------------+</span><br><span class="line">| id  | country | state    | amount | trans_date |</span><br><span class="line">+-----+---------+----------+--------+------------+</span><br><span class="line">| 101 | US      | approved | 1000   | 2019-05-18 |</span><br><span class="line">| 102 | US      | declined | 2000   | 2019-05-19 |</span><br><span class="line">| 103 | US      | approved | 3000   | 2019-06-10 |</span><br><span class="line">| 104 | US      | declined | 4000   | 2019-06-13 |</span><br><span class="line">| 105 | US      | approved | 5000   | 2019-06-15 |</span><br><span class="line">+-----+---------+----------+--------+------------+</span><br><span class="line">Chargebacks 表：</span><br><span class="line">+----------+------------+</span><br><span class="line">| trans_id | trans_date |</span><br><span class="line">+----------+------------+</span><br><span class="line">| 102      | 2019-05-29 |</span><br><span class="line">| 101      | 2019-06-30 |</span><br><span class="line">| 105      | 2019-09-18 |</span><br><span class="line">+----------+------------+</span><br><span class="line">输出：</span><br><span class="line">+---------+---------+----------------+-----------------+------------------+-------------------+</span><br><span class="line">| month   | country | approved_count | approved_amount | chargeback_count | chargeback_amount |</span><br><span class="line">+---------+---------+----------------+-----------------+------------------+-------------------+</span><br><span class="line">| 2019-05 | US      | 1              | 1000            | 1                | 2000              |</span><br><span class="line">| 2019-06 | US      | 2              | 8000            | 1                | 1000              |</span><br><span class="line">| 2019-09 | US      | 0              | 0               | 1                | 5000              |</span><br><span class="line">+---------+---------+----------------+-----------------+------------------+-------------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">select month, country,</span><br><span class="line">count(case when state = &#x27;approved&#x27; and tag=0 then 1 else null end) as approved_count,</span><br><span class="line">sum(case when state = &#x27;approved&#x27; and tag =0 then amount else 0 end)as approved_amount,</span><br><span class="line">count(case when tag =1 then 1 else null end)as chargeback_count,</span><br><span class="line">sum(case when tag =1 then amount else 0 end)as chargeback_amount</span><br><span class="line">from </span><br><span class="line">(</span><br><span class="line">-- 每个月和每个国家/地区的已批准交易的数量</span><br><span class="line">select id,country,state,amount,date_format(trans_date ,&quot;%Y-%m&quot;)as month,0 as tag</span><br><span class="line">from Transactions</span><br><span class="line">where state = &#x27;approved&#x27;</span><br><span class="line">union all</span><br><span class="line">-- 每个月和每个国家/地区的退单的数量</span><br><span class="line">select id,country,state,amount,date_format(c.trans_date ,&quot;%Y-%m&quot;)as month,1 as tag</span><br><span class="line">from Transactions as t inner join Chargebacks as c </span><br><span class="line">on t.id = c.trans_id</span><br><span class="line">)temp</span><br><span class="line">group by month,country</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">    trans_date,</span><br><span class="line">    country,</span><br><span class="line">    state,</span><br><span class="line">    amount</span><br><span class="line">from Transactions</span><br><span class="line">where state = &#x27;approved&#x27;</span><br><span class="line">union all</span><br><span class="line">select</span><br><span class="line">    a.trans_date,</span><br><span class="line">    b.country,</span><br><span class="line">    &#x27;declined&#x27; state,</span><br><span class="line">    b.amount</span><br><span class="line">from Chargebacks a</span><br><span class="line">inner join Transactions b</span><br><span class="line">on a.trans_id = b.id</span><br><span class="line">)</span><br><span class="line">select</span><br><span class="line">    date_format(trans_date,&#x27;%Y-%m&#x27;) month,</span><br><span class="line">    country,</span><br><span class="line">    count(case when state = &#x27;approved&#x27; then 1 else null end) approved_count,</span><br><span class="line">    sum(case when state = &#x27;approved&#x27; then amount else 0 end) approved_amount,</span><br><span class="line">    count(case when state = &#x27;declined&#x27; then 1 else null end) chargeback_count,</span><br><span class="line">    sum(case when state = &#x27;declined&#x27; then amount else 0 end) chargeback_amount</span><br><span class="line">from tmp</span><br><span class="line">group by date_format(trans_date,&#x27;%Y-%m&#x27;),country;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">WITH</span><br><span class="line">    T AS (</span><br><span class="line">        SELECT * FROM Transactions</span><br><span class="line">        UNION</span><br><span class="line">        SELECT id, country, &#x27;chargeback&#x27;, amount, c.trans_date</span><br><span class="line">        FROM</span><br><span class="line">            Transactions AS t</span><br><span class="line">            JOIN Chargebacks AS c ON t.id = c.trans_id</span><br><span class="line">    )</span><br><span class="line">SELECT</span><br><span class="line">    DATE_FORMAT(trans_date, &#x27;%Y-%m&#x27;) AS month,</span><br><span class="line">    country,</span><br><span class="line">    SUM(state = &#x27;approved&#x27;) AS approved_count,</span><br><span class="line">    SUM(IF(state = &#x27;approved&#x27;, amount, 0)) AS approved_amount,</span><br><span class="line">    SUM(state = &#x27;chargeback&#x27;) AS chargeback_count,</span><br><span class="line">    SUM(IF(state = &#x27;chargeback&#x27;, amount, 0)) AS chargeback_amount</span><br><span class="line">FROM T</span><br><span class="line">GROUP BY 1, 2</span><br><span class="line">HAVING approved_amount OR chargeback_amount;</span><br></pre></td></tr></table></figure>

<h4 id="1212-查询球队积分-列转行"><a href="#1212-查询球队积分-列转行" class="headerlink" title="1212.查询球队积分 列转行"></a>1212.查询球队积分 列转行</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">表: Teams</span><br><span class="line">+---------------+----------+</span><br><span class="line">| Column Name   | Type     |</span><br><span class="line">+---------------+----------+</span><br><span class="line">| team_id       | int      |</span><br><span class="line">| team_name     | varchar  |</span><br><span class="line">+---------------+----------+</span><br><span class="line">team_id 是该表具有唯一值的列。</span><br><span class="line">表中的每一行都代表一支独立足球队。</span><br><span class="line"> </span><br><span class="line">表: Matches</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| match_id      | int     |</span><br><span class="line">| host_team     | int     |</span><br><span class="line">| guest_team    | int     | </span><br><span class="line">| host_goals    | int     |</span><br><span class="line">| guest_goals   | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">match_id 是该表具有唯一值的列。</span><br><span class="line">表中的每一行都代表一场已结束的比赛。</span><br><span class="line">比赛的主客队分别由它们自己的 id 表示，他们的进球由 host_goals 和 guest_goals 分别表示。</span><br><span class="line"></span><br><span class="line">你希望在所有比赛之后计算所有球队的比分。积分奖励方式如下:</span><br><span class="line"></span><br><span class="line">如果球队赢了比赛(即比对手进更多的球)，就得 3 分。</span><br><span class="line">如果双方打成平手(即，与对方得分相同)，则得 1 分。</span><br><span class="line">如果球队输掉了比赛(例如，比对手少进球)，就 不得分 。</span><br><span class="line">编写解决方案，以找出每个队的 team_id，team_name 和 num_points。</span><br><span class="line"></span><br><span class="line">返回的结果根据 num_points 降序排序，如果有两队积分相同，那么这两队按 team_id  升序排序。</span><br><span class="line">返回结果格式如下。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">with t as(</span><br><span class="line">select host_team,case when host_goals&gt;guest_goals then 3 when host_goals=guest_goals then 1 when host_goals&lt;guest_goals then 0 END host_team_score,guest_team,case when host_goals&lt;guest_goals then 3 when host_goals=guest_goals then 1 when host_goals&gt;guest_goals then 0 END guest_team_score</span><br><span class="line">from Matches</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">select team_id,team_name,sum(num_points) num_points</span><br><span class="line">from</span><br><span class="line">(select host_team team_id,host_team_score num_points</span><br><span class="line">from t</span><br><span class="line">union all</span><br><span class="line">select guest_team team_id,guest_team_score num_points</span><br><span class="line">from t) ut,Teams</span><br><span class="line">where ut.team_id = Teams.team_id</span><br><span class="line">group by ut.team_id</span><br><span class="line">order by num_points DESC,team_id</span><br></pre></td></tr></table></figure>

<h4 id="1225-报告系统状态的连续日期"><a href="#1225-报告系统状态的连续日期" class="headerlink" title="1225.报告系统状态的连续日期"></a>1225.报告系统状态的连续日期</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">表：Failed</span><br><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| fail_date    | date    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">该表主键为 fail_date (具有唯一值的列)。</span><br><span class="line">该表包含失败任务的天数.</span><br><span class="line"></span><br><span class="line">表： Succeeded</span><br><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| success_date | date    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">该表主键为 success_date (具有唯一值的列)。</span><br><span class="line">该表包含成功任务的天数.</span><br><span class="line"></span><br><span class="line">系统 每天 运行一个任务。每个任务都独立于先前的任务。任务的状态可以是失败或是成功。</span><br><span class="line"></span><br><span class="line">编写解决方案找出 2019-01-01 到 2019-12-31 期间任务连续同状态 period_state 的起止日期（start_date 和 end_date）。即如果任务失败了，就是失败状态的起止日期，如果任务成功了，就是成功状态的起止日期。</span><br><span class="line"></span><br><span class="line">最后结果按照起始日期 start_date 排序</span><br><span class="line">输入：</span><br><span class="line">Failed table:</span><br><span class="line">+-------------------+</span><br><span class="line">| fail_date         |</span><br><span class="line">+-------------------+</span><br><span class="line">| 2018-12-28        |</span><br><span class="line">| 2018-12-29        |</span><br><span class="line">| 2019-01-04        |</span><br><span class="line">| 2019-01-05        |</span><br><span class="line">+-------------------+</span><br><span class="line">Succeeded table:</span><br><span class="line">+-------------------+</span><br><span class="line">| success_date      |</span><br><span class="line">+-------------------+</span><br><span class="line">| 2018-12-30        |</span><br><span class="line">| 2018-12-31        |</span><br><span class="line">| 2019-01-01        |</span><br><span class="line">| 2019-01-02        |</span><br><span class="line">| 2019-01-03        |</span><br><span class="line">| 2019-01-06        |</span><br><span class="line">+-------------------+</span><br><span class="line">输出：</span><br><span class="line">+--------------+--------------+--------------+</span><br><span class="line">| period_state | start_date   | end_date     |</span><br><span class="line">+--------------+--------------+--------------+</span><br><span class="line">| succeeded    | 2019-01-01   | 2019-01-03   |</span><br><span class="line">| failed       | 2019-01-04   | 2019-01-05   |</span><br><span class="line">| succeeded    | 2019-01-06   | 2019-01-06   |</span><br><span class="line">+--------------+--------------+--------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">select state as period_state,   min(dt ) as start_date,    max(dt) as end_date</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">    select *,rank()over(partition by state order by  dt ) as rk ,subdate(dt,rank()over(partition by state order by  dt)) as dif</span><br><span class="line">    from </span><br><span class="line">    (</span><br><span class="line">        select &#x27;succeeded&#x27; as &#x27;state&#x27;,success_date as &#x27;dt&#x27;</span><br><span class="line">        from Succeeded where success_date between &#x27;2019-01-01&#x27; and &#x27;2019-12-31&#x27;</span><br><span class="line">        union </span><br><span class="line">        select &#x27;failed&#x27;as &#x27;state&#x27;,fail_date as &#x27;dt&#x27;</span><br><span class="line">        from Failed    where fail_date    between &#x27;2019-01-01&#x27; and &#x27;2019-12-31&#x27;</span><br><span class="line">    )t1</span><br><span class="line">)t2</span><br><span class="line">group by state,dif</span><br><span class="line">order by dt</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">WITH</span><br><span class="line">    T AS (</span><br><span class="line">        SELECT fail_date AS dt, &#x27;failed&#x27; AS st</span><br><span class="line">        FROM Failed</span><br><span class="line">        WHERE YEAR(fail_date) = 2019</span><br><span class="line">        UNION ALL</span><br><span class="line">        SELECT success_date AS dt, &#x27;succeeded&#x27; AS st</span><br><span class="line">        FROM Succeeded</span><br><span class="line">        WHERE YEAR(success_date) = 2019</span><br><span class="line">    )</span><br><span class="line">SELECT</span><br><span class="line">    st AS period_state,</span><br><span class="line">    MIN(dt) AS start_date,</span><br><span class="line">    MAX(dt) AS end_date</span><br><span class="line">FROM</span><br><span class="line">    (</span><br><span class="line">        SELECT</span><br><span class="line">            *,</span><br><span class="line">            SUBDATE(</span><br><span class="line">                dt,</span><br><span class="line">                RANK() OVER (</span><br><span class="line">                    PARTITION BY st</span><br><span class="line">                    ORDER BY dt</span><br><span class="line">                )</span><br><span class="line">            ) AS pt</span><br><span class="line">        FROM T</span><br><span class="line">    ) AS t</span><br><span class="line">GROUP BY 1, pt</span><br><span class="line">ORDER BY 2;</span><br></pre></td></tr></table></figure>

<h4 id="1264-页面推荐"><a href="#1264-页面推荐" class="headerlink" title="1264.页面推荐"></a>1264.页面推荐</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">朋友关系列表： Friendship</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user1_id      | int     |</span><br><span class="line">| user2_id      | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(user1_id, user2_id) 是这张表具有唯一值的列的组合。</span><br><span class="line">这张表的每一行代表着 user1_id 和 user2_id 之间存在着朋友关系。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">喜欢列表： Likes</span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| user_id     | int     |</span><br><span class="line">| page_id     | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">(user_id, page_id) 是这张表具有唯一值的列的组合。</span><br><span class="line">这张表的每一行代表着 user_id 喜欢 page_id。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写解决方案，向user_id = 1 的用户，推荐其朋友们喜欢的页面。不要推荐该用户已经喜欢的页面。</span><br><span class="line">以 任意顺序 返回结果，其中不应当包含重复项。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">WITH</span><br><span class="line">    T AS (</span><br><span class="line">        SELECT user1_id AS user_id FROM Friendship WHERE user2_id = 1</span><br><span class="line">        UNION</span><br><span class="line">        SELECT user2_id AS user_id FROM Friendship WHERE user1_id = 1</span><br><span class="line">    )</span><br><span class="line">SELECT DISTINCT page_id AS recommended_page</span><br><span class="line">FROM</span><br><span class="line">    T</span><br><span class="line">    JOIN Likes USING (user_id)</span><br><span class="line">WHERE page_id NOT IN (SELECT page_id FROM Likes WHERE user_id = 1);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">with t as (</span><br><span class="line">select case when user1_id=1 then user2_id case when user2_id=1 then user1_id end user_id</span><br><span class="line">from Friendship</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">select page_id recommended_page </span><br><span class="line">from t,Likes</span><br><span class="line">where t.user_id = Likes.user_id and Likes.page_id not in (select page_id from Likes where user_id=1)</span><br></pre></td></tr></table></figure>

<h4 id="1270-向公司-CEO-汇报工作的所有人-难"><a href="#1270-向公司-CEO-汇报工作的所有人-难" class="headerlink" title="1270.向公司 CEO 汇报工作的所有人 难"></a>1270.向公司 CEO 汇报工作的所有人 难</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">员工表：Employees</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| employee_id   | int     |</span><br><span class="line">| employee_name | varchar |</span><br><span class="line">| manager_id    | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">employee_id 是这个表具有唯一值的列。</span><br><span class="line">这个表中每一行中，employee_id 表示职工的 ID，employee_name 表示职工的名字，manager_id 表示该职工汇报工作的直线经理。</span><br><span class="line">这个公司 CEO 是 employee_id = 1 的人。</span><br><span class="line"></span><br><span class="line">编写解决方案，找出所有直接或间接向公司 CEO 汇报工作的职工的 employee_id 。</span><br><span class="line">由于公司规模较小，经理之间的间接关系 不超过 3 个经理 。</span><br><span class="line">可以以 任何顺序 返回无重复项的结果。</span><br><span class="line">返回结果示例如下。</span><br><span class="line"></span><br><span class="line">示例 1：</span><br><span class="line">输入：</span><br><span class="line">Employees table:</span><br><span class="line">+-------------+---------------+------------+</span><br><span class="line">| employee_id | employee_name | manager_id |</span><br><span class="line">+-------------+---------------+------------+</span><br><span class="line">| 1           | Boss          | 1          |</span><br><span class="line">| 3           | Alice         | 3          |</span><br><span class="line">| 2           | Bob           | 1          |</span><br><span class="line">| 4           | Daniel        | 2          |</span><br><span class="line">| 7           | Luis          | 4          |</span><br><span class="line">| 8           | Jhon          | 3          |</span><br><span class="line">| 9           | Angela        | 8          |</span><br><span class="line">| 77          | Robert        | 1          |</span><br><span class="line">+-------------+---------------+------------+</span><br><span class="line">输出：</span><br><span class="line">+-------------+</span><br><span class="line">| employee_id |</span><br><span class="line">+-------------+</span><br><span class="line">| 2           |</span><br><span class="line">| 77          |</span><br><span class="line">| 4           |</span><br><span class="line">| 7           |</span><br><span class="line">+-------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">SELECT e1.employee_id</span><br><span class="line">FROM</span><br><span class="line">    Employees AS e1</span><br><span class="line">    JOIN Employees AS e2 ON e1.manager_id = e2.employee_id</span><br><span class="line">    JOIN Employees AS e3 ON e2.manager_id = e3.employee_id</span><br><span class="line">WHERE e1.employee_id != 1 AND e3.manager_id = 1;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">with recursive temp as (</span><br><span class="line">    select e.employee_id from Employees e where e.employee_id!=1 and manager_id=1</span><br><span class="line">    union all </span><br><span class="line">    select e.employee_id from Employees e join temp t on t.employee_id=e.manager_id</span><br><span class="line">)</span><br><span class="line">select * from temp </span><br></pre></td></tr></table></figure>

<h4 id="1280-学生们参加各科测试的次数-ifnull-构造行"><a href="#1280-学生们参加各科测试的次数-ifnull-构造行" class="headerlink" title="1280.学生们参加各科测试的次数 ifnull 构造行"></a>1280.学生们参加各科测试的次数 ifnull 构造行</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">学生表: Students</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| student_id    | int     |</span><br><span class="line">| student_name  | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">在 SQL 中，主键为 student_id（学生ID）。</span><br><span class="line">该表内的每一行都记录有学校一名学生的信息。</span><br><span class="line"></span><br><span class="line">科目表: Subjects</span><br><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| subject_name | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">在 SQL 中，主键为 subject_name（科目名称）。</span><br><span class="line">每一行记录学校的一门科目名称。</span><br><span class="line"></span><br><span class="line">考试表: Examinations</span><br><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| student_id   | int     |</span><br><span class="line">| subject_name | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">这个表可能包含重复数据（换句话说，在 SQL 中，这个表没有主键）。</span><br><span class="line">学生表里的一个学生修读科目表里的每一门科目。</span><br><span class="line">这张考试表的每一行记录就表示学生表里的某个学生参加了一次科目表里某门科目的测试。</span><br><span class="line"> </span><br><span class="line">查询出每个学生参加每一门科目测试的次数，结果按 student_id 和 subject_name 排序。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">with t as(</span><br><span class="line">select e.student_id student_id,student_name,subject_name,count(*) attended_exams </span><br><span class="line">from Examinations e,Students s</span><br><span class="line">where e.student_id = s.student_id </span><br><span class="line">group by e.student_id,subject_name </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">with s as(</span><br><span class="line">select student_id,student_name,subject_name </span><br><span class="line">from Students,Subjects</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">select s.student_id,s.student_name,s.subject_name,ifnull(attended_exams,0) attended_exams</span><br><span class="line">from s left join t</span><br><span class="line">on s.student_id = t.student_id and s.subject_name = t.subject_name </span><br><span class="line">order by student_id,subject_name</span><br></pre></td></tr></table></figure>

<h4 id="1285-找到连续区间的开始和结束数字"><a href="#1285-找到连续区间的开始和结束数字" class="headerlink" title="1285.找到连续区间的开始和结束数字"></a>1285.找到连续区间的开始和结束数字</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">表：Logs</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| log_id        | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id 是上表具有唯一值的列。</span><br><span class="line">上表的每一行包含日志表中的一个 ID。</span><br><span class="line"> </span><br><span class="line">编写解决方案，得到 Logs 表中的连续区间的开始数字和结束数字。</span><br><span class="line">返回结果表按照 start_id 排序。</span><br><span class="line">结果格式如下面的例子。</span><br><span class="line"></span><br><span class="line">示例 1：</span><br><span class="line">输入：</span><br><span class="line">Logs 表：</span><br><span class="line">+------------+</span><br><span class="line">| log_id     |</span><br><span class="line">+------------+</span><br><span class="line">| 1          |</span><br><span class="line">| 2          |</span><br><span class="line">| 3          |</span><br><span class="line">| 7          |</span><br><span class="line">| 8          |</span><br><span class="line">| 10         |</span><br><span class="line">+------------+</span><br><span class="line">输出：</span><br><span class="line">+------------+--------------+</span><br><span class="line">| start_id   | end_id       |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 1          | 3            |</span><br><span class="line">| 7          | 8            |</span><br><span class="line">| 10         | 10           |</span><br><span class="line">+------------+--------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">WITH</span><br><span class="line">    T AS (</span><br><span class="line">        SELECT</span><br><span class="line">            log_id,</span><br><span class="line">            log_id - ROW_NUMBER() OVER (ORDER BY log_id) AS pid</span><br><span class="line">        FROM Logs</span><br><span class="line">    )</span><br><span class="line">SELECT MIN(log_id) AS start_id, MAX(log_id) AS end_id</span><br><span class="line">FROM T</span><br><span class="line">GROUP BY pid;</span><br></pre></td></tr></table></figure>



<h4 id="1321-餐馆营业额变化增长-range-row-between-and"><a href="#1321-餐馆营业额变化增长-range-row-between-and" class="headerlink" title="1321.餐馆营业额变化增长 range  row between and"></a>1321.餐馆营业额变化增长 range  row between and</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">表: Customer</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">| visited_on    | date    |</span><br><span class="line">| amount        | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">在 SQL 中，(customer_id, visited_on) 是该表的主键。</span><br><span class="line">该表包含一家餐馆的顾客交易数据。</span><br><span class="line">visited_on 表示 (customer_id) 的顾客在 visited_on 那天访问了餐馆。</span><br><span class="line">amount 是一个顾客某一天的消费总额。</span><br><span class="line"></span><br><span class="line">你是餐馆的老板，现在你想分析一下可能的营业额变化增长（每天至少有一位顾客）。</span><br><span class="line"></span><br><span class="line">计算以 7 天（某日期 + 该日期前的 6 天）为一个时间段的顾客消费平均值。average_amount 要 保留两位小数。</span><br><span class="line">结果按 visited_on 升序排序。</span><br><span class="line">返回结果格式的例子如下。</span><br><span class="line"></span><br><span class="line">示例 1:</span><br><span class="line">输入：</span><br><span class="line">Customer 表:</span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line">| customer_id | name         | visited_on   | amount      |</span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line">| 1           | Jhon         | 2019-01-01   | 100         |</span><br><span class="line">| 2           | Daniel       | 2019-01-02   | 110         |</span><br><span class="line">| 3           | Jade         | 2019-01-03   | 120         |</span><br><span class="line">| 4           | Khaled       | 2019-01-04   | 130         |</span><br><span class="line">| 5           | Winston      | 2019-01-05   | 110         | </span><br><span class="line">| 6           | Elvis        | 2019-01-06   | 140         | </span><br><span class="line">| 7           | Anna         | 2019-01-07   | 150         |</span><br><span class="line">| 8           | Maria        | 2019-01-08   | 80          |</span><br><span class="line">| 9           | Jaze         | 2019-01-09   | 110         | </span><br><span class="line">| 1           | Jhon         | 2019-01-10   | 130         | </span><br><span class="line">| 3           | Jade         | 2019-01-10   | 150         | </span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line">输出：</span><br><span class="line">+--------------+--------------+----------------+</span><br><span class="line">| visited_on   | amount       | average_amount |</span><br><span class="line">+--------------+--------------+----------------+</span><br><span class="line">| 2019-01-07   | 860          | 122.86         |</span><br><span class="line">| 2019-01-08   | 840          | 120            |</span><br><span class="line">| 2019-01-09   | 840          | 120            |</span><br><span class="line">| 2019-01-10   | 1000         | 142.86         |</span><br><span class="line">+--------------+--------------+----------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select visited_on, amount, average_amount</span><br><span class="line">from (select row_number() over(order by visited_on) rn, </span><br><span class="line">             visited_on,</span><br><span class="line">             round(sum(amount) over (order by visited_on rows between 6 preceding and current row), 2) amount,</span><br><span class="line">             round(avg(amount) over (order by visited_on rows between 6 preceding and current row)/7, 2) average_amount</span><br><span class="line">      from (select visited_on, sum(amount) amount</span><br><span class="line">            from Customer</span><br><span class="line">            group by visited_on) temp) result</span><br><span class="line">where rn &gt;= 7;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">    visited_on, amount, average_amount</span><br><span class="line">from (</span><br><span class="line">    select </span><br><span class="line">        distinct visited_on,  # 因为窗口函数是按照日期计算的。所以相同日期的结果也是相同的，直接去重即可</span><br><span class="line">        sum(amount) over(order by visited_on range interval 6 day preceding) amount, # 按照日期排序，范围是当前日期和当前日期的前六天</span><br><span class="line">        round(sum(amount) over(order by visited_on range interval 6 day preceding)/7, 2) average_amount # 同理</span><br><span class="line">    from </span><br><span class="line">        Customer) t</span><br><span class="line">where datediff(visited_on, (select min(visited_on) from Customer))&gt;=6 #去除日期不足7日的结果</span><br><span class="line">order by visited_on;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">其实是先用窗口函数计算指定日期之内的销售总额，得到两个10号之前的总额，再去重，因为两个10号得到的金额是一样的。ROUND(SUM(amount) OVER (ORDER BY visited_on RANGE INTERVAL 6 DAY PRECEDING) / 7, 2) 计算这7天的消费平均值。这里的计算是针对每个日期的过去7天消费进行的，无论有多少顾客在这7天内消费，都将其总消费额平均。这里除以7就是因为窗口函数其实计算了八个顾客的总金额不能avg，只能除以七天</span><br></pre></td></tr></table></figure>

<h4 id="1322-广告效果-SUM-action-‘xxx’"><a href="#1322-广告效果-SUM-action-‘xxx’" class="headerlink" title="1322.广告效果 SUM(action &#x3D; ‘xxx’)"></a>1322.广告效果 SUM(action &#x3D; ‘xxx’)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">表: Ads</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| ad_id         | int     |</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| action        | enum    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(ad_id, user_id) 是该表的主键(具有唯一值的列的组合)</span><br><span class="line">该表的每一行包含一条广告的 ID(ad_id)，用户的 ID(user_id) 和用户对广告采取的行为 (action)</span><br><span class="line">action 列是一个枚举类型 (&#x27;Clicked&#x27;, &#x27;Viewed&#x27;, &#x27;Ignored&#x27;) 。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">一家公司正在运营这些广告并想计算每条广告的效果。</span><br><span class="line"></span><br><span class="line">广告效果用点击通过率（Click-Through Rate：CTR）来衡量，公式如下:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">编写解决方案找出每一条广告的 ctr ，ctr 要 保留两位小数 。</span><br><span class="line"></span><br><span class="line">返回结果需要按 ctr 降序、按 ad_id 升序 进行排序。</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cloudflare-imgbed-bhx.pages.de/file/1750844415657_61f2-20250625-image-20250625174002953.png" alt="image-20250625174002953"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    ad_id,</span><br><span class="line">    ROUND(IFNULL(SUM(action = &#x27;Clicked&#x27;) / SUM(action IN(&#x27;Clicked&#x27;, &#x27;Viewed&#x27;)) * 100, 0), 2) AS ctr</span><br><span class="line">FROM Ads</span><br><span class="line">GROUP BY 1</span><br><span class="line">ORDER BY 2 DESC, 1;</span><br></pre></td></tr></table></figure>

<h4 id="1336-每次访问的交易次数-难-应该是没读懂题目意思"><a href="#1336-每次访问的交易次数-难-应该是没读懂题目意思" class="headerlink" title="1336.每次访问的交易次数 难 应该是没读懂题目意思"></a>1336.每次访问的交易次数 难 应该是没读懂题目意思</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">表: Visits</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| visit_date    | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(user_id, visit_date) 是该表的主键(具有唯一值的列的组合)</span><br><span class="line">该表的每行表示 user_id 在 visit_date 访问了银行</span><br><span class="line"> </span><br><span class="line">表: Transactions</span><br><span class="line">+------------------+---------+</span><br><span class="line">| Column Name      | Type    |</span><br><span class="line">+------------------+---------+</span><br><span class="line">| user_id          | int     |</span><br><span class="line">| transaction_date | date    |</span><br><span class="line">| amount           | int     |</span><br><span class="line">+------------------+---------+</span><br><span class="line">该表可能有重复行</span><br><span class="line">该表的每一行表示 user_id 在 transaction_date 完成了一笔 amount 数额的交易</span><br><span class="line">可以保证用户 (user) 在 transaction_date 访问了银行 (也就是说 Visits 表包含 (user_id, transaction_date) 行)</span><br><span class="line"> </span><br><span class="line">银行想要得到银行客户在一次访问时的交易次数和相应的在一次访问时该交易次数的客户数量的图表</span><br><span class="line">编写解决方案找出多少客户访问了银行但没有进行任何交易，多少客户访问了银行进行了一次交易等等</span><br><span class="line"></span><br><span class="line">结果包含两列：</span><br><span class="line">transactions_count： 客户在一次访问中的交易次数</span><br><span class="line">visits_count： 在 transactions_count 交易次数下相应的一次访问时的客户数量</span><br><span class="line">transactions_count 的值从 0 到所有用户一次访问中的 max(transactions_count) </span><br><span class="line"></span><br><span class="line">结果按 transactions_count 排序</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">with t as(</span><br><span class="line">select l.user_id user_id,l.visit_date date,count(t.user_id) transactions_count </span><br><span class="line">from Visits l left join Transactions t</span><br><span class="line">on l.user_id = t.user_id and l.visit_date = t.transaction_date</span><br><span class="line">group by l.user_id,l.visit_date</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">select transactions_count,count(distinct user_id) visits_count </span><br><span class="line">from t</span><br><span class="line">group by transactions_count </span><br></pre></td></tr></table></figure>

<h4 id="1369-获取最近第二次的活动"><a href="#1369-获取最近第二次的活动" class="headerlink" title="1369.获取最近第二次的活动"></a>1369.获取最近第二次的活动</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">表: UserActivity</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| username      | varchar |</span><br><span class="line">| activity      | varchar |</span><br><span class="line">| startDate     | Date    |</span><br><span class="line">| endDate       | Date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">该表可能有重复的行</span><br><span class="line">该表包含每个用户在一段时间内进行的活动的信息</span><br><span class="line">名为 username 的用户在 startDate 到 endDate 日内有一次活动</span><br><span class="line"></span><br><span class="line">编写解决方案展示每一位用户 最近第二次 的活动</span><br><span class="line">如果用户仅有一次活动，返回该活动</span><br><span class="line">一个用户不能同时进行超过一项活动，以 任意 顺序返回结果</span><br><span class="line">下面是返回结果格式的例子。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    username,</span><br><span class="line">    activity,</span><br><span class="line">    startdate,</span><br><span class="line">    enddate</span><br><span class="line">FROM</span><br><span class="line">    (</span><br><span class="line">        SELECT</span><br><span class="line">            *,</span><br><span class="line">            RANK() OVER (</span><br><span class="line">                PARTITION BY username</span><br><span class="line">                ORDER BY startdate DESC</span><br><span class="line">            ) AS rk,</span><br><span class="line">            COUNT(username) OVER (PARTITION BY username) AS cnt</span><br><span class="line">        FROM UserActivity</span><br><span class="line">    ) AS a</span><br><span class="line">WHERE a.rk = 2 OR a.cnt = 1;</span><br></pre></td></tr></table></figure>

<h4 id="1384-按年度列出销售总额-难"><a href="#1384-按年度列出销售总额-难" class="headerlink" title="1384.按年度列出销售总额 难"></a>1384.按年度列出销售总额 难</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Product 表：</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| product_name  | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">product_id 是这张表的主键(具有唯一值的列)。</span><br><span class="line">product_name 是产品的名称。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">Sales 表：</span><br><span class="line"></span><br><span class="line">+---------------------+---------+</span><br><span class="line">| Column Name         | Type    |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">| product_id          | int     |</span><br><span class="line">| period_start        | date    |</span><br><span class="line">| period_end          | date    |</span><br><span class="line">| average_daily_sales | int     |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">product_id 是这张表的主键(具有唯一值的列)。</span><br><span class="line">period_start 和 period_end 是该产品销售期的起始日期和结束日期，且这两个日期包含在销售期内。</span><br><span class="line">average_daily_sales 列存储销售期内该产品的日平均销售额。</span><br><span class="line">销售日期范围为2018年到2020年。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写解决方案，找出每个产品每年的总销售额，并包含 product_id , product_name , report_year 以及 total_amount 。</span><br><span class="line"></span><br><span class="line">返回结果并按 product_id 和 report_year 排序。</span><br><span class="line"></span><br><span class="line">返回结果格式如下例所示。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">with s as(</span><br><span class="line">select product_id,product_name,Year(period_start) report_year,datediff(period_end,period_start)*average_daily_sales total_amount</span><br><span class="line">from Sales</span><br><span class="line">where Year(period_start)=Year(period_end)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">with t as(</span><br><span class="line">select product_id,product_name,period_start,case when Year(period_start)=2018 and Year(period_end)=2019 then Year(period_start)+&#x27;12-31&#x27; case when Year(period_start)=2019 and Year(period_end)=2020 then Year(period_start)+&#x27;12-31&#x27; m-year,period_end,average_daily_sales </span><br><span class="line">from Sales</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">with d as(</span><br><span class="line">select product_id,product_name,period_start,&#x27;2018-12-31&#x27; m-year,365,&#x27;2020-1-1&#x27; mm-year,period_end,average_daily_sales </span><br><span class="line">from Sales</span><br><span class="line">where Year(period_start)=2018 and Year(period_end)=2020</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">select product_id,product_name,Year(period_start),datediff(m-year,period_start)*average_daily_sales total_amount</span><br><span class="line">from t</span><br><span class="line">union all </span><br><span class="line">select product_id,product_name,Year(period_end),datediff(period_end,date_add(m-year,interval 1 day)*average_daily_sales total_amount</span><br><span class="line">from t</span><br><span class="line">union all</span><br><span class="line">select *</span><br><span class="line">from s</span><br><span class="line">union all</span><br><span class="line">select product_id,product_name,Year(period_start),datediff(m-year,period_start)*average_daily_sales total_amount from d</span><br><span class="line">union all</span><br><span class="line">select product_id,product_name,2019,365*average_daily_sales total_amount from d</span><br><span class="line">union all</span><br><span class="line">select product_id,product_name,2020,datediff(period_end,mm-year)*average_daily_sales total_amount from d</span><br></pre></td></tr></table></figure>

<h4 id="1412-查找成绩处于中游的学生"><a href="#1412-查找成绩处于中游的学生" class="headerlink" title="1412.查找成绩处于中游的学生"></a>1412.查找成绩处于中游的学生</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">表: Student</span><br><span class="line">+---------------------+---------+</span><br><span class="line">| Column Name         | Type    |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">| student_id          | int     |</span><br><span class="line">| student_name        | varchar |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">student_id 是该表主键(具有唯一值的列)。</span><br><span class="line">student_name 学生名字。</span><br><span class="line"></span><br><span class="line">表: Exam</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| exam_id       | int     |</span><br><span class="line">| student_id    | int     |</span><br><span class="line">| score         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(exam_id, student_id) 是该表主键(具有唯一值的列的组合)。</span><br><span class="line">学生 student_id 在测验 exam_id 中得分为 score。</span><br><span class="line"></span><br><span class="line">成绩处于中游的学生是指至少参加了一次测验, 且得分既不是最高分也不是最低分的学生。</span><br><span class="line">编写解决方案，找出在 所有 测验中都处于中游的学生 (student_id, student_name)。不要返回从来没有参加过测验的学生。</span><br><span class="line"></span><br><span class="line">返回结果表按照 student_id 排序。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">with t as(</span><br><span class="line">select student_id</span><br><span class="line">from Exam a,</span><br><span class="line">(select exam_id,max(score) maxScore,min(score) minScore</span><br><span class="line">from Exam</span><br><span class="line">group by exam_id) s</span><br><span class="line">where a.exam_id = s.exam_id and (a.score = minScore OR a.score = maxScore)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">select student_id,student_name</span><br><span class="line">from Exam,Student</span><br><span class="line">where Exam.student_id = Student.student_id and Exam.student_id not in(</span><br><span class="line">	select * from t</span><br><span class="line">)</span><br><span class="line">order by student_id</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">WITH</span><br><span class="line">    T AS (</span><br><span class="line">        SELECT</span><br><span class="line">            student_id,</span><br><span class="line">            RANK() OVER (</span><br><span class="line">                PARTITION BY exam_id</span><br><span class="line">                ORDER BY score</span><br><span class="line">            ) AS rk1,</span><br><span class="line">            RANK() OVER (</span><br><span class="line">                PARTITION BY exam_id</span><br><span class="line">                ORDER BY score DESC</span><br><span class="line">            ) AS rk2</span><br><span class="line">        FROM Exam</span><br><span class="line">    )</span><br><span class="line">SELECT student_id, student_name</span><br><span class="line">FROM</span><br><span class="line">    T</span><br><span class="line">    JOIN Student USING (student_id)</span><br><span class="line">GROUP BY 1</span><br><span class="line">HAVING SUM(rk1 = 1) = 0 AND SUM(rk2 = 1) = 0</span><br><span class="line">ORDER BY 1;</span><br></pre></td></tr></table></figure>

<h4 id="1435-制作会话柱状图"><a href="#1435-制作会话柱状图" class="headerlink" title="1435.制作会话柱状图"></a>1435.制作会话柱状图</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">表：Sessions</span><br><span class="line">+---------------------+---------+</span><br><span class="line">| Column Name         | Type    |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">| session_id          | int     |</span><br><span class="line">| duration            | int     |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">session_id 是该表主键</span><br><span class="line">duration 是用户访问应用的时间, 以秒为单位</span><br><span class="line"> </span><br><span class="line">你想知道用户在你的 app 上的访问时长情况。因此你决定统计访问时长区间分别为 &quot;[0-5&gt;&quot;，&quot;[5-10&gt;&quot;，&quot;[10-15&gt;&quot; 和 &quot;15 minutes or more&quot; 的会话数量，并以此绘制柱状图。</span><br><span class="line">写一个解决方案来报告 (bin, total) 。</span><br><span class="line"></span><br><span class="line">返回结果 无顺序要求 </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select &#x27;[0-5&gt;&#x27;,sum(duration&gt;=0 and duration&lt;300) total</span><br><span class="line">from Sessions</span><br><span class="line">union all</span><br><span class="line">select &#x27;[5-10&gt;&#x27;,sum(duration&gt;=300 and duration&lt;600) total</span><br><span class="line">from Sessions</span><br><span class="line">union all</span><br><span class="line">select &#x27;[10-15&gt;&#x27;,sum(duration&gt;=600 and duration&lt;900) total</span><br><span class="line">from Sessions</span><br><span class="line">union all</span><br><span class="line">select &#x27;15 or more&#x27;,sum(duration&gt;=900) total</span><br><span class="line">from Sessions</span><br></pre></td></tr></table></figure>

<h4 id="1440-计算布尔表达式的值"><a href="#1440-计算布尔表达式的值" class="headerlink" title="1440.计算布尔表达式的值"></a>1440.计算布尔表达式的值</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">表 Variables:</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| name          | varchar |</span><br><span class="line">| value         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">在 SQL 中，name 是该表主键.</span><br><span class="line">该表包含了存储的变量及其对应的值.</span><br><span class="line"> </span><br><span class="line">表 Expressions:</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| left_operand  | varchar |</span><br><span class="line">| operator      | enum    |</span><br><span class="line">| right_operand | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">在 SQL 中，(left_operand, operator, right_operand) 是该表主键.</span><br><span class="line">该表包含了需要计算的布尔表达式.</span><br><span class="line">operator 是枚举类型, 取值于(&#x27;&lt;&#x27;, &#x27;&gt;&#x27;, &#x27;=&#x27;)</span><br><span class="line">left_operand 和 right_operand 的值保证存在于 Variables 表单中.</span><br><span class="line"></span><br><span class="line">计算表 Expressions 中的布尔表达式。</span><br><span class="line">返回的结果表 无顺序要求 。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select left_operand,operator,right_operand,case when operator=&#x27;=&#x27; then v1.value = v2.value case when operator=&#x27;&gt;&#x27; then v1.value &gt; v2.value case when operator=&#x27;&lt;&#x27; then v1.value &lt; v2.value end value </span><br><span class="line">from Expressions e,Variables v1,Variables v2</span><br><span class="line">where e.left_operand = v1.name and e.right_operand = v2.name</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">SELECT</span><br><span class="line">    left_operand,</span><br><span class="line">    operator,</span><br><span class="line">    right_operand,</span><br><span class="line">    CASE</span><br><span class="line">        WHEN (</span><br><span class="line">            (operator = &#x27;=&#x27; AND v1.value = v2.value)</span><br><span class="line">            OR (operator = &#x27;&gt;&#x27; AND v1.value &gt; v2.value)</span><br><span class="line">            OR (operator = &#x27;&lt;&#x27; AND v1.value &lt; v2.value)</span><br><span class="line">        ) THEN &#x27;true&#x27;</span><br><span class="line">        ELSE &#x27;false&#x27;</span><br><span class="line">    END AS value</span><br><span class="line">FROM</span><br><span class="line">    Expressions AS e</span><br><span class="line">    JOIN Variables AS v1 ON e.left_operand = v1.name</span><br><span class="line">    JOIN Variables AS v2 ON e.right_operand = v2.name;</span><br></pre></td></tr></table></figure>

<h4 id="1454-活跃用户"><a href="#1454-活跃用户" class="headerlink" title="1454.活跃用户"></a>1454.活跃用户</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">表 Accounts:</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id 是该表主键（具有唯一值的列）</span><br><span class="line">该表包含账户 id 和账户的用户名.</span><br><span class="line"></span><br><span class="line">表 Logins:</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| login_date    | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">该表可能包含重复项.</span><br><span class="line">该表包含登录用户的账户 id 和登录日期. 用户也许一天内登录多次.</span><br><span class="line"> </span><br><span class="line">活跃用户 是指那些至少连续 5 天登录账户的用户。</span><br><span class="line">编写解决方案,  找到 活跃用户 的 id 和 name。</span><br><span class="line">返回的结果表按照 id 排序 。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">WITH</span><br><span class="line">    T AS (</span><br><span class="line">        SELECT DISTINCT *</span><br><span class="line">        FROM</span><br><span class="line">            Logins</span><br><span class="line">            JOIN Accounts USING (id)</span><br><span class="line">    ),</span><br><span class="line">    P AS (</span><br><span class="line">        SELECT</span><br><span class="line">            *,</span><br><span class="line">            DATE_SUB(</span><br><span class="line">                login_date,</span><br><span class="line">                INTERVAL ROW_NUMBER() OVER (</span><br><span class="line">                    PARTITION BY id</span><br><span class="line">                    ORDER BY login_date</span><br><span class="line">                ) DAY</span><br><span class="line">            ) g</span><br><span class="line">        FROM T</span><br><span class="line">    )</span><br><span class="line">SELECT DISTINCT id, name</span><br><span class="line">FROM P</span><br><span class="line">GROUP BY id, g</span><br><span class="line">HAVING COUNT(*) &gt;= 5</span><br><span class="line">ORDER BY 1;</span><br></pre></td></tr></table></figure>

<h4 id="1479-周内每天的销售情况"><a href="#1479-周内每天的销售情况" class="headerlink" title="1479.周内每天的销售情况"></a>1479.周内每天的销售情况</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">表：Orders</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| order_id      | int     |</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| order_date    | date    | </span><br><span class="line">| item_id       | varchar |</span><br><span class="line">| quantity      | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(order_id, item_id) 是该表主键(具有唯一值的列的组合)</span><br><span class="line">该表包含了订单信息</span><br><span class="line">order_date 是id为 item_id 的商品被id为 customer_id 的消费者订购的日期.</span><br><span class="line"></span><br><span class="line">表：Items</span><br><span class="line">+---------------------+---------+</span><br><span class="line">| Column Name         | Type    |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">| item_id             | varchar |</span><br><span class="line">| item_name           | varchar |</span><br><span class="line">| item_category       | varchar |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">item_id 是该表主键(具有唯一值的列)</span><br><span class="line">item_name 是商品的名字</span><br><span class="line">item_category 是商品的类别</span><br><span class="line"> </span><br><span class="line">你是企业主，想要获得分类商品和周内每天的销售报告。</span><br><span class="line">编写解决方案，报告 周内每天 每个商品类别下订购了多少单位。</span><br><span class="line">返回结果表单 按商品类别排序 。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">SELECT</span><br><span class="line">    item_category AS c2ategory,</span><br><span class="line">    SUM(IF(DAYOFWEEK(order_date) = &#x27;2&#x27;, quantity, 0)) AS Monday,</span><br><span class="line">    SUM(IF(DAYOFWEEK(order_date) = &#x27;3&#x27;, quantity, 0)) AS Tuesday,</span><br><span class="line">    SUM(IF(DAYOFWEEK(order_date) = &#x27;4&#x27;, quantity, 0)) AS Wednesday,</span><br><span class="line">    SUM(IF(DAYOFWEEK(order_date) = &#x27;5&#x27;, quantity, 0)) AS Thursday,</span><br><span class="line">    SUM(IF(DAYOFWEEK(order_date) = &#x27;6&#x27;, quantity, 0)) AS Friday,</span><br><span class="line">    SUM(IF(DAYOFWEEK(order_date) = &#x27;7&#x27;, quantity, 0)) AS Saturday,</span><br><span class="line">    SUM(IF(DAYOFWEEK(order_date) = &#x27;1&#x27;, quantity, 0)) AS Sunday</span><br><span class="line">FROM</span><br><span class="line">    Orders AS o</span><br><span class="line">    RIGHT JOIN Items AS i ON o.item_id = i.item_id</span><br><span class="line">GROUP BY category</span><br><span class="line">ORDER BY category</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这里把if换成case when也可以，注意case when then ... when then ... end 和case when then end,case when then end的不同</span><br></pre></td></tr></table></figure>

<h4 id="1484-按日期分组销售产品-group-concat"><a href="#1484-按日期分组销售产品-group-concat" class="headerlink" title="1484.按日期分组销售产品 group_concat"></a>1484.按日期分组销售产品 group_concat</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">表 Activities：</span><br><span class="line">+-------------+---------+</span><br><span class="line">| 列名         | 类型    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| sell_date   | date    |</span><br><span class="line">| product     | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">该表没有主键(具有唯一值的列)。它可能包含重复项。</span><br><span class="line">此表的每一行都包含产品名称和在市场上销售的日期。</span><br><span class="line"></span><br><span class="line">编写解决方案找出每个日期、销售的不同产品的数量及其名称。</span><br><span class="line">每个日期的销售产品名称应按词典序排列。</span><br><span class="line">返回按 sell_date 排序的结果表。</span><br><span class="line">结果表结果格式如下例所示。</span><br><span class="line"></span><br><span class="line">示例 1:</span><br><span class="line">输入：</span><br><span class="line">Activities 表：</span><br><span class="line">+------------+-------------+</span><br><span class="line">| sell_date  | product     |</span><br><span class="line">+------------+-------------+</span><br><span class="line">| 2020-05-30 | Headphone   |</span><br><span class="line">| 2020-06-01 | Pencil      |</span><br><span class="line">| 2020-06-02 | Mask        |</span><br><span class="line">| 2020-05-30 | Basketball  |</span><br><span class="line">| 2020-06-01 | Bible       |</span><br><span class="line">| 2020-06-02 | Mask        |</span><br><span class="line">| 2020-05-30 | T-Shirt     |</span><br><span class="line">+------------+-------------+</span><br><span class="line">输出：</span><br><span class="line">+------------+----------+------------------------------+</span><br><span class="line">| sell_date  | num_sold | products                     |</span><br><span class="line">+------------+----------+------------------------------+</span><br><span class="line">| 2020-05-30 | 3        | Basketball,Headphone,T-shirt |</span><br><span class="line">| 2020-06-01 | 2        | Bible,Pencil                 |</span><br><span class="line">| 2020-06-02 | 1        | Mask                         |</span><br><span class="line">+------------+----------+------------------------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">     sell_date,</span><br><span class="line">     count(distinct product) as num_sold,</span><br><span class="line">     group_concat(distinct product order by product separator &#x27;,&#x27;) as products</span><br><span class="line"> from Activities </span><br><span class="line"> group by sell_date</span><br><span class="line"> order by sell_date </span><br></pre></td></tr></table></figure>

<h4 id="1517-查找拥有有效邮箱的用户-regexp-REGEXP-LIKE-正则表达式"><a href="#1517-查找拥有有效邮箱的用户-regexp-REGEXP-LIKE-正则表达式" class="headerlink" title="1517.查找拥有有效邮箱的用户 regexp REGEXP_LIKE 正则表达式"></a>1517.查找拥有有效邮箱的用户 regexp REGEXP_LIKE 正则表达式</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">表: Users</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">| mail          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">user_id 是该表的主键（具有唯一值的列）。</span><br><span class="line">该表包含了网站已注册用户的信息。有一些电子邮件是无效的。</span><br><span class="line"> </span><br><span class="line">编写一个解决方案，以查找具有有效电子邮件的用户。</span><br><span class="line">一个有效的电子邮件具有前缀名称和域，其中：</span><br><span class="line"></span><br><span class="line"> 前缀 名称是一个字符串，可以包含字母（大写或小写），数字，下划线 &#x27;_&#x27; ，点 &#x27;.&#x27; 和/或破折号 &#x27;-&#x27; 。前缀名称 必须 以字母开头。</span><br><span class="line">域 为 &#x27;@leetcode.com&#x27; 。</span><br><span class="line">以任何顺序返回结果表。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select *</span><br><span class="line">from users</span><br><span class="line">where mail regexp &#x27;^[a-zA-Z]+[a-zA-Z0-9_\\.\\/\\-]*@leetcode\\.com$&#x27;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SELECT * </span><br><span class="line">FROM users</span><br><span class="line">WHERE REGEXP_LIKE(mail, &#x27;^[a-zA-Z][a-zA-Z0-9._-]*@leetcode\\.com$&#x27;, &#x27;c&#x27;);</span><br></pre></td></tr></table></figure>

<h4 id="1527-患某种疾病的患者-like-REGEXP"><a href="#1527-患某种疾病的患者-like-REGEXP" class="headerlink" title="1527.患某种疾病的患者 like REGEXP"></a>1527.患某种疾病的患者 like REGEXP</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">患者信息表： Patients</span><br><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| patient_id   | int     |</span><br><span class="line">| patient_name | varchar |</span><br><span class="line">| conditions   | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">在 SQL 中，patient_id （患者 ID）是该表的主键。</span><br><span class="line">&#x27;conditions&#x27; （疾病）包含 0 个或以上的疾病代码，以空格分隔。</span><br><span class="line">这个表包含医院中患者的信息。</span><br><span class="line"></span><br><span class="line">查询患有 I 类糖尿病的患者 ID （patient_id）、患者姓名（patient_name）以及其患有的所有疾病代码（conditions）。I 类糖尿病的代码总是包含前缀DIAB1 。</span><br><span class="line"></span><br><span class="line">按 任意顺序 返回结果表。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from Patients</span><br><span class="line">where conditions like &#x27;DIAB1%&#x27; or conditions like &#x27;% DIAB1%&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT patient_id, patient_name, conditions</span><br><span class="line">FROM Patients</span><br><span class="line">WHERE conditions REGEXP &#x27;^DIAB1|\\sDIAB1&#x27;;</span><br></pre></td></tr></table></figure>

<h4 id="1613-找到遗失的ID-递归-recursive"><a href="#1613-找到遗失的ID-递归-recursive" class="headerlink" title="1613.找到遗失的ID 递归 recursive"></a>1613.找到遗失的ID 递归 recursive</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">表: Customers</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| customer_name | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">customer_id 是该表主键.</span><br><span class="line">该表第一行包含了顾客的名字和 id.</span><br><span class="line"> </span><br><span class="line">编写一个解决方案, 找到所有遗失的顾客 id。遗失的顾客 id 是指那些不在 Customers 表中, 值却处于 1 和表中 最大 customer_id 之间的 id.</span><br><span class="line">注意: 最大的 customer_id 值不会超过 100.</span><br><span class="line">返回结果按 ids 升序 排列</span><br><span class="line"></span><br><span class="line">查询结果格式如下例所示。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">WITH RECURSIVE</span><br><span class="line">    t AS (</span><br><span class="line">        SELECT</span><br><span class="line">            1 AS n</span><br><span class="line">        UNION ALL</span><br><span class="line">        SELECT</span><br><span class="line">            n + 1</span><br><span class="line">        FROM t</span><br><span class="line">        WHERE n &lt; 100</span><br><span class="line">    )</span><br><span class="line">SELECT</span><br><span class="line">    n AS ids</span><br><span class="line">FROM t</span><br><span class="line">WHERE</span><br><span class="line">    n &lt; (</span><br><span class="line">        SELECT</span><br><span class="line">            MAX(customer_id)</span><br><span class="line">        FROM Customers</span><br><span class="line">    )</span><br><span class="line">    AND n NOT IN (</span><br><span class="line">        SELECT</span><br><span class="line">            customer_id</span><br><span class="line">        FROM Customers</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>

<h4 id="1635-Hopper-公司查询-recursive"><a href="#1635-Hopper-公司查询-recursive" class="headerlink" title="1635.Hopper 公司查询! recursive"></a>1635.Hopper 公司查询! recursive</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">表: Drivers</span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| driver_id   | int     |</span><br><span class="line">| join_date   | date    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">driver_id 是该表的主键(具有唯一值的列)。</span><br><span class="line">该表的每一行均包含驾驶员的ID以及他们加入Hopper公司的日期。</span><br><span class="line"></span><br><span class="line">表: Rides</span><br><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| ride_id      | int     |</span><br><span class="line">| user_id      | int     |</span><br><span class="line">| requested_at | date    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">ride_id 是该表的主键(具有唯一值的列)。</span><br><span class="line">该表的每一行均包含行程ID(ride_id)，用户ID(user_id)以及该行程的日期(requested_at)。</span><br><span class="line">该表中可能有一些不被接受的乘车请求。</span><br><span class="line"></span><br><span class="line">表: AcceptedRides</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| ride_id       | int     |</span><br><span class="line">| driver_id     | int     |</span><br><span class="line">| ride_distance | int     |</span><br><span class="line">| ride_duration | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">ride_id 是该表的主键(具有唯一值的列)。</span><br><span class="line">该表的每一行都包含已接受的行程信息。</span><br><span class="line">表中的行程信息都在“Rides”表中存在。</span><br><span class="line">编写解决方案以报告 2020 年每个月的以下统计信息：</span><br><span class="line"></span><br><span class="line">截至某月底，当前在Hopper公司工作的驾驶员数量（active_drivers）。</span><br><span class="line">该月接受的乘车次数（accepted_rides）。</span><br><span class="line">返回按month 升序排列的结果表，其中month 是月份的数字（一月是1，二月是2，依此类推）。</span><br><span class="line"></span><br><span class="line">返回结果格式如下例所示。</span><br><span class="line"></span><br><span class="line">示例 1：</span><br><span class="line">输入：</span><br><span class="line">表 Drivers:</span><br><span class="line">+-----------+------------+</span><br><span class="line">| driver_id | join_date  |</span><br><span class="line">+-----------+------------+</span><br><span class="line">| 10        | 2019-12-10 |</span><br><span class="line">| 8         | 2020-1-13  |</span><br><span class="line">| 5         | 2020-2-16  |</span><br><span class="line">| 7         | 2020-3-8   |</span><br><span class="line">| 4         | 2020-5-17  |</span><br><span class="line">| 1         | 2020-10-24 |</span><br><span class="line">| 6         | 2021-1-5   |</span><br><span class="line">+-----------+------------+</span><br><span class="line">表 Rides:</span><br><span class="line">+---------+---------+--------------+</span><br><span class="line">| ride_id | user_id | requested_at |</span><br><span class="line">+---------+---------+--------------+</span><br><span class="line">| 6       | 75      | 2019-12-9    |</span><br><span class="line">| 1       | 54      | 2020-2-9     |</span><br><span class="line">| 10      | 63      | 2020-3-4     |</span><br><span class="line">| 19      | 39      | 2020-4-6     |</span><br><span class="line">| 3       | 41      | 2020-6-3     |</span><br><span class="line">| 13      | 52      | 2020-6-22    |</span><br><span class="line">| 7       | 69      | 2020-7-16    |</span><br><span class="line">| 17      | 70      | 2020-8-25    |</span><br><span class="line">| 20      | 81      | 2020-11-2    |</span><br><span class="line">| 5       | 57      | 2020-11-9    |</span><br><span class="line">| 2       | 42      | 2020-12-9    |</span><br><span class="line">| 11      | 68      | 2021-1-11    |</span><br><span class="line">| 15      | 32      | 2021-1-17    |</span><br><span class="line">| 12      | 11      | 2021-1-19    |</span><br><span class="line">| 14      | 18      | 2021-1-27    |</span><br><span class="line">+---------+---------+--------------+</span><br><span class="line">表 AcceptedRides:</span><br><span class="line">+---------+-----------+---------------+---------------+</span><br><span class="line">| ride_id | driver_id | ride_distance | ride_duration |</span><br><span class="line">+---------+-----------+---------------+---------------+</span><br><span class="line">| 10      | 10        | 63            | 38            |</span><br><span class="line">| 13      | 10        | 73            | 96            |</span><br><span class="line">| 7       | 8         | 100           | 28            |</span><br><span class="line">| 17      | 7         | 119           | 68            |</span><br><span class="line">| 20      | 1         | 121           | 92            |</span><br><span class="line">| 5       | 7         | 42            | 101           |</span><br><span class="line">| 2       | 4         | 6             | 38            |</span><br><span class="line">| 11      | 8         | 37            | 43            |</span><br><span class="line">| 15      | 8         | 108           | 82            |</span><br><span class="line">| 12      | 8         | 38            | 34            |</span><br><span class="line">| 14      | 1         | 90            | 74            |</span><br><span class="line">+---------+-----------+---------------+---------------+</span><br><span class="line">输出：</span><br><span class="line">+-------+----------------+----------------+</span><br><span class="line">| month | active_drivers | accepted_rides |</span><br><span class="line">+-------+----------------+----------------+</span><br><span class="line">| 1     | 2              | 0              |</span><br><span class="line">| 2     | 3              | 0              |</span><br><span class="line">| 3     | 4              | 1              |</span><br><span class="line">| 4     | 4              | 0              |</span><br><span class="line">| 5     | 5              | 0              |</span><br><span class="line">| 6     | 5              | 1              |</span><br><span class="line">| 7     | 5              | 1              |</span><br><span class="line">| 8     | 5              | 1              |</span><br><span class="line">| 9     | 5              | 0              |</span><br><span class="line">| 10    | 6              | 0              |</span><br><span class="line">| 11    | 6              | 2              |</span><br><span class="line">| 12    | 6              | 1              |</span><br><span class="line">+-------+----------------+----------------+</span><br><span class="line">解释：</span><br><span class="line">截至1月底-&gt;两个活跃的驾驶员（10,8），没有被接受的行程。</span><br><span class="line">截至2月底-&gt;三个活跃的驾驶员（10,8,5），没有被接受的行程。</span><br><span class="line">截至3月底-&gt;四个活跃的驾驶员（10,8,5,7），一个被接受的行程（10）。</span><br><span class="line">截至4月底-&gt;四个活跃的驾驶员（10,8,5,7），没有被接受的行程。</span><br><span class="line">截至5月底-&gt;五个活跃的驾驶员（10,8,5,7,4），没有被接受的行程。</span><br><span class="line">截至6月底-&gt;五个活跃的驾驶员（10,8,5,7,4），一个被接受的行程（13）。</span><br><span class="line">截至7月底-&gt;五个活跃的驾驶员（10,8,5,7,4），一个被接受的行程（7）。</span><br><span class="line">截至8月底-&gt;五个活跃的驾驶员（10,8,5,7,4），一位接受的行程（17）。</span><br><span class="line">截至9月底-&gt;五个活跃的驾驶员（10,8,5,7,4），没有被接受的行程。</span><br><span class="line">截至10月底-&gt;六个活跃的驾驶员（10,8,5,7,4,1），没有被接受的行程。</span><br><span class="line">截至11月底-&gt;六个活跃的驾驶员（10,8,5,7,4,1），两个被接受的行程（20,5）。</span><br><span class="line">截至12月底-&gt;六个活跃的驾驶员（10,8,5,7,4,1），一个被接受的行程（2）。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">WITH</span><br><span class="line">    recursive Months AS (</span><br><span class="line">        SELECT</span><br><span class="line">            1 AS month</span><br><span class="line">        UNION ALL</span><br><span class="line">        SELECT</span><br><span class="line">            month + 1</span><br><span class="line">        FROM Months</span><br><span class="line">        WHERE month &lt; 12</span><br><span class="line">    ),</span><br><span class="line">    Ride AS (</span><br><span class="line">        SELECT MONTH(requested_at) AS month, COUNT(1) AS cnt</span><br><span class="line">        FROM</span><br><span class="line">            Rides AS r</span><br><span class="line">            JOIN AcceptedRides AS a</span><br><span class="line">                ON r.ride_id = a.ride_id AND YEAR(requested_at) = 2020</span><br><span class="line">        GROUP BY month</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">SELECT</span><br><span class="line">    m.month,</span><br><span class="line">    COUNT(driver_id) AS active_drivers,</span><br><span class="line">    IFNULL(r.cnt, 0) AS accepted_rides</span><br><span class="line">FROM</span><br><span class="line">    Months AS m</span><br><span class="line">    LEFT JOIN Drivers AS d</span><br><span class="line">        ON (m.month &gt;= MONTH(d.join_date) AND YEAR(d.join_date) = 2020)</span><br><span class="line">        OR YEAR(d.join_date) &lt; 2020</span><br><span class="line">    LEFT JOIN Ride AS r ON m.month = r.month</span><br><span class="line">GROUP BY month;</span><br></pre></td></tr></table></figure>

<h4 id="1651-Hopper-公司查询-川-RECURSIVE-OVER-ROWS-BETWEEN"><a href="#1651-Hopper-公司查询-川-RECURSIVE-OVER-ROWS-BETWEEN" class="headerlink" title="1651.Hopper 公司查询 川 RECURSIVE OVER (ROWS BETWEEN)"></a>1651.Hopper 公司查询 川 RECURSIVE OVER (ROWS BETWEEN)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">表： Drivers</span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| driver_id   | int     |</span><br><span class="line">| join_date   | date    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">driver_id 是该表具有唯一值的列。</span><br><span class="line">该表的每一行均包含驾驶员的 ID 以及他们加入 Hopper 公司的日期。</span><br><span class="line"></span><br><span class="line">表：Rides</span><br><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| ride_id      | int     |</span><br><span class="line">| user_id      | int     |</span><br><span class="line">| requested_at | date    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">ride_id 是该表具有唯一值的列。 </span><br><span class="line">该表的每一行均包含行程 ID(ride_id)，用户 ID(user_id) 以及该行程的日期(requested_at)。 </span><br><span class="line">该表中可能有一些不被接受的乘车请求。</span><br><span class="line"></span><br><span class="line">表：AcceptedRides</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| ride_id       | int     |</span><br><span class="line">| driver_id     | int     |</span><br><span class="line">| ride_distance | int     |</span><br><span class="line">| ride_duration | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">ride_id 是该表具有唯一值的列。 </span><br><span class="line">该表的每一行都包含已接受的行程信息。 </span><br><span class="line">表中的行程信息都在 &quot;Rides&quot; 表中存在。</span><br><span class="line"> </span><br><span class="line">编写一个解决方案，计算出从 2020 年 1 月至 3 月 至 2020 年 10 月至 12 月 的每三个月窗口的 average_ride_distance 和 average_ride_duration 。并将 average_ride_distance 和 average_ride_duration 四舍五入至 小数点后两位 。</span><br><span class="line">通过将三个月的总 ride_distance 相加并除以 3 来计算 average_ride_distance 。average_ride_duration 的计算方法与此类似。</span><br><span class="line">返回按 month 升序排列的结果表，其中 month 是起始月份的编号（一月为 1，二月为 2 ...）。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">WITH RECURSIVE</span><br><span class="line">    Months AS (</span><br><span class="line">        SELECT 1 AS month</span><br><span class="line">        UNION ALL</span><br><span class="line">        SELECT month + 1</span><br><span class="line">        FROM Months</span><br><span class="line">        WHERE month &lt; 12</span><br><span class="line">    ),</span><br><span class="line">    Ride AS (</span><br><span class="line">        SELECT</span><br><span class="line">            month,</span><br><span class="line">            SUM(IFNULL(ride_distance, 0)) AS ride_distance,</span><br><span class="line">            SUM(IFNULL(ride_duration, 0)) AS ride_duration</span><br><span class="line">        FROM</span><br><span class="line">            Months AS m</span><br><span class="line">            LEFT JOIN Rides AS r ON month = MONTH(requested_at) AND YEAR(requested_at) = 2020</span><br><span class="line">            LEFT JOIN AcceptedRides AS a ON r.ride_id = a.ride_id</span><br><span class="line">        GROUP BY month</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">SELECT</span><br><span class="line">    month,</span><br><span class="line">    ROUND(</span><br><span class="line">        AVG(ride_distance) OVER (ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING),</span><br><span class="line">        2</span><br><span class="line">    ) AS average_ride_distance,</span><br><span class="line">    ROUND(</span><br><span class="line">        AVG(ride_duration) OVER (ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING),</span><br><span class="line">        2</span><br><span class="line">    ) AS average_ride_duration</span><br><span class="line">FROM Ride</span><br><span class="line">ORDER BY month</span><br><span class="line">LIMIT 10;</span><br></pre></td></tr></table></figure>

<h4 id="1661-每台机器的进程平均运行时间"><a href="#1661-每台机器的进程平均运行时间" class="headerlink" title="1661.每台机器的进程平均运行时间"></a>1661.每台机器的进程平均运行时间</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">表: Activity</span><br><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| machine_id     | int     |</span><br><span class="line">| process_id     | int     |</span><br><span class="line">| activity_type  | enum    |</span><br><span class="line">| timestamp      | float   |</span><br><span class="line">+----------------+---------+</span><br><span class="line">该表展示了一家工厂网站的用户活动。</span><br><span class="line">(machine_id, process_id, activity_type) 是当前表的主键（具有唯一值的列的组合）。</span><br><span class="line">machine_id 是一台机器的ID号。</span><br><span class="line">process_id 是运行在各机器上的进程ID号。</span><br><span class="line">activity_type 是枚举类型 (&#x27;start&#x27;, &#x27;end&#x27;)。</span><br><span class="line">timestamp 是浮点类型,代表当前时间(以秒为单位)。</span><br><span class="line">&#x27;start&#x27; 代表该进程在这台机器上的开始运行时间戳 , &#x27;end&#x27; 代表该进程在这台机器上的终止运行时间戳。</span><br><span class="line">同一台机器，同一个进程都有一对开始时间戳和结束时间戳，而且开始时间戳永远在结束时间戳前面。</span><br><span class="line"></span><br><span class="line">现在有一个工厂网站由几台机器运行，每台机器上运行着 相同数量的进程 。编写解决方案，计算每台机器各自完成一个进程任务的平均耗时。</span><br><span class="line"></span><br><span class="line">完成一个进程任务的时间指进程的&#x27;end&#x27; 时间戳 减去 &#x27;start&#x27; 时间戳。平均耗时通过计算每台机器上所有进程任务的总耗费时间除以机器上的总进程数量获得。</span><br><span class="line"></span><br><span class="line">结果表必须包含machine_id（机器ID） 和对应的 average time（平均耗时） 别名 processing_time，且四舍五入保留3位小数。</span><br><span class="line"></span><br><span class="line">以 任意顺序 返回表。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">    machine_id,</span><br><span class="line">    round(2*avg(if(activity_type = &#x27;start&#x27;,-1,1)*timestamp),3) as processing_time</span><br><span class="line">from</span><br><span class="line">    Activity</span><br><span class="line">group by</span><br><span class="line">    machine_id</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum(if(activity_type = &#x27;start&#x27;,-1*timestamp,timestamp))/count(distinct process_id)</span><br></pre></td></tr></table></figure>

<h4 id="1667-修复表中的名字-concat-left-right-upper-lower"><a href="#1667-修复表中的名字-concat-left-right-upper-lower" class="headerlink" title="1667.修复表中的名字 concat left right upper lower"></a>1667.修复表中的名字 concat left right upper lower</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">表： Users</span><br><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| user_id        | int     |</span><br><span class="line">| name           | varchar |</span><br><span class="line">+----------------+---------+</span><br><span class="line">user_id 是该表的主键(具有唯一值的列)。</span><br><span class="line">该表包含用户的 ID 和名字。名字仅由小写和大写字符组成。</span><br><span class="line"></span><br><span class="line">编写解决方案，修复名字，使得只有第一个字符是大写的，其余都是小写的。</span><br><span class="line"></span><br><span class="line">返回按 user_id 排序的结果表。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">with cte1 as (</span><br><span class="line">    #先全部小写处理</span><br><span class="line">    select user_id, lower(name) as name from Users) </span><br><span class="line">    #首字母改成大写和字符串剩下部分进行拼接</span><br><span class="line">    select user_id,  concat( </span><br><span class="line">        case substring(name,1,1) when &quot;a&quot; then &quot;A&quot; </span><br><span class="line">        when &quot;b&quot; then &quot;B&quot; </span><br><span class="line">        when &quot;c&quot; then &quot;C&quot; </span><br><span class="line">        when &quot;d&quot; then &quot;D&quot; </span><br><span class="line">        when &quot;e&quot; then &quot;E&quot; </span><br><span class="line">        when &quot;f&quot; then &quot;F&quot; </span><br><span class="line">        when &quot;g&quot; then &quot;G&quot; </span><br><span class="line">        when &quot;h&quot; then &quot;H&quot; </span><br><span class="line">        when &quot;i&quot; then &quot;I&quot; </span><br><span class="line">        when &quot;j&quot; then &quot;J&quot; </span><br><span class="line">        when &quot;k&quot; then &quot;K&quot; </span><br><span class="line">        when &quot;l&quot; then &quot;L&quot; </span><br><span class="line">        when &quot;m&quot; then &quot;M&quot; </span><br><span class="line">        when &quot;n&quot; then &quot;N&quot; </span><br><span class="line">        when &quot;o&quot; then &quot;O&quot; </span><br><span class="line">        when &quot;p&quot; then &quot;P&quot; </span><br><span class="line">        when &quot;q&quot; then &quot;Q&quot; </span><br><span class="line">        when &quot;r&quot; then &quot;R&quot; </span><br><span class="line">        when &quot;s&quot; then &quot;S&quot; </span><br><span class="line">        when &quot;t&quot; then &quot;T&quot; </span><br><span class="line">        when &quot;u&quot; then &quot;U&quot; </span><br><span class="line">        when &quot;v&quot; then &quot;V&quot; </span><br><span class="line">        when &quot;w&quot; then &quot;W&quot; </span><br><span class="line">        when &quot;x&quot; then &quot;X&quot; </span><br><span class="line">        when &quot;y&quot; then &quot;Y&quot; </span><br><span class="line">        when &quot;z&quot; then &quot;Z&quot; end ,</span><br><span class="line">    substring(name,2)) as name from cte1 order by user_id;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select user_id,</span><br><span class="line">concat(upper(left(name, 1)), lower(right(name, length(name) - 1))) name</span><br><span class="line">from Users</span><br><span class="line">order by user_id</span><br></pre></td></tr></table></figure>

<h4 id="1683-无效的推文"><a href="#1683-无效的推文" class="headerlink" title="1683.无效的推文"></a>1683.无效的推文</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">表：Tweets</span><br><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| tweet_id       | int     |</span><br><span class="line">| content        | varchar |</span><br><span class="line">+----------------+---------+</span><br><span class="line">在 SQL 中，tweet_id 是这个表的主键。</span><br><span class="line">content 只包含字母数字字符，&#x27;!&#x27;，&#x27; &#x27;，不包含其它特殊字符。</span><br><span class="line">这个表包含某社交媒体 App 中所有的推文。</span><br><span class="line"></span><br><span class="line">查询所有无效推文的编号（ID）。当推文内容中的字符数严格大于 15 时，该推文是无效的。</span><br><span class="line"></span><br><span class="line">以任意顺序返回结果表。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">SELECT</span><br><span class="line">    tweet_id</span><br><span class="line">FROM Tweets</span><br><span class="line">WHERE CHAR_LENGTH(content) &gt; 15;</span><br></pre></td></tr></table></figure>

<h4 id="1709-访问日期之间最大的空档期-LEAD-xxx-OVER-partition-by"><a href="#1709-访问日期之间最大的空档期-LEAD-xxx-OVER-partition-by" class="headerlink" title="1709.访问日期之间最大的空档期  LEAD(xxx) OVER(partition by)"></a>1709.访问日期之间最大的空档期  LEAD(xxx) OVER(partition by)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">表： UserVisits</span><br><span class="line">+-------------+------+</span><br><span class="line">| Column Name | Type |</span><br><span class="line">+-------------+------+</span><br><span class="line">| user_id     | int  |</span><br><span class="line">| visit_date  | date |</span><br><span class="line">+-------------+------+</span><br><span class="line">该表没有主键，它可能有重复的行</span><br><span class="line">该表包含用户访问某特定零售商的日期日志。</span><br><span class="line"> </span><br><span class="line">假设今天的日期是 &#x27;2021-1-1&#x27; 。</span><br><span class="line"></span><br><span class="line">编写解决方案，对于每个 user_id ，求出每次访问及其下一个访问（若该次访问是最后一次，则为今天）之间最大的空档期天数 window 。</span><br><span class="line"></span><br><span class="line">返回结果表，按用户编号 user_id 排序。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">with t as(</span><br><span class="line">	select user_id,visit_date,row_number() over(partition by user_id order by visit_date) rk</span><br><span class="line">	from UserVisits</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">with s as(</span><br><span class="line">select t1.user_id user_id,max(t2.visit_date-t1.visit_date) biggest_window</span><br><span class="line">from t t1 join t t2 </span><br><span class="line">on t1.user_id = t2.user_id and t2.rk - t1.rk = 1</span><br><span class="line">group by t1.user_id</span><br><span class="line">order by user_id</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">select * from s</span><br><span class="line">union all</span><br><span class="line">select user_id,datediff(&#x27;2021-1-1&#x27;,visit_date) biggest_window</span><br><span class="line">from UserVisits</span><br><span class="line">where user_id not in select user_id from s</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">WITH</span><br><span class="line">    T AS (</span><br><span class="line">        SELECT</span><br><span class="line">            user_id,</span><br><span class="line">            DATEDIFF(</span><br><span class="line">                LEAD(visit_date, 1, &#x27;2021-1-1&#x27;) OVER (</span><br><span class="line">                    PARTITION BY user_id</span><br><span class="line">                    ORDER BY visit_date</span><br><span class="line">                ),</span><br><span class="line">                visit_date</span><br><span class="line">            ) AS diff</span><br><span class="line">        FROM UserVisits</span><br><span class="line">    )</span><br><span class="line">SELECT user_id, MAX(diff) AS biggest_window</span><br><span class="line">FROM T</span><br><span class="line">GROUP BY 1</span><br><span class="line">ORDER BY 1;</span><br></pre></td></tr></table></figure>



<h4 id="1972-同一天的第一个电话和最后一个电话-难"><a href="#1972-同一天的第一个电话和最后一个电话-难" class="headerlink" title="1972  同一天的第一个电话和最后一个电话 难"></a>1972  同一天的第一个电话和最后一个电话 难</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">编写一个 SQL 查询来找出那些ID们在任意一天的第一个电话和最后一个电话都是和同一个人的。这些电话不论是拨打者还是接收者都会被记录。</span><br><span class="line">结果请放在一个任意次序约束的表中。</span><br><span class="line">查询结果格式如下所示：</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202408121903084.png" alt="image-20240812190332249"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">--MySQL </span><br><span class="line">with temp as (select * from calls</span><br><span class="line">            union all</span><br><span class="line">            select recipient_id caller_id, caller_id recipient_id, call_time from calls</span><br><span class="line">    ),</span><br><span class="line"></span><br><span class="line">temp1 as (select</span><br><span class="line">            *,</span><br><span class="line">            dense_rank() over (partition by date_format(call_time,&quot;%Y-%m-%d&quot;),caller_id order by call_time asc) rk1,</span><br><span class="line">            dense_rank() over (partition by date_format(call_time,&quot;%Y-%m-%d&quot;),caller_id order by call_time desc) rk2</span><br><span class="line">        from temp</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">select</span><br><span class="line">    distinct caller_id as user_id</span><br><span class="line">from temp1</span><br><span class="line">where rk1 = 1 or rk2 = 1</span><br><span class="line">group by caller_id, date_format(call_time,&quot;%Y-%m-%d&quot;)</span><br><span class="line">having count(distinct recipient_id) = 1</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">with t1 as (select</span><br><span class="line">caller_id,recipient_id,call_time #选出 所有id 在某个时间 跟另一个通话的id</span><br><span class="line">from</span><br><span class="line">Calls</span><br><span class="line"> </span><br><span class="line">union all</span><br><span class="line"> </span><br><span class="line">select</span><br><span class="line">recipient_id,caller_id,call_time</span><br><span class="line">from</span><br><span class="line">Calls</span><br><span class="line">),</span><br><span class="line">t2 as (</span><br><span class="line">select#按 caller_id 和 每天 分组  对 call_time标号 便于 找到 每天 第一个 和最后的一通电话</span><br><span class="line">caller_id,recipient_id,call_time,row_number() over(partition by caller_id,date_format(call_time,&#x27;%Y-%m-%d&#x27;) order by call_time) rn,row_number() over(partition by caller_id,date_format(call_time,&#x27;%Y-%m-%d&#x27;) order by call_time desc) rn2</span><br><span class="line">from</span><br><span class="line">t1</span><br><span class="line">),</span><br><span class="line">t3 as (</span><br><span class="line">select</span><br><span class="line">caller_id,recipient_id,date_format(call_time,&#x27;%Y-%m-%d&#x27;) day #某天第一次通话</span><br><span class="line">from</span><br><span class="line">t2</span><br><span class="line">where rn = 1 </span><br><span class="line">union all</span><br><span class="line">select</span><br><span class="line">caller_id,recipient_id,date_format(call_time,&#x27;%Y-%m-%d&#x27;) day#某天最后一次通话</span><br><span class="line">from</span><br><span class="line">t2</span><br><span class="line">where rn2 = 1 </span><br><span class="line">)</span><br><span class="line">select</span><br><span class="line">distinct caller_id user_id</span><br><span class="line">from</span><br><span class="line"> </span><br><span class="line">t3</span><br><span class="line">group by </span><br><span class="line">caller_id,day #对 某人某天第一次 和最后一次通话的id 去重计数  值为1就是题中需求</span><br><span class="line">having</span><br><span class="line">count(distinct recipient_id)=1</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t2结果</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202408131737800.png" alt="image-20240813173733417"></p>
<h5 id="mysql注释问题"><a href="#mysql注释问题" class="headerlink" title="mysql注释问题"></a>mysql注释问题</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在MySQL中，注释不应该使用井号（#）在SQL语句的中间部分，尤其是在SELECT列表或其他语句结构中。井号（#）在MySQL中通常用于行尾来标记注释的开始，直到行末。如果您想在SQL语句的某部分添加注释，您应该使用两个连字符（--）后跟空格，或者如果注释跨越多行，您可以使用/* 注释内容 */。</span><br></pre></td></tr></table></figure>

<h5 id="mysql修改列数据类型"><a href="#mysql修改列数据类型" class="headerlink" title="mysql修改列数据类型"></a>mysql修改列数据类型</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MySQL </span><br><span class="line">alter table name modify column col1 int;</span><br><span class="line"></span><br><span class="line">sql server </span><br><span class="line">alter table name alter column col1 int;</span><br></pre></td></tr></table></figure>



<h4 id="1988"><a href="#1988" class="headerlink" title="1988"></a>1988</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">表： Schools</span><br><span class="line"></span><br><span class="line">+-------------+------+</span><br><span class="line">| Column Name | Type |</span><br><span class="line">+-------------+------+</span><br><span class="line">| school_id   | int  |</span><br><span class="line">| capacity    | int  |</span><br><span class="line">+-------------+------+</span><br><span class="line">school_id 是该表的主键。</span><br><span class="line">此表包含了一些学校的容纳能力。容纳能力指的是学校能够接纳学生的最大数量。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">表： Exam</span><br><span class="line"></span><br><span class="line">+---------------+------+</span><br><span class="line">| Column Name   | Type |</span><br><span class="line">+---------------+------+</span><br><span class="line">| score         | int  |</span><br><span class="line">| student_count | int  |</span><br><span class="line">+---------------+------+</span><br><span class="line">score 是该表的主键。</span><br><span class="line">表中每一行表示有 student_count 名学生在考试中至少获得了 score 分。</span><br><span class="line">表中的数据在逻辑上是正确的，即记录了高score的行相比记录了低score的行拥有相同或更少的student_count。</span><br><span class="line">也就是说，对于表中的i行与j行，如果scorei &gt; scorej，那么student_counti &lt;= student_countj</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">每年，学校会公布学生申请所需的最低分数要求。学校根据所有学生的考试成绩来决定其最低分数要求。</span><br><span class="line"></span><br><span class="line">学校希望确保即使每一个满足分数要求的学生都申请该学校，学校也有足够的能力接纳每一个学生。</span><br><span class="line">学校也希望尽可能多的学生能申请该学校。</span><br><span class="line">学校必须使用在 Exam 表中的 score 来作为最低分数要求。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">编写一个SQL查询来查询每所学校的最低分数要求。如果同时有多个score值满足上述要求，则选择其中最小的一个。如果数据不足以决定最低分数要求，那么输出 -1。</span><br><span class="line"></span><br><span class="line">返回的结果表可以按任意顺序排序。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">查询结果格式如下例所示：</span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line"></span><br><span class="line">输入:</span><br><span class="line">Schools 表:</span><br><span class="line">+-----------+----------+</span><br><span class="line">| school_id | capacity |</span><br><span class="line">+-----------+----------+</span><br><span class="line">| 11        | 151      |</span><br><span class="line">| 5         | 48       |</span><br><span class="line">| 9         | 9        |</span><br><span class="line">| 10        | 99       |</span><br><span class="line">+-----------+----------+</span><br><span class="line">Exam 表:</span><br><span class="line">+-------+---------------+</span><br><span class="line">| score | student_count |</span><br><span class="line">+-------+---------------+</span><br><span class="line">| 975   | 10            |</span><br><span class="line">| 966   | 60            |</span><br><span class="line">| 844   | 76            |</span><br><span class="line">| 749   | 76            |</span><br><span class="line">| 744   | 100           |</span><br><span class="line">+-------+---------------+</span><br><span class="line">输出:</span><br><span class="line">+-----------+-------+</span><br><span class="line">| school_id | score |</span><br><span class="line">+-----------+-------+</span><br><span class="line">| 5         | 975   |</span><br><span class="line">| 9         | -1    |</span><br><span class="line">| 10        | 749   |</span><br><span class="line">| 11        | 744   |</span><br><span class="line">+-----------+-------+</span><br><span class="line">解释： </span><br><span class="line">- School 5：学校的容纳能力为 48 。选择 975 作为最低分数要求，因为学校最多会收到 10 份申请，这在学校的容纳能力以内。</span><br><span class="line">- School 10：学校的容纳能力为 99 。可以选择 844 或 749 作为最低分数要求，因为学校最多会收到 76 份申请，这在学校的容纳能力以内。又因为 749 是所有可选项中最小的，因此我们选择 749 。</span><br><span class="line">- School 11：学校的容纳能力为 151 。选择 744 作为最低分数要求，因为学校最多会收到 100 份申请，这在学校的容纳能力以内。</span><br><span class="line">- School 9：给出的数据不足以确定最低分数要求。如果选择 975 作为最低分数要求，学校可能会收到 10 份申请，然而学校的容纳能力只有 9 。我们没有关于更高分数的信息，因此我们返回 -1 。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">    school_id,</span><br><span class="line">    ifnull(min(score),-1) as score</span><br><span class="line">from Schools</span><br><span class="line">left join Exam</span><br><span class="line">on capacity&gt;=student_count</span><br><span class="line">group by school_id;</span><br></pre></td></tr></table></figure>

<h4 id="1990"><a href="#1990" class="headerlink" title="1990"></a>1990</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">问题：</span><br><span class="line">三个实验平台中每种实验完成的次数</span><br><span class="line">请注意，每一对（实验平台、实验名称）都应包含在输出中，包括平台上实验次数是零的。</span><br><span class="line"></span><br><span class="line">表: Experiments</span><br><span class="line"></span><br><span class="line">+-----------------+------+</span><br><span class="line">| Column Name     | Type |</span><br><span class="line">+-----------------+------+</span><br><span class="line">| experiment_id   | int  |</span><br><span class="line">| platform        | enum |</span><br><span class="line">| experiment_name | enum |</span><br><span class="line">+-----------------+------+</span><br><span class="line"></span><br><span class="line">experiment_id 是这个表的主键.</span><br><span class="line">platform 是枚举类型的，取值是这三种 (&#x27;Android&#x27;, &#x27;IOS&#x27;, &#x27;Web&#x27;) 之一.</span><br><span class="line">experiment_name 也是枚举类型的，取值是这三种 (&#x27;Reading&#x27;, &#x27;Sports&#x27;, &#x27;Programming&#x27;) 之一.</span><br><span class="line">这个表包含有关随机实验人员进行的实验的 ID、用于做实验的平台以及实验名称的信息。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">结果可以以任意顺序给出。</span><br><span class="line">查询的结果如下所示：</span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line">输入：</span><br><span class="line">Experiments table:</span><br><span class="line">+---------------+----------+-----------------+</span><br><span class="line">| experiment_id | platform | experiment_name |</span><br><span class="line">+---------------+----------+-----------------+</span><br><span class="line">| 4             | IOS      | Programming     |</span><br><span class="line">| 13            | IOS      | Sports          |</span><br><span class="line">| 14            | Android  | Reading         |</span><br><span class="line">| 8             | Web      | Reading         |</span><br><span class="line">| 12            | Web      | Reading         |</span><br><span class="line">| 18            | Web      | Programming     |</span><br><span class="line">+---------------+----------+-----------------+</span><br><span class="line">输出：</span><br><span class="line">+----------+-----------------+-----------------+</span><br><span class="line">| platform | experiment_name | num_experiments |</span><br><span class="line">+----------+-----------------+-----------------+</span><br><span class="line">| Android  | Reading         | 1               |</span><br><span class="line">| Android  | Sports          | 0               |</span><br><span class="line">| Android  | Programming     | 0               |</span><br><span class="line">| IOS      | Reading         | 0               |</span><br><span class="line">| IOS      | Sports          | 1               |</span><br><span class="line">| IOS      | Programming     | 1               |</span><br><span class="line">| Web      | Reading         | 2               |</span><br><span class="line">| Web      | Sports          | 0               |</span><br><span class="line">| Web      | Programming     | 1               |</span><br><span class="line">+----------+-----------------+-----------------+</span><br><span class="line">解释：</span><br><span class="line">在安卓平台上, 我们只做了一个&quot;Reading&quot; 实验.</span><br><span class="line">在 &quot;IOS&quot; 平台上，我们做了一个&quot;Sports&quot; 实验和一个&quot;Programming&quot; 实验.</span><br><span class="line">在 &quot;Web&quot; 平台上，我们做了两个&quot;Reading&quot; 实验和一个&quot;Programming&quot; 实验.</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-- https://leetcode.cn/problems/count-the-number-of-experiments</span><br><span class="line">drop table if EXISTS Experiments;</span><br><span class="line">Create table If Not Exists Experiments (experiment_id int, platform enum(&#x27;Android&#x27;,&#x27;IOS&#x27;,&#x27;Web&#x27;), experiment_name enum(&#x27;Programming&#x27;,&#x27;Sports&#x27;,&#x27;Reading&#x27;));</span><br><span class="line">insert into Experiments values (4,&#x27;IOS&#x27;,&#x27;Programming&#x27;);</span><br><span class="line">insert into Experiments values (13,&#x27;IOS&#x27;,&#x27;Sports&#x27;);</span><br><span class="line">insert into Experiments values (14,&#x27;Android&#x27;,&#x27;Reading&#x27;);</span><br><span class="line">insert into Experiments values (8,&#x27;Web&#x27;,&#x27;Reading&#x27;);</span><br><span class="line">insert into Experiments values (12,&#x27;Web&#x27;,&#x27;Reading&#x27;);</span><br><span class="line">insert into Experiments values (18,&#x27;Web&#x27;,&#x27;Programming&#x27;);</span><br><span class="line">select * from Experiments;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">with pe as</span><br><span class="line">(   select * from</span><br><span class="line">    (</span><br><span class="line">    select &#x27;IOS&#x27; platform union all</span><br><span class="line">    select &#x27;Android&#x27; platform union all</span><br><span class="line">    select &#x27;Web&#x27; platform</span><br><span class="line">    )p</span><br><span class="line">cross join</span><br><span class="line">(</span><br><span class="line">    select &#x27;Programming&#x27; experiment_name union all</span><br><span class="line">    select &#x27;Sports&#x27; experiment_name union all</span><br><span class="line">    select &#x27;Reading&#x27; experiment_name</span><br><span class="line">)e</span><br><span class="line">)</span><br><span class="line">-- select * from pe;</span><br><span class="line">select pe.platform,pe.experiment_name,count(w.platform) as num_experiments</span><br><span class="line">from pe left join Experiments as w using(platform,experiment_name)</span><br><span class="line">group by platform,experiment_name;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">with new_table as(</span><br><span class="line">    select &#x27;Android&#x27; platform</span><br><span class="line">    union select &#x27;IOS&#x27;</span><br><span class="line">    union select &#x27;Web&#x27;</span><br><span class="line">),</span><br><span class="line">other_table as(</span><br><span class="line">    select &#x27;Reading&#x27; experiment_name</span><br><span class="line">    union select &#x27;Sports&#x27;</span><br><span class="line">    union select &#x27;Programming&#x27;</span><br><span class="line">)</span><br><span class="line">select new_table.platform ,other_table.experiment_name,count(experiment_id)num_experiments</span><br><span class="line">from new_table join other_table #笛卡尔积</span><br><span class="line">left join Experiments E </span><br><span class="line">on E.platform = new_table.platform </span><br><span class="line">AND other_table.experiment_name = E.experiment_name</span><br><span class="line">group by new_table.platform ,other_table.experiment_name</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2004"><a href="#2004" class="headerlink" title="2004"></a>2004</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">SQL架构</span><br><span class="line"></span><br><span class="line">表: Candidates</span><br><span class="line"></span><br><span class="line">+-------------+------+</span><br><span class="line">| Column Name | Type |</span><br><span class="line">+-------------+------+</span><br><span class="line">| employee_id | int  |</span><br><span class="line">| experience  | enum |</span><br><span class="line">| salary      | int  |</span><br><span class="line">+-------------+------+</span><br><span class="line">employee_id是此表的主键列。</span><br><span class="line">经验是包含一个值（“高级”、“初级”）的枚举类型。</span><br><span class="line">此表的每一行都显示候选人的id、月薪和经验。</span><br><span class="line">一家公司想雇佣新员工。公司的工资预算是 70000 美元。公司的招聘标准是：</span><br><span class="line"></span><br><span class="line">雇佣最多的高级员工。</span><br><span class="line">在雇佣最多的高级员工后，使用剩余预算雇佣最多的初级员工。</span><br><span class="line">编写一个SQL查询，查找根据上述标准雇佣的高级员工和初级员工的数量。</span><br><span class="line">按 任意顺序 返回结果表。</span><br><span class="line">查询结果格式如下例所示。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">示例 1:</span><br><span class="line"></span><br><span class="line">输入: </span><br><span class="line">Candidates table:</span><br><span class="line">+-------------+------------+--------+</span><br><span class="line">| employee_id | experience | salary |</span><br><span class="line">+-------------+------------+--------+</span><br><span class="line">| 1           | Junior     | 10000  |</span><br><span class="line">| 9           | Junior     | 10000  |</span><br><span class="line">| 2           | Senior     | 20000  |</span><br><span class="line">| 11          | Senior     | 20000  |</span><br><span class="line">| 13          | Senior     | 50000  |</span><br><span class="line">| 4           | Junior     | 40000  |</span><br><span class="line">+-------------+------------+--------+</span><br><span class="line">输出: </span><br><span class="line">+------------+---------------------+</span><br><span class="line">| experience | accepted_candidates |</span><br><span class="line">+------------+---------------------+</span><br><span class="line">| Senior     | 2                   |</span><br><span class="line">| Junior     | 2                   |</span><br><span class="line">+------------+---------------------+</span><br><span class="line">说明：</span><br><span class="line">我们可以雇佣2名ID为（2,11）的高级员工。由于预算是7万美元，他们的工资总额是4万美元，我们还有3万美元，但他们不足以雇佣ID为13的高级员工。</span><br><span class="line">我们可以雇佣2名ID为（1,9）的初级员工。由于剩下的预算是3万美元，他们的工资总额是2万美元，我们还有1万美元，但他们不足以雇佣ID为4的初级员工。</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">with t1 as (select</span><br><span class="line">employee_id,experience,salary,sum(salary) over(partition by experience order by salary rows between unbounded preceding and current row) so</span><br><span class="line">#按 experience 分组开窗,按salary 生序排列逐一求和   然后 &lt;=70000 就是能招聘的 员工</span><br><span class="line">from</span><br><span class="line">Candidates</span><br><span class="line">),</span><br><span class="line">t2 as (</span><br><span class="line">select</span><br><span class="line">&quot;Senior&quot; experience,count(employee_id) accepted_candidates,70000-ifnull(max(so),0) m   # 能招聘的 Senior 等级员工</span><br><span class="line">from</span><br><span class="line">t1</span><br><span class="line">where</span><br><span class="line">experience = &quot;Senior&quot; and so&lt;=70000</span><br><span class="line"> </span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line">select</span><br><span class="line">experience,accepted_candidates</span><br><span class="line">from</span><br><span class="line">t2</span><br><span class="line">union all #上下两表拼接 就是题中需求</span><br><span class="line">select</span><br><span class="line">&quot;Junior&quot; experience,count(employee_id) accepted_candidates # 能招聘的 Junior 等级员工</span><br><span class="line">from</span><br><span class="line">t1</span><br><span class="line">where</span><br><span class="line">experience = &quot;Junior&quot; and so&lt;=(select m from t2)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">自己思路：找出高级和低级的生成临时表，然后用变量from t,@var=0,然后对高级和低级临时表的工资逐行加，再筛选出低于预备工资的数据，得到高级多少人并且一共花多少，再和低级临时表连接，条件是高级的总工资+低级总工资&lt;预算，得到低级多少人和低级总工资</span><br></pre></td></tr></table></figure>



<h4 id="2020-简单"><a href="#2020-简单" class="headerlink" title="2020 简单"></a>2020 简单</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202406111501368.png" alt="在这里插入图片描述"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">简单 别人的答案</span><br><span class="line"></span><br><span class="line"># Write your MySQL query statement below</span><br><span class="line">with new_table as(</span><br><span class="line">    select  DISTINCT account_id from Subscriptions where </span><br><span class="line">    date_format(start_date,&#x27;%Y&#x27;) = &#x27;2021&#x27; or</span><br><span class="line">    date_format(end_date,&#x27;%Y&#x27;) = &#x27;2021&#x27; </span><br><span class="line">)</span><br><span class="line">select count(*) accounts_count</span><br><span class="line">from Streams S right join new_table N</span><br><span class="line">on N.account_id = S.account_id</span><br><span class="line">where substring(stream_date,1,4) &lt;&gt; &#x27;2021&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">用year函数，or, not in，子查询就可以了</span><br></pre></td></tr></table></figure>





<h4 id="2026-简单"><a href="#2026-简单" class="headerlink" title="2026 简单"></a>2026 简单</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">简单 但我只想到了select是算出比率，然后再select</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202406111507021.png" alt="在这里插入图片描述"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">SELECT problem_id</span><br><span class="line">FROM Problems</span><br><span class="line">#这里不要用round四舍五入</span><br><span class="line">WHERE likes/(likes+dislikes)&lt;0.60</span><br><span class="line">order by problem_id asc</span><br></pre></td></tr></table></figure>



<h4 id="2041-简单"><a href="#2041-简单" class="headerlink" title="2041 简单"></a>2041 简单</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">简单</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202406111511919.png"></p>
<h4 id="2051"><a href="#2051" class="headerlink" title="2051"></a>2051</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202406111530105.png" alt="在这里插入图片描述"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202406111529019.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202406111528723.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">select M.member_id,M.name,(</span><br><span class="line">case</span><br><span class="line">    when count(V.visit_id) = 0 then &#x27;Bronze&#x27;</span><br><span class="line">    when count(P.visit_id)/count(V.visit_id) &lt; 0.5 then &#x27;Silver&#x27;</span><br><span class="line">    when count(P.visit_id)/count(V.visit_id) &lt;0.8 then &#x27;Gold&#x27;</span><br><span class="line">    else &#x27;Diamond&#x27;</span><br><span class="line">    end) AS category</span><br><span class="line">from Members M left join Visits V</span><br><span class="line">on M.member_id = V.member_id </span><br><span class="line">left join Purchases P </span><br><span class="line">on P.visit_id = V.visit_id</span><br><span class="line">group by M.member_id</span><br></pre></td></tr></table></figure>

<h4 id="3421-查找进步的学生"><a href="#3421-查找进步的学生" class="headerlink" title="3421.查找进步的学生"></a>3421.查找进步的学生</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">表：Scores</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| student_id  | int     |</span><br><span class="line">| subject     | varchar |</span><br><span class="line">| score       | int     |</span><br><span class="line">| exam_date   | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">(student_id, subject, exam_date) 是这张表的主键。</span><br><span class="line">每一行包含有关学生在特定考试日期特定科目成绩的信息。分数范围从 0 到 100（包括边界）。</span><br><span class="line">编写一个解决方案来查找 进步的学生。如果 同时 满足以下两个条件，则该学生被认为是进步的：</span><br><span class="line"></span><br><span class="line">在 同一科目 至少参加过两个不同日期的考试。</span><br><span class="line">他们在该学科 最近的分数 比他们 第一次该学科考试的分数更高。</span><br><span class="line">返回结果表以 student_id，subject 升序 排序。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">with rk as (</span><br><span class="line">    select *, rank() over(partition by student_id,subject order by exam_date) r1,</span><br><span class="line">        rank() over(partition by student_id,subject order by exam_date desc) r2</span><br><span class="line">    from Scores</span><br><span class="line">)</span><br><span class="line">select a.student_id, a.subject, a.score first_score, b.score latest_score</span><br><span class="line">from rk a join rk b on</span><br><span class="line">    a.student_id=b.student_id and a.subject=b.subject and</span><br><span class="line">    a.r1=1 and b.r2=1 and a.r1!=a.r2 and a.score&lt;b.score</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">先筛选出一门学科至少参加过两次的人，对这些人的这些学科再按照上面那样做也可以</span><br></pre></td></tr></table></figure>



<h4 id="3436-查找合法邮箱-regexp"><a href="#3436-查找合法邮箱-regexp" class="headerlink" title="3436.查找合法邮箱 regexp"></a>3436.查找合法邮箱 regexp</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">表：Users</span><br><span class="line"></span><br><span class="line">+-----------------+---------+</span><br><span class="line">| Column Name     | Type    |</span><br><span class="line">+-----------------+---------+</span><br><span class="line">| user_id         | int     |</span><br><span class="line">| email           | varchar |</span><br><span class="line">+-----------------+---------+</span><br><span class="line">(user_id) 是这张表的唯一主键。</span><br><span class="line">每一行包含用户的唯一 ID 和邮箱地址。</span><br><span class="line">编写一个解决方案来查找所有 合法邮箱地址。一个合法的邮箱地址符合下述条件：</span><br><span class="line"></span><br><span class="line">只包含一个 @ 符号。</span><br><span class="line">以 .com 结尾。</span><br><span class="line">@ 符号前面的部分只包含 字母数字 字符和 下划线。</span><br><span class="line">@ 符号后面与 .com 前面的部分 包含 只有字母 的域名。</span><br><span class="line">返回结果表以 user_id 升序 排序。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select user_id, email from Users</span><br><span class="line">where email rlike &#x27;^[a-zA-Z0-9_]+@[a-zA-Z]+\\.com$&#x27;</span><br><span class="line">order by user_id asc</span><br></pre></td></tr></table></figure>

<h4 id="3451-查找无效的-IP-地址-substring-index-cast-regepx-replace"><a href="#3451-查找无效的-IP-地址-substring-index-cast-regepx-replace" class="headerlink" title="3451.查找无效的 IP 地址  substring_index cast regepx replace"></a>3451.查找无效的 IP 地址  substring_index cast regepx replace</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">表：logs</span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| log_id      | int     |</span><br><span class="line">| ip          | varchar |</span><br><span class="line">| status_code | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">log_id 是这张表的唯一主键。</span><br><span class="line">每一行包含服务器访问日志信息，包括 IP 地址和 HTTP 状态码。</span><br><span class="line">编写一个解决方案来查找 无效的 IP 地址。一个 IPv4 地址如果满足以下任何条件之一，则无效：</span><br><span class="line"></span><br><span class="line">任何 8 位字节中包含大于 255 的数字</span><br><span class="line">任何 8 位字节中含有 前导零（如 01.02.03.04）</span><br><span class="line">少于或多于 4 个 8 位字节</span><br><span class="line">返回结果表分别以 invalid_count，ip 降序 排序。</span><br><span class="line"></span><br><span class="line">结果格式如下所示。</span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line">输入：</span><br><span class="line"></span><br><span class="line">logs 表：</span><br><span class="line">+--------+---------------+-------------+</span><br><span class="line">| log_id | ip            | status_code | </span><br><span class="line">+--------+---------------+-------------+</span><br><span class="line">| 1      | 192.168.1.1   | 200         | </span><br><span class="line">| 2      | 256.1.2.3     | 404         | </span><br><span class="line">| 3      | 192.168.001.1 | 200         | </span><br><span class="line">| 4      | 192.168.1.1   | 200         | </span><br><span class="line">| 5      | 192.168.1     | 500         | </span><br><span class="line">| 6      | 256.1.2.3     | 404         | </span><br><span class="line">| 7      | 192.168.001.1 | 200         | </span><br><span class="line">+--------+---------------+-------------+</span><br><span class="line">输出：</span><br><span class="line">+---------------+--------------+</span><br><span class="line">| ip            | invalid_count|</span><br><span class="line">+---------------+--------------+</span><br><span class="line">| 256.1.2.3     | 2            |</span><br><span class="line">| 192.168.001.1 | 2            |</span><br><span class="line">| 192.168.1     | 1            |</span><br><span class="line">+---------------+--------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"></span><br><span class="line">select ip, count(*) as invalid_count</span><br><span class="line">from logs</span><br><span class="line">WHERE ip like &quot;%.0%&quot; or ip like &quot;0%&quot; </span><br><span class="line">or length(ip) - length(replace(ip, &#x27;.&#x27;, &#x27;&#x27;)) != 3 </span><br><span class="line">or CAST(substring_index(ip, &quot;.&quot;, 1) AS UNSIGNED)&gt;255 </span><br><span class="line">or CAST(substring_index(substring_index(ip, &quot;.&quot;, 2), &quot;.&quot;, -1) AS UNSIGNED) &gt;255 </span><br><span class="line">or CAST(substring_index(substring_index(ip, &quot;.&quot;, 3), &quot;.&quot;, -1) AS UNSIGNED) &gt;255 </span><br><span class="line">or CAST(substring_index(ip, &quot;.&quot;, -1) AS UNSIGNED) &gt;255</span><br><span class="line">GROUP BY ip</span><br><span class="line">ORDER BY invalid_count DESC, ip DESC;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">一个0-255的数字字符串，匹配字符是这样的：</span><br><span class="line">250-255：25[0-5]</span><br><span class="line">200-249：2[0-4][0-9]</span><br><span class="line">100-199：1[0-9]&#123;2&#125;</span><br><span class="line">10-99（无前导零）：[1-9][0-9]</span><br><span class="line">0-9：[0-9]</span><br><span class="line"></span><br><span class="line">串起来就是：</span><br><span class="line">25[0-5]|2[0-4][0-9]|1[0-9]&#123;2&#125;|[1-9][0-9]|[0-9]</span><br><span class="line"></span><br><span class="line">这样的4个数字+三个点拼起来就可以了，可以写成一个数字字符串+一个点重复三次，加一个单独的数字字符串即可，即：</span><br><span class="line">&#x27;^((25[0-5]|2[0-4][0-9]|1[0-9]&#123;2&#125;|[1-9][0-9]|[0-9])\\.)&#123;3&#125;(25[0-5]|2[0-4][0-9]|1[0-9]&#123;2&#125;|[1-9][0-9]|[0-9])$&#x27;</span><br><span class="line">最终做一个正则表达式匹配，完了分组输出即可。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SELECT ip, count(ip) as invalid_count            </span><br><span class="line">FROM logs </span><br><span class="line">WHERE ip not REGEXP &#x27;^((25[0-5]|2[0-4][0-9]|1[0-9]&#123;2&#125;|[1-9][0-9]|[0-9])\\.)&#123;3&#125;(25[0-5]|2[0-4][0-9]|1[0-9]&#123;2&#125;|[1-9][0-9]|[0-9])$&#x27;</span><br><span class="line">group by ip</span><br><span class="line">order by invalid_count desc, ip desc</span><br></pre></td></tr></table></figure>



<h4 id="3465-查找具有有效序列号的产品-REGEXP"><a href="#3465-查找具有有效序列号的产品-REGEXP" class="headerlink" title="3465.查找具有有效序列号的产品 REGEXP"></a>3465.查找具有有效序列号的产品 REGEXP</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">表：products</span><br><span class="line"></span><br><span class="line">+--------------+------------+</span><br><span class="line">| Column Name  | Type       |</span><br><span class="line">+--------------+------------+</span><br><span class="line">| product_id   | int        |</span><br><span class="line">| product_name | varchar    |</span><br><span class="line">| description  | varchar    |</span><br><span class="line">+--------------+------------+</span><br><span class="line">(product_id) 是这张表的唯一主键。</span><br><span class="line">这张表的每一行表示一个产品的唯一 ID，名字和描述。</span><br><span class="line">编写一个解决方案来找到所有描述中 包含一个有效序列号 模式的产品。一个有效序列号符合下述规则：</span><br><span class="line"></span><br><span class="line">以 SN 字母开头（区分大小写）。</span><br><span class="line">后面有恰好 4 位数字。</span><br><span class="line">接着是一个短横（-）， 短横后面还有另一组 4 位数字</span><br><span class="line">序列号必须在描述内（可能不在描述的开头）</span><br><span class="line">返回结果表以 product_id 升序 排序。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select product_id, product_name, description from products where description regexp &#x27;\\bSN[0-9]&#123;4&#125;-[0-9]&#123;4&#125;\\b&#x27; order by product_id</span><br></pre></td></tr></table></figure>

<h4 id="3475-DNA-模式识别-REGEXP-LIKE-LEFT-RIGHT-INSTR-regexp-like"><a href="#3475-DNA-模式识别-REGEXP-LIKE-LEFT-RIGHT-INSTR-regexp-like" class="headerlink" title="3475.DNA 模式识别  REGEXP LIKE LEFT RIGHT INSTR regexp_like"></a>3475.DNA 模式识别  REGEXP LIKE LEFT RIGHT INSTR regexp_like</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">表：Samples</span><br><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    | </span><br><span class="line">+----------------+---------+</span><br><span class="line">| sample_id      | int     |</span><br><span class="line">| dna_sequence   | varchar |</span><br><span class="line">| species        | varchar |</span><br><span class="line">+----------------+---------+</span><br><span class="line">sample_id 是这张表的唯一主键。</span><br><span class="line">每一行包含一个 DNA 序列以一个字符（A，T，G，C）组成的字符串表示以及它所采集自的物种。</span><br><span class="line">生物学家正在研究 DNA 序列中的基本模式。编写一个解决方案以识别具有以下模式的 sample_id：</span><br><span class="line"></span><br><span class="line">以 ATG 开头 的序列（一个常见的 起始密码子）</span><br><span class="line">以 TAA，TAG 或 TGA 结尾 的序列（终止密码子）</span><br><span class="line">包含基序 ATAT 的序列（一个简单重复模式）</span><br><span class="line">有 至少 3 个连续 G 的序列（如 GGG 或 GGGG）</span><br><span class="line">返回结果表以 sample_id 升序 排序。</span><br><span class="line"></span><br><span class="line">结果格式如下所示。</span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line">输入：</span><br><span class="line">Samples 表：</span><br><span class="line">+-----------+------------------+-----------+</span><br><span class="line">| sample_id | dna_sequence     | species   |</span><br><span class="line">+-----------+------------------+-----------+</span><br><span class="line">| 1         | ATGCTAGCTAGCTAA  | Human     |</span><br><span class="line">| 2         | GGGTCAATCATC     | Human     |</span><br><span class="line">| 3         | ATATATCGTAGCTA   | Human     |</span><br><span class="line">| 4         | ATGGGGTCATCATAA  | Mouse     |</span><br><span class="line">| 5         | TCAGTCAGTCAG     | Mouse     |</span><br><span class="line">| 6         | ATATCGCGCTAG     | Zebrafish |</span><br><span class="line">| 7         | CGTATGCGTCGTA    | Zebrafish |</span><br><span class="line">+-----------+------------------+-----------+</span><br><span class="line">输出：</span><br><span class="line">+-----------+------------------+-------------+-------------+------------+------------+------------+</span><br><span class="line">| sample_id | dna_sequence     | species     | has_start   | has_stop   | has_atat   | has_ggg    |</span><br><span class="line">+-----------+------------------+-------------+-------------+------------+------------+------------+</span><br><span class="line">| 1         | ATGCTAGCTAGCTAA  | Human       | 1           | 1          | 0          | 0          |</span><br><span class="line">| 2         | GGGTCAATCATC     | Human       | 0           | 0          | 0          | 1          |</span><br><span class="line">| 3         | ATATATCGTAGCTA   | Human       | 0           | 0          | 1          | 0          |</span><br><span class="line">| 4         | ATGGGGTCATCATAA  | Mouse       | 1           | 1          | 0          | 1          |</span><br><span class="line">| 5         | TCAGTCAGTCAG     | Mouse       | 0           | 0          | 0          | 0          |</span><br><span class="line">| 6         | ATATCGCGCTAG     | Zebrafish   | 0           | 1          | 1          | 0          |</span><br><span class="line">| 7         | CGTATGCGTCGTA    | Zebrafish   | 0           | 0          | 0          | 0          |</span><br><span class="line">+-----------+------------------+-------------+-------------+------------+------------</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">SELECT</span><br><span class="line">    sample_id,</span><br><span class="line">    dna_sequence,</span><br><span class="line">    species,</span><br><span class="line">    dna_sequence LIKE &#x27;ATG%&#x27; AS has_start,</span><br><span class="line">    dna_sequence REGEXP &#x27;TAA$|TAG$|TGA$&#x27; AS has_stop,</span><br><span class="line">    dna_sequence LIKE &#x27;%ATAT%&#x27; AS has_atat,</span><br><span class="line">    dna_sequence REGEXP &#x27;GGG+&#x27; AS has_ggg</span><br><span class="line">FROM Samples</span><br><span class="line">ORDER BY 1;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select *,</span><br><span class="line">    left(dna_sequence,3)=&#x27;ATG&#x27; has_start,</span><br><span class="line">    right(dna_sequence,3) in (&#x27;TAA&#x27;,&#x27;TAG&#x27;,&#x27;TGA&#x27;) has_stop,</span><br><span class="line">    dna_sequence like &#x27;%ATAT%&#x27; has_atat,</span><br><span class="line">    instr(dna_sequence,&#x27;GGG&#x27;)&gt;0 has_ggg</span><br><span class="line">from Samples</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CASE WHEN regexp_like(dna_sequence, &#x27;^ATG&#x27;) THEN 1 ELSE 0 END has_start,</span><br><span class="line">CASE WHEN regexp_like(dna_sequence, &#x27;(TAA$|TAG$|TGA$)&#x27;) THEN 1 ELSE 0 END has_stop,</span><br><span class="line">CASE WHEN regexp_like(dna_sequence, &#x27;ATAT&#x27;) THEN 1 ELSE 0 END has_atat,</span><br><span class="line">CASE WHEN regexp_like(dna_sequence, &#x27;G&#123;3&#125;&#x27;) THEN 1 ELSE 0 END has_ggg</span><br></pre></td></tr></table></figure>



<h4 id="3482-分析组织层级-递归"><a href="#3482-分析组织层级-递归" class="headerlink" title="3482.分析组织层级 递归"></a>3482.分析组织层级 递归</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">表：Employees</span><br><span class="line"></span><br><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    | </span><br><span class="line">+----------------+---------+</span><br><span class="line">| employee_id    | int     |</span><br><span class="line">| employee_name  | varchar |</span><br><span class="line">| manager_id     | int     |</span><br><span class="line">| salary         | int     |</span><br><span class="line">| department     | varchar |</span><br><span class="line">+----------------+----------+</span><br><span class="line">employee_id 是这张表的唯一主键。</span><br><span class="line">每一行包含关于一名员工的信息，包括他们的 ID，姓名，他们经理的 ID，薪水和部门。</span><br><span class="line">顶级经理（CEO）的 manager_id 是空的。</span><br><span class="line">编写一个解决方案来分析组织层级并回答下列问题：</span><br><span class="line"></span><br><span class="line">层级：对于每名员工，确定他们在组织中的层级（CEO 层级为 1，CEO 的直接下属员工层级为 2，以此类推）。</span><br><span class="line">团队大小：对于每个是经理的员工，计算他们手下的（直接或间接下属）总员工数。</span><br><span class="line">薪资预算：对于每个经理，计算他们控制的总薪资预算（所有手下员工的工资总和，包括间接下属，加上自己的工资）。</span><br><span class="line">返回结果表以 层级 升序 排序，然后以预算 降序 排序，最后以 employee_name 升序 排序。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">WITH RECURSIVE cte (employee_id, employee_name, salary, level, label) AS</span><br><span class="line">(</span><br><span class="line">    SELECT employee_id, employee_name, salary, 1, concat(employee_id) FROM Employees WHERE manager_id IS NULL</span><br><span class="line">    UNION</span><br><span class="line">    SELECT e.employee_id, e.employee_name, e.salary, level + 1, concat(label, &#x27;,&#x27;, e.employee_id) FROM Employees e JOIN cte ON e.manager_id = cte.employee_id</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">SELECT c.employee_id, c.employee_name, c.level, count(1) - 1 team_size, sum(c1.salary) budget </span><br><span class="line">FROM cte c JOIN cte c1 </span><br><span class="line">ON c1.label REGEXP concat(&#x27;^&#x27;, c.label, &#x27;\\b&#x27;) </span><br><span class="line">GROUP BY c.employee_id </span><br><span class="line">ORDER BY c.level, budget DESC, c.employee_name</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"></span><br><span class="line">with recursive EmployeeTree as (</span><br><span class="line">    select *, 1 as level</span><br><span class="line">    from Employees</span><br><span class="line">    where manager_id is null</span><br><span class="line">    union all</span><br><span class="line">    select e.*, et.level + 1 as level</span><br><span class="line">    from Employees e</span><br><span class="line">    join EmployeeTree et on et.employee_id = e.manager_id</span><br><span class="line">),</span><br><span class="line">AllSubsident as (</span><br><span class="line">    select </span><br><span class="line">        employee_id as employee_id,</span><br><span class="line">        employee_id as subsident_id,</span><br><span class="line">        salary</span><br><span class="line">    from Employees</span><br><span class="line">    union all</span><br><span class="line">    select </span><br><span class="line">        a.employee_id,</span><br><span class="line">        e.employee_id as subsident_id,</span><br><span class="line">        e.salary</span><br><span class="line">    from Employees e</span><br><span class="line">    join AllSubsident a on a.subsident_id = e.manager_id</span><br><span class="line">),</span><br><span class="line">grouped as (</span><br><span class="line">    select employee_id, count(subsident_id) - 1 as team_size, sum(salary) as budget</span><br><span class="line">    from AllSubsident</span><br><span class="line">    group by employee_id</span><br><span class="line">    order by employee_id</span><br><span class="line">)</span><br><span class="line">select </span><br><span class="line">    g.employee_id,</span><br><span class="line">    e.employee_name,</span><br><span class="line">    e.level,</span><br><span class="line">    g.team_size,</span><br><span class="line">    g.budget</span><br><span class="line">from grouped g</span><br><span class="line">join EmployeeTree e</span><br><span class="line">on g.employee_id = e.employee_id</span><br><span class="line">order by e.level,g.budget desc,e.employee_name;</span><br></pre></td></tr></table></figure>





<h4 id="3554-查找类别推荐对"><a href="#3554-查找类别推荐对" class="headerlink" title="3554.查找类别推荐对"></a>3554.查找类别推荐对</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">表：ProductPurchases</span><br><span class="line">+-------------+------+</span><br><span class="line">| Column Name | Type | </span><br><span class="line">+-------------+------+</span><br><span class="line">| user_id     | int  |</span><br><span class="line">| product_id  | int  |</span><br><span class="line">| quantity    | int  |</span><br><span class="line">+-------------+------+</span><br><span class="line">(user_id, product_id) 是这张表的唯一主键。</span><br><span class="line">每一行代表用户以特定数量购买的一种产品。</span><br><span class="line">表：ProductInfo</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    | </span><br><span class="line">+-------------+---------+</span><br><span class="line">| product_id  | int     |</span><br><span class="line">| category    | varchar |</span><br><span class="line">| price       | decimal |</span><br><span class="line">+-------------+---------+</span><br><span class="line">product_id 是这张表的唯一主键。</span><br><span class="line">每一行表示一件商品的类别和价格。</span><br><span class="line">亚马逊想要了解不同产品类别的购物模式。编写一个解决方案：</span><br><span class="line"></span><br><span class="line">查找所有 类别对（其中 category1 &lt; category2）</span><br><span class="line">对于每个类别对，确定同时购买了两类别产品的不同用户数量</span><br><span class="line">如果至少有 3 个不同的客户购买了两个类别的产品，则类别对被视为 可报告的。</span><br><span class="line"></span><br><span class="line">返回可报告类别对的结果表以 customer_count 降序 排序，并且为了防止排序持平，以 category1 字典序 升序 排序，然后以 category2 升序 排序。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">WITH</span><br><span class="line">    user_category AS (</span><br><span class="line">        SELECT DISTINCT</span><br><span class="line">            user_id,</span><br><span class="line">            category</span><br><span class="line">        FROM</span><br><span class="line">            ProductPurchases</span><br><span class="line">            JOIN ProductInfo USING (product_id)</span><br><span class="line">    ),</span><br><span class="line">    pair_per_user AS (</span><br><span class="line">        SELECT</span><br><span class="line">            a.user_id,</span><br><span class="line">            a.category AS category1,</span><br><span class="line">            b.category AS category2</span><br><span class="line">        FROM</span><br><span class="line">            user_category AS a</span><br><span class="line">            JOIN user_category AS b ON a.user_id = b.user_id AND a.category &lt; b.category</span><br><span class="line">    )</span><br><span class="line">SELECT category1, category2, COUNT(DISTINCT user_id) AS customer_count</span><br><span class="line">FROM pair_per_user</span><br><span class="line">GROUP BY 1, 2</span><br><span class="line">HAVING customer_count &gt;= 3</span><br><span class="line">ORDER BY 3 DESC, 1, 2;</span><br></pre></td></tr></table></figure>



<h4 id="3564-季节性销售分析"><a href="#3564-季节性销售分析" class="headerlink" title="3564.季节性销售分析"></a>3564.季节性销售分析</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">表：sales</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| sale_id       | int     |</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| sale_date     | date    |</span><br><span class="line">| quantity      | int     |</span><br><span class="line">| price         | decimal |</span><br><span class="line">+---------------+---------+</span><br><span class="line">sale_id 是这张表的唯一主键。</span><br><span class="line">每一行包含一件产品的销售信息，包括 product_id，销售日期，销售数量，以及单价。</span><br><span class="line">表：products</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| product_name  | varchar |</span><br><span class="line">| category      | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">product_id 是这张表的唯一主键。</span><br><span class="line">每一行包含一件产品的信息，包括它的名字和分类。</span><br><span class="line">编写一个解决方案来找到每个季节最受欢迎的产品分类。季节定义如下：</span><br><span class="line"></span><br><span class="line">冬季：十二月，一月，二月</span><br><span class="line">春季：三月，四月，五月</span><br><span class="line">夏季：六月，七月，八月</span><br><span class="line">秋季：九月，十月，十一月</span><br><span class="line">一个 分类 的 受欢迎度 由某个 季节 的 总销售量 决定。如果有并列，选择总收入最高的类别 (quantity × price)。</span><br><span class="line"></span><br><span class="line">返回结果表以季节 升序 排序。</span><br><span class="line"></span><br><span class="line">结果格式如下所示。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line"></span><br><span class="line">sales 表：</span><br><span class="line"></span><br><span class="line">+---------+------------+------------+----------+-------+</span><br><span class="line">| sale_id | product_id | sale_date  | quantity | price |</span><br><span class="line">+---------+------------+------------+----------+-------+</span><br><span class="line">| 1       | 1          | 2023-01-15 | 5        | 10.00 |</span><br><span class="line">| 2       | 2          | 2023-01-20 | 4        | 15.00 |</span><br><span class="line">| 3       | 3          | 2023-03-10 | 3        | 18.00 |</span><br><span class="line">| 4       | 4          | 2023-04-05 | 1        | 20.00 |</span><br><span class="line">| 5       | 1          | 2023-05-20 | 2        | 10.00 |</span><br><span class="line">| 6       | 2          | 2023-06-12 | 4        | 15.00 |</span><br><span class="line">| 7       | 5          | 2023-06-15 | 5        | 12.00 |</span><br><span class="line">| 8       | 3          | 2023-07-24 | 2        | 18.00 |</span><br><span class="line">| 9       | 4          | 2023-08-01 | 5        | 20.00 |</span><br><span class="line">| 10      | 5          | 2023-09-03 | 3        | 12.00 |</span><br><span class="line">| 11      | 1          | 2023-09-25 | 6        | 10.00 |</span><br><span class="line">| 12      | 2          | 2023-11-10 | 4        | 15.00 |</span><br><span class="line">| 13      | 3          | 2023-12-05 | 6        | 18.00 |</span><br><span class="line">| 14      | 4          | 2023-12-22 | 3        | 20.00 |</span><br><span class="line">| 15      | 5          | 2024-02-14 | 2        | 12.00 |</span><br><span class="line">+---------+------------+------------+----------+-------+</span><br><span class="line">products 表：</span><br><span class="line"></span><br><span class="line">+------------+-----------------+----------+</span><br><span class="line">| product_id | product_name    | category |</span><br><span class="line">+------------+-----------------+----------+</span><br><span class="line">| 1          | Warm Jacket     | Apparel  |</span><br><span class="line">| 2          | Designer Jeans  | Apparel  |</span><br><span class="line">| 3          | Cutting Board   | Kitchen  |</span><br><span class="line">| 4          | Smart Speaker   | Tech     |</span><br><span class="line">| 5          | Yoga Mat        | Fitness  |</span><br><span class="line">+------------+-----------------+----------+</span><br><span class="line">输出：</span><br><span class="line"></span><br><span class="line">+---------+----------+----------------+---------------+</span><br><span class="line">| season  | category | total_quantity | total_revenue |</span><br><span class="line">+---------+----------+----------------+---------------+</span><br><span class="line">| Fall    | Apparel  | 10             | 120.00        |</span><br><span class="line">| Spring  | Kitchen  | 3              | 54.00         |</span><br><span class="line">| Summer  | Tech     | 5              | 100.00        |</span><br><span class="line">| Winter  | Apparel  | 9              | 110.00        |</span><br><span class="line">+---------+----------+----------------+---------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">with details as (</span><br><span class="line">select</span><br><span class="line">,</span><br><span class="line">case when month(sale_date) in (&#x27;12&#x27;,&#x27;1&#x27;,&#x27;2&#x27;) then &#x27;Winter&#x27;</span><br><span class="line">when month(sale_date) in (&#x27;3&#x27;,&#x27;4&#x27;,&#x27;5&#x27;) then &#x27;Spring&#x27;</span><br><span class="line">when month(sale_date) in (&#x27;6&#x27;,&#x27;7&#x27;,&#x27;8&#x27;) then &#x27;Summer&#x27;</span><br><span class="line">when month(sale_date) in (&#x27;9&#x27;,&#x27;10&#x27;,&#x27;11&#x27;) then &#x27;Fall&#x27;</span><br><span class="line">end as season</span><br><span class="line">from</span><br><span class="line">sales</span><br><span class="line">),</span><br><span class="line">group_details as (select</span><br><span class="line">a.season,b.category,</span><br><span class="line">sum(quantity) as total_quantity,</span><br><span class="line">sum(quantityprice) as total_revenue,</span><br><span class="line">row_number() over(partition by a.season order by sum(quantity) desc,sum(quantityprice) desc) rn</span><br><span class="line">from</span><br><span class="line">details a</span><br><span class="line">left join</span><br><span class="line">products b</span><br><span class="line">on a.product_id = b.product_id</span><br><span class="line">group by a.season,b.category)</span><br><span class="line">select</span><br><span class="line">season,category,</span><br><span class="line">total_quantity,total_revenue</span><br><span class="line">from</span><br><span class="line">group_details</span><br><span class="line">where rn=1</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">with t as (</span><br><span class="line">    select *, </span><br><span class="line">        case</span><br><span class="line">            when month(sale_date) between 3 and 5 then &quot;Spring&quot;</span><br><span class="line">            when month(sale_date) between 6 and 8 then &quot;Summer&quot;</span><br><span class="line">            when month(sale_date) between 9 and 11 then &quot;Fall&quot;</span><br><span class="line">            else &quot;Winter&quot;</span><br><span class="line">        end as &quot;season&quot;</span><br><span class="line">     from sales </span><br><span class="line">),t2 as (</span><br><span class="line">    select </span><br><span class="line">        sum(quantity * price) &quot;total_revenue&quot;,</span><br><span class="line">        season,category,sum(quantity) as &quot;total_quantity&quot;,</span><br><span class="line">        rank()over(partition by season order by sum(quantity) desc,sum(quantity * price) desc) as rk</span><br><span class="line">    from t join products p using(product_id) group by season,category</span><br><span class="line">    </span><br><span class="line">)</span><br><span class="line">select </span><br><span class="line">    season,category,total_quantity,total_revenue</span><br><span class="line">from t2 where rk = 1 order by season </span><br><span class="line"></span><br><span class="line">#########</span><br><span class="line">with t as (</span><br><span class="line">    select *, </span><br><span class="line">        case</span><br><span class="line">            when month(sale_date) between 3 and 5 then &quot;Spring&quot;</span><br><span class="line">            when month(sale_date) between 6 and 8 then &quot;Summer&quot;</span><br><span class="line">            when month(sale_date) between 9 and 11 then &quot;Fall&quot;</span><br><span class="line">            else &quot;Winter&quot;</span><br><span class="line">        end as &quot;season&quot;</span><br><span class="line">     from sales </span><br><span class="line">),t2 as (</span><br><span class="line">    select </span><br><span class="line">        sum(quantity * price)over(partition by season,category) as &quot;total_revenue&quot;,</span><br><span class="line">        season,category,sum(quantity)over(partition by season,category) as &quot;total_quantity&quot;</span><br><span class="line">    from t join products p using(product_id)</span><br><span class="line">),t3 as (</span><br><span class="line">    select *,rank()over(partition by season order by total_quantity desc,total_revenue desc) as rk</span><br><span class="line">    from t2</span><br><span class="line">)</span><br><span class="line">select </span><br><span class="line">    distinct season,category,total_quantity,total_revenue</span><br><span class="line">from t3 where rk = 1 order by season</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">WITH temp AS (</span><br><span class="line">    SELECT *, Month(sale_date) AS month</span><br><span class="line">    FROM sales</span><br><span class="line">), get_season AS (</span><br><span class="line">    SELECT *, CASE WHEN month in (12,1,2) THEN &#x27;Winter&#x27;</span><br><span class="line">                    WHEN month in (3,4,5) THEN &#x27;Spring&#x27;</span><br><span class="line">                    WHEN month in (6,7,8) THEN &#x27;Summer&#x27;</span><br><span class="line">                    ELSE &#x27;Fall&#x27; END AS season</span><br><span class="line">    FROM temp</span><br><span class="line">), get_cat AS (</span><br><span class="line">    SELECT g.product_id, quantity, price, category, season</span><br><span class="line">    FROM get_season g LEFT JOIN products p ON g.product_id = p.product_id</span><br><span class="line">) </span><br><span class="line">,get_prod_quant AS (</span><br><span class="line">    SELECT product_id,season,SUM(quantity) AS total_quantity,</span><br><span class="line">                            SUM(quantity*price) AS total_revenue</span><br><span class="line">    FROM get_cat</span><br><span class="line">    GROUP BY category, season</span><br><span class="line">), get_rank AS (</span><br><span class="line">    SELECT *</span><br><span class="line">    FROM (</span><br><span class="line">        SELECT *, DENSE_RANK() OVER(PARTITION BY season ORDER BY total_quantity DESC, total_revenue DESC ) rnk</span><br><span class="line">        FROM get_prod_quant</span><br><span class="line">    ) tmp</span><br><span class="line">    WHERE rnk = 1</span><br><span class="line">), final AS (</span><br><span class="line">    SELECT season, category, total_quantity, total_revenue</span><br><span class="line">    FROM get_rank g LEFT JOIN products p ON g.product_id = p.product_id</span><br><span class="line">    ORDER BY season </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">SELECT * FROM final</span><br></pre></td></tr></table></figure>

<h4 id="3580-寻找持续进步的员工"><a href="#3580-寻找持续进步的员工" class="headerlink" title="3580.寻找持续进步的员工"></a>3580.寻找持续进步的员工</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">表：employees</span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| employee_id | int     |</span><br><span class="line">| name        | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">employee_id 是这张表的唯一主键。</span><br><span class="line">每一行包含一名员工的信息。</span><br><span class="line">表：performance_reviews</span><br><span class="line"></span><br><span class="line">+-------------+------+</span><br><span class="line">| Column Name | Type |</span><br><span class="line">+-------------+------+</span><br><span class="line">| review_id   | int  |</span><br><span class="line">| employee_id | int  |</span><br><span class="line">| review_date | date |</span><br><span class="line">| rating      | int  |</span><br><span class="line">+-------------+------+</span><br><span class="line">review_id 是这张表的唯一主键。</span><br><span class="line">每一行表示一名员工的绩效评估。评分在 1-5 的范围内，5分代表优秀，1分代表较差。</span><br><span class="line">编写一个解决方案，以找到在过去三次评估中持续提高绩效的员工。</span><br><span class="line"></span><br><span class="line">员工 至少需要 3 次评估 才能被考虑</span><br><span class="line">员工过去的 3 次评估，评分必须 严格递增（每次评价都比上一次好）</span><br><span class="line">根据 review_date 为每位员工分析最近的 3 次评估</span><br><span class="line">进步分数 为最后 3 次评估中最后一次评分与最早一次评分之间的差值</span><br><span class="line">返回结果表以 进步分数 降序 排序，然后以 名字 升序 排序。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">with t as(</span><br><span class="line">select employee_id,review_date,rating,lead(rating,1) over(partition by employee_id order by review_date) lrating</span><br><span class="line">from performance_reviews pr</span><br><span class="line">where lrating is not null and pr.employee_id in</span><br><span class="line">(</span><br><span class="line">select employee_id</span><br><span class="line">from performance_reviews p</span><br><span class="line">group by employee_id</span><br><span class="line">having count(*)&gt;=3</span><br><span class="line">)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">with p as(</span><br><span class="line">select distinct employee_id</span><br><span class="line">from(</span><br><span class="line">select employee_id,review_date,lrating&gt;rating r</span><br><span class="line">from t) s</span><br><span class="line">where r=0</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">select y.employee_id,name,max(rating)-min(rating) improvement_score </span><br><span class="line">from(</span><br><span class="line">select employee_id,review_date,rating,row_number() over(partition by employee_id order by review_date desc) rk</span><br><span class="line">from t </span><br><span class="line">where t.employee_id not in (</span><br><span class="line">select * from p</span><br><span class="line">)</span><br><span class="line">) y join employees on y.employee_id = employees.employee_id</span><br><span class="line">where y.rk &lt;=3</span><br><span class="line">group by y.employee_id</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这里理解有点问题，它的意思是最近三次是依次增加就行，不用全部都是一次增加</span><br></pre></td></tr></table></figure>



<h4 id="3586-寻找-COVID-康复患者"><a href="#3586-寻找-COVID-康复患者" class="headerlink" title="3586.寻找 COVID 康复患者"></a>3586.寻找 COVID 康复患者</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">表：patients</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| patient_id  | int     |</span><br><span class="line">| patient_name| varchar |</span><br><span class="line">| age         | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">patient_id 是这张表的唯一主键。</span><br><span class="line">每一行表示一个患者的信息。</span><br><span class="line">表：covid_tests</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| test_id     | int     |</span><br><span class="line">| patient_id  | int     |</span><br><span class="line">| test_date   | date    |</span><br><span class="line">| result      | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">test_id 是这张表的唯一主键。</span><br><span class="line">每一行代表一个 COVID 检测结果。结果可以是阳性、阴性或不确定。</span><br><span class="line">编写一个解决方案以找到从 COVID 中康复的患者——那些曾经检测呈阳性但后来检测呈阴性的患者。</span><br><span class="line"></span><br><span class="line">患者如果 至少有一次阳性 检测结果后，在 之后的日期 至少有一次 阴性 检测结果，则被认为已康复。</span><br><span class="line">计算从 首次阳性检测 结果到 该阳性检测 后的 首次阴性检测结果 之间的 康复时间（以天为单位）</span><br><span class="line">仅包括 同时具有阳性及阴性检测结果的患者</span><br><span class="line">返回结果表以 recovery_time 升序 排序，然后以 patient_name 升序 排序。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">with t as(</span><br><span class="line">select patient_id,min(result) result,min(test_date) test_date</span><br><span class="line">from covid_tests</span><br><span class="line">where result=&#x27;Positive&#x27;</span><br><span class="line">group by patient_id </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">select covid_tests.patient_id patient_id,patient_name ,age,min(covid_tests.test_date)-t.test_date recovery_time </span><br><span class="line">from covid_tests join t </span><br><span class="line">on covid_tests.patient_id = t.patient_id and covid_tests.test_date &gt; t.test_date </span><br><span class="line">join patients on t.patient_id = patients.patient_id</span><br><span class="line">where covid_tests.result = &#x27;Negative&#x27;</span><br><span class="line">group by covid_tests.patient_id</span><br></pre></td></tr></table></figure>



<h3 id="常用积累"><a href="#常用积累" class="headerlink" title="常用积累"></a>常用积累</h3><h4 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h4><h5 id="1"><a href="#1" class="headerlink" title="1"></a>1</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">删除重复邮件，保留最小的id email 来自leecode</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">delete from Person where Person.id not in (</span><br><span class="line">select t.id from (</span><br><span class="line">select p2.id </span><br><span class="line">from Person p2</span><br><span class="line">where p2.email in (select p1.email</span><br><span class="line">from Person p1</span><br><span class="line">group by p1.email</span><br><span class="line">having count(*)=1)</span><br><span class="line">) t</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如果不要貌似多余的select t.id from ( 会报错</span><br><span class="line"></span><br><span class="line">--MySQL 不允许在 DELETE 语句的 WHERE 子句中直接使用正在被更新的表。</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202405161000539.png" alt="image-20240516100028199"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">delete from Person where id not in (</span><br><span class="line">	select a.id from (</span><br><span class="line">		select min(id) from Person group by email a</span><br><span class="line">	)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DELETE p1 FROM Person p1,</span><br><span class="line">    Person p2</span><br><span class="line">WHERE</span><br><span class="line">    p1.Email = p2.Email AND p1.Id &gt; p2.Id</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p1是Person表的别名，这个DELETE语句会删除Person表中所有满足JOIN条件和WHERE条件的行</span><br><span class="line"></span><br><span class="line">所以答案这样写的意思是，最终会在P1中delete，而不是在笛卡尔积的表里delete是吗？</span><br></pre></td></tr></table></figure>

<h4 id="日期相关"><a href="#日期相关" class="headerlink" title="日期相关"></a>日期相关</h4><h5 id="DATEDIFF"><a href="#DATEDIFF" class="headerlink" title="DATEDIFF()"></a>DATEDIFF()</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DATEDIFF() 函数返回两个日期之间的时间。天数、月数、年数</span><br><span class="line"></span><br><span class="line">结果：day=DiffDate=enddate−startdate=1day=DiffDate=enddate-startdate=1day=DiffDate=enddate−startdate=1，把示例的day换成year，就是按年计算</span><br><span class="line"></span><br><span class="line">select </span><br><span class="line">    b.Id </span><br><span class="line">from </span><br><span class="line">    weather a </span><br><span class="line">inner join </span><br><span class="line">    weather b </span><br><span class="line">where </span><br><span class="line">    DATEDIFF(b.recordDate,a.recordDate)=1 </span><br><span class="line">and b.Temperature &gt; a.Temperature;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="TIMESTAMPDIFF-NOW"><a href="#TIMESTAMPDIFF-NOW" class="headerlink" title="TIMESTAMPDIFF()  |  NOW()"></a>TIMESTAMPDIFF()  |  NOW()</h5><p><a target="_blank" rel="noopener" href="https://www.php.cn/faq/631801.html">timestampdiff</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">timestampdiff(year,参数1,参数2) </span><br><span class="line"></span><br><span class="line">TIMESTAMPDIFF能干什么，可以计算相差天数、小时、分钟和秒，相比于datediff函数要灵活很多。格式是时间小的前，时间大的放在后面。 计算相差天数：</span><br><span class="line"></span><br><span class="line">其中，year处可以是以下值之一：</span><br><span class="line">MICROSECOND</span><br><span class="line">SECOND</span><br><span class="line">MINUTE</span><br><span class="line">HOUR</span><br><span class="line">DAY</span><br><span class="line">WEEK</span><br><span class="line">MONTH</span><br><span class="line">QUARTER</span><br><span class="line">YEAR</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select w1.Id</span><br><span class="line">from Weather as w1, Weather as w2</span><br><span class="line">where TIMESTAMPDIFF(DAY, w2.RecordDate, w1.RecordDate) = 1 </span><br><span class="line">AND w1.Temperature &gt; w2.Temperature</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT TIMESTAMPDIFF(YEAR,&#x27;1999-11-02&#x27;,NOW()) age;</span><br><span class="line">24</span><br><span class="line"></span><br><span class="line">now()</span><br><span class="line">+---------------------+</span><br><span class="line">| 2024-11-01 22:46:28</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202411012250530.png" alt="image-20241101225020808"></p>
<h5 id="DATE-FORMAT"><a href="#DATE-FORMAT" class="headerlink" title="DATE_FORMAT()"></a>DATE_FORMAT()</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">%b	缩写月名</span><br><span class="line">%m	月，数值(00-12)</span><br><span class="line">%d	月的天，数值(00-31)</span><br><span class="line">%e	月的天，数值(0-31)</span><br><span class="line">%Y	年，4 位</span><br><span class="line">%y	年，2 位</span><br><span class="line">%H	小时 (00-23)</span><br><span class="line">%h	小时 (01-12)</span><br><span class="line">%i	分钟，数值(00-59)</span><br><span class="line">%p	AM 或 PM</span><br><span class="line">%T	时间, 24-小时 (hh:mm:ss)</span><br><span class="line">%f	微秒</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--2018-12-18</span><br><span class="line"></span><br><span class="line">DATE_FORMAT(trans_date, &#x27;%Y-%m&#x27;)</span><br><span class="line"></span><br><span class="line">--2018-12</span><br></pre></td></tr></table></figure>

<h5 id="DATE-ADD"><a href="#DATE-ADD" class="headerlink" title="DATE_ADD()"></a>DATE_ADD()</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">DATE_ADD() ：从日期增加指定的时间间隔，返回的是一个字符串</span><br><span class="line"></span><br><span class="line">DATE_ADD(date,INTERVAL expr type)</span><br><span class="line"></span><br><span class="line">date 参数是合法的日期表达式。expr 参数是您希望添加的时间间隔。</span><br><span class="line"></span><br><span class="line">type 参数可以是下列值</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">二、使用</span><br><span class="line">now() //now函数为获取当前时间</span><br><span class="line"></span><br><span class="line">select date_add(now(), interval 1 day); - 加1天</span><br><span class="line">select date_add(now(),INTERVAL -1 DAY);-当前日期向前推1天</span><br><span class="line">select date_add(now(), interval 1 hour); -加1小时</span><br><span class="line">select date_add(now(), interval 1 minute); - 加1分钟</span><br><span class="line">select date_add(now(), interval 1 second); -加1秒</span><br><span class="line">select date_add(now(), interval 1 microsecond);-加1毫秒</span><br><span class="line">select date_add(now(), interval 1 week);-加1周</span><br><span class="line">select date_add(now(), interval 1 month);-加1月</span><br><span class="line">select date_add(now(), interval 1 quarter);-加1季</span><br><span class="line">select date_add(now(), interval 1 year);-加1年</span><br><span class="line">MySQL adddate(), addtime()函数，可以用date_add() 来替代。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select IFNULL(round(count(distinct(Result.player_id)) / count(distinct(Activity.player_id)), 2), 0) as fraction</span><br><span class="line">from (</span><br><span class="line">  select Activity.player_id as player_id</span><br><span class="line">  from (</span><br><span class="line">    select player_id, DATE_ADD(MIN(event_date), INTERVAL 1 DAY) as second_date</span><br><span class="line">    from Activity</span><br><span class="line">    group by player_id</span><br><span class="line">  ) as Expected, Activity</span><br><span class="line">  where Activity.event_date = Expected.second_date and Activity.player_id = Expected.player_id</span><br><span class="line">) as Result, Activity</span><br></pre></td></tr></table></figure>

<h5 id="CURDATE-，NOW"><a href="#CURDATE-，NOW" class="headerlink" title="CURDATE()，NOW()"></a>CURDATE()，NOW()</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select curdate();</span><br><span class="line">+------------+</span><br><span class="line">| curdate()  |</span><br><span class="line">+------------+</span><br><span class="line">| 2024-11-01 |</span><br><span class="line">+------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select now();</span><br><span class="line">+---------------------+</span><br><span class="line">| now()               |</span><br><span class="line">+---------------------+</span><br><span class="line">| 2024-11-01 22:46:28 |</span><br><span class="line">+---------------------+</span><br></pre></td></tr></table></figure>

<h5 id="month-week-year"><a href="#month-week-year" class="headerlink" title="month(),week(),year()"></a>month(),week(),year()</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">略</span><br></pre></td></tr></table></figure>

<h4 id="lag-、lead-、with"><a href="#lag-、lead-、with" class="headerlink" title="lag()、lead()、with"></a>lag()、lead()、with</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">lag()和lead()这两个函数可以查询我们得到的结果集上下偏移相应行数的相应的结果。</span><br><span class="line"></span><br><span class="line">lag()函数：</span><br><span class="line">查询当前行向上偏移n行对应的结果</span><br><span class="line">该函数有三个参数：第一个为待查询的参数列名，第二个为向上偏移的位数，第三个参数为超出最上面边界的默认值。</span><br><span class="line"></span><br><span class="line">lead()函数：</span><br><span class="line">查询当前行向下偏移n行对应的结果</span><br><span class="line">该函数有三个参数：第一个为待查询的参数列名，第二个为向下偏移的位数，第三个参数为超出最下面边界的默认值。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">with people as</span><br><span class="line">(</span><br><span class="line">    select id, visit_date, people,</span><br><span class="line">    Lag(people,2) over(order by id) as pprvPeople,</span><br><span class="line">    Lag(people,1) over(order by id) as prvPeople,</span><br><span class="line">    Lead(people,1) over(order by id) as nextPeople,</span><br><span class="line">    Lead(people,2) over(order by id) as nnextPeople</span><br><span class="line">    from stadium</span><br><span class="line">)</span><br><span class="line">select id, visit_date, people from people</span><br><span class="line">where </span><br><span class="line">(people &gt;= 100 and prvPeople&gt;=100 and pprvPeople&gt;=100) ||</span><br><span class="line">(people &gt;= 100 and nextPeople&gt;=100 and nnextPeople&gt;=100) ||</span><br><span class="line">(people &gt;= 100 and nextPeople&gt;=100 and prvPeople&gt;=100) </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当比如第一行取lag前一行，为null</span><br></pre></td></tr></table></figure>



<h5 id="with语句"><a href="#with语句" class="headerlink" title="with语句"></a>with语句</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">WITH BaseSalary AS (</span><br><span class="line">    SELECT employee_id, salary * 12 AS annual_base_salary</span><br><span class="line">    FROM employees</span><br><span class="line">),</span><br><span class="line">Bonus AS (</span><br><span class="line">    SELECT employee_id, SUM(amount) AS total_bonus</span><br><span class="line">    FROM bonuses</span><br><span class="line">    GROUP BY employee_id</span><br><span class="line">),</span><br><span class="line">Commission AS (</span><br><span class="line">    SELECT employee_id, SUM(amount) AS total_commission</span><br><span class="line">    FROM commissions</span><br><span class="line">    GROUP BY employee_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">WITH cte_name (column_name1, column_name2, ...) AS (</span><br><span class="line">-- CTE查询定义</span><br><span class="line">SELECT column1, column2,</span><br><span class="line">FROM table_name</span><br><span class="line">WHERE condition</span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在SQL查询中，经常会遇到需要重复使用的子查询。为了简化查询语句并提高可读性，SQL引入了WITH AS语法。通过使用WITH AS，我们可以创建临时表或视图，将子查询的结果保存起来，并在主查询中使用。本文将通过示例介绍SQL中WITH AS的特点，展示其在查询中的优势。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1. 简化复杂查询</span><br><span class="line"></span><br><span class="line">WITH customer_orders (customer_id, total_amount) AS (</span><br><span class="line">   SELECT customer_id, SUM(order_amount) AS total_amount</span><br><span class="line">   FROM orders</span><br><span class="line">   GROUP BY customer_id</span><br><span class="line">)</span><br><span class="line">SELECT customer_id, total_amount</span><br><span class="line">FROM customer_orders</span><br><span class="line">WHERE total_amount &gt; 1000;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">2. 提高查询性能：使用WITH AS可以避免在主查询中重复执行相同的子查询，从而提高查询性能。临时表的结果会被缓存，主查询只需要引用临时表即可，避免了重复计算子查询的开销。</span><br><span class="line"></span><br><span class="line">WITH average_salary AS (</span><br><span class="line">   SELECT AVG(salary) AS avg_salary</span><br><span class="line">   FROM employees</span><br><span class="line">)</span><br><span class="line">SELECT employee_id, first_name, last_name, salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE salary &gt; (SELECT avg_salary FROM average_salary)</span><br><span class="line">ORDER BY salary DESC;</span><br></pre></td></tr></table></figure>



<h4 id="roud-、if"><a href="#roud-、if" class="headerlink" title="roud()、if()"></a>roud()、if()</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SELECT T.request_at AS `Day`, </span><br><span class="line">	ROUND(</span><br><span class="line">			SUM(</span><br><span class="line">				IF(T.STATUS = &#x27;completed&#x27;,0,1)</span><br><span class="line">			)</span><br><span class="line">			/ </span><br><span class="line">			COUNT(T.STATUS),</span><br><span class="line">			2</span><br><span class="line">	) AS `Cancellation Rate`</span><br><span class="line">FROM Trips AS T</span><br><span class="line">JOIN Users AS U1 ON (T.client_id = U1.users_id AND U1.banned =&#x27;No&#x27;)</span><br><span class="line">JOIN Users AS U2 ON (T.driver_id = U2.users_id AND U2.banned =&#x27;No&#x27;)</span><br><span class="line">WHERE T.request_at BETWEEN &#x27;2013-10-01&#x27; AND &#x27;2013-10-03&#x27;</span><br><span class="line">GROUP BY T.request_at</span><br></pre></td></tr></table></figure>

<h4 id="limit"><a href="#limit" class="headerlink" title="limit()"></a>limit()</h4><p><a target="_blank" rel="noopener" href="https://www.jb51.net/database/3070058yf.htm"></a></p>
<h5 id="一个参数"><a href="#一个参数" class="headerlink" title="一个参数"></a>一个参数</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">limit 10</span><br></pre></td></tr></table></figure>

<h5 id="两个参数"><a href="#两个参数" class="headerlink" title="两个参数"></a>两个参数</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">limit 0,2 第一个参数表示从第几行开始取，第二个表示取几行</span><br><span class="line"></span><br><span class="line">--其实这个实现分页也是可以的</span><br></pre></td></tr></table></figure>

<h5 id="分页offset"><a href="#分页offset" class="headerlink" title="分页offset"></a>分页offset</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">例如，把结果集分页，每页3条记录。要获取第1页的记录，可以使用LIMIT 3 OFFSET 0：</span><br><span class="line">SELECT * FROM student LIMIT 3 OFFSET 0;</span><br><span class="line">上述查询LIMIT 3 OFFSET 0表示，对结果集从0号记录开始，最多取3条。注意SQL记录集的索引从0开始。</span><br><span class="line"></span><br><span class="line">如果要查询第2页，那么我们只需要“跳过”头3条记录，也就是对结果集从3号记录开始查询，把OFFSET设定为3：</span><br><span class="line">SELECT * FROM student LIMIT 3 OFFSET 3;</span><br><span class="line"></span><br><span class="line">LIMIT总是设定为pageSize</span><br><span class="line">OFFSET计算公式为pageSize * (pageIndex - 1)</span><br></pre></td></tr></table></figure>

<h4 id="IF"><a href="#IF" class="headerlink" title="IF"></a>IF</h4><h5 id="if"><a href="#if" class="headerlink" title="if()"></a>if()</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IF(T.STATUS = &#x27;completed&#x27;,0,1)</span><br></pre></td></tr></table></figure>

<h5 id="IFNULL-、NULLIF-、ISNULL"><a href="#IFNULL-、NULLIF-、ISNULL" class="headerlink" title="IFNULL()、NULLIF()、ISNULL()"></a>IFNULL()、NULLIF()、ISNULL()</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">IFNULL()函数的使用</span><br><span class="line">IFNULL(expr1,expr2)，如果expr1的值为null，则返回expr2的值，如果expr1的值不为null，则返回expr1的值。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">SELECT IFNULL(NULL,&#x27;B&#x27;); -- 输出结果：B</span><br><span class="line"> </span><br><span class="line">SELECT IFNULL(&#x27;HELLO&#x27;,&#x27;B&#x27;); -- 输出结果：HELLO</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">NULLIF()函数的使用</span><br><span class="line">NULLIF(expr1,expr2)，如果expr1=expr2成立，那么返回值为null，否则返回值为expr1的值。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">SELECT NULLIF(&#x27;A&#x27;,&#x27;A&#x27;); -- 输出结果：null</span><br><span class="line"> </span><br><span class="line">SELECT NULLIF(&#x27;A&#x27;,&#x27;B&#x27;); -- 输出结果：A</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ISNULL()函数的使用</span><br><span class="line"></span><br><span class="line">ISNULL(expr)，如果expr的值为null，则返回1，如果expr1的值不为null，则返回0。</span><br><span class="line"></span><br><span class="line">SELECT ISNULL(NULL); -- 输出结果：1</span><br><span class="line"> </span><br><span class="line">SELECT ISNULL(&#x27;HELLO&#x27;); -- 输出结果：0</span><br></pre></td></tr></table></figure>



<h4 id="、-、、NULL、TRUE、FALSE、UNKNOWN、is-null、is-not-null"><a href="#、-、、NULL、TRUE、FALSE、UNKNOWN、is-null、is-not-null" class="headerlink" title="&lt;&gt;、!&#x3D;、&lt;&#x3D;&gt;、NULL、TRUE、FALSE、UNKNOWN、is null、is not null"></a>&lt;&gt;、!&#x3D;、&lt;&#x3D;&gt;、NULL、TRUE、FALSE、UNKNOWN、is null、is not null</h4><p><a target="_blank" rel="noopener" href="https://deepinout.com/mysql/mysql-questions/68_tk_1702767681.html">安全等于</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MySQL提供了IS NULL和IS NOT NULL这两个操作符，它们专门用于检查字段是否为NULL。当我们使用IS NULL时，如果字段的值为NULL，查询将返回TRUE；如果字段的值不是NULL（包括字段中有值和字段为空），查询将返回FALSE。 同样地，IS NOT NULL用于检查字段值是否不是NULL。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">普通的=，不能用于null的比较，两个式子中有一个或者两个null结果为null</span><br><span class="line">安全等于&lt;=&gt;，可以用于包含null的比较，除了null&lt;=&gt;null等于1,null&lt;=&gt;1等于0</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&lt;=&gt;0	‘2’&lt;=&gt;2	2&lt;=&gt;2	‘b’&lt;=&gt;‘b’	(1+3)&lt;=&gt;(2+2)	NULL&lt;=&gt;NULL	NULL&lt;=&gt;‘1234’	NULL&lt;=&gt;123	‘456’&lt;=&gt;NULL</span><br><span class="line">0	1	1	1	1	1	0	0	0</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql中两个字符串比较按照字符串规则来，字符串和数字比较，字符串转换成数字比较 </span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202405171532529.png" alt="image-20240517153247499"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202405171533625.png" alt="image-20240517153306278"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202405171534845.png" alt="image-20240517153424876"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">安全等于可以用于比较null,同null为1，一个则为0。其它情况和=类似</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">输入： </span><br><span class="line">Customer 表:</span><br><span class="line">+----+------+------------+</span><br><span class="line">| id | name | referee_id |</span><br><span class="line">+----+------+------------+</span><br><span class="line">| 1  | Will | null       |</span><br><span class="line">| 2  | Jane | null       |</span><br><span class="line">| 3  | Alex | 2          |</span><br><span class="line">| 4  | Bill | null       |</span><br><span class="line">| 5  | Zack | 1          |</span><br><span class="line">| 6  | Mark | 2          |</span><br><span class="line">+----+------+------------+</span><br><span class="line"></span><br><span class="line">找出那些 没有被 id = 2 的客户 推荐 的客户的姓名。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">法一 </span><br><span class="line">SELECT name</span><br><span class="line">FROM customer</span><br><span class="line">WHERE NOT referee_id &lt;=&gt; 2;</span><br><span class="line"></span><br><span class="line">法二</span><br><span class="line">SELECT name FROM customer WHERE referee_id != 2 OR referee_id IS NULL;</span><br></pre></td></tr></table></figure>

<h4 id="笛卡尔积、CROSS-JOIN"><a href="#笛卡尔积、CROSS-JOIN" class="headerlink" title="笛卡尔积、CROSS JOIN"></a>笛卡尔积、CROSS JOIN</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sql笛卡尔积</span><br><span class="line">SQL中的笛卡尔积（Cartesian Product）是指两个表的所有可能的组合。当两个表没有关联条件时，数据库系统会对这两个表进行笛卡尔积操作，这会导致性能下降和资源浪费。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">    *</span><br><span class="line">FROM</span><br><span class="line">    Students s</span><br><span class="line">CROSS JOIN</span><br><span class="line">    Subjects sub</span><br><span class="line"></span><br><span class="line">和</span><br><span class="line">from Students,Subjects</span><br><span class="line"></span><br><span class="line">一样的，都是笛卡尔积</span><br></pre></td></tr></table></figure>

<h4 id="WITH"><a href="#WITH" class="headerlink" title="WITH"></a>WITH</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">with people as</span><br><span class="line">(</span><br><span class="line">    select id, visit_date, people,</span><br><span class="line">    Lag(people,2) over(order by id) as pprvPeople,</span><br><span class="line">    Lag(people,1) over(order by id) as prvPeople,</span><br><span class="line">    Lead(people,1) over(order by id) as nextPeople,</span><br><span class="line">    Lead(people,2) over(order by id) as nnextPeople</span><br><span class="line">    from stadium</span><br><span class="line">)</span><br><span class="line">select id, visit_date, people from people</span><br><span class="line">where </span><br><span class="line">(people &gt;= 100 and prvPeople&gt;=100 and pprvPeople&gt;=100) ||</span><br><span class="line">(people &gt;= 100 and nextPeople&gt;=100 and nnextPeople&gt;=100) ||</span><br><span class="line">(people &gt;= 100 and nextPeople&gt;=100 and prvPeople&gt;=100) </span><br></pre></td></tr></table></figure>

<h4 id="mod-M-N"><a href="#mod-M-N" class="headerlink" title="mod(M,N)"></a>mod(M,N)</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">取余函数</span><br><span class="line"><span class="built_in">mod</span>(id,<span class="number">2</span>)</span><br><span class="line">id<span class="operator">%</span><span class="number">2</span></span><br></pre></td></tr></table></figure>

<h4 id="substring"><a href="#substring" class="headerlink" title="substring()"></a>substring()</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">不是下标为0开始</span><br><span class="line"></span><br><span class="line">--2018-12-18</span><br><span class="line">substring(trans_date,1,7)</span><br></pre></td></tr></table></figure>


<h4 id="group-by-新奇"><a href="#group-by-新奇" class="headerlink" title="group by 新奇"></a>group by 新奇</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT DATE_FORMAT(trans_date, &#x27;%Y-%m&#x27;) AS month,</span><br><span class="line">    country,</span><br><span class="line">    COUNT(*) AS trans_count,</span><br><span class="line">    COUNT(IF(state = &#x27;approved&#x27;, 1, NULL)) AS approved_count,</span><br><span class="line">    SUM(amount) AS trans_total_amount,</span><br><span class="line">    SUM(IF(state = &#x27;approved&#x27;, amount, 0)) AS approved_total_amount</span><br><span class="line">FROM Transactions</span><br><span class="line">GROUP BY month, country --这里的month是截取的，不能再group by后面截取，截取后也不能重命名</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select e.student_id,student_name,count(*) attended_exams </span><br><span class="line">from Students s ,Examinations e</span><br><span class="line">where s.student_id=e.student_id</span><br><span class="line">group by student_id,student_name</span><br><span class="line"></span><br><span class="line">-- 这里能select student_name,因为这里同分组下student_name相同</span><br></pre></td></tr></table></figure>



<h4 id="自定义变量"><a href="#自定义变量" class="headerlink" title="自定义变量"></a>自定义变量</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Queue 表</span><br><span class="line">+-----------+-------------+--------+------+</span><br><span class="line">| person_id | person_name | weight | turn |</span><br><span class="line">+-----------+-------------+--------+------+</span><br><span class="line">| 5         | Alice       | 250    | 1    |</span><br><span class="line">| 4         | Bob         | 175    | 5    |</span><br><span class="line">| 3         | Alex        | 350    | 2    |</span><br><span class="line">| 6         | John Cena   | 400    | 3    |</span><br><span class="line">| 1         | Winston     | 500    | 6    |</span><br><span class="line">| 2         | Marie       | 200    | 4    |</span><br><span class="line">+-----------+-------------+--------+------+</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT a.person_name</span><br><span class="line">FROM (</span><br><span class="line">	SELECT person_name, @pre := @pre + weight AS weight</span><br><span class="line">	FROM Queue, (SELECT @pre := 0) tmp</span><br><span class="line">	ORDER BY turn</span><br><span class="line">) a</span><br><span class="line">WHERE a.weight &lt;= 1000</span><br><span class="line">ORDER BY a.weight DESC</span><br><span class="line">LIMIT 1</span><br></pre></td></tr></table></figure>

<h4 id="窗口函数"><a href="#窗口函数" class="headerlink" title="窗口函数"></a>窗口函数</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql8.0时开始支持</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/CoderSharry/article/details/135063960">参考</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通常将常用的窗口函数分为两大类：聚合窗口函数与专用窗口函数。</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>SUM</th>
<th>求和</th>
</tr>
</thead>
<tbody><tr>
<td>AVG</td>
<td>求平均值</td>
</tr>
<tr>
<td>COUNT</td>
<td>求数量</td>
</tr>
<tr>
<td>MAX</td>
<td>求最大值</td>
</tr>
<tr>
<td>MIN</td>
<td>求最小值</td>
</tr>
</tbody></table>
<p>函数名	分类	说明<br>RANK	排序函数	类似于排名，并列的结果序号可以重复，序号不连续<br>DENSE_RANK	排序函数	类似于排名，并列的结果序号可以重复，序号连续<br>ROW_NUMBER	排序函数	对该分组下的所有结果作一个排序，基于该分组给一个行数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[你要的操作] OVER ( PARTITION BY  &lt;用于分组的列名&gt;</span><br><span class="line">                    ORDER BY &lt;按序叠加的列名&gt; </span><br><span class="line">                    ROWS &lt;窗口滑动的数据范围&gt; )</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">窗口函数([参数]) OVER (</span><br><span class="line">  [PARTITION BY &lt;分组列&gt;] </span><br><span class="line">  [ORDER BY &lt;排序列 ASC/DESC&gt;]</span><br><span class="line">  [ROWS BETWEEN 开始行 AND 结束行]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h5 id="rows-between-and"><a href="#rows-between-and" class="headerlink" title="rows between and"></a>rows between and</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;窗口滑动的数据范围&gt; 用来限定[ 你要的操作] 所运用的数据的范围，具体有如下这些：</span><br><span class="line"></span><br><span class="line">当前行 - current row</span><br><span class="line">之前的行 - preceding</span><br><span class="line">之后的行 - following</span><br><span class="line">无界限 - unbounded</span><br><span class="line">表示从前面的起点 - unbounded preceding</span><br><span class="line">表示到后面的终点 - unbounded following</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">举例理解一下：</span><br><span class="line"></span><br><span class="line">取当前行和前五行：ROWS between 5 preceding and current row --共6行</span><br><span class="line">取当前行和后五行：ROWS between current row and 5 following --共6行</span><br><span class="line">取前五行和后五行：ROWS between 5 preceding and 5 folowing --共11行</span><br><span class="line"></span><br><span class="line">// 从当前行到最后的数据</span><br><span class="line">sum(sales_volume) over(partition by id rows between current row and unbounded following) sum_sales</span><br><span class="line"></span><br><span class="line">sum(sales_volume) over(partition by id rows between unbounded preceding and current row) sum_sales</span><br><span class="line"></span><br><span class="line">sum(sales_volume) over(partition by id rows between current row and 2 following) sum_sales</span><br><span class="line"></span><br><span class="line">sum(sales_volume) over(partition by id rows between 1 preceding and current row) sum_sales</span><br></pre></td></tr></table></figure>

<h5 id="range-between-and"><a href="#range-between-and" class="headerlink" title="range between and"></a>range between and</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">range表示的是 具体的值，比这个值小n的行，比这个值大n的行</span><br><span class="line">range between是以当前值为锚点进行计算</span><br><span class="line"></span><br><span class="line">比如</span><br><span class="line">range between 4 preceding AND 7 following</span><br><span class="line">1</span><br><span class="line">表示：如果当前值为10的话就取前后的值在6到17之间的数据。</span><br><span class="line"></span><br><span class="line">sum(close) range between 100 preceding and 200 following</span><br><span class="line">1</span><br><span class="line">则通过字段差值来进行选择。如当前行的 close 字段值是 200，那么这个窗口大小的定义就会选择分区中 close 字段值落在 100 至 400 区间的记录（行）</span><br></pre></td></tr></table></figure>



<h5 id="dense-rank-over"><a href="#dense-rank-over" class="headerlink" title="dense_rank() over"></a>dense_rank() over</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT SId,totalscore,DENSE_RANK()over(ORDER BY totalscore DESC) r</span><br><span class="line">FROM</span><br><span class="line">(</span><br><span class="line">SELECT SId,SUM(score) totalscore</span><br><span class="line">FROM sc</span><br><span class="line">GROUP BY SId</span><br><span class="line">) t</span><br></pre></td></tr></table></figure>

<h5 id="avg-x-over"><a href="#avg-x-over" class="headerlink" title="avg(x) over()"></a>avg(x) over()</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">  sales.*,</span><br><span class="line">  AVG( revenue ) OVER ( PARTITION BY category ) AS avg_revenue </span><br><span class="line">FROM</span><br><span class="line">	sales</span><br></pre></td></tr></table></figure>





<h4 id="CASE"><a href="#CASE" class="headerlink" title="CASE"></a>CASE</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">case语句格式一</span><br><span class="line"></span><br><span class="line">CASE语句在执行时，将CASE后的表达式的值与各WHEN子句的表达式值比较，如果相等，则执行THEN后面的表达式或语句，然后跳出CASE语句；否则，返回ELSE后面的表达式。</span><br><span class="line"></span><br><span class="line">CASE input_expression</span><br><span class="line">    WHEN expression1 THEN result_expression1</span><br><span class="line">    WHEN expression2 THEN result_expression2</span><br><span class="line">    [...n]</span><br><span class="line">    ELSE result_expression</span><br><span class="line">    END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">case语句格式二</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CASE</span><br><span class="line">    WHEN expression1 THEN result_expression1</span><br><span class="line">    WHEN expression2 THEN result_expression2</span><br><span class="line">    [...n]</span><br><span class="line">    ELSE result_expression</span><br><span class="line">    END</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CASE后面没有表达式，多个WHEN子句中的表达式依次执行，如果表达式结果为真，则执行相应THEN关键字后面的表达式或语句，执行完毕之后跳出CASE语句。如果所有WHEN语句都为FALSE，则执行ELSE子句中的语句。</span><br><span class="line"></span><br><span class="line">小tips：在交换数据和列转行时可以考虑使用case语句</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">case when ... then x else x end</span><br><span class="line"></span><br><span class="line">\</span><br><span class="line"></span><br><span class="line">case when then x</span><br><span class="line">when then x else x end</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">case when sc.cid=&#x27;01&#x27; then sc.score end</span><br></pre></td></tr></table></figure>



<h4 id="GROUP-CONCAT"><a href="#GROUP-CONCAT" class="headerlink" title="GROUP_CONCAT()"></a>GROUP_CONCAT()</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202405231753919.png" alt="image-20240523175304465"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT sell_date,</span><br><span class="line">       COUNT(DISTINCT product) num_sold,</span><br><span class="line">       GROUP_CONCAT(DISTINCT product) products</span><br><span class="line">FROM Activities</span><br><span class="line">GROUP BY sell_date</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">可以指定自定义的分隔符，不指定的情况下，默认是 &#x27;,&#x27; GROUP_CONCAT(DISTINCT product ORDER BY product ASC SEPARATOR &#x27;,&#x27;)</span><br></pre></td></tr></table></figure>

<h4 id="正则表达式-REGEXP-regexp-like"><a href="#正则表达式-REGEXP-regexp-like" class="headerlink" title="正则表达式 REGEXP  regexp_like"></a>正则表达式 REGEXP  regexp_like</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dna_sequence REGEXP &#x27;xxx&#x27;</span><br><span class="line"></span><br><span class="line">regexp_like(dna_sequence, &#x27;xxx&#x27;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rlike和regexp一样的效果</span><br></pre></td></tr></table></figure>



<h4 id=""><a href="#" class="headerlink" title="||"></a>||</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sql语句中“||”符号表示，连接符。比如&#x27;111&#x27;||&#x27;222&#x27;其结果就是&#x27;111222&#x27;。</span><br></pre></td></tr></table></figure>

<h4 id="ONLY-FULL-GROUP-BY"><a href="#ONLY-FULL-GROUP-BY" class="headerlink" title="ONLY_FULL_GROUP_BY"></a>ONLY_FULL_GROUP_BY</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">关闭ONLY_FULL_GROUP_BY模式的弊端</span><br><span class="line"></span><br><span class="line">结果的不确定性：关闭 ONLY_FULL_GROUP_BY 可能导致分组查询返回不确定的结果。特别是当 SELECT 列表中包含非聚合列，且这些列没有包含在 GROUP BY 子句中时，MySQL 将从每个分组中任意选择一个值作为结果，这可能导致结果难以预测和解释。</span><br><span class="line">调试复杂性：在没有 ONLY_FULL_GROUP_BY 的约束下，编写的查询可能在逻辑上不那么明确，尤其是当查询变得复杂时。这可能使得调试和维护查询变得更加困难。</span><br><span class="line">性能问题：虽然不是直接结果，但关闭 ONLY_FULL_GROUP_BY 并依赖 MySQL 从分组中随机选择数据可能导致查询效率不是最优的，特别是在处理大量数据时。</span><br><span class="line">标准SQL的偏离：ONLY_FULL_GROUP_BY 更接近于 SQL 标准对分组操作的定义。关闭它可能意味着编写的 SQL 在其他遵循 SQL 标准的数据库系统中可能不会工作或者产生不同的结果。</span><br></pre></td></tr></table></figure>

<h4 id="行转列、列转行"><a href="#行转列、列转行" class="headerlink" title="行转列、列转行"></a>行转列、列转行</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">行转列一般使用 IF 或 <span class="keyword">CASE</span> <span class="keyword">WHEN</span> 语句 <span class="operator">+</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="operator">+</span> 聚合函数。而列转行一般使用 <span class="keyword">UNION</span> <span class="operator">+</span> 多个查询 的方法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  product_id,</span><br><span class="line">  <span class="built_in">SUM</span>(IF(store <span class="operator">=</span> <span class="string">&#x27;store1&#x27;</span>, price, <span class="keyword">NULL</span>)) <span class="string">&#x27;store1&#x27;</span>,</span><br><span class="line">  <span class="built_in">SUM</span>(IF(store <span class="operator">=</span> <span class="string">&#x27;store2&#x27;</span>, price, <span class="keyword">NULL</span>)) <span class="string">&#x27;store2&#x27;</span>,</span><br><span class="line">  <span class="built_in">SUM</span>(IF(store <span class="operator">=</span> <span class="string">&#x27;store3&#x27;</span>, price, <span class="keyword">NULL</span>)) <span class="string">&#x27;store3&#x27;</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  Products1 </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> product_id ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> product_id, <span class="string">&#x27;store1&#x27;</span> store, store1 price <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> store1 <span class="keyword">IS</span> <span class="keyword">NOT NULL</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> product_id, <span class="string">&#x27;store2&#x27;</span> store, store2 price <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> store2 <span class="keyword">IS</span> <span class="keyword">NOT NULL</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> product_id, <span class="string">&#x27;store3&#x27;</span> store, store3 price <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> store3 <span class="keyword">IS</span> <span class="keyword">NOT NULL</span>;</span><br></pre></td></tr></table></figure>



<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202405281307874.png" alt="image-20240528130754538"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202405281308365.png" alt="image-20240528130802977"></p>
<h4 id="左右外连接当连接键不唯一时"><a href="#左右外连接当连接键不唯一时" class="headerlink" title="左右外连接当连接键不唯一时"></a>左右外连接当连接键不唯一时</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">还是可以正常连接</span><br><span class="line"></span><br><span class="line">不用去笛卡尔积，然后过滤</span><br></pre></td></tr></table></figure>



<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202406021438298.png" alt="image-20240602143811747"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/ttyong/hexoBlog/master/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%B9%96Hudi/202406021438977.png" alt="image-20240602143830263"></p>
<h4 id="mysql全外连接"><a href="#mysql全外连接" class="headerlink" title="mysql全外连接"></a>mysql全外连接</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql不支持</span><br><span class="line">可以用left + right +union实现(这里需要去重)</span><br></pre></td></tr></table></figure>

<h4 id="union和union-all"><a href="#union和union-all" class="headerlink" title="union和union all"></a>union和union all</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">union会去重</span><br><span class="line">union all不会去重</span><br></pre></td></tr></table></figure>

<h4 id="limit-1"><a href="#limit-1" class="headerlink" title="limit"></a>limit</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">limit  2 ==&gt;从0索引开始读取2个</span><br><span class="line"></span><br><span class="line">select * from table limit 2,1;                </span><br><span class="line">//含义是跳过2条取出1条数据，limit后面是从第2条开始读，读取1条信息，即读取第3条数据</span><br><span class="line"> </span><br><span class="line">select * from table limit 2 offset 1;     </span><br><span class="line">//含义是从下标1开始取出2条数据，limit后面跟的是2条数据，即读取第2,3条</span><br></pre></td></tr></table></figure>

<h4 id="where-player-id-event-date-in-select-a-b"><a href="#where-player-id-event-date-in-select-a-b" class="headerlink" title="where (player_id, event_date) in select a,b"></a>where (player_id, event_date) in select a,b</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select player_id, device_id</span><br><span class="line">from activity</span><br><span class="line">where (player_id, event_date) in </span><br><span class="line">(select player_id, min(event_date)</span><br><span class="line">from activity</span><br><span class="line">group by player_id)</span><br></pre></td></tr></table></figure>

<h4 id="order-by和limit一起使用注意事项"><a href="#order-by和limit一起使用注意事项" class="headerlink" title="order by和limit一起使用注意事项"></a>order by和limit一起使用注意事项</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如果 order by 的列有相同的值时，MySQL 会随机选取这些行</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">当order by的列有重复值时，</span><br><span class="line">select ... order by A和select ... order by A limit 6结果可能不一样</span><br><span class="line"></span><br><span class="line">可以在order by A后面再加一个字段，让两个方法保持结果一致性</span><br></pre></td></tr></table></figure>

<h4 id="sqrt-开平方"><a href="#sqrt-开平方" class="headerlink" title="sqrt()开平方"></a>sqrt()开平方</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqrt(A)对A开平方根</span><br></pre></td></tr></table></figure>

<h4 id="count-count-0-count-1"><a href="#count-count-0-count-1" class="headerlink" title="count(**)\count(*0)\count(1)"></a>count(**)\count(*0)\count(1)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">结果是一样的</span><br></pre></td></tr></table></figure>

<h4 id="ABS-p1-x-value-p2-x-value"><a href="#ABS-p1-x-value-p2-x-value" class="headerlink" title="ABS(p1.x_value - p2.x_value)"></a>ABS(p1.x_value - p2.x_value)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">取绝对值</span><br></pre></td></tr></table></figure>

<h4 id="UPPER-LOWER-CONCAT-group-concat"><a href="#UPPER-LOWER-CONCAT-group-concat" class="headerlink" title="UPPER LOWER CONCAT group_concat"></a>UPPER LOWER CONCAT group_concat</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">UPPER(expression)：将字符串表达式转换为大写。</span><br><span class="line"></span><br><span class="line">LOWER(expression)：将字符串表达式转换为小写。</span><br><span class="line"></span><br><span class="line">CONCAT(string1, string2, ...)：将两个或多个字符串连接成一个。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">     sell_date,</span><br><span class="line">     count(distinct product) as num_sold,</span><br><span class="line">     group_concat(distinct product order by product separator &#x27;,&#x27;) as products</span><br><span class="line"> from Activities </span><br><span class="line"> group by sell_date</span><br><span class="line"> order by sell_date </span><br></pre></td></tr></table></figure>

<h4 id="TRIM"><a href="#TRIM" class="headerlink" title="TRIM"></a>TRIM</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">TRIM() 函数用于从字符串的开头和结尾删除指定字符，默认情况下删除空格</span><br><span class="line"></span><br><span class="line">TRIM([BOTH | LEADING | TRAILING] [remstr] FROM str)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BOTH: 删除两侧的字符（默认）。</span><br><span class="line">LEADING: 删除开头的字符。</span><br><span class="line">TRAILING: 删除结尾的字符。</span><br><span class="line">remstr: 要删除的字符集，默认为空格</span><br><span class="line"></span><br><span class="line">删除两侧空格</span><br><span class="line">SELECT TRIM(BOTH &#x27; &#x27; FROM &#x27; Hello World &#x27;);</span><br><span class="line">-- 输出: &#x27;Hello World&#x27;</span><br><span class="line"></span><br><span class="line">删除左侧空格</span><br><span class="line">SELECT TRIM(LEADING &#x27; &#x27; FROM &#x27; Hello World&#x27;);</span><br><span class="line">-- 输出: &#x27;Hello World&#x27;</span><br><span class="line"></span><br><span class="line">删除右侧空格</span><br><span class="line">SELECT TRIM(TRAILING &#x27; &#x27; FROM &#x27;Hello World &#x27;);</span><br><span class="line">-- 输出: &#x27;Hello World&#x27;</span><br><span class="line"></span><br><span class="line">删除指定字符</span><br><span class="line">SELECT TRIM(BOTH &#x27;*&#x27; FROM &#x27;**Hello*World**&#x27;);</span><br><span class="line">-- 输出: &#x27;Hello*World&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="left-right-instr"><a href="#left-right-instr" class="headerlink" title="left right instr"></a>left right instr</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">instr(dna_sequence,&#x27;GGG&#x27;)&gt;0</span><br></pre></td></tr></table></figure>



<h4 id="递归-recursive-题目1613-1270-3482"><a href="#递归-recursive-题目1613-1270-3482" class="headerlink" title="递归 recursive 题目1613 1270 3482"></a>递归 recursive 题目1613 1270 3482</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">有两种递归字段n的声明写法，第一种是在with… as 中声明需要递归的字段，第二种是在sql语句中第一段的初始值内声明变量。</span><br><span class="line"></span><br><span class="line">WITH RECURSIVE cte (n) AS</span><br><span class="line">( select 初始值 from table</span><br><span class="line">union all</span><br><span class="line">select 递归内容 from cte where (终止条件)</span><br><span class="line">)</span><br><span class="line">这里注意 递归内容中选择的表格是cte,引用的是临时的递归表格。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.生成数字序列</span><br><span class="line"></span><br><span class="line">with recursive t(n) as</span><br><span class="line">(</span><br><span class="line">	select 1</span><br><span class="line">	union all</span><br><span class="line">	select n+1 from t where n&lt;100</span><br><span class="line"></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">2.树状或者层级结构</span><br><span class="line"></span><br><span class="line">比如公司员工表，用一个员工表join另一个员工表可以得到上下级关系，再join...，但是又时不知道有多少个层级，就得用recursive了</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">with Recursive emp_path as(</span><br><span class="line">	select emp_id,emp,name,emp_name path</span><br><span class="line">	from employee</span><br><span class="line">	where emp_id = 1</span><br><span class="line">	union all</span><br><span class="line">	select e.emp_id,e.emp_name,concat(m.path,&#x27;-&gt;&#x27;,e.emp_name)</span><br><span class="line">	from employee e</span><br><span class="line">	join emp_path m on (m.emp_id=e.manager)</span><br><span class="line">)</span><br><span class="line">select * from emp_path;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cloudflare-imgbed-bhx.pages.de/file/1751512369142_9537-20250703-image-20250703111238963.png" alt="image-20250703111238963"></p>
<h4 id="CAST-expression-AS-TYPE"><a href="#CAST-expression-AS-TYPE" class="headerlink" title="CAST(expression AS TYPE)"></a>CAST(expression AS TYPE)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CAST(expression AS TYPE) 函数可以将任何类型的值转换为具有指定类型的值,利用该函数可以直接在数据库层处理部分因数据类型引起的问题</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">支持的TYPE类型	描述</span><br><span class="line">BINARY	二进制型</span><br><span class="line">CHAR	字符型</span><br><span class="line">DATE	日期，格式为 ‘YYYY-MM-DD’</span><br><span class="line">DATETIME	日期加具体的时间，格式为 ‘YYYY-MM-DD HH:MM:SS’</span><br><span class="line">TIME	时间，格式为 ‘HH:MM:SS’</span><br><span class="line">DECIMAL	float 型</span><br><span class="line">SIGNED	int 型</span><br><span class="line">UNSIGNED	无符号int</span><br></pre></td></tr></table></figure>

<h4 id="substring-index"><a href="#substring-index" class="headerlink" title="substring_index"></a>substring_index</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SUBSTRING_INDEX 是MySQL中的一个非常实用的字符串截取函数。它的基本用法是 SUBSTRING_INDEX(str, delim, count)，其中 str 是要截取的原始字符串，delim 是作为分隔符的字符，而 count 指定了分隔符出现的次数。这个函数返回 str 中在第 count 次出现 delim 之前的子字符串。如果 count 是正数，它返回从左边开始到 delim 的所有内容；如果 count 是负数，它则返回从右边开始 delim 之后的所有内容。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-- 获取第一个逗号前的字符串</span><br><span class="line">SELECT SUBSTRING_INDEX(&#x27;15,151,152,16&#x27;, &#x27;,&#x27;, 1);</span><br><span class="line">-- 结果: &#x27;15&#x27;</span><br><span class="line"></span><br><span class="line">-- 获取第二个逗号前的字符串</span><br><span class="line">SELECT SUBSTRING_INDEX(&#x27;15,151,152,16&#x27;, &#x27;,&#x27;, 2);</span><br><span class="line">-- 结果: &#x27;15,151&#x27;</span><br><span class="line"></span><br><span class="line">-- 获取最后一个逗号后的字符串</span><br><span class="line">SELECT SUBSTRING_INDEX(&#x27;15,151,152,16&#x27;, &#x27;,&#x27;, -1);</span><br><span class="line">-- 结果: &#x27;16&#x27;</span><br><span class="line"></span><br><span class="line">-- 获取倒数第二个逗号前的字符串中，最后一个逗号后的部分</span><br><span class="line">SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(&#x27;15,151,152,16&#x27;, &#x27;,&#x27;, 2), &#x27;,&#x27;, -1);</span><br><span class="line">-- 结果: &#x27;151&#x27;</span><br><span class="line"></span><br><span class="line">-- 获取倒数第二个逗号后的字符串中，第一个逗号前的部分</span><br><span class="line">SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(&#x27;15,151,152,16&#x27;, &#x27;,&#x27;, -2), &#x27;,&#x27;, 1);</span><br><span class="line">-- 结果: &#x27;152&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="length"><a href="#length" class="headerlink" title="length"></a>length</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">字符串字符数</span><br></pre></td></tr></table></figure>





<h2 id="Hbase"><a href="#Hbase" class="headerlink" title="Hbase"></a>Hbase</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.我们在设计列族的时候，可以把经常读取的列存储到一个列族中，不经常读取的列放到另一个列族中。</span><br><span class="line">这样我们在读取部分列的数据的时候，就只需要读取对应列族文件中的数据，提高读取效率。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">在HBase中，数据块大小和MemStore大小是两个不同的概念，它们具有不同的功能和调整目的。</span><br><span class="line"></span><br><span class="line">数据块大小主要影响HBase中的数据存储和访问性能。数据块由多个cell（key-value对）集合组成，每个数据块的大小在创建表的列族时可以指定。数据块大小的设定影响数据块索引的大小，数据块越小，索引越大，从而占用更大内存空间。因此，在随机查找性能和数据块索引内存占用之间需要权衡。如果需要更好的随机查找性能，可以将数据块设置为较小的值；而如果需要更好的序列扫描性能，则可以考虑增大数据块的大小。</span><br><span class="line"></span><br><span class="line">而MemStore是HBase中用于保存修改数据（即key-value对）的内存结构。当MemStore的大小达到一个阈值（默认是128MB）时，MemStore会被Flush到文件（即StoreFile），以释放内存空间。MemStore的大小设置主要影响HBase的写入性能和内存使用。如果MemStore太小，可能导致频繁的Flush操作，影响写入性能；如果MemStore太大，则可能消耗过多的内存资源。</span><br><span class="line"></span><br><span class="line">因此，hbase数据块大小和memstore大小不一样，它们是HBase中两个不同的参数，需要根据具体的应用场景和性能需求进行独立调整。</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">智汇君</div><div class="post-copyright__author_desc">路漫漫其修远兮，吾将上下而求索！</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/01/17/%E9%9D%A2%E8%AF%95%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%EF%BC%9F/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/01/17/面试 数据库常见面试问题？/')">面试 数据库常见面试问题？</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="/img/%E5%BE%AE%E4%BF%A1%E6%94%B6%E6%AC%BE%E7%A0%81.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E5%BE%AE%E4%BF%A1%E6%94%B6%E6%AC%BE%E7%A0%81.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%B6%E6%AC%BE%E7%A0%81.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%B6%E6%AC%BE%E7%A0%81.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/01/17/%E9%9D%A2%E8%AF%95%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%EF%BC%9F/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Tech智汇站</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E9%9D%A2%E8%AF%95/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>面试<span class="tagsPageCount">12</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/01/17/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-%E8%BF%9B%E9%98%B6%E7%AF%87%201/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">黑马MySQL数据库从入门到精通-进阶篇 1</div></div></a></div><div class="next-post pull-right"><a href="/2025/01/17/%E9%BB%91%E9%A9%ACMySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-%E5%9F%BA%E7%A1%80%E7%AF%87%20%E4%BA%8B%E5%8A%A1/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">黑马MySQL数据库从入门到精通-基础篇 事务</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/01/17/%E5%B0%9A%E8%A7%82%E4%BA%91%E8%AE%A1%E7%AE%97%E4%B9%8Boracle%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%9F%BA%E7%A1%80%E9%83%A8%E5%88%86%201/" title="尚观云计算之oracle数据库 基础部分 1"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-17</div><div class="title">尚观云计算之oracle数据库 基础部分 1</div></div></a></div><div><a href="/2025/01/17/%E9%9D%A2%E8%AF%95%20ES%E9%9D%A2%E8%AF%951/" title="面试 ES面试1"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-17</div><div class="title">面试 ES面试1</div></div></a></div><div><a href="/2025/01/17/%E9%9D%A2%E8%AF%95%20SHELL%E8%84%9A%E6%9C%AC%E5%BC%80%E5%8F%91/" title="面试 SHELL脚本开发"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-17</div><div class="title">面试 SHELL脚本开发</div></div></a></div><div><a href="/2025/01/17/%E9%9D%A2%E8%AF%95%20Hadoop%E9%9D%A2%E8%AF%95/" title="面试 Hadoop面试"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-17</div><div class="title">面试 Hadoop面试</div></div></a></div><div><a href="/2025/01/17/%E9%9D%A2%E8%AF%95%20hive%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%982/" title="面试 hive常见面试题2"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-17</div><div class="title">面试 hive常见面试题2</div></div></a></div><div><a href="/2025/01/17/%E9%9D%A2%E8%AF%95%20hive%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%981/" title="面试 hive常见面试题1"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-17</div><div class="title">面试 hive常见面试题1</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">智汇君</h1><div class="author-info__desc">路漫漫其修远兮，吾将上下而求索！</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="/contact/" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来看我的博客鸭~</div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(/img/博客微信公众号图片.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">数据库常见面试问题？</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql"><span class="toc-number">1.1.</span> <span class="toc-text">mysql</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">课程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%80%E5%9C%9F%E6%8E%98%E9%87%91"><span class="toc-number">1.1.2.</span> <span class="toc-text">稀土掘金</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%B9%BB%E8%AF%BB%EF%BC%8C%E8%84%8F%E8%AF%BB%EF%BC%8C%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E5%91%A2%EF%BC%9F"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">什么是幻读，脏读，不可重复读呢？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#limit-1000000-%E5%8A%A0%E8%BD%BD%E5%BE%88%E6%85%A2%E7%9A%84%E8%AF%9D%EF%BC%8C%E4%BD%A0%E6%98%AF%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%E7%9A%84%E5%91%A2%EF%BC%9F"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">limit 1000000 加载很慢的话，你是怎么解决的呢？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E9%AB%98%E5%B9%B6%E5%8F%91%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E5%A6%82%E4%BD%95%E5%81%9A%E5%88%B0%E5%AE%89%E5%85%A8%E7%9A%84%E4%BF%AE%E6%94%B9%E5%90%8C%E4%B8%80%E8%A1%8C%E6%95%B0%E6%8D%AE%EF%BC%9F"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">在高并发情况下，如何做到安全的修改同一行数据？</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%82%B2%E8%A7%82%E9%94%81"><span class="toc-number">1.1.2.3.1.</span> <span class="toc-text">使用悲观锁</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%B9%90%E8%A7%82%E9%94%81"><span class="toc-number">1.1.2.3.2.</span> <span class="toc-text">使用乐观锁</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CSDN%E6%A1%88%E4%BE%8B"><span class="toc-number">1.1.2.4.</span> <span class="toc-text">CSDN案例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%B8%80"><span class="toc-number">1.1.2.4.1.</span> <span class="toc-text">案例一</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1"><span class="toc-number">1.1.2.4.2.</span> <span class="toc-text">1.1</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-2"><span class="toc-number">1.1.2.4.2.1.</span> <span class="toc-text">1.2</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#1-3"><span class="toc-number">1.1.2.4.2.2.</span> <span class="toc-text">1.3</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-EXISTS"><span class="toc-number">1.1.2.4.3.</span> <span class="toc-text">3 EXISTS</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#7-having%E7%9A%84%E4%B8%80%E4%B8%AA%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7"><span class="toc-number">1.1.2.4.3.1.</span> <span class="toc-text">7 having的一个使用技巧</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#8"><span class="toc-number">1.1.2.4.3.2.</span> <span class="toc-text">8</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#9"><span class="toc-number">1.1.2.4.3.3.</span> <span class="toc-text">9</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#13-avg-over-partition-by"><span class="toc-number">1.1.2.4.3.4.</span> <span class="toc-text">13 avg() over(partition by)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#14"><span class="toc-number">1.1.2.4.3.5.</span> <span class="toc-text">14</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#15-%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.1.2.4.3.6.</span> <span class="toc-text">15  变量的使用</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#16-dense-rank-%E3%80%81%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.1.2.4.3.7.</span> <span class="toc-text">16 dense_rank()、变量的使用</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#17-%E5%8C%BA%E5%9F%9F%E6%AE%B5-case-when-then-concat"><span class="toc-number">1.1.2.4.3.8.</span> <span class="toc-text">17 区域段 case when then  concat</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#22-like"><span class="toc-number">1.1.2.4.3.9.</span> <span class="toc-text">22 like</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#25"><span class="toc-number">1.1.2.4.3.10.</span> <span class="toc-text">25</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#33-%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%BF%E7%94%A8-limit"><span class="toc-number">1.1.2.4.3.11.</span> <span class="toc-text">33 变量的使用 limit</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#34-%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.1.2.4.3.12.</span> <span class="toc-text">34  变量的使用</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#41-current-day-substring-year-now"><span class="toc-number">1.1.2.4.3.13.</span> <span class="toc-text">41 current_day(),substring(),year(),now()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#42-week"><span class="toc-number">1.1.2.4.3.14.</span> <span class="toc-text">42 week</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#43-month"><span class="toc-number">1.1.2.4.3.15.</span> <span class="toc-text">43 month</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#44-month"><span class="toc-number">1.1.2.4.3.16.</span> <span class="toc-text">44 month</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%BA%8C"><span class="toc-number">1.1.2.4.4.</span> <span class="toc-text">案例二</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#9-%E5%A4%96%E8%BF%9E%E6%8E%A5%E5%AE%9E%E7%8E%B0except"><span class="toc-number">1.1.2.4.4.1.</span> <span class="toc-text">9 !外连接实现except</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#10"><span class="toc-number">1.1.2.4.4.2.</span> <span class="toc-text">10</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#11"><span class="toc-number">1.1.2.4.4.3.</span> <span class="toc-text">11</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#13"><span class="toc-number">1.1.2.4.4.4.</span> <span class="toc-text">13</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#14-1"><span class="toc-number">1.1.2.4.4.5.</span> <span class="toc-text">14</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#14-case-when-round-%E5%80%BC%E5%BE%97%E6%B3%A8%E6%84%8F"><span class="toc-number">1.1.2.4.4.6.</span> <span class="toc-text">14 case when round 值得注意</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#15-PARTITION-BY-%E4%B8%8B%E9%9D%A2%E9%82%A3%E4%B8%AAwith%E6%A1%88%E4%BE%8B%E5%80%BC%E5%BE%97%E6%B3%A8%E6%84%8F"><span class="toc-number">1.1.2.4.4.7.</span> <span class="toc-text">15 PARTITION BY  下面那个with案例值得注意</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#16-%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%BF%E7%94%A8-%E6%B3%95%E4%B8%80%E6%B2%A1%E7%9C%8B%E6%87%82-%E6%B3%95%E4%BA%8C%E6%B3%95%E5%85%AD-%E5%80%BC%E5%BE%97%E6%B3%A8%E6%84%8F"><span class="toc-number">1.1.2.4.4.8.</span> <span class="toc-text">16 变量的使用 法一没看懂 法二法六 值得注意</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#17-18%E5%80%BC%E5%BE%97%E6%B3%A8%E6%84%8F-22-ROUND-CASE-CONCAT"><span class="toc-number">1.1.2.4.4.9.</span> <span class="toc-text">17 18值得注意 22 ROUND\CASE\CONCAT</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%EF%BC%8133-34-35-36-37-39-40-HAVING-%E5%8F%98%E9%87%8F"><span class="toc-number">1.1.2.4.4.10.</span> <span class="toc-text">！33 34 35 36 37 39 40 HAVING 变量</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%EF%BC%81timestampdiff-week-month-NOW-YEAR-x-CURDATE"><span class="toc-number">1.1.2.4.4.11.</span> <span class="toc-text">！timestampdiff()\week()\month()\NOW()\YEAR(x)\CURDATE()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#41"><span class="toc-number">1.1.2.4.4.12.</span> <span class="toc-text">41</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#42"><span class="toc-number">1.1.2.4.4.13.</span> <span class="toc-text">42</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#43"><span class="toc-number">1.1.2.4.4.14.</span> <span class="toc-text">43</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#44"><span class="toc-number">1.1.2.4.4.15.</span> <span class="toc-text">44</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#45"><span class="toc-number">1.1.2.4.4.16.</span> <span class="toc-text">45</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%B8%89"><span class="toc-number">1.1.2.4.5.</span> <span class="toc-text">案例三</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LEECODE%E6%A1%88%E4%BE%8B"><span class="toc-number">1.1.3.</span> <span class="toc-text">LEECODE案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#177-%E7%AC%ACN%E9%AB%98%E7%9A%84%E8%96%AA%E6%B0%B4-%E5%87%BD%E6%95%B0-dense-rank-limit"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">177.第N高的薪水  函数 dense_rank limit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#178-%E5%88%86%E6%95%B0%E6%8E%92%E5%90%8D-dense-rank-b-score-a-score"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">178.分数排名 dense_rank b.score &gt;&#x3D; a.score</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#180-%E8%BF%9E%E7%BB%AD%E5%87%BA%E7%8E%B0%E7%9A%84%E6%95%B0%E5%AD%97-lag-lead-with-%E5%8F%98%E9%87%8F-%E5%A4%9A%E5%90%8C%E8%A1%A8%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">180.连续出现的数字 lag lead with 变量 多同表连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#184-%E9%83%A8%E9%97%A8%E5%B7%A5%E8%B5%84%E6%9C%80%E9%AB%98%E7%9A%84%E5%91%98%E5%B7%A5"><span class="toc-number">1.1.3.4.</span> <span class="toc-text">184.部门工资最高的员工</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#185-%E9%83%A8%E9%97%A8%E5%B7%A5%E8%B5%84%E5%89%8D%E4%B8%89%E9%AB%98%E7%9A%84%E6%89%80%E6%9C%89%E5%91%98%E5%B7%A5"><span class="toc-number">1.1.3.5.</span> <span class="toc-text">185.部门工资前三高的所有员工</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#196-%E5%88%A0%E9%99%A4%E9%87%8D%E5%A4%8D%E7%9A%84%E7%94%B5%E5%AD%90%E9%82%AE%E7%AE%B1-%E8%BF%9E%E8%A1%A8delete"><span class="toc-number">1.1.3.6.</span> <span class="toc-text">196.删除重复的电子邮箱  连表delete</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#197-%E4%B8%8A%E5%8D%87%E7%9A%84%E6%B8%A9%E5%BA%A6-datediff-lag-date-add"><span class="toc-number">1.1.3.7.</span> <span class="toc-text">197.上升的温度 datediff lag date_add</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#262-%E8%A1%8C%E7%A8%8B%E5%92%8C%E7%94%A8%E6%88%B7-IF-Case"><span class="toc-number">1.1.3.8.</span> <span class="toc-text">262.行程和用户 IF Case</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#avg%E7%B2%BE%E5%BD%A9%E7%94%A8%E6%B3%95"><span class="toc-number">1.1.3.8.1.</span> <span class="toc-text">avg精彩用法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#534-%E6%B8%B8%E6%88%8F%E7%8E%A9%E6%B3%95%E5%88%86%E6%9E%90-III-sum-over-partition-by"><span class="toc-number">1.1.3.9.</span> <span class="toc-text">534.游戏玩法分析 III  sum() over(partition by</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%BE-569-%E6%B8%B8%E6%88%8F%E7%8E%A9%E6%B3%95%E5%88%86%E6%9E%90-IV-partition-by-%E4%B8%AD%E4%BD%8D%E6%95%B0"><span class="toc-number">1.1.3.10.</span> <span class="toc-text">难 569.游戏玩法分析 IV  partition by 中位数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%BE-571-%E7%BB%99%E5%AE%9A%E6%95%B0%E5%AD%97%E7%9A%84%E9%A2%91%E7%8E%87%E6%9F%A5%E8%AF%A2%E4%B8%AD%E4%BD%8D%E6%95%B0"><span class="toc-number">1.1.3.11.</span> <span class="toc-text">难 571.给定数字的频率查询中位数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#578-%E6%9F%A5%E8%AF%A2%E5%9B%9E%E7%AD%94%E7%8E%87%E6%9C%80%E9%AB%98%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.3.12.</span> <span class="toc-text">578.查询回答率最高的问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#579-%E6%9F%A5%E8%AF%A2%E5%91%98%E5%B7%A5%E7%9A%84%E7%B4%AF%E8%AE%A1%E8%96%AA%E6%B0%B4"><span class="toc-number">1.1.3.13.</span> <span class="toc-text">579.查询员工的累计薪水</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#580-%E7%BB%9F%E8%AE%A1%E5%90%84%E4%B8%93%E4%B8%9A%E5%AD%A6%E7%94%9F%E4%BA%BA%E6%95%B0"><span class="toc-number">1.1.3.14.</span> <span class="toc-text">580.统计各专业学生人数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#585-2016%E5%B9%B4%E7%9A%84%E6%8A%95%E8%B5%84"><span class="toc-number">1.1.3.15.</span> <span class="toc-text">585.2016年的投资</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#597-%E5%A5%BD%E5%8F%8B%E7%94%B3%E8%AF%B71-%E6%80%BB%E4%BD%93%E9%80%9A%E8%BF%87%E7%8E%87"><span class="toc-number">1.1.3.16.</span> <span class="toc-text">597.好友申请1:总体通过率</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#601-%E4%BD%93%E8%82%B2%E9%A6%86%E7%9A%84%E4%BA%BA%E6%B5%81%E9%87%8F-lag-lead-leaset"><span class="toc-number">1.1.3.17.</span> <span class="toc-text">601.体育馆的人流量  lag() lead() leaset()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#602-case-when"><span class="toc-number">1.1.3.18.</span> <span class="toc-text">602 case when</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#603-%E8%BF%9E%E7%BB%AD%E7%A9%BA%E4%BD%99%E5%BA%A7%E4%BD%8D-lag-lead-ROWS-BETWEEN-AND"><span class="toc-number">1.1.3.19.</span> <span class="toc-text">603.连续空余座位 lag lead  ROWS BETWEEN  AND</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#608-union"><span class="toc-number">1.1.3.20.</span> <span class="toc-text">608 union</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#610-%E5%88%A4%E6%96%AD%E4%B8%89%E8%A7%92%E5%BD%A2"><span class="toc-number">1.1.3.21.</span> <span class="toc-text">610.判断三角形</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#614-%E4%BA%8C%E7%BA%A7%E5%85%B3%E6%B3%A8%E8%80%85"><span class="toc-number">1.1.3.22.</span> <span class="toc-text">614.二级关注者</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#615-%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84-%E9%83%A8%E9%97%A8%E4%B8%8E%E5%85%AC%E5%8F%B8%E6%AF%94%E8%BE%83"><span class="toc-number">1.1.3.23.</span> <span class="toc-text">615.平均工资:部门与公司比较</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#618-%E5%AD%A6%E7%94%9F%E5%9C%B0%E7%90%86%E4%BF%A1%E6%81%AF%E6%8A%A5%E5%91%8A-%E8%A1%8C%E8%BD%AC%E5%88%97"><span class="toc-number">1.1.3.24.</span> <span class="toc-text">618.学生地理信息报告 行转列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#626-%E6%8D%A2%E5%BA%A7%E4%BD%8D-%E6%8D%A2%E5%BA%8F%E5%8F%B7"><span class="toc-number">1.1.3.25.</span> <span class="toc-text">626.换座位 换序号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#627-%E5%8F%98%E6%9B%B4%E6%80%A7%E5%88%AB-update-replace"><span class="toc-number">1.1.3.26.</span> <span class="toc-text">627.变更性别 update replace</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1070-%E4%BA%A7%E5%93%81%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90-%E5%B7%9D"><span class="toc-number">1.1.3.27.</span> <span class="toc-text">1070.产品销售分析 川</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1083-%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90-sum-%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">1.1.3.28.</span> <span class="toc-text">1083.销售分析 | sum(表达式)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1097-%E6%B8%B8%E6%88%8F%E7%8E%A9%E6%B3%95%E5%88%86%E6%9E%90-V-MIN-OVER-PARTITION-BY"><span class="toc-number">1.1.3.29.</span> <span class="toc-text">1097.游戏玩法分析 V  MIN() OVER (PARTITION BY</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1098-%E5%B0%8F%E4%BC%97%E4%B9%A6%E7%B1%8D"><span class="toc-number">1.1.3.30.</span> <span class="toc-text">1098.小众书籍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1107-%E6%AF%8F%E6%97%A5%E6%96%B0%E7%94%A8%E6%88%B7%E7%BB%9F%E8%AE%A1-MIN-OVER-PARTITION-BY"><span class="toc-number">1.1.3.31.</span> <span class="toc-text">1107.每日新用户统计 MIN() OVER (PARTITION BY</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1127-%E7%94%A8%E6%88%B7%E8%B4%AD%E4%B9%B0%E5%B9%B3%E5%8F%B0"><span class="toc-number">1.1.3.32.</span> <span class="toc-text">1127.用户购买平台</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1159-%E5%B8%82%E5%9C%BA%E5%88%86%E6%9E%90-I-I"><span class="toc-number">1.1.3.33.</span> <span class="toc-text">1159.市场分析 I I</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1174-%E5%8D%B3%E6%97%B6%E9%A3%9F%E7%89%A9%E9%85%8D%E9%80%81%E2%85%A1"><span class="toc-number">1.1.3.34.</span> <span class="toc-text">1174.即时食物配送Ⅱ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1179-%E9%87%8D%E6%96%B0%E6%A0%BC%E5%BC%8F%E5%8C%96%E9%83%A8%E9%97%A8%E8%A1%A8-%E8%A1%8C%E8%BD%AC%E5%88%97"><span class="toc-number">1.1.3.35.</span> <span class="toc-text">1179.重新格式化部门表 行转列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1193-%E6%AF%8F%E6%9C%88%E4%BA%A4%E6%98%93-date-format-left-sub-string"><span class="toc-number">1.1.3.36.</span> <span class="toc-text">1193.每月交易| date_format(),left(),sub_string()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1194-%E9%94%A6%E6%A0%87%E8%B5%9B%E4%BC%98%E8%83%9C%E8%80%85-%E5%88%97%E8%BD%AC%E8%A1%8C"><span class="toc-number">1.1.3.37.</span> <span class="toc-text">1194.锦标赛优胜者 列转行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1204-%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E8%83%BD%E8%BF%9B%E5%85%A5%E5%B7%B4%E5%A3%AB%E7%9A%84%E4%BA%BA"><span class="toc-number">1.1.3.38.</span> <span class="toc-text">1204.最后一个能进入巴士的人</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1205-%E6%AF%8F%E6%9C%88%E4%BA%A4%E6%98%93-count-1-count-null-sum-0"><span class="toc-number">1.1.3.39.</span> <span class="toc-text">1205.每月交易 | count(1),count(null),sum(0)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1212-%E6%9F%A5%E8%AF%A2%E7%90%83%E9%98%9F%E7%A7%AF%E5%88%86-%E5%88%97%E8%BD%AC%E8%A1%8C"><span class="toc-number">1.1.3.40.</span> <span class="toc-text">1212.查询球队积分 列转行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1225-%E6%8A%A5%E5%91%8A%E7%B3%BB%E7%BB%9F%E7%8A%B6%E6%80%81%E7%9A%84%E8%BF%9E%E7%BB%AD%E6%97%A5%E6%9C%9F"><span class="toc-number">1.1.3.41.</span> <span class="toc-text">1225.报告系统状态的连续日期</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1264-%E9%A1%B5%E9%9D%A2%E6%8E%A8%E8%8D%90"><span class="toc-number">1.1.3.42.</span> <span class="toc-text">1264.页面推荐</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1270-%E5%90%91%E5%85%AC%E5%8F%B8-CEO-%E6%B1%87%E6%8A%A5%E5%B7%A5%E4%BD%9C%E7%9A%84%E6%89%80%E6%9C%89%E4%BA%BA-%E9%9A%BE"><span class="toc-number">1.1.3.43.</span> <span class="toc-text">1270.向公司 CEO 汇报工作的所有人 难</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1280-%E5%AD%A6%E7%94%9F%E4%BB%AC%E5%8F%82%E5%8A%A0%E5%90%84%E7%A7%91%E6%B5%8B%E8%AF%95%E7%9A%84%E6%AC%A1%E6%95%B0-ifnull-%E6%9E%84%E9%80%A0%E8%A1%8C"><span class="toc-number">1.1.3.44.</span> <span class="toc-text">1280.学生们参加各科测试的次数 ifnull 构造行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1285-%E6%89%BE%E5%88%B0%E8%BF%9E%E7%BB%AD%E5%8C%BA%E9%97%B4%E7%9A%84%E5%BC%80%E5%A7%8B%E5%92%8C%E7%BB%93%E6%9D%9F%E6%95%B0%E5%AD%97"><span class="toc-number">1.1.3.45.</span> <span class="toc-text">1285.找到连续区间的开始和结束数字</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1321-%E9%A4%90%E9%A6%86%E8%90%A5%E4%B8%9A%E9%A2%9D%E5%8F%98%E5%8C%96%E5%A2%9E%E9%95%BF-range-row-between-and"><span class="toc-number">1.1.3.46.</span> <span class="toc-text">1321.餐馆营业额变化增长 range  row between and</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1322-%E5%B9%BF%E5%91%8A%E6%95%88%E6%9E%9C-SUM-action-%E2%80%98xxx%E2%80%99"><span class="toc-number">1.1.3.47.</span> <span class="toc-text">1322.广告效果 SUM(action &#x3D; ‘xxx’)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1336-%E6%AF%8F%E6%AC%A1%E8%AE%BF%E9%97%AE%E7%9A%84%E4%BA%A4%E6%98%93%E6%AC%A1%E6%95%B0-%E9%9A%BE-%E5%BA%94%E8%AF%A5%E6%98%AF%E6%B2%A1%E8%AF%BB%E6%87%82%E9%A2%98%E7%9B%AE%E6%84%8F%E6%80%9D"><span class="toc-number">1.1.3.48.</span> <span class="toc-text">1336.每次访问的交易次数 难 应该是没读懂题目意思</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1369-%E8%8E%B7%E5%8F%96%E6%9C%80%E8%BF%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E7%9A%84%E6%B4%BB%E5%8A%A8"><span class="toc-number">1.1.3.49.</span> <span class="toc-text">1369.获取最近第二次的活动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1384-%E6%8C%89%E5%B9%B4%E5%BA%A6%E5%88%97%E5%87%BA%E9%94%80%E5%94%AE%E6%80%BB%E9%A2%9D-%E9%9A%BE"><span class="toc-number">1.1.3.50.</span> <span class="toc-text">1384.按年度列出销售总额 难</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1412-%E6%9F%A5%E6%89%BE%E6%88%90%E7%BB%A9%E5%A4%84%E4%BA%8E%E4%B8%AD%E6%B8%B8%E7%9A%84%E5%AD%A6%E7%94%9F"><span class="toc-number">1.1.3.51.</span> <span class="toc-text">1412.查找成绩处于中游的学生</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1435-%E5%88%B6%E4%BD%9C%E4%BC%9A%E8%AF%9D%E6%9F%B1%E7%8A%B6%E5%9B%BE"><span class="toc-number">1.1.3.52.</span> <span class="toc-text">1435.制作会话柱状图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1440-%E8%AE%A1%E7%AE%97%E5%B8%83%E5%B0%94%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%80%BC"><span class="toc-number">1.1.3.53.</span> <span class="toc-text">1440.计算布尔表达式的值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1454-%E6%B4%BB%E8%B7%83%E7%94%A8%E6%88%B7"><span class="toc-number">1.1.3.54.</span> <span class="toc-text">1454.活跃用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1479-%E5%91%A8%E5%86%85%E6%AF%8F%E5%A4%A9%E7%9A%84%E9%94%80%E5%94%AE%E6%83%85%E5%86%B5"><span class="toc-number">1.1.3.55.</span> <span class="toc-text">1479.周内每天的销售情况</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1484-%E6%8C%89%E6%97%A5%E6%9C%9F%E5%88%86%E7%BB%84%E9%94%80%E5%94%AE%E4%BA%A7%E5%93%81-group-concat"><span class="toc-number">1.1.3.56.</span> <span class="toc-text">1484.按日期分组销售产品 group_concat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1517-%E6%9F%A5%E6%89%BE%E6%8B%A5%E6%9C%89%E6%9C%89%E6%95%88%E9%82%AE%E7%AE%B1%E7%9A%84%E7%94%A8%E6%88%B7-regexp-REGEXP-LIKE-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">1.1.3.57.</span> <span class="toc-text">1517.查找拥有有效邮箱的用户 regexp REGEXP_LIKE 正则表达式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1527-%E6%82%A3%E6%9F%90%E7%A7%8D%E7%96%BE%E7%97%85%E7%9A%84%E6%82%A3%E8%80%85-like-REGEXP"><span class="toc-number">1.1.3.58.</span> <span class="toc-text">1527.患某种疾病的患者 like REGEXP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1613-%E6%89%BE%E5%88%B0%E9%81%97%E5%A4%B1%E7%9A%84ID-%E9%80%92%E5%BD%92-recursive"><span class="toc-number">1.1.3.59.</span> <span class="toc-text">1613.找到遗失的ID 递归 recursive</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1635-Hopper-%E5%85%AC%E5%8F%B8%E6%9F%A5%E8%AF%A2-recursive"><span class="toc-number">1.1.3.60.</span> <span class="toc-text">1635.Hopper 公司查询! recursive</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1651-Hopper-%E5%85%AC%E5%8F%B8%E6%9F%A5%E8%AF%A2-%E5%B7%9D-RECURSIVE-OVER-ROWS-BETWEEN"><span class="toc-number">1.1.3.61.</span> <span class="toc-text">1651.Hopper 公司查询 川 RECURSIVE OVER (ROWS BETWEEN)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1661-%E6%AF%8F%E5%8F%B0%E6%9C%BA%E5%99%A8%E7%9A%84%E8%BF%9B%E7%A8%8B%E5%B9%B3%E5%9D%87%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4"><span class="toc-number">1.1.3.62.</span> <span class="toc-text">1661.每台机器的进程平均运行时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1667-%E4%BF%AE%E5%A4%8D%E8%A1%A8%E4%B8%AD%E7%9A%84%E5%90%8D%E5%AD%97-concat-left-right-upper-lower"><span class="toc-number">1.1.3.63.</span> <span class="toc-text">1667.修复表中的名字 concat left right upper lower</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1683-%E6%97%A0%E6%95%88%E7%9A%84%E6%8E%A8%E6%96%87"><span class="toc-number">1.1.3.64.</span> <span class="toc-text">1683.无效的推文</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1709-%E8%AE%BF%E9%97%AE%E6%97%A5%E6%9C%9F%E4%B9%8B%E9%97%B4%E6%9C%80%E5%A4%A7%E7%9A%84%E7%A9%BA%E6%A1%A3%E6%9C%9F-LEAD-xxx-OVER-partition-by"><span class="toc-number">1.1.3.65.</span> <span class="toc-text">1709.访问日期之间最大的空档期  LEAD(xxx) OVER(partition by)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1972-%E5%90%8C%E4%B8%80%E5%A4%A9%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%94%B5%E8%AF%9D%E5%92%8C%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E7%94%B5%E8%AF%9D-%E9%9A%BE"><span class="toc-number">1.1.3.66.</span> <span class="toc-text">1972  同一天的第一个电话和最后一个电话 难</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql%E6%B3%A8%E9%87%8A%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.3.66.1.</span> <span class="toc-text">mysql注释问题</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql%E4%BF%AE%E6%94%B9%E5%88%97%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.1.3.66.2.</span> <span class="toc-text">mysql修改列数据类型</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1988"><span class="toc-number">1.1.3.67.</span> <span class="toc-text">1988</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1990"><span class="toc-number">1.1.3.68.</span> <span class="toc-text">1990</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2004"><span class="toc-number">1.1.3.69.</span> <span class="toc-text">2004</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2020-%E7%AE%80%E5%8D%95"><span class="toc-number">1.1.3.70.</span> <span class="toc-text">2020 简单</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2026-%E7%AE%80%E5%8D%95"><span class="toc-number">1.1.3.71.</span> <span class="toc-text">2026 简单</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2041-%E7%AE%80%E5%8D%95"><span class="toc-number">1.1.3.72.</span> <span class="toc-text">2041 简单</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2051"><span class="toc-number">1.1.3.73.</span> <span class="toc-text">2051</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3421-%E6%9F%A5%E6%89%BE%E8%BF%9B%E6%AD%A5%E7%9A%84%E5%AD%A6%E7%94%9F"><span class="toc-number">1.1.3.74.</span> <span class="toc-text">3421.查找进步的学生</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3436-%E6%9F%A5%E6%89%BE%E5%90%88%E6%B3%95%E9%82%AE%E7%AE%B1-regexp"><span class="toc-number">1.1.3.75.</span> <span class="toc-text">3436.查找合法邮箱 regexp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3451-%E6%9F%A5%E6%89%BE%E6%97%A0%E6%95%88%E7%9A%84-IP-%E5%9C%B0%E5%9D%80-substring-index-cast-regepx-replace"><span class="toc-number">1.1.3.76.</span> <span class="toc-text">3451.查找无效的 IP 地址  substring_index cast regepx replace</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3465-%E6%9F%A5%E6%89%BE%E5%85%B7%E6%9C%89%E6%9C%89%E6%95%88%E5%BA%8F%E5%88%97%E5%8F%B7%E7%9A%84%E4%BA%A7%E5%93%81-REGEXP"><span class="toc-number">1.1.3.77.</span> <span class="toc-text">3465.查找具有有效序列号的产品 REGEXP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3475-DNA-%E6%A8%A1%E5%BC%8F%E8%AF%86%E5%88%AB-REGEXP-LIKE-LEFT-RIGHT-INSTR-regexp-like"><span class="toc-number">1.1.3.78.</span> <span class="toc-text">3475.DNA 模式识别  REGEXP LIKE LEFT RIGHT INSTR regexp_like</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3482-%E5%88%86%E6%9E%90%E7%BB%84%E7%BB%87%E5%B1%82%E7%BA%A7-%E9%80%92%E5%BD%92"><span class="toc-number">1.1.3.79.</span> <span class="toc-text">3482.分析组织层级 递归</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3554-%E6%9F%A5%E6%89%BE%E7%B1%BB%E5%88%AB%E6%8E%A8%E8%8D%90%E5%AF%B9"><span class="toc-number">1.1.3.80.</span> <span class="toc-text">3554.查找类别推荐对</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3564-%E5%AD%A3%E8%8A%82%E6%80%A7%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90"><span class="toc-number">1.1.3.81.</span> <span class="toc-text">3564.季节性销售分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3580-%E5%AF%BB%E6%89%BE%E6%8C%81%E7%BB%AD%E8%BF%9B%E6%AD%A5%E7%9A%84%E5%91%98%E5%B7%A5"><span class="toc-number">1.1.3.82.</span> <span class="toc-text">3580.寻找持续进步的员工</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3586-%E5%AF%BB%E6%89%BE-COVID-%E5%BA%B7%E5%A4%8D%E6%82%A3%E8%80%85"><span class="toc-number">1.1.3.83.</span> <span class="toc-text">3586.寻找 COVID 康复患者</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%A7%AF%E7%B4%AF"><span class="toc-number">1.1.4.</span> <span class="toc-text">常用积累</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Delete"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">Delete</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1"><span class="toc-number">1.1.4.1.1.</span> <span class="toc-text">1</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E7%9B%B8%E5%85%B3"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">日期相关</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#DATEDIFF"><span class="toc-number">1.1.4.2.1.</span> <span class="toc-text">DATEDIFF()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#TIMESTAMPDIFF-NOW"><span class="toc-number">1.1.4.2.2.</span> <span class="toc-text">TIMESTAMPDIFF()  |  NOW()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#DATE-FORMAT"><span class="toc-number">1.1.4.2.3.</span> <span class="toc-text">DATE_FORMAT()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#DATE-ADD"><span class="toc-number">1.1.4.2.4.</span> <span class="toc-text">DATE_ADD()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CURDATE-%EF%BC%8CNOW"><span class="toc-number">1.1.4.2.5.</span> <span class="toc-text">CURDATE()，NOW()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#month-week-year"><span class="toc-number">1.1.4.2.6.</span> <span class="toc-text">month(),week(),year()</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lag-%E3%80%81lead-%E3%80%81with"><span class="toc-number">1.1.4.3.</span> <span class="toc-text">lag()、lead()、with</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#with%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.1.4.3.1.</span> <span class="toc-text">with语句</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#roud-%E3%80%81if"><span class="toc-number">1.1.4.4.</span> <span class="toc-text">roud()、if()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#limit"><span class="toc-number">1.1.4.5.</span> <span class="toc-text">limit()</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0"><span class="toc-number">1.1.4.5.1.</span> <span class="toc-text">一个参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%A4%E4%B8%AA%E5%8F%82%E6%95%B0"><span class="toc-number">1.1.4.5.2.</span> <span class="toc-text">两个参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E9%A1%B5offset"><span class="toc-number">1.1.4.5.3.</span> <span class="toc-text">分页offset</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IF"><span class="toc-number">1.1.4.6.</span> <span class="toc-text">IF</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#if"><span class="toc-number">1.1.4.6.1.</span> <span class="toc-text">if()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#IFNULL-%E3%80%81NULLIF-%E3%80%81ISNULL"><span class="toc-number">1.1.4.6.2.</span> <span class="toc-text">IFNULL()、NULLIF()、ISNULL()</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%81-%E3%80%81%E3%80%81NULL%E3%80%81TRUE%E3%80%81FALSE%E3%80%81UNKNOWN%E3%80%81is-null%E3%80%81is-not-null"><span class="toc-number">1.1.4.7.</span> <span class="toc-text">&lt;&gt;、!&#x3D;、&lt;&#x3D;&gt;、NULL、TRUE、FALSE、UNKNOWN、is null、is not null</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF%E3%80%81CROSS-JOIN"><span class="toc-number">1.1.4.8.</span> <span class="toc-text">笛卡尔积、CROSS JOIN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#WITH"><span class="toc-number">1.1.4.9.</span> <span class="toc-text">WITH</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mod-M-N"><span class="toc-number">1.1.4.10.</span> <span class="toc-text">mod(M,N)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#substring"><span class="toc-number">1.1.4.11.</span> <span class="toc-text">substring()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#group-by-%E6%96%B0%E5%A5%87"><span class="toc-number">1.1.4.12.</span> <span class="toc-text">group by 新奇</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F"><span class="toc-number">1.1.4.13.</span> <span class="toc-text">自定义变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.4.14.</span> <span class="toc-text">窗口函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#rows-between-and"><span class="toc-number">1.1.4.14.1.</span> <span class="toc-text">rows between and</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#range-between-and"><span class="toc-number">1.1.4.14.2.</span> <span class="toc-text">range between and</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#dense-rank-over"><span class="toc-number">1.1.4.14.3.</span> <span class="toc-text">dense_rank() over</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#avg-x-over"><span class="toc-number">1.1.4.14.4.</span> <span class="toc-text">avg(x) over()</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CASE"><span class="toc-number">1.1.4.15.</span> <span class="toc-text">CASE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GROUP-CONCAT"><span class="toc-number">1.1.4.16.</span> <span class="toc-text">GROUP_CONCAT()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F-REGEXP-regexp-like"><span class="toc-number">1.1.4.17.</span> <span class="toc-text">正则表达式 REGEXP  regexp_like</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-number">1.1.4.18.</span> <span class="toc-text">||</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ONLY-FULL-GROUP-BY"><span class="toc-number">1.1.4.19.</span> <span class="toc-text">ONLY_FULL_GROUP_BY</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%8C%E8%BD%AC%E5%88%97%E3%80%81%E5%88%97%E8%BD%AC%E8%A1%8C"><span class="toc-number">1.1.4.20.</span> <span class="toc-text">行转列、列转行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A6%E5%8F%B3%E5%A4%96%E8%BF%9E%E6%8E%A5%E5%BD%93%E8%BF%9E%E6%8E%A5%E9%94%AE%E4%B8%8D%E5%94%AF%E4%B8%80%E6%97%B6"><span class="toc-number">1.1.4.21.</span> <span class="toc-text">左右外连接当连接键不唯一时</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql%E5%85%A8%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.1.4.22.</span> <span class="toc-text">mysql全外连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#union%E5%92%8Cunion-all"><span class="toc-number">1.1.4.23.</span> <span class="toc-text">union和union all</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#limit-1"><span class="toc-number">1.1.4.24.</span> <span class="toc-text">limit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#where-player-id-event-date-in-select-a-b"><span class="toc-number">1.1.4.25.</span> <span class="toc-text">where (player_id, event_date) in select a,b</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#order-by%E5%92%8Climit%E4%B8%80%E8%B5%B7%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.1.4.26.</span> <span class="toc-text">order by和limit一起使用注意事项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sqrt-%E5%BC%80%E5%B9%B3%E6%96%B9"><span class="toc-number">1.1.4.27.</span> <span class="toc-text">sqrt()开平方</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#count-count-0-count-1"><span class="toc-number">1.1.4.28.</span> <span class="toc-text">count(**)\count(*0)\count(1)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ABS-p1-x-value-p2-x-value"><span class="toc-number">1.1.4.29.</span> <span class="toc-text">ABS(p1.x_value - p2.x_value)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UPPER-LOWER-CONCAT-group-concat"><span class="toc-number">1.1.4.30.</span> <span class="toc-text">UPPER LOWER CONCAT group_concat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TRIM"><span class="toc-number">1.1.4.31.</span> <span class="toc-text">TRIM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#left-right-instr"><span class="toc-number">1.1.4.32.</span> <span class="toc-text">left right instr</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%92%E5%BD%92-recursive-%E9%A2%98%E7%9B%AE1613-1270-3482"><span class="toc-number">1.1.4.33.</span> <span class="toc-text">递归 recursive 题目1613 1270 3482</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CAST-expression-AS-TYPE"><span class="toc-number">1.1.4.34.</span> <span class="toc-text">CAST(expression AS TYPE)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#substring-index"><span class="toc-number">1.1.4.35.</span> <span class="toc-text">substring_index</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#length"><span class="toc-number">1.1.4.36.</span> <span class="toc-text">length</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hbase"><span class="toc-number">1.2.</span> <span class="toc-text">Hbase</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/07/02/%E5%A4%A7%E6%95%B0%E6%8D%AE-hive/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2025/07/02/%E5%A4%A7%E6%95%B0%E6%8D%AE-hive/" title="无题">无题</a><time datetime="2025-07-02T10:28:32.791Z" title="发表于 2025-07-02 18:28:32">2025-07-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/02/%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%AE%8C%E6%95%B4%E6%80%A7%E7%BA%A6%E6%9D%9F/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2025/07/02/%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%AE%8C%E6%95%B4%E6%80%A7%E7%BA%A6%E6%9D%9F/" title="无题">无题</a><time datetime="2025-07-02T03:31:20.020Z" title="发表于 2025-07-02 11:31:20">2025-07-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/14/%E5%BB%96%E9%9B%AA%E5%B3%B0PythonJava%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2025/05/14/%E5%BB%96%E9%9B%AA%E5%B3%B0PythonJava%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/" title="无题">无题</a><time datetime="2025-05-14T04:06:50.987Z" title="发表于 2025-05-14 12:06:50">2025-05-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/14/%E5%BB%96%E9%9B%AA%E5%B3%B0Python/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2025/05/14/%E5%BB%96%E9%9B%AA%E5%B3%B0Python/" title="无题">无题</a><time datetime="2025-05-14T04:02:32.996Z" title="发表于 2025-05-14 12:02:32">2025-05-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/16/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0/" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/%E6%96%87%E7%AB%A0%E5%B0%81%E9%9D%A2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2025/04/16/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0/" title="无题">无题</a><time datetime="2025-04-16T02:11:28.562Z" title="发表于 2025-04-16 10:11:28">2025-04-16</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-上班摸鱼中.svg" alt="距离月入25k也就还差一个大佬带我~" title="距离月入25k也就还差一个大佬带我~"/><div id="runtimeTextTip"></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2024 - 2025 By <a class="footer-bar-link" href="/" title="智汇君" target="_blank">智汇君</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">82</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">30</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://video-b2g.pages.dev/" title="视频解析"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/视频.png" alt="视频解析"/><span class="back-menu-item-text">视频解析</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://md5-uir.pages.dev/" title="md5值解密"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/MD5.png" alt="md5值解密"/><span class="back-menu-item-text">md5值解密</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://screencheck.pages.dev/#welcome" title="屏幕坏点检查"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/屏幕外观.png" alt="屏幕坏点检查"/><span class="back-menu-item-text">屏幕坏点检查</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://htmleditor-9lo.pages.dev/" title="在线html编辑器"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/html编辑器.png" alt="在线html编辑器"/><span class="back-menu-item-text">在线html编辑器</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">博客</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://ttyong-github-io.pages.dev/" title="旧博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/博客.png" alt="旧博客"/><span class="back-menu-item-text">旧博客</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Git/" style="font-size: 0.88rem;">Git<sup>1</sup></a><a href="/tags/GitHub/" style="font-size: 0.88rem;">GitHub<sup>1</sup></a><a href="/tags/Hexo/" style="font-size: 0.88rem;">Hexo<sup>1</sup></a><a href="/tags/NodeJs/" style="font-size: 0.88rem;">NodeJs<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>3</sup></a><a href="/tags/github/" style="font-size: 0.88rem;">github<sup>1</sup></a><a href="/tags/idea/" style="font-size: 0.88rem;">idea<sup>1</sup></a><a href="/tags/%E5%85%AC%E8%80%83%E6%9D%A8%E8%80%81%E5%B8%88/" style="font-size: 0.88rem;">公考杨老师<sup>10</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 0.88rem;">博客<sup>1</sup></a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 0.88rem;">大数据<sup>27</sup></a><a href="/tags/%E5%AE%89%E7%9F%A5%E9%B1%BC%E4%B8%BB%E9%A2%98/" style="font-size: 0.88rem;">安知鱼主题<sup>1</sup></a><a href="/tags/%E5%BB%96%E9%9B%AA%E5%B3%B0/" style="font-size: 0.88rem;">廖雪峰<sup>9</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">计算机网络<sup>1</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 0.88rem;">面试<sup>12</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("24/12/2024 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2024 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 智汇君 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("24/12/2024 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-下班啦.svg";
        img.title = "下班了就该开开心心的玩耍，嘿嘿~";
        img.alt = "下班了就该开开心心的玩耍，嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script async src="https://at.alicdn.com/t/c/font_4792307_02gxbpyxcpwp.js?spm=a313x.manage_type_myprojects.i1.10.56323a81KZGFDE&amp;file=font_4792307_02gxbpyxcpwp.js# 阿里图标symbol 引用链接，主题会进行加载 symbol 引用"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>